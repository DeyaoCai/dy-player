{"version":3,"sources":["webpack://dy-player/./src/components/canvasConfig.ts","webpack://dy-player/./src/App.vue?3291","webpack://dy-player/./src/views/Index.vue?0dcf","webpack://dy-player/./src/music/Music.ts","webpack://dy-player/./src/utils.ts","webpack://dy-player/./src/units/appendStyle.ts","webpack://dy-player/./src/picture/Picture.ts","webpack://dy-player/./src/music/MusicConfig.ts","webpack://dy-player/./src/music/MusicVisualizer.ts","webpack://dy-player/./src/components/NavBar.vue?435e","webpack://dy-player/src/components/NavBar.vue","webpack://dy-player/./src/components/NavBar.vue?6ae8","webpack://dy-player/./src/components/NavBar.vue","webpack://dy-player/./src/components/MusicSearchBox.vue?8c13","webpack://dy-player/./proxy/httpConf.js","webpack://dy-player/./proxy/http.js","webpack://dy-player/./src/units/ListBox.ts","webpack://dy-player/./src/components/ListBoxView.vue?d362","webpack://dy-player/./src/components/ProgressBar.vue?4ea3","webpack://dy-player/./src/tools/Drag.ts","webpack://dy-player/src/components/ProgressBar.vue","webpack://dy-player/./src/components/ProgressBar.vue?8cec","webpack://dy-player/./src/components/ProgressBar.vue","webpack://dy-player/src/components/ListBoxView.vue","webpack://dy-player/./src/components/ListBoxView.vue?9c87","webpack://dy-player/./src/components/ListBoxView.vue","webpack://dy-player/src/components/MusicSearchBox.vue","webpack://dy-player/./src/components/MusicSearchBox.vue?84b6","webpack://dy-player/./src/components/MusicSearchBox.vue","webpack://dy-player/./src/components/MusicLocalBox.vue?3cb9","webpack://dy-player/src/components/MusicLocalBox.vue","webpack://dy-player/./src/components/MusicLocalBox.vue?ded0","webpack://dy-player/./src/components/MusicLocalBox.vue","webpack://dy-player/./src/components/ModifyBox.vue?e29d","webpack://dy-player/src/components/ModifyBox.vue","webpack://dy-player/./src/components/ModifyBox.vue?26e1","webpack://dy-player/./src/components/ModifyBox.vue","webpack://dy-player/./src/components/ThreeView.vue?9db8","webpack://dy-player/./src/tools/three/ctrl/OrbitControls.js","webpack://dy-player/./src/tools/three/jsm/loaders/3DMLoader.js","webpack://dy-player/./src/tools/three/jsm/loaders/MD2Loader.js","webpack://dy-player/./src/tools/three/jsm/libs/inflate.module.min.js","webpack://dy-player/./src/tools/three/jsm/curves/NURBSUtils.js","webpack://dy-player/./src/tools/three/jsm/curves/NURBSCurve.js","webpack://dy-player/./src/tools/three/jsm/loaders/FBXLoader.js","webpack://dy-player/./src/tools/three/jsm/loaders/TGALoader.js","webpack://dy-player/./src/components/ThreeViewUtils.ts","webpack://dy-player/src/components/ThreeView.vue","webpack://dy-player/./src/components/ThreeView.vue?d875","webpack://dy-player/./src/components/ThreeView.vue","webpack://dy-player/./src/components/CanvasView.vue?1437","webpack://dy-player/src/components/CanvasView.vue","webpack://dy-player/./src/components/CanvasView.vue?2603","webpack://dy-player/./src/components/CanvasView.vue","webpack://dy-player/./src/components/CanvasPic.vue?c525","webpack://dy-player/./src/tools/random.js","webpack://dy-player/./src/tools/PS.ts","webpack://dy-player/src/components/CanvasPic.vue","webpack://dy-player/./src/components/CanvasPic.vue?d12d","webpack://dy-player/./src/components/CanvasPic.vue","webpack://dy-player/./src/components/CanvasTitle.vue?d31c","webpack://dy-player/src/components/CanvasTitle.vue","webpack://dy-player/./src/components/CanvasTitle.vue?2055","webpack://dy-player/./src/components/CanvasTitle.vue","webpack://dy-player/./src/components/CanvasText.vue?de39","webpack://dy-player/src/components/CanvasText.vue","webpack://dy-player/./src/components/CanvasText.vue?b20f","webpack://dy-player/./src/components/CanvasText.vue","webpack://dy-player/./src/components/VideoView.vue?2e43","webpack://dy-player/src/components/VideoView.vue","webpack://dy-player/./src/components/VideoView.vue?42bf","webpack://dy-player/./src/components/VideoView.vue","webpack://dy-player/./src/components/DomClock.vue?905b","webpack://dy-player/./src/tools/Time.ts","webpack://dy-player/./src/components/DomClockItem.vue?e6aa","webpack://dy-player/src/components/DomClockItem.vue","webpack://dy-player/./src/components/DomClockItem.vue?36ab","webpack://dy-player/./src/components/DomClockItem.vue","webpack://dy-player/src/components/DomClock.vue","webpack://dy-player/./src/components/DomClock.vue?6d8e","webpack://dy-player/./src/components/DomClock.vue","webpack://dy-player/./src/components/GameUI.vue?911a","webpack://dy-player/src/components/GameUI.vue","webpack://dy-player/./src/components/GameUI.vue?5b9a","webpack://dy-player/./src/components/GameUI.vue","webpack://dy-player/src/views/Index.vue","webpack://dy-player/./src/views/Index.vue?0a0f","webpack://dy-player/./src/views/Index.vue","webpack://dy-player/src/App.vue","webpack://dy-player/./src/App.vue?b170","webpack://dy-player/./src/App.vue","webpack://dy-player/./src/registerServiceWorker.ts","webpack://dy-player/./src/main.ts","webpack://dy-player/./src/tools/DomUtil.ts","webpack://dy-player/./src/tools/GetType.ts","webpack://dy-player/./src/tools/ListEqual.ts","webpack://dy-player/./src/tools/ShortCut.ts","webpack://dy-player/./src/tools/Sound.ts","webpack://dy-player/webpack/bootstrap","webpack://dy-player/webpack/runtime/chunk loaded","webpack://dy-player/webpack/runtime/compat get default export","webpack://dy-player/webpack/runtime/define property getters","webpack://dy-player/webpack/runtime/global","webpack://dy-player/webpack/runtime/hasOwnProperty shorthand","webpack://dy-player/webpack/runtime/make namespace object","webpack://dy-player/webpack/runtime/jsonp chunk loading","webpack://dy-player/webpack/startup"],"names":["TrackItem","trackList","key","name","defValue","value","valueType","min","max","desc","this","setVal","val","savePresets","Track","defaultValue","constructor","name_","current","playing","list","commonConfigs","forEach","item","defaultVal","push","undefined","Object","defineProperty","get","console","log","length","configName","index","len","play","setIndex","thisItem","enc","dec","setMin","setMax","reset","createTrackClass","className","string","eval","trackConfigs","required","multiple","biquadFilterFrequency","balanceTrackConfigs","map","ModifyManager","updateCommonOptions","setList","TrackList","init","find","exportPresets","presets","importPresets","replacer","splice","replace","prev","next","add","call","arguments","delete","copy","createALink","data","fileName","parentNode","blob","Blob","type","url","URL","createObjectURL","link","href","download","document","body","parent","loadPresets","constructorList","constructorName","hasDto","some","i","options","TrackClass","config","filter","includes","item_","curVal","location","reload","result","$a","JSON","stringify","click","localStorage","setItem","parse","getItem","hasDot","e","track","conf","setConfig","render","_vm","_h","$createElement","_c","_self","attrs","staticRenderFns","staticClass","commonOptions","_e","_l","modifyManager","CanvasView","musicData","realTimeData","EventTarget_","callback","listeners","stack","l","removeEventListener","event","target","MusicDataFlags","RhythmPoint","vol","isRhythmPoint","EventTar","fnMap","ev","fns","MVData","soundTrackArr","prevAvrLevel","prevAddSpeed","total","reduce","a","b","avrLevel","addSpeed","RhythmPointVolumeFloatRange","getTrackByName","getVal","rhythmPoint","shockNum","Event","dispatchEvent","soundTrackArrMaxLen","shift","MusicData","originData","GameScore","score","gameScore","DomUtil","classList","innerHTML","toString","prevNode","GameCombo","combo","GameNode","gameList","isDebug","gameInner","calculateScore","Date","now","remove","time","dom","style","hueRange","deg","innerDom","addEventListener","endFunction","currentTime","Math","abs","delay","setCurrentScore","Sound","GameList","mv","delayTime","ended","currentScore","totalScore","maxCombo","missCount","uselessCount","isStop","isMiss","setCombo","buffer","gameNode","indexOf","eventTarget","GameScene","gameData","x","per","join","destroy","UniqueList","findIndex","id","Color","round","rate","r","g","dCompose","MakeThrottle","prevTime","propertyKey","descriptor","fn","apply","appendStyle","compName","styleStr","forceUpdate","cacheMap","createElement","head","appendChild","canvas","pciCanvas","Picture","musicConfig","compressRate","ctx","getContext","cacheList","cacheImg","img","onload","setImage","src","width","height","drawImage","imageData","getImageData","color","aviOfArr","noNeedChangeCurrentImgAviColor","currentImgAviColor","makeEl","test","offsetWidth","offsetHeight","pciCtx","y","w","h","sumOfArr","arr","sum","num","MusicConfig","_x","_y","_main","main","images","imageGroup","pictureCanvasCtx","setPictureCanvasCtx","currentImgSrc","changePic","mouseMoveConf","enent","touches","clientX","clientY","keys","lrc","reverse","unshift","pop","shockAtOnce","picDom","load","shock","volume","createPanner","context","panner","ac","panningModel","distanceModel","refDistance","maxDistance","rolloffFactor","coneInnerAngle","coneOuterAngle","coneOuterGain","orientationX","orientationY","orientationZ","positionX","positionY","positionZ","setOrientation","setPosition","initListener","constext","listener","forwardX","forwardY","forwardZ","upX","upY","upZ","createBiquadFilters","input","output","biquadFilters","frequency","createBiquadFilter","biquadFilter","connect","createAudioSource","$audio","source","createMediaElementSource","crossOrigin","autoplay","onended","window","dy_player_mv_cache","MusicVisualizer","obj","notClearPrev","cur","isDestoryed","destory","AudioContext","webkitAudioContext","analyser","createAnalyser","analyserBefore","gain","createGain","size","fftSize","createDelay","destination","xhr","XMLHttpRequest","draw","changeVolume","visualize","fun","stopType","abort","open","responseType","response","send","pause","suspend","arrayBuffer","decodeAudioData","err","path","n","count","stop","resetLatestPlayTime","ArrayBuffer","decode","bufferSource","createBufferSource","start","latestPlayTime","isPhone","percent","Uint8Array","frequencyBinCount","requestAnimationFrame","webkitrequestAnimationFrame","mozrequestAnimationFrame","hidden","getByteFrequencyData","setVolume","class","active","on","$event","navList","_v","_s","stopPropagation","_t","component","makeAjax","cb","then","fullUrl","protocol","hostname","fetch","encodeURI","xhrFields","withCredentials","credentials","res","json","catch","special","ajax","camel","str","split","toUpperCase","slice","httpConf","file","route","ListBox","shallPlay","focus","isFocus","itemId","directives","rawName","expression","ref","domProps","blur","composing","$set","tabs","tabItem","getImgUrl","backgroundImage","transform","song","_index","searchText","rename","touchEv","moveEv","endEv","Drag","option","direction","oriPoint","ori","pre","doNotStopWhenMatch","resetPositionWhenTouch","position","isTouching","_direction","touched","cachePosition","$el","DOMRect","getBoundingClientRect","rect","bottom","top","right","left","setEl","screenX","screenY","moved","cancelBubble","preventDefault","offset","getOffset","oriPosition","OrbitControls","object","domElement","warn","error","enabled","Vector3","minDistance","Infinity","minZoom","maxZoom","minPolarAngle","maxPolarAngle","PI","minAzimuthAngle","maxAzimuthAngle","enableDamping","dampingFactor","enableZoom","zoomSpeed","enableRotate","rotateSpeed","enablePan","panSpeed","screenSpacePanning","keyPanSpeed","autoRotate","autoRotateSpeed","enableKeys","LEFT","UP","RIGHT","BOTTOM","mouseButtons","MOUSE","MIDDLE","ONE","TOUCH","TWO","target0","clone","position0","zoom0","zoom","getPolarAngle","spherical","phi","getAzimuthalAngle","theta","saveState","scope","updateProjectionMatrix","changeEvent","update","state","STATE","NONE","quat","Quaternion","setFromUnitVectors","up","quatInverse","inverse","lastPosition","lastQuaternion","sub","applyQuaternion","setFromVector3","rotateLeft","getAutoRotationAngle","sphericalDelta","makeSafe","radius","scale","addScaledVector","panOffset","setFromSpherical","lookAt","multiplyScalar","set","zoomChanged","distanceToSquared","EPS","dot","quaternion","dispose","onContextMenu","onMouseDown","onMouseWheel","onTouchStart","onTouchEnd","onTouchMove","onMouseMove","onMouseUp","onKeyDown","startEvent","endEvent","ROTATE","DOLLY","PAN","TOUCH_ROTATE","TOUCH_PAN","TOUCH_DOLLY_PAN","TOUCH_DOLLY_ROTATE","Spherical","rotateStart","Vector2","rotateEnd","rotateDelta","panStart","panEnd","panDelta","dollyStart","dollyEnd","dollyDelta","getZoomScale","pow","angle","rotateUp","panLeft","v","distance","objectMatrix","setFromMatrixColumn","panUp","crossVectors","pan","deltaX","deltaY","element","isPerspectiveCamera","targetDistance","tan","fov","clientHeight","matrix","isOrthographicCamera","clientWidth","dollyIn","dollyScale","dollyOut","handleMouseDownRotate","handleMouseDownDolly","handleMouseDownPan","handleMouseMoveRotate","subVectors","handleMouseMoveDolly","handleMouseMovePan","handleMouseUp","handleMouseWheel","handleKeyDown","needsUpdate","keyCode","handleTouchStartRotate","pageX","pageY","handleTouchStartPan","handleTouchStartDolly","dx","dy","sqrt","handleTouchStartDollyPan","handleTouchStartDollyRotate","handleTouchMoveRotate","handleTouchMovePan","handleTouchMoveDolly","handleTouchMoveDollyPan","handleTouchMoveDollyRotate","handleTouchEnd","button","ctrlKey","metaKey","shiftKey","tabIndex","prototype","create","EventDispatcher","MapControls","Rhino3dmLoader","manager","Loader","libraryPath","libraryPending","libraryBinary","libraryConfig","workerLimit","workerPool","workerNextTaskID","workerSourceURL","workerConfig","materials","taskCache","WeakMap","assign","setLibraryPath","setWorkerLimit","onLoad","onProgress","onError","loader","FileLoader","setPath","setResponseType","setRequestHeader","requestHeader","has","cachedTask","promise","decodeObjects","debug","worker","_taskLoad","taskID","taskCost","byteLength","objectPending","_getWorker","_worker","Promise","resolve","reject","_callbacks","postMessage","message","_createGeometry","_releaseTask","_compareMaterials","material","mat","m","_mat","_createMaterial","MeshStandardMaterial","metalness","side","_diffuseColor","diffuseColor","diffusecolor","transparent","transparency","opacity","textureLoader","TextureLoader","textures","texture","image","bumpMap","alphaMap","envMap","Object3D","instanceDefinitionObjects","instanceDefinitions","instanceReferences","userData","layers","groups","settings","objects","attributes","objectType","hasOwnProperty","rMaterial","materialUUID","_object","_createObject","layer","layerIndex","visible","isInstanceDefinitionObject","iDef","j","objectIds","objId","p","idoId","iRef","geometry","parentIdefId","iRefObject","xf","xform","array","Matrix4","applyMatrix4","BufferGeometryLoader","_color","drawColor","PointsMaterial","sizeAttenuation","vertexColors","points","Points","mesh","Mesh","castShadow","castsShadows","receiveShadow","receivesShadows","brepObject","LineBasicMaterial","lines","Line","font","fontHeight","fontFace","measureText","text","textBaseline","textAlign","fillStyle","fillRect","fillText","CanvasTexture","minFilter","LinearFilter","wrapS","ClampToEdgeWrapping","wrapT","SpriteMaterial","depthTest","sprite","Sprite","point","light","isDirectionalLight","DirectionalLight","shadow","normalBias","isPointLight","PointLight","isRectangularLight","RectAreaLight","isSpotLight","SpotLight","spotAngleRadians","isLinearLight","intensity","_initLibrary","jsLoader","jsContent","binaryLoader","binaryContent","all","wasmBinary","Rhino3dmWorker","substring","lastIndexOf","Worker","_taskCosts","onmessage","sort","terminate","rhino","doc","File3dm","fromByteArray","views","namedViews","extractObjectData","materialIndex","mId","idef","idefAttributes","extractProperties","getObjectIds","textureTypes","TextureType","Diffuse","Bump","Transparency","Opacity","Emap","pbrTextureTypes","PBR_BaseColor","PBR_Subsurface","PBR_SubsurfaceScattering","PBR_SubsurfaceScatteringRadius","PBR_Metallic","PBR_Specular","PBR_SpecularTint","PBR_Roughness","PBR_Anisotropic","PBR_Anisotropic_Rotation","PBR_Sheen","PBR_SheenTint","PBR_Clearcoat","PBR_ClearcoatBump","PBR_ClearcoatRoughness","PBR_OpacityIor","PBR_OpacityRoughness","PBR_Emission","PBR_AmbientOcclusion","PBR_Displacement","_material","_pbrMaterial","physicallyBased","_texture","getTexture","textureType","getEmbeddedFileAsBase64","supported","pbMaterialProperties","_layer","_view","view","_namedView","namedView","_group","group","_geometry","_attributes","ObjectType","Curve","pts","curveToPoints","itemSize","Point","pt","PointSet","toThreejsJSON","Brep","faces","faceIndex","face","getMesh","MeshType","Any","Extrusion","TextDot","Light","InstanceReference","toFloatArray","groupCount","groupIds","getGroupList","userStringCount","userStrings","getUserStrings","property","curve","pointLimit","pointCount","rc","ts","LineCurve","pointAtStart","pointAtEnd","PolylineCurve","PolyCurve","segmentCount","segment","segmentCurve","segmentArray","concat","ArcCurve","floor","angleDegrees","NurbsCurve","degree","domain","divisions","t","tangentAt","prevTan","tS","ptS","denominator","z","acos","pointAt","RhinoModule","onRuntimeInitialized","rhino3dm","self","MD2Loader","setWithCredentials","itemError","normalData","DataView","header","headerNames","getInt32","ident","version","offset_end","BufferGeometry","uvsTemp","offset_st","num_st","u","getInt16","skinwidth","skinheight","offset_tris","vertexIndices","uvIndices","num_tris","getUint16","translation","frames","offset_frames","num_frames","getFloat32","character","getUint8","frame","String","fromCharCode","vertices","normals","num_vertices","positions","uvs","verticesTemp","normalsTemp","vertexIndex","stride","nx","ny","nz","uvIndex","setAttribute","Float32BufferAttribute","morphPositions","morphNormals","attributeName","jl","positionAttribute","normalAttribute","morphAttributes","normal","morphTargetsRelative","animations","AnimationClip","mod","aa","c","d","execScript","Uint16Array","Uint32Array","f","k","s","Number","POSITIVE_INFINITY","Array","bufferSize","bufferType","resize","A","Error","B","C","subarray","ba","ca","D","S","T","U","M","F","q","V","E","P","fa","G","H","I","J","K","L","da","ea","N","O","R","ga","Q","W","verify","ha","method","o","charCodeAt","Y","Z","$","ia","X","ADAPTIVE","BLOCK","Inflate","Zlib","NURBSUtils","findSpan","low","high","mid","calcBasisFunctions","span","saved","rv","lv","temp","calcBSplinePoint","Vector4","Nj","wNj","calcBasisFunctionDerivatives","zeroArr","ders","ndu","s1","s2","rk","pk","j1","j2","calcBSplineDerivatives","nd","du","CK","nders","Pw","calcKoverI","nom","denom","calcRationalCurveDerivatives","Pders","Aders","wders","divideScalar","calcNURBSDerivatives","calcSurfacePoint","uspan","vspan","Nu","Nv","Sw","NURBSCurve","knots","controlPoints","startKnot","endKnot","getPoint","optionalTarget","hpoint","getTangent","tangent","normalize","fbxTree","connections","sceneGraph","FBXLoader","FBXTreeParser","GeometryParser","AnimationParser","TextParser","BinaryParser","BinaryReader","littleEndian","dv","FBXTree","isFbxFormatBinary","CORRECT","convertArrayBufferToString","isFbxFormatASCII","cursor","read","getFbxVersion","versionRegExp","match","parseInt","convertFBXTimeToSeconds","LoaderUtils","FBXBuffer","FBXText","resourcePath","setCrossOrigin","parseConnections","parseImages","parseTextures","parseMaterials","deformers","parseDeformers","geometryMap","parseScene","connectionMap","Map","rawConnections","Connections","rawConnection","fromID","toID","relationship","parents","children","parentRelationship","ID","childRelationship","blobs","Objects","videoNodes","Video","nodeID","videoNode","RelativeFilename","Filename","arrayBufferContent","Content","base64Content","parseImage","filename","content","extension","toLowerCase","getHandler","textureMap","textureNodes","Texture","parseTexture","textureNode","loadTexture","attrName","wrapModeU","WrapModeU","wrapModeV","WrapModeV","valueU","valueV","RepeatWrapping","values","Scaling","repeat","currentPath","FileName","materialMap","materialNodes","Material","parseMaterial","materialNode","ShadingModel","parameters","parseParameters","MeshPhongMaterial","MeshLambertMaterial","setValues","BumpFactor","bumpScale","fromArray","DiffuseColor","DisplacementFactor","displacementScale","Emissive","emissive","EmissiveColor","EmissiveFactor","emissiveIntensity","parseFloat","ReflectionFactor","reflectivity","Shininess","shininess","Specular","specular","SpecularColor","child","aoMap","encoding","sRGBEncoding","displacementMap","emissiveMap","normalMap","mapping","EquirectangularReflectionMapping","specularMap","LayeredTexture","skeletons","morphTargets","DeformerNodes","Deformer","deformerNode","relationships","attrType","skeleton","parseSkeleton","geometryID","morphTarget","rawTargets","parseMorphTargets","deformerNodes","rawBones","boneNode","rawBone","indices","weights","transformLink","TransformLink","Indexes","Weights","bones","rawMorphTargets","morphTargetNode","rawMorphTarget","initialWeight","DeformPercent","fullWeights","FullWeights","geoID","Group","modelMap","parseModels","modelNodes","Model","model","modelNode","setLookAtProperties","parentConnections","connection","bindSkeleton","createAmbientLight","setupMorphMaterials","traverse","node","transformData","parentMatrixWorld","generateTransform","isGroup","buildSkeleton","createCamera","createLight","createMesh","createCurve","Bone","PropertyBinding","getTransformData","bone","subBone","matrixWorld","cameraAttribute","attr","NodeAttribute","CameraProjectionType","nearClippingPlane","NearPlane","farClippingPlane","FarPlane","innerWidth","innerHeight","AspectWidth","AspectHeight","aspect","FieldOfView","focalLength","FocalLength","PerspectiveCamera","setFocalLength","OrthographicCamera","lightAttribute","LightType","Intensity","CastLightOnObject","FarAttenuationEnd","EnableFarAttenuation","decay","InnerAngle","MathUtils","penumbra","OuterAngle","CastShadows","FBX_Deformer","skinning","SkinnedMesh","normalizeSkinWeights","geo","linewidth","inheritType","InheritType","eulerOrder","getEulerOrder","RotationOrder","Lcl_Translation","preRotation","PreRotation","rotation","Lcl_Rotation","postRotation","PostRotation","Lcl_Scaling","scalingOffset","ScalingOffset","scalingPivot","ScalingPivot","rotationOffset","RotationOffset","rotationPivot","RotationPivot","lookAtTarget","pos","bindMatrices","parsePoseNodes","geoRelationships","geoConnParent","bind","Skeleton","BindPoseNode","Pose","poseNodes","PoseNode","isArray","poseNode","Node","Matrix","GlobalSettings","ambientColor","AmbientColor","AmbientLight","isMesh","setupMorphMaterial","uuid","matUuid","sharedMat","clonedMat","geoNodes","Geometry","parseGeometry","geoNode","parseMeshGeometry","parseNurbsGeometry","GeometricTranslation","GeometricRotation","GeometricScaling","genGeometry","preTransform","geoInfo","parseGeoNode","buffers","genBuffers","vertex","colors","Uint16BufferAttribute","weightsIndices","vertexWeights","normalMatrix","Matrix3","getNormalMatrix","applyNormalMatrix","uvBuffer","mappingType","prevMaterialIndex","startIndex","currentIndex","addGroup","lastGroup","lastIndex","addMorphTargets","vertexPositions","Vertices","PolygonVertexIndex","LayerElementColor","parseVertexColors","LayerElementMaterial","parseMaterialIndices","LayerElementNormal","parseNormals","LayerElementUV","uv","UV","parseUVs","weightTable","weight","polygonIndex","faceLength","displayedWeightsWarning","facePositionIndexes","faceNormals","faceColors","faceUVs","faceWeights","faceWeightIndices","polygonVertexIndex","endOfFace","weightIndices","getData","wt","wIndex","Weight","weightIndex","currentWeight","comparedWeight","comparedWeightIndex","comparedWeightArray","tmp","genFace","parentGeo","parentGeoNode","rawTarget","morphGeoNode","genMorphGeometry","morphPositionsSparse","Float32Array","morphIndex","morphGeoInfo","morphBuffers","NormalNode","MappingInformationType","referenceType","ReferenceInformationType","Normals","indexBuffer","NormalIndex","NormalsIndex","dataSize","UVNode","UVIndex","ColorNode","Colors","ColorIndex","MaterialNode","materialIndexBuffer","Materials","materialIndices","order","Order","isNaN","KnotVector","pointsValues","Form","getPoints","toArray","BufferAttribute","animationClips","rawClips","parseClips","rawClip","clip","addClip","AnimationCurve","curveNodesMap","parseAnimationCurveNodes","parseAnimationCurves","layersMap","parseAnimationLayers","parseAnimStacks","rawCurveNodes","AnimationCurveNode","rawCurveNode","curveNode","curves","rawCurves","animationCurve","times","KeyTime","KeyValueFloat","animationCurveID","animationCurveRelationship","rawLayers","AnimationLayer","layerCurveNodes","modelID","rawModel","modelName","initialPosition","initialRotation","initialScale","morph","deformerID","morpherID","morphName","rawStacks","AnimationStack","tracks","rawTracks","generateTracks","decompose","Euler","setFromQuaternion","positionTrack","generateVectorTrack","rotationTrack","generateRotationTrack","scaleTrack","morphTrack","generateMorphTrack","initialValue","getTimesForAllAxes","getKeyframeTrackValues","VectorKeyframeTrack","interpolateRotations","setFromEuler","euler","quaternionValues","premultiply","multiply","QuaternionKeyframeTrack","morphNum","getObjectByName","morphTargetDictionary","NumberKeyframeTrack","elem","prevValue","xIndex","yIndex","zIndex","xValue","yValue","zValue","valuesSpan","absoluteSpan","numSubIntervals","step","nextValue","initialTime","timeSpan","interval","nextTime","interpolatedTimes","interpolatedValues","inject","getPrevNode","nodeStack","currentIndent","getCurrentNode","getCurrentProp","currentProp","pushStack","popStack","setCurrentProp","currentPropName","allNodes","line","matchComment","matchEmpty","matchBeginning","matchProperty","matchEnd","parseNodeBegin","parseNodeProperty","parseNodePropertyContinued","nodeName","trim","nodeAttrs","parseNodeAttr","currentNode","contentLine","propName","propValue","parentName","connProps","from","to","rest","append","parseNumberArray","parseNodeSpecialProperty","props","prop","innerPropName","innerPropType1","innerPropType2","innerPropFlag","innerPropValue","reader","skip","getUint32","endOfContent","parseNode","endOffset","getUint64","numProperties","nameLen","getString","propertyList","parseProperty","singleProperty","subNode","parseSubNode","getBoolean","getFloat64","getInt64","getArrayBuffer","arrayLength","compressedLength","getBooleanArray","getFloat64Array","getFloat32Array","getInt32Array","getInt64Array","inflate","reader2","decompress","nullByte","dataArray","infoObject","tempEuler","tempVec","lTranslationM","lPreRotationM","lRotationM","lPostRotationM","lScalingM","lScalingPivotM","lScalingOffsetM","lRotationOffsetM","lRotationPivotM","lParentGX","lGlobalT","makeRotationFromEuler","lLRM","lParentGRM","extractRotation","lParentTM","copyPosition","lParentGSM","getInverse","lGlobalRS","lParentLSM_inv","lParentGSM_noLocal","lRotationPivotM_inv","lScalingPivotM_inv","lTransform","lLocalTWithAllPivotAndOffsetInfo","lGlobalTranslation","enums","a1","a2","TGALoader","tgaCheckHeader","image_type","TGA_TYPE_INDEXED","TGA_TYPE_RLE_INDEXED","colormap_length","colormap_size","colormap_type","TGA_TYPE_RGB","TGA_TYPE_GREY","TGA_TYPE_RLE_RGB","TGA_TYPE_RLE_GREY","TGA_TYPE_NO_DATA","pixel_size","tgaParse","use_rle","use_pal","pixel_data","pixel_total","palettes","pixels","tgaGetImageData8bits","y_start","y_step","y_end","x_start","x_step","x_end","colormap","tgaGetImageData16bits","tgaGetImageData24bits","tgaGetImageData32bits","tgaGetImageDataGrey8bits","tgaGetImageDataGrey16bits","getTgaRGBA","palette","flags","TGA_ORIGIN_MASK","TGA_ORIGIN_SHIFT","TGA_ORIGIN_UL","TGA_ORIGIN_BL","TGA_ORIGIN_UR","TGA_ORIGIN_BR","use_grey","id_length","colormap_index","origin","useOffscreen","OffscreenCanvas","createImageData","putImageData","ThreeViewUtils","scene","cubes","directions","currentPosi","cube","circles","perDeg","data_","circle","sin","cos","sphere","Random","max_","min_","sign_","exec","GetType","unique","int","boolean","random","sign","aisleMap","PS","aisleType","cutType","ret","cutFnMap","xOffset","yOffset","aisleData","getAisle","1","2","3","handelEnded","list_","index_","Time","stamp","getFullYear","to00","getMonth","getDate","getHours","getMinutes","getSeconds","to000","getMilliseconds","formConfig","label","ready","registered","cached","updatefound","updated","offline","IsPhone","navigator","userAgent","App","$mount","sDom","eDom","sDom_","eDom_","hasChild","nodeType","childNodes","every","isEmptyTag","textContent","isTag","tagName","targetTagNames","endAt","tag","newNode","removeChild","targetType","contains","createTextNode","template","oldDom","newDom","insertBefore","nextSibling","isTagNode","textNode","end","start_","mid_","end_","nodeValue","insertAfter","getType","findEqualByKey","deleteEqualByKey","replaceEqualByKey","concatListEqual","lists","subLists","ListEqual","keyMap","keyMap_","ShortCutAbstract","keyNum","makeShortCutInitFn","ShortCut","maps","describeMaps","wrap","triggered","slef","$body","querySelector","hasInited","altKey","which","describeMaps_","cmd","cacheTriggered","setTimeout","triggeredCacheLength","toast","shortCut","soundMap","change","confirm","done","warning","CacheList","playEnd","getAudio","volumeMap","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","deferred","chunkIds","priority","notFulfilled","fulfilled","getter","__esModule","definition","enumerable","globalThis","Function","Symbol","toStringTag","installedChunks","143","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","chunkLoadingGlobal","__webpack_exports__"],"mappings":"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","file":"js/app.6d71ac64.js","sourcesContent":["import {DomUtil} from \"@/tools/DomUtil\";\r\nimport {GetType} from \"@/tools/GetType\";\r\nimport {ListEqual} from \"@/tools/ListEqual\";\r\n\r\ninterface ITrackListItem {\r\n  key: string;\r\n  name: string;\r\n  defValue: number;\r\n  value: number;\r\n  valueType: string;\r\n  min: number;\r\n  max: number;\r\n  desc: string;\r\n}\r\nclass TrackItem implements ITrackListItem{\r\n\r\n  key: string;\r\n  name: string;\r\n  defValue: number;\r\n  value: number;\r\n  valueType: string;\r\n  min: number;\r\n  max: number;\r\n  desc: string;\r\n  trackList: TrackList;\r\n\r\n  constructor(trackList: TrackList, key: string, name: string, defValue: number, value: number, valueType: string, min: number, max: number, desc: string) {\r\n    this.trackList = trackList;\r\n    this.key = key;\r\n    this.name = name;\r\n    this.defValue = defValue;\r\n    this.value = value;\r\n    this.valueType = valueType;\r\n    this.min = min;\r\n    this.max = max;\r\n    this.desc = desc;\r\n  }\r\n\r\n  public enc() {\r\n    this.setVal(this.value + 1);\r\n    return this;\r\n  }\r\n\r\n  public dec() {\r\n    this.setVal(this.value - 1);\r\n    return this;\r\n  }\r\n  public setMin(){\r\n    this.setVal(this.min);\r\n    return this;\r\n  }\r\n  public setMax(){\r\n    this.setVal(this.max);\r\n    return this;\r\n  }\r\n  public setVal (val: number){\r\n    if (val > this.max) val = this.max;\r\n    if (val < this.min) val = this.min;\r\n    this.value = val;\r\n    this.trackList.savePresets('');\r\n    return this;\r\n  }\r\n  public reset(){\r\n    this.setVal(this.defValue);\r\n    return this;\r\n  }\r\n}\r\n\r\nexport class Track {\r\n  static commonConfigs: { [index: string]: [string, string, number, string, number, number, string][] } = {};\r\n  static name_ = 'Track';\r\n\r\n  trackList: TrackList;\r\n  current: number;\r\n  playing: number;\r\n  list: TrackItem[];\r\n  name: string;\r\n  constructor(name: string, trackList: TrackList, defaultValue: { [index: string]: number } = {}) {\r\n    // @ts-ignore;\r\n    this.name = (name || this.constructor.name_);\r\n    this.current = 0;\r\n    this.playing = 0;\r\n    this.trackList = trackList;\r\n    this.list = [];\r\n    // @ts-ignore; // this.constructor.name_ 由于代码混淆导致 this.constructor.name 与预期不符， 故手动设置\r\n    Track.commonConfigs[this.constructor.name_].forEach(item => {\r\n      const [key, name, defValue, valueType, min, max, desc] = item;\r\n      const defaultVal = defaultValue[key];\r\n      this.list.push(new TrackItem(trackList, key, name, defValue, defaultVal !== undefined ? defaultVal : defValue, valueType, min, max, desc));\r\n    });\r\n\r\n    this.list.forEach(item => {\r\n      Object.defineProperty(this, item.key, {\r\n        get() {\r\n          return item.value;\r\n        },\r\n      });\r\n    });\r\n  }\r\n\r\n  rename(name: string){\r\n    console.log(name)\r\n    this.name = name;\r\n    this.trackList.savePresets('');\r\n  }\r\n  get len() {\r\n    return this.list.length\r\n  }\r\n  public getVal(configName: string){\r\n    return ListEqual.findByKey(this.list, configName).value;\r\n  }\r\n\r\n  // 设置轨道\r\n  public setIndex(index: number) {\r\n    if (index > this.len - 1) index = this.len - 1;\r\n    if (index < 0) index = 0;\r\n    this.current = index;\r\n    this.play();\r\n    return this;\r\n  }\r\n\r\n  // 设置轨道， 打开轨道编辑器\r\n  public play() {\r\n    this.playing = this.current;\r\n    return this;\r\n  }\r\n\r\n  public prev() {\r\n    this.setIndex((this.current - 1 + this.len) % this.len);\r\n    return this;\r\n  }\r\n\r\n  public next() {\r\n    this.setIndex((this.current + 1) % this.len);\r\n    return this;\r\n  }\r\n\r\n  public enc() {\r\n    const thisItem = this.list[this.current];\r\n    thisItem.enc();\r\n    return this;\r\n  }\r\n\r\n  public dec() {\r\n    const thisItem = this.list[this.current];\r\n    thisItem.dec();\r\n    return this;\r\n  }\r\n  setMin(){\r\n    const thisItem = this.list[this.current];\r\n    thisItem.setMin();\r\n    return this;\r\n  }\r\n  setMax(){\r\n    const thisItem = this.list[this.current];\r\n    thisItem.setMax();\r\n    return this;\r\n  }\r\n  public setVal (val: number){\r\n    const thisItem = this.list[this.current];\r\n    thisItem.setVal(val);\r\n    return this;\r\n  }\r\n  public reset(){\r\n    const thisItem = this.list[this.current];\r\n    thisItem.reset();\r\n    return this;\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\nfunction createTrackClass(className: string) {\r\n  const string = `\r\nclass ${className} extends Track {\r\n  static name_ = '${className}';\r\n  constructor() {\r\n    const [...rest] = arguments;\r\n    super(...rest);\r\n  }\r\n\r\n  static setConfig(key, name, defaultValue, valueType, min, max, desc) {\r\n    Track.commonConfigs.${className} || (Track.commonConfigs.${className} = []);\r\n    Track.commonConfigs.${className}.push([key, name, defaultValue, valueType, min, max, desc]);\r\n    return ${className};\r\n  }\r\n}`;\r\n  return eval(`(${string})`);\r\n}\r\n\r\n\r\n\r\n\r\nconst trackConfigs = [\r\n  {\r\n    name: 'CommonOptionsTrack', required: true, list: [\r\n      ['CanvasView', '开启音频可视化轨道', 0, 'int', 0, 1, '是否启用'],\r\n      ['CanvasPic', '开启背景轨道', 0, 'int', 0, 1, '是否启用'],\r\n      ['CanvasPicMalfunction', '开启背景轨道故障特效', 0, 'int', 0, 1, '是否启用'],\r\n      ['CanvasText', '开启歌词轨道', 0, 'int', 0, 1, '是否启用'],\r\n      ['CanvasTextMalfunction', '开启歌词轨道故障特效', 0, 'int', 0, 1, '是否启用'],\r\n      ['changeBG_When_LRC_Changed', '背景歌词同步切换', 1, 'int', 0, 1, '是否启用'],\r\n      ['VideoView', '开启视频轨道1', 0, 'int', 0, 1, '是否启用'],\r\n      ['VideoView1', '开启视频轨道2', 0, 'int', 0, 1, '是否启用'],\r\n      ['DomClock', '显示时钟', 0, 'int', 0, 1, '是否启用'],\r\n      ['gameUI', '显示游戏界面', 0, 'int', 0, 1, '是否启用'],\r\n      ['gameScene', '显示游戏场景', 0, 'int', 0, 1, '是否启用'],\r\n    ]\r\n  },\r\n  {\r\n    name: 'GameTrack', required: true, list: [\r\n      ['RhythmPointVolumeFloatRange', '节奏点浮动范围', 1, 'int', 0, 30, '值越大， 则节奏点越少'],\r\n      ['RhythmPointTimeout', '节奏点最小间隔', 15, 'int', 0, 30, 'timeout = (num * 10) ms'],\r\n      ['RhythmPointRemoveFloatRange', '节奏点消除范围', 20, 'int', 5, 60, 'range = (num * 10)'],\r\n      ['RhythmPointMissTipSound', 'miss提示音', 0, 'int', 0, 1, '是否开启'],\r\n      ['RhythmPointCenterPointOffset', '轨道偏移量', -30, 'int', -60, 60, '轨道偏移量'],\r\n      ['trick', '开启作弊模式', 0, 'int', 0, 1, '是否开启'],\r\n    ]\r\n  },\r\n  {\r\n    multiple: true,\r\n    required: true,\r\n    name: 'CanvasTrack', list: [\r\n      ['disable', '是否启用', 0, 'int', 0, 1, '是否启用'],\r\n      ['renderType', '渲染方式', 2, 'int', 0, 3, '渲染方式'],\r\n      ['direction', '渲染方向', 0, 'int', 0, 1, '渲染方式'],\r\n      ['baseSizeType', '基础尺寸单位', 0, 'int', 0, 1, '0: 屏幕较小边， 1： 屏幕较大边'],\r\n      ['noZero', '删除无效数据', 1, 'int', 0, 1, '将频谱数据复制一份， 并逆向拼接在源数据后面'],\r\n      ['copyData', '复制并反向数据', 1, 'int', 0, 1, '将频谱数据复制一份， 并逆向拼接在源数据后面'],\r\n      ['showDataBefore', '展示均衡前的数据', 0, 'int', 0, 1, '展示均衡前的数据'],\r\n      ['midPositionX', 'X中心位子', 50, 'int', 0, 100, '绘制中心位于屏幕位置， 0在最左， 100在最右'],\r\n      ['midPositionY', 'Y中心位子', 50, 'int', 0, 100, '绘制中心位于屏幕位置， 0在最上， 100在最下'],\r\n      ['clearPrevView', '保留上次渲染', 70, 'int', 0, 100, '保留上次绘制（百分比）'],\r\n      ['mainRadius', '基线距中心点位置（Y轴）', 25, 'int', -100, 100, '圆形时为半径, 百分比基于基础尺寸单位'],\r\n      ['avrLevelMainRadiusModify', '频谱均值基线距离修正系数', 25, 'int', 0, 100, '基线随频谱修正系数（百分比）'],\r\n      ['mainRadiusOpacity', '基线透明度', 75, 'int', 0, 100, '基线透明度'],\r\n      ['mainRadiusLineWidth', '基线宽度', 3, 'int', 0, 100, '基线宽度， 千分比基准此村'],\r\n      ['floatRange', '频谱波动范围', 2, 'int', -10, 10, '频谱波动范围 相对基础尺寸 百分制'],\r\n      ['avrLevelFloatRangeModify', '频谱均值波动范围修正系数', 25, 'int', 0, 100, '基线随频谱修正系数（百分比）'],\r\n      ['stepModify', '频谱间隔修正', 10, 'int', 0, 100, ' 十分比预设'],\r\n      ['lineLineWidth', '频谱宽度', 3, 'int', 0, 100, ' 千分比预设'],\r\n      ['dataModify', '频谱修正系数', 15, 'int', 0, 100, '十分比预设'],\r\n      ['dataOffsetModify', '频谱偏移修正系数', 6, 'int', -100, 100, '百分比预设'],\r\n      ['minHeightModify', '频谱最小修正系数', -0, 'int', -300, 100, '百分比预设'],\r\n      ['threshold', '阈值', 7, 'int', 0, 100, '百分比预设']\r\n    ]\r\n  },\r\n  {name: 'VideoTrack', list: []}\r\n];\r\n\r\n\r\nexport const biquadFilterFrequency = [31, 63, 125, 250, 500, 1000, 2000, 4000, 8000, 16000, 20000, 24000];\r\nconst balanceTrackConfigs = {\r\n  name: 'BalanceTrack',\r\n  required: true,\r\n  list: biquadFilterFrequency.map((item, index) => [`balance${index}`, `${item}`, 0, 'int', -12, 12, 'db'])\r\n};\r\ntrackConfigs.push(balanceTrackConfigs);\r\n\r\n\r\n\r\nexport class ModifyManager {\r\n  updateCommonOptions?: Function;\r\n  list: [TrackList, ...Track[]] | [];\r\n  playing: number;\r\n  current: number;\r\n\r\n  constructor(updateCommonOptions?: Function) {\r\n    this.list = [];\r\n    this.playing = 0;\r\n    this.current = 0;\r\n    this.setList([new TrackList(this)]);\r\n    this.setIndex(0);\r\n    updateCommonOptions && (this.updateCommonOptions = updateCommonOptions);\r\n    this.init();\r\n  }\r\n  getTrackByName(name: TTrackClass){\r\n    // @ts-ignore;\r\n    return this.list[0].list.find(item => item.constructor.name_ === name);\r\n  }\r\n\r\n\r\n  init() {\r\n    // @ts-ignore;\r\n    this.updateCommonOptions && this.updateCommonOptions();\r\n    return this;\r\n  }\r\n\r\n  get len() {\r\n    return this.list.length;\r\n  }\r\n  savePresets() {\r\n    this.list[0]?.savePresets('');\r\n    return this;\r\n  }\r\n\r\n  exportPresets(){\r\n    this.list[0]?.exportPresets();\r\n    return this;\r\n  }\r\n  importPresets(presets: any){\r\n    this.list[0]?.importPresets(presets);\r\n    return this;\r\n  }\r\n  setList(list: [TrackList, ...Track[]]) {\r\n    this.list = list;\r\n    this.current = 0;\r\n    return this;\r\n  }\r\n\r\n  replace(index: number, replacer: Track) {\r\n    this.list.splice(index, 1, replacer);\r\n    return this;\r\n  }\r\n\r\n  // 设置轨道\r\n  setIndex(index: number) {\r\n    if (index > this.len - 1) index = this.len - 1;\r\n    if (index < 0) index = 0;\r\n    this.current = index;\r\n    this.play();\r\n    return this;\r\n  }\r\n\r\n  // 设置轨道， 打开轨道编辑器\r\n  play() {\r\n    this.playing = this.current;\r\n    if (this.current === 0) {\r\n      // @ts-ignore;\r\n      this.replace(1, this.list[this.current])\r\n    }\r\n    this.list[this.current].play();\r\n    return this;\r\n  }\r\n\r\n  prev() {\r\n    this.setIndex((this.current - 1 + this.len) % this.len);\r\n    return this;\r\n  }\r\n\r\n  next() {\r\n    this.setIndex((this.current + 1) % this.len);\r\n    return this;\r\n  }\r\n\r\n  enc() {\r\n    // @ts-ignore;\r\n    this.list[this.current] && this.list[this.current].enc();\r\n    this.list[0]?.savePresets('');\r\n    return this;\r\n  }\r\n\r\n  dec() {\r\n    // @ts-ignore;\r\n    this.list[this.current] && this.list[this.current].dec();\r\n    this.list[0]?.savePresets('');\r\n    return this;\r\n  }\r\n\r\n  prevItem() {\r\n    this.list[this.current] && this.list[this.current].prev();\r\n    return this;\r\n  }\r\n\r\n  nextItem() {\r\n    this.list[this.current] && this.list[this.current].next();\r\n    return this;\r\n  }\r\n\r\n  up() {\r\n\r\n    // @ts-ignore;\r\n    this.list[0].prev();\r\n    return this;\r\n  }\r\n\r\n  down() {\r\n    // @ts-ignore;\r\n    this.list[0].next();\r\n    return this;\r\n  }\r\n\r\n  add() {\r\n    // @ts-ignore;\r\n    this.list[0]?.add.call(this.list[0], ...arguments);\r\n    // @ts-ignore;\r\n    this.list[0]?.savePresets('');\r\n    return this;\r\n  }\r\n\r\n  delete() {\r\n    // @ts-ignore;\r\n    this.list[0].delete.call(this.list[0], ...arguments);\r\n    // @ts-ignore;\r\n    this.list[0]?.savePresets();\r\n    return this;\r\n  }\r\n\r\n  copy() {\r\n    // @ts-ignore;\r\n    this.list[0].copy.call(this.list[0], ...arguments);\r\n    // @ts-ignore;\r\n    this.list[0].savePresets();\r\n    return this;\r\n  }\r\n}\r\n\r\n\r\nfunction createALink (data: any, fileName: string, parentNode?: Element): Element{\r\n  const blob = new Blob([data], {type:\"text/plain;charset=utf-8\"});\r\n  const url = URL.createObjectURL(blob);\r\n  const link: Element = DomUtil.node('a', fileName);\r\n  // @ts-ignore;\r\n  link.href = url;\r\n  // @ts-ignore;\r\n  link.download = fileName;\r\n  DomUtil.append(parentNode || document.body, link);\r\n  return link;\r\n}\r\n\r\n\r\n// 轨道列表管理器\r\n// 可以是 canvas 轨道 和视频轨道 // 左侧第一栏\r\nclass TrackList {\r\n  static name_ = 'TrackList';\r\n\r\n  playing: number;\r\n  current: number;\r\n  parent: ModifyManager;\r\n  list: (ModifyManager|Track)[];\r\n\r\n  constructor(parent: ModifyManager) {\r\n    this.list = [];\r\n    this.parent = parent;\r\n    this.playing = 0;\r\n    this.current = 0;\r\n    this.loadPresets();\r\n\r\n    constructorList.forEach((constructor) => {\r\n      // @ts-ignore;\r\n      const constructorName = constructor.name_;\r\n      // @ts-ignore;\r\n      const hasDto = this.list.some(i => i.constructor.name_ === constructorName);\r\n      if (!hasDto) {\r\n        // @ts-ignore;\r\n        this.add({type: constructorName, name: constructorName})\r\n      }\r\n    })\r\n\r\n\r\n  }\r\n\r\n  get len() {\r\n    return this.list.length;\r\n  }\r\n\r\n  add(options: {\r\n    type?: 'CanvasTrack' | 'VideoTrack' | 'CommonOptionsTrack' | 'BalanceTrack' | 'GameTrack';\r\n    name?: string;\r\n    data?: {[index: string]: number}\r\n  } = {}, len = 1) {\r\n    const {type = 'CanvasTrack', name, data} = options;\r\n    for (let i = 0; i < len; i++) {\r\n      // @ts-ignore;\r\n      TrackClass[type] && this.list.push(new TrackClass[type](name, this, data));\r\n    }\r\n    this.setIndex(this.len - 1);\r\n    return this;\r\n  }\r\n\r\n  delete() {\r\n    const item = this.list[this.current];\r\n    // @ts-ignore;\r\n    const className = item.constructor.name_;\r\n    const config = trackConfigs.find(config => config.name === className);\r\n    // 不是多项的不让删， 最后一条不让删\r\n    // @ts-ignore;\r\n    if (!config.multiple || this.list.filter(item => item.constructor.name_ === className).length<=1) {\r\n      return;\r\n    }\r\n    if (item) {\r\n      this.list.splice(this.current, 1);\r\n      this.setIndex(0);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  copy() {\r\n    const item = this.list[this.current];\r\n    // @ts-ignore;\r\n    const className = item.constructor.name_;\r\n    const config = trackConfigs.find(config => config.name === className);\r\n    // 不是多项的不让复制\r\n    // @ts-ignore;\r\n    if (!config.multiple) return;\r\n    // @ts-ignore;\r\n    if (item && !['CommonOptionsTrack', 'BalanceTrack'].includes(item.constructor.name_)) {\r\n      // @ts-ignore;\r\n      this.list.splice(this.current, 0, new item.constructor(item.name + 'Copy', this, item));\r\n      this.setIndex(this.current + 1);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  setList(list: (Track|ModifyManager)[]) {\r\n    this.list = list;\r\n    this.current = 0;\r\n    return this;\r\n  }\r\n\r\n  // 设置轨道\r\n  setIndex(index: number) {\r\n    if (index > this.len - 1) index = this.len - 1;\r\n    if (index < 0) index = 0;\r\n    this.current = index;\r\n    this.play();\r\n    return this;\r\n  }\r\n\r\n  // 设置轨道， 打开轨道编辑器\r\n  play() {\r\n    this.playing = this.current;\r\n    // @ts-ignore;\r\n    this.parent.replace(1, this.list[this.current]);\r\n    return this;\r\n  }\r\n\r\n  prev() {\r\n    this.setIndex((this.current - 1 + this.len) % this.len);\r\n    return this;\r\n  }\r\n\r\n  next() {\r\n    this.setIndex((this.current + 1) % this.len);\r\n    return this;\r\n  }\r\n\r\n  importPresets(presets: any){\r\n    presets.forEach((item: any, index: number) => {\r\n      // @ts-ignore;\r\n      const prev = this.list.find(item_ => item_.constructor.name_ === item.type);\r\n      // @ts-ignore;\r\n      if (prev && !['CanvasTrack'].includes(item.type)) {\r\n        prev.list.forEach((val: any) => {\r\n          const curVal = item.data[val.key];\r\n          GetType.isEmpty(curVal) || (val.value = curVal)\r\n        })\r\n      } else {\r\n        this.add(item);\r\n      }\r\n    });\r\n    this.savePresets('');\r\n    // @ts-ignore;\r\n    location.reload();\r\n    return this;\r\n  }\r\n  exportPresets(){\r\n    const result = this.list.map(item => {\r\n      const data:{[idnex: string]: number} = {};\r\n      // @ts-ignore;\r\n      item.list.forEach((key: ITrackListItem) => {\r\n        // @ts-ignore;\r\n        data[key.key] = item[key.key];\r\n      });\r\n      // @ts-ignore;\r\n      return {name: item.name, data, type: item.constructor.name_}\r\n    });\r\n\r\n    const $a = createALink(JSON.stringify(result), `dy_player.preset`);\r\n    // @ts-ignore;\r\n    $a.click();\r\n    DomUtil.remove($a);\r\n  }\r\n  savePresets(name: string) {\r\n    const result = this.list.map(item => {\r\n      const data:{[idnex: string]: number} = {};\r\n      // @ts-ignore;\r\n      item.list.forEach((key: ITrackListItem) => {\r\n        // @ts-ignore;\r\n        data[key.key] = item[key.key];\r\n      });\r\n      // @ts-ignore;\r\n      return {name: item.name, data, type: item.constructor.name_}\r\n    });\r\n\r\n    this.parent?.updateCommonOptions && this.parent?.updateCommonOptions();\r\n    localStorage.setItem('configPresets', JSON.stringify(result));\r\n    return this;\r\n  }\r\n\r\n  loadPresets() {\r\n    try {\r\n      const presets = JSON.parse(localStorage.getItem('configPresets') || '[]');\r\n\r\n      presets.length || presets.push({});\r\n\r\n      constructorList.forEach(constructor => {\r\n        // @ts-ignore;\r\n        const constructorName = constructor.name_;\r\n        // @ts-ignore;\r\n        const hasDot = presets.some(i => i.type === constructorName);\r\n        if (!hasDot) {\r\n          // @ts-ignore;\r\n          this.add({type: constructorName, name: constructorName})\r\n        }\r\n      });\r\n\r\n      // @ts-ignore;\r\n      presets.forEach(item => {\r\n        this.add(item);\r\n      });\r\n    } catch (e) {\r\n      console.log(e);\r\n      console.log('load presets fail.');\r\n    }\r\n    return this;\r\n  }\r\n}\r\n\r\n\r\nconst TrackClass: {[index: string]: Track} = {\r\n};\r\ntype TTrackClass = keyof typeof TrackClass;\r\ntrackConfigs.forEach(config => {\r\n  const track = TrackClass[config.name] = createTrackClass(config.name);\r\n  config.list.forEach(conf => {\r\n    track.setConfig(...conf)\r\n  });\r\n\r\n});\r\nconst constructorList: Track[] = trackConfigs.filter(config => config.required).map(config =>  TrackClass[config.name]);\r\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"app\"}},[_c('Index')],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"container\"},[_c('NavBar'),_c('div',{staticClass:\"box-wrap\"},[_c('MusicSearchBox'),_c('MusicLocalBox'),_c('ModifyBox')],1),_c('div',{staticClass:\"canvas-view-wrap\"},[(_vm.commonOptions.gameUI)?_c('GameUI'):_vm._e(),(_vm.commonOptions.CanvasPic)?_c('CanvasPic'):_vm._e(),(_vm.commonOptions.CanvasText)?_c('CanvasText'):_vm._e(),_vm._l((_vm.modifyManager.list[0].list),function(item,index){return [(_vm.commonOptions.CanvasView && item && item.constructor.name_ === 'CanvasTrack')?_c('CanvasView',{attrs:{\"config\":item}}):_vm._e()]})],2),(_vm.commonOptions.VideoView)?_c('VideoView',{attrs:{\"index\":0}}):_vm._e(),(_vm.commonOptions.VideoView1)?_c('VideoView',{attrs:{\"index\":1}}):_vm._e(),(_vm.commonOptions.DomClock)?_c('DomClock'):_vm._e(),(_vm.musicData.realTimeData.data)?_c('ThreeView'):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import {MusicConfig} from \"./MusicConfig\";\r\nimport {MusicVisualizer} from \"./MusicVisualizer\";\r\n\r\n// @ts-ignore;\r\nimport {ModifyManager} from \"./canvasConfig.js\";\r\nimport {DomUtil} from \"@/tools/DomUtil\";\r\nimport {Sound} from \"@/tools/Sound\"\r\n// @ts-ignore;\r\n\r\n\r\nclass EventTarget_ {\r\n  listeners: {[index: string]: any} = {};\r\n  public addEventListener(type: string, callback: Function) {\r\n    if(!(type in this.listeners)) {\r\n      this.listeners[type] = [];\r\n    }\r\n    this.listeners[type].push(callback);\r\n  }\r\n  public removeEventListener(type: string, callback: Function): any {\r\n    if(!(type in this.listeners)) {\r\n      return;\r\n    }\r\n    const stack = this.listeners[type];\r\n    for(let i = 0, l = stack.length; i < l; i++) {\r\n      if(stack[i] === callback){\r\n        stack.splice(i, 1);\r\n        return this.removeEventListener(type, callback);\r\n      }\r\n    }\r\n  }\r\n  public dispatchEvent(event: Event) {\r\n    if(!(event.type in this.listeners)) {\r\n      return;\r\n    }\r\n    const stack = this.listeners[event.type];\r\n    // @ts-ignore;\r\n    event.target = this;\r\n    for(let i = 0, l = stack.length; i < l; i++) {\r\n      stack[i].call(this, event);\r\n    }\r\n  }\r\n}\r\n\r\nexport class MusicDataFlags {\r\n  dataFlag: number = 0;\r\n  shockFlag: number = 0;\r\n}\r\n\r\nclass RhythmPoint{\r\n  isRhythmPoint: boolean;\r\n  vol: number;\r\n  constructor(vol: number, isRhythmPoint: boolean){\r\n    this.vol = vol;\r\n    this.isRhythmPoint = isRhythmPoint;\r\n  }\r\n}\r\n\r\ntype IColor = [number, number, number, number] | [number, number, number];\r\n\r\nclass EventTar {\r\n  fnMap:{[index: string]: Function[]} = {};\r\n  addEventListener(type: string, callback: Function){\r\n    this.fnMap[type] || (this.fnMap[type] = []);\r\n    this.fnMap[type].push(callback)\r\n  }\r\n  dispatchEvent(ev: Event){\r\n    const fns = this.fnMap[ev.type];\r\n    fns && fns.forEach(i => i(ev));\r\n  }\r\n}\r\nclass MVData{\r\n  event: EventTar = new EventTar();\r\n  prevAddSpeed: number = 0;\r\n  prevAvrLevel: number = 0;\r\n  data?: Uint8Array;\r\n  avrLevel: number = 0;\r\n  total: number = 0;\r\n  addSpeed: number = 0;\r\n  soundTrackArr: RhythmPoint[] = [];\r\n  soundTrackArrMaxLen: number = 100;\r\n  shockNum: number = 0;\r\n  modifyManager: ModifyManager;\r\n  constructor(modifyManager: ModifyManager){\r\n    this.modifyManager = modifyManager;\r\n  }\r\n  update(data: Uint8Array){\r\n    const {soundTrackArr, prevAvrLevel, prevAddSpeed} = this;\r\n    this.data = data;\r\n    this.total = data.reduce((a = 0, b = 0) => (a + b));\r\n    const avrLevel = this.avrLevel = this.total / data.length;\r\n    const addSpeed = this.addSpeed = avrLevel - prevAvrLevel;\r\n\r\n    const RhythmPointVolumeFloatRange = this.modifyManager.getTrackByName('GameTrack').getVal('RhythmPointVolumeFloatRange');\r\n    /**\r\n     * 转折点， 声音开始变大的第一帧。 乐器的吹奏、敲击（或者人发声）的瞬间， 大概率会使音量提高。\r\n     * 所以就是 音量从减小， 突变到开始升高表示是个节奏点；\r\n     */\r\n    const isRhythmPoint = prevAddSpeed <= 0 && addSpeed > RhythmPointVolumeFloatRange / 10;\r\n\r\n    const rhythmPoint = new RhythmPoint(avrLevel, isRhythmPoint);\r\n    soundTrackArr.push(rhythmPoint);\r\n    if (isRhythmPoint) {\r\n      this.shockNum ++;\r\n      const ev = new Event('shock');\r\n      // @ts-ignore;\r\n      ev.rhythmPoint = rhythmPoint;\r\n      this.event.dispatchEvent(ev);\r\n    }\r\n\r\n    if (soundTrackArr.length > this.soundTrackArrMaxLen) {\r\n      soundTrackArr.shift();\r\n    }\r\n\r\n    this.prevAddSpeed = addSpeed;\r\n    this.prevAvrLevel = avrLevel;\r\n\r\n    this.event.dispatchEvent(new Event('update'));\r\n  }\r\n}\r\n\r\nexport class MusicData {\r\n  realTimeData: MVData;\r\n  originData: MVData;\r\n  currentImgAviColor: IColor = [0,0,0,0];\r\n  calculateColors: [IColor, IColor] = [[255, 255, 255], [255, 255, 255]];\r\n  modifyManager: ModifyManager;\r\n  constructor(\r\n    modifyManager: ModifyManager\r\n  ){\r\n    this.modifyManager = modifyManager;\r\n    this.realTimeData = new MVData(modifyManager);\r\n    this.originData = new MVData(modifyManager);\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\r\nclass GameScore{\r\n  static prevNode?: Node;\r\n  constructor(score: number | string){\r\n    const gameScore = DomUtil.node('div');\r\n    gameScore.classList.add('game-score');\r\n    gameScore.innerHTML = score.toString();\r\n    DomUtil.append(document.body, gameScore);\r\n    GameScore.prevNode && DomUtil.remove(GameScore.prevNode);\r\n    GameScore.prevNode = gameScore;\r\n  }\r\n}\r\n\r\n\r\nclass GameCombo{\r\n  static prevNode?: Node;\r\n  constructor(combo: number){\r\n    GameCombo.prevNode && DomUtil.remove(GameCombo.prevNode);\r\n    GameCombo.prevNode = undefined;\r\n    if (combo > 5) {\r\n      const gameScore = DomUtil.node('div');\r\n      gameScore.classList.add('game-combo');\r\n      gameScore.innerHTML = `${combo || 0} x combo`;\r\n      DomUtil.append(document.body, gameScore);\r\n      GameCombo.prevNode = gameScore;\r\n    }\r\n\r\n  }\r\n}\r\n\r\nclass GameNode {\r\n  gameList: GameList;\r\n  dom: Node;\r\n  score?: number;\r\n  time: number;\r\n  isDebug?: boolean = false;\r\n  modifyManager: ModifyManager;\r\n  constructor(\r\n    gameList: GameList,\r\n    rhythmPoint: RhythmPoint,\r\n    isDebug: boolean = false,\r\n    gameInner: Element,\r\n    modifyManager: ModifyManager,\r\n  ){\r\n    this.gameList = gameList;\r\n    this.time = Date.now();\r\n    this.modifyManager = modifyManager;\r\n    const dom = this.dom = DomUtil.node('div');\r\n    dom.className = 'game-item';\r\n\r\n    if (isDebug) {\r\n      this.isDebug = isDebug;\r\n      // @ts-ignore;\r\n      dom.style = `animation: gamingDebug linear 0.8s;`;\r\n    }\r\n\r\n    const hueRange = 120;\r\n    const deg = rhythmPoint.vol * this.modifyManager.getTrackByName('GameTrack').getVal('RhythmPointCenterPointOffset');\r\n\r\n    const innerDom = DomUtil.node('div');\r\n    DomUtil.append(dom, innerDom);\r\n    // @ts-ignore;\r\n      innerDom.style = `\r\n      transform: rotate(${deg}deg) translate(0, calc(${150 + rhythmPoint.vol/3}px));\r\n      background-color: hsl(${90 - hueRange * rhythmPoint.vol / 255}, 50%, 50%);\r\n    `;\r\n    DomUtil.append(gameInner, dom);\r\n\r\n    dom.addEventListener(\"webkitAnimationEnd\", this.endFunction);\r\n    dom.addEventListener(\"animationend\", this.endFunction);\r\n  }\r\n  calculateScore(currentTime: number){\r\n    const {gameList, time} = this;\r\n    this.score = Math.abs(currentTime - time - gameList.delay);\r\n  }\r\n  remove(){\r\n    const {dom} = this;\r\n    this.gameList.setCurrentScore(this.score);\r\n\r\n    if (this.score !== undefined) {\r\n      Sound.play(\"done\");\r\n    }else {\r\n      this.modifyManager.getTrackByName('GameTrack').getVal('RhythmPointMissTipSound') && Sound.play('warning');\r\n    }\r\n\r\n    dom.removeEventListener('webkitAnimationEnd', this.endFunction);\r\n    dom.removeEventListener('animationend', this.endFunction);\r\n    dom && DomUtil.remove(dom);\r\n  }\r\n  endFunction = (ev?: Event) => {\r\n    if (this.isDebug) {\r\n      this.calculateScore(Date.now())\r\n    }\r\n    this.remove();\r\n    this.gameList.remove(this);\r\n  }\r\n}\r\n\r\n\r\nexport class GameList {\r\n  currentTime: number = 0;\r\n  durationTime: number = 0;\r\n  ended: boolean = false;\r\n  combo: number = 0;\r\n  maxCombo: number = 0;\r\n  currentScore: number = 0;\r\n  totalScore: number = 0;\r\n  total: number = 0;\r\n  missCount: number = 0;\r\n  uselessCount: number = 0;\r\n  mv: MusicVisualizer;\r\n  gameInner: Element;\r\n  modifyManager: ModifyManager;\r\n  public endSong(){\r\n    this.ended = true;\r\n  }\r\n  public startSong(){\r\n    this.ended = false;\r\n    this.currentScore = 0;\r\n    this.totalScore = 0;\r\n    this.total = 0;\r\n    this.combo = 0;\r\n    this.maxCombo = 0;\r\n    this.missCount = 0;\r\n    this.uselessCount = 0;\r\n  }\r\n\r\n  constructor(\r\n    mv: MusicVisualizer,\r\n    gameInner: Element,\r\n    modifyManager: ModifyManager\r\n  ){\r\n\r\n    this.modifyManager = modifyManager;\r\n    this.mv = mv;\r\n    this.delay = this.mv.delay.delayTime.value * 1000\r\n    this.gameInner = gameInner;\r\n  }\r\n  setCombo(isStop: boolean){\r\n    isStop ? (this.combo = 0) : (this.combo ++);\r\n    this.combo > this.maxCombo && (this.maxCombo = this.combo);\r\n    new GameCombo(this.combo);\r\n  }\r\n\r\n  setCurrentScore(score: number | undefined){\r\n    this.currentScore = score || 0;\r\n    this.totalScore += (score || 0);\r\n    const isMiss = score === undefined;\r\n\r\n    isMiss && (this.missCount ++);\r\n    this.setCombo(isMiss);\r\n    new GameScore(isMiss ? 'miss' : `score - ${score}`);\r\n  }\r\n  eventTarget: EventTarget_ = new EventTarget_();\r\n  delay: number;\r\n  buffer: number = 150;\r\n  duration: number = 2000;\r\n  list: GameNode[] = [];\r\n\r\n  find(time: number): GameNode | undefined {\r\n    const {buffer, delay} = this;\r\n    // return this.list[0];\r\n    return this.list.find((item) => Math.abs(time - item.time - delay) < buffer);\r\n  }\r\n  indexOf(gameNode: GameNode){\r\n    return this.list.indexOf(gameNode);\r\n  }\r\n  remove(gameNode: GameNode){\r\n    const index = this.indexOf(gameNode);\r\n    index !== -1 && this.list.splice(index,1);\r\n  }\r\n  createGameNode(rhythmPoint: RhythmPoint, isDebug: boolean = false){\r\n    const gameNode = new GameNode(this, rhythmPoint, isDebug, this.gameInner, this.modifyManager);\r\n    this.list.push(gameNode);\r\n    this.total ++;\r\n    return gameNode;\r\n  }\r\n  setBuffer(buffer: number){\r\n    this.buffer = buffer;\r\n    this.eventTarget.dispatchEvent(new Event('bufferChange'));\r\n  }\r\n  shootGameNode(){\r\n    // 得分 目前时间 - 开始生成时间 - delay\r\n    const time = Date.now();\r\n    const gameNode = this.find(time);\r\n    if (gameNode) {\r\n      gameNode.calculateScore(time);\r\n\r\n      gameNode.endFunction();\r\n    } else {\r\n      this.uselessCount ++;\r\n      new GameScore('userLess press');\r\n    }\r\n  }\r\n}\r\n\r\n\r\n\r\nexport class GameScene {\r\n  dom: Node;\r\n  time: number;\r\n  modifyManager: ModifyManager;\r\n  constructor(gameData: MVData, musicData: MusicData, gameInner: Element, modifyManager: ModifyManager){\r\n    this.modifyManager = modifyManager;\r\n    this.time = Date.now();\r\n    const dom = this.dom = DomUtil.node('div');\r\n    dom.className = 'game-scene';\r\n    // @ts-ignore;\r\n    let list = [...gameData.data].filter(i => i).filter((x, i) => !(i % 16));\r\n    // list.length || (list = [0]);\r\n    const per = 360 / list.length;\r\n    const deg = musicData.originData.avrLevel * (modifyManager.getTrackByName('GameTrack').getVal('RhythmPointCenterPointOffset') || 0);\r\n    // @ts-ignore;\r\n    dom.innerHTML = list.map((item: number, index: number) => {\r\n      return `<div style=\"transform: rotateZ(${-(index) * per + 180 +deg}deg) translate(0, calc(400px + ${item * 10}px));\"></div>`;\r\n    }).join('');\r\n\r\n    DomUtil.append(gameInner, dom);\r\n\r\n    dom.addEventListener(\"webkitAnimationEnd\", this.destroy);\r\n    dom.addEventListener(\"animationend\", this.destroy);\r\n  }\r\n  remove(){\r\n    const {dom} = this;\r\n    dom.removeEventListener('webkitAnimationEnd', this.destroy);\r\n    dom.removeEventListener('animationend', this.destroy);\r\n    dom && DomUtil.remove(dom);\r\n  }\r\n  destroy = () => {\r\n    this.remove();\r\n  }\r\n}\r\n\r\ninterface UniqueListItem {\r\n  id: number|string;\r\n  [index: string]: any;\r\n}\r\nexport class UniqueList {\r\n  list: UniqueListItem[] = [];\r\n  enter(item: UniqueListItem){\r\n    const index = this.list.findIndex(item_ => item.id === item_.id);\r\n    index === -1 ? this.list.push(item) : this.list.splice(index, 1);\r\n  }\r\n}\r\n\r\nexport class Color {\r\n  static compose(i: number) {\r\n    i = i / 255;\r\n    return Math.round((i + (i - .5) * (1 - i)) * 255);\r\n  }\r\n  static dCompose(i: number, time = 0) {\r\n    i = i / 255;\r\n    let rate = (1 - i);\r\n    while (time + 3) {\r\n      rate *= (1 - i);\r\n      time --;\r\n    }\r\n    return Math.round((1- rate) * 255);\r\n  }\r\n  static getPure(r: number, g: number, b: number, time = 2): [IColor, IColor]{\r\n    // 同时减去最小值\r\n    const min = Math.min(r, g, b);\r\n    const per = min / 256;\r\n    const {dCompose, reduce} = Color\r\n    return [\r\n      [\r\n        dCompose(r, time),\r\n        dCompose(r, time),\r\n        dCompose(r, time)\r\n      ], [\r\n        dCompose(reduce(r, per), time + 2),\r\n        dCompose(reduce(g, per), time + 2),\r\n        dCompose(reduce(b, per), time + 2)\r\n      ]\r\n    ];\r\n  }\r\n  static reduce(r: number, per: number){\r\n    return Math.round((r - 255 * per) / (1  -  per));\r\n  }\r\n}\r\n\r\n\r\n","export function MakeThrottle_(fn: Function, time = 300) {\r\n  let prevTime = 0;\r\n  const ret = function () {\r\n    if (Date.now() - prevTime - ret.time > 0) {\r\n      fn.apply(null, [...arguments]);\r\n      prevTime = Date.now();\r\n    }\r\n  }\r\n  ret.time = time;\r\n  return ret;\r\n}\r\n\r\nexport function MakeThrottle(time = 300) {\r\n  let prevTime = 0;\r\n  return function (target: any, propertyKey: string, descriptor: PropertyDescriptor) {\r\n    const fn = target[propertyKey];\r\n    target[propertyKey] = function () {\r\n      if (Date.now() - prevTime - time > 0) {\r\n        fn.apply(target, [...arguments]);\r\n        prevTime = Date.now();\r\n      }\r\n    }\r\n  }\r\n}\r\n","export function appendStyle(compName: string, styleStr: string, forceUpdate: boolean = false) {\r\n  // @ts-ignore;\r\n  appendStyle.cacheMap || (appendStyle.cacheMap = {});\r\n  // @ts-ignore;\r\n  if (forceUpdate || !appendStyle.cacheMap[compName]) {\r\n    const style = document.createElement('style');\r\n    style.innerHTML = styleStr.replace(/<\\/?style.*?>/g, '');\r\n    document.head.appendChild(style);\r\n    // @ts-ignore;\r\n    appendStyle.cacheMap[compName] = styleStr;\r\n  } else {\r\n    console.log(`[style][${compName}] is already exist!`);\r\n  }\r\n}\r\n","import {appendStyle} from \"@/units/appendStyle\";\r\n\r\nappendStyle(``, ``);\r\n\r\nlet canvas = document.createElement('canvas');\r\n\r\nconst pciCanvas = document.createElement('canvas');\r\n\r\n\r\nexport class Picture {\r\n  static pciCanvas = pciCanvas;\r\n  static pciCtx = pciCanvas.getContext(\"2d\");\r\n  compressRate: number;\r\n  canvas: Element;\r\n  ctx: any;\r\n  musicConfig: any;\r\n  cacheList: Element[];\r\n  cacheImg: {[index: string]: number[]};\r\n  constructor(musicConfig: any) {\r\n    this.compressRate = 0.1;\r\n    this.musicConfig = musicConfig;\r\n    this.canvas = canvas = canvas || document.createElement(\"canvas\");\r\n    this.ctx = canvas.getContext('2d');\r\n    this.cacheList = [];\r\n    this.cacheImg = {};\r\n  }\r\n\r\n  static setImage(img: any) {\r\n    const {offsetWidth, offsetHeight} = document.body;\r\n    Picture.pciCanvas.width = offsetWidth;\r\n    Picture.pciCanvas.height = offsetHeight;\r\n    Picture && Picture.pciCtx && Picture.pciCtx.drawImage(img, (offsetWidth - img.width) / 2, (offsetHeight - img.height) / 2, img.width, img.height);\r\n  }\r\n\r\n  static getImageData(x: number, y: number, w: number, h: number):ImageData {\r\n    // @ts-ignore;\r\n    return Picture.pciCtx && Picture.pciCtx.getImageData(x, y, w, h);\r\n  }\r\n\r\n  makeEl() {\r\n    const img = document.createElement(\"img\");\r\n    const {cacheList, cacheImg, ctx, compressRate} = this;\r\n    img.onload = () => {\r\n      Picture.setImage(img);\r\n      if (!cacheImg[img.src]) {\r\n        const {width, height} = img;\r\n        canvas.width = width * compressRate;\r\n        canvas.height = height * compressRate;\r\n        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\r\n        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n        const result:number[][] = [[], [], [], []];\r\n        imageData.data.forEach((color: number, index: number) => {\r\n          result[index % 4].push(color);\r\n        });\r\n        cacheImg[img.src] = [\r\n          aviOfArr(result[0]), aviOfArr(result[1]), aviOfArr(result[2]), aviOfArr(result[3])\r\n        ];\r\n      }\r\n      // @ts-ignore;\r\n      img.noNeedChangeCurrentImgAviColor || (this.musicConfig.currentImgAviColor = cacheImg[img.src]);\r\n      cacheList.push(img);\r\n    };\r\n    return img;\r\n  }\r\n\r\n  load(url: string, noNeedChangeCurrentImgAviColor?: boolean) {\r\n    if (!url) return;\r\n    const img = this.cacheList.shift() || this.makeEl();\r\n    // @ts-ignore;\r\n    img.noNeedChangeCurrentImgAviColor = noNeedChangeCurrentImgAviColor;\r\n    // @ts-ignore;\r\n    img.src = /:\\/\\//.test(url) ? url : `./img/${url}`;\r\n    return img;\r\n  }\r\n}\r\n\r\n\r\nfunction sumOfArr(arr: number[]) {\r\n  return arr.reduce((sum, num) => sum += num, 0);\r\n}\r\n\r\nfunction aviOfArr(arr: number[]) {\r\n  return Math.round(sumOfArr(arr) / arr.length);\r\n}\r\n\r\n","// @ts-ignore;\r\nimport {MakeThrottle} from \"@/utils\";\r\nimport {Picture} from \"@/picture/Picture\";\r\n\r\n\r\n// 图片\r\ninterface IMusicConfigOptions {\r\n  images: string[];\r\n}\r\n\r\nexport class MusicConfig {\r\n  lrc: string = '';\r\n  ended?:Function;\r\n  pictureCanvasCtx?: Picture;\r\n  picDom?: Node = undefined;\r\n  imageGroup: string[][] = [];\r\n\r\n  mouseMoveConf = {x: 0, y: 0, w: 1, h: 1, _x: .5, _y: .5}; // 鼠标位置\r\n  // 当前图片计算出来的色调\r\n  currentImgAviColor: [number, number, number, number] =  [255, 255, 255, 1];\r\n  // 当前主音量\r\n  volume: { _main: number; main: number; } = {\r\n    _main: 1,\r\n    main: .01,\r\n  };\r\n  // 当前图片的链接\r\n  currentImgSrc:string = '';\r\n\r\n  constructor(options: IMusicConfigOptions){\r\n    const {images} = options;\r\n    this.imageGroup = [options.images];\r\n\r\n\r\n    const pictureCanvasCtx = new Picture(this);\r\n    this.setPictureCanvasCtx(pictureCanvasCtx);\r\n\r\n    this.currentImgSrc = images[0];\r\n\r\n    if (this.currentImgSrc) {\r\n      this.changePic(undefined, true);\r\n    }\r\n  }\r\n  handelMouseMove(ev: Event){\r\n    if (ev.target !== document.body) return;\r\n    const {mouseMoveConf} = this;\r\n    // @ts-ignore;\r\n    const enent = ev.touches ? ev.touches[0] : ev;\r\n    // @ts-ignore;\r\n    const [x, y, w, h] = [enent.clientX, enent.clientY, enent.target.offsetWidth, enent.target.offsetHeight];\r\n    const conf = {\r\n      x, y, w, h,\r\n      _x: (x - w / 2) / w,\r\n      _y: (y - h / 2) / h\r\n    };\r\n    Object.keys(mouseMoveConf).forEach(key => {\r\n      // @ts-ignore;\r\n      mouseMoveConf[key] = conf[key]\r\n    })\r\n  }\r\n  @MakeThrottle(1)\r\n  shock() {\r\n    // DesktopImage.play(musicConfig.currentImgSrc);\r\n  };\r\n  setLrc(lrc: string){\r\n    this.lrc = lrc;\r\n  }\r\n  getImageData(x: number, y: number, w: number, h: number): ImageData{\r\n    return Picture.getImageData(x, y, w, h);\r\n  };\r\n\r\n\r\n  changePicGroup(reverse: boolean) {\r\n    const {imageGroup} = this;\r\n    if (imageGroup.length) {\r\n      // @ts-ignore;\r\n      reverse ? imageGroup.unshift(imageGroup.pop()) : imageGroup.push(imageGroup.shift());\r\n    }\r\n    this.changePic();\r\n  }\r\n  // 切换图片 // 传参 isReverse // false 时 下一张 true 时 上一张\r\n  changePic(reverse?: boolean, shockAtOnce?: boolean) {\r\n    const images = this.imageGroup[0];\r\n    if (images.length) {\r\n      // @ts-ignore;\r\n      reverse ? images.unshift(images.pop()) : images.push(images.shift());\r\n      this.currentImgSrc = images[0];\r\n      if (this.pictureCanvasCtx) {\r\n        this.picDom =  this.pictureCanvasCtx.load(this.currentImgSrc);\r\n      }\r\n\r\n      shockAtOnce && this.shock();\r\n    }\r\n\r\n  }\r\n  // 增加音量\r\n  encVolume() {\r\n    let {main} = this.volume;\r\n    main = main + 0.05;\r\n    if (main < 0) main = 0;\r\n    if (main > 1) main = 1;\r\n    this.volume.main = main;\r\n  }\r\n  // 减小音量\r\n  decVolumn() {\r\n    let {main} = this.volume;\r\n    main = main - 0.05;\r\n    if (main < 0) main = 0;\r\n    if (main > 1) main = 1;\r\n    this.volume.main = main;\r\n  }\r\n  setPictureCanvasCtx (pictureCanvasCtx: Picture){\r\n    this.pictureCanvasCtx = pictureCanvasCtx;\r\n  }\r\n}\r\n\r\n\r\n\r\n","// 其他 AudioContext API 移步 https://developer.mozilla.org/zh-CN/docs/Web/API/AudioContext\r\n// @ts-ignore;\r\nimport {MusicConfig} from \"src/music/MusicConfig\";\r\n// @ts-ignore;\r\nimport {biquadFilterFrequency} from \"@/components/canvasConfig\";\r\n\r\n\r\n\r\n\r\ninterface IMusicVisualizerConifg {\r\n  musicConfig: MusicConfig;\r\n  size: number;\r\n  draw?: Function;\r\n  volume?: number;\r\n  notClearPrev?: boolean;\r\n}\r\n\r\nfunction createPanner(context: MusicVisualizer){\r\n  const panner = context.ac.createPanner();\r\n  panner.panningModel = 'HRTF';\r\n  panner.distanceModel = 'inverse';\r\n  panner.refDistance = 1;\r\n  panner.maxDistance = 10;\r\n  panner.rolloffFactor = 10;\r\n  panner.coneInnerAngle = 360;\r\n  panner.coneOuterAngle = 0;\r\n  panner.coneOuterGain = 0;\r\n\r\n\r\n  if (panner.orientationX) {\r\n    panner.orientationX.value = 0;\r\n    panner.orientationY.value = 0;\r\n    panner.orientationZ.value = 0;\r\n\r\n    panner.positionX.value = 0;\r\n    panner.positionY.value = 0;\r\n    panner.positionZ.value = 0;\r\n  } else {\r\n    panner.setOrientation && panner.setOrientation(0,0,0);\r\n    panner.setPosition && panner.setPosition(0,0,0)\r\n  }\r\n\r\n  return panner;\r\n}\r\n\r\nfunction initListener (constext: MusicVisualizer){\r\n  const listener = constext.ac.listener;\r\n\r\n  if (listener.forwardX) {\r\n\r\n    listener.forwardX.value = 0;\r\n    listener.forwardY.value = 1;\r\n    listener.forwardZ.value = 0;\r\n\r\n    listener.upX.value = 0;\r\n    listener.upY.value = 0;\r\n    listener.upZ.value = 1;\r\n\r\n\r\n    listener.positionX.value = 0;\r\n    listener.positionY.value = 0;\r\n    listener.positionZ.value = 0;\r\n  } else {\r\n\r\n    listener.setOrientation && listener.setOrientation(0, 1, 0, 0, 0, 1);\r\n    listener.setPosition && listener.setPosition(0, 0, 0)\r\n  }\r\n  return listener;\r\n}\r\n\r\n\r\nfunction createBiquadFilters(context: MusicVisualizer, input: AudioNode, output: AudioNode) {\r\n  // @ts-ignore;\r\n  const biquadFilters =  biquadFilterFrequency.map(frequency => createBiquadFilter(context, frequency));\r\n  // @ts-ignore;\r\n  biquadFilters.forEach(biquadFilter => {\r\n    input.connect(biquadFilter);\r\n    input = biquadFilter;\r\n  });\r\n  input.connect(output);\r\n  return biquadFilters;\r\n}\r\n\r\nfunction createBiquadFilter(context: MusicVisualizer, frequency: number) {\r\n  const biquadFilter = context.ac.createBiquadFilter();\r\n  biquadFilter.type = 'peaking';\r\n  biquadFilter.frequency.value = frequency;\r\n  return biquadFilter;\r\n}\r\n\r\nfunction createAudioSource(context: MusicVisualizer) {\r\n  const $audio = context.$audio = document.createElement('audio');\r\n  const source = context.ac.createMediaElementSource($audio);\r\n  $audio.crossOrigin = \"anonymous\";\r\n  $audio.autoplay = true;\r\n  $audio.volume = context.musicConfig.volume.main;\r\n\r\n  $audio.onended = () => context.musicConfig.ended && context.musicConfig.ended();\r\n  return {$audio, source}\r\n}\r\n\r\n// @ts-ignore;\r\nwindow.dy_player_mv_cache || (window.dy_player_mv_cache = []);\r\n\r\nexport class MusicVisualizer {\r\n  static dtos: MusicVisualizer[] = [];\r\n  duration: number = 1;\r\n  playing: boolean = false;\r\n  stopType: string = '';\r\n  source?: any = null;\r\n  latestPlayTime: number = 0;\r\n  count: number = 0;\r\n  delay: DelayNode;\r\n  musicConfig: MusicConfig;\r\n  gain: GainNode;\r\n  // merger: ChannelMergerNode;\r\n  // splitter: ChannelSplitterNode;\r\n  // gainNodes: { main: GainNode, left: GainNode, right: GainNode };\r\n  size: number;\r\n  analyser: AnalyserNode;\r\n  analyserBefore: AnalyserNode;\r\n\r\n  biquadFilters: BiquadFilterNode[];\r\n  draw?: Function;\r\n  resetLatestPlayTime: boolean = false;\r\n  xhr: XMLHttpRequest;\r\n  panner: PannerNode;\r\n  $audio: HTMLMediaElement;\r\n  isDestoryed: boolean = false;\r\n  // 音频上下文\r\n  ac: AudioContext;\r\n  constructor(obj: IMusicVisualizerConifg) {\r\n    if (!obj.notClearPrev) {\r\n      // @ts-ignore;\r\n      while (dy_player_mv_cache.length){\r\n        // @ts-ignore;\r\n        const cur = dy_player_mv_cache.shift();\r\n        cur.isDestoryed = true;\r\n        cur.destory();\r\n      }\r\n    }\r\n    // @ts-ignore;\r\n    dy_player_mv_cache.push(this);\r\n    // @ts-ignore;\r\n    this.ac = new (window.AudioContext || window.webkitAudioContext)();\r\n\r\n    this.musicConfig = obj.musicConfig;\r\n\r\n    const {$audio, source} = createAudioSource(this);\r\n    this.$audio = $audio;\r\n    $audio.volume = 0.01;\r\n    const panner = this.panner = createPanner(this);\r\n    initListener(this);\r\n\r\n    const analyser = this.analyser = this.ac.createAnalyser();\r\n    const analyserBefore = this.analyserBefore = this.ac.createAnalyser();\r\n    const gain = this.gain = this.ac.createGain();\r\n    gain.gain.value = 0.5;\r\n\r\n\r\n    this.size = obj.size || 8;\r\n    analyserBefore.fftSize = analyser.fftSize = this.size * 2;\r\n\r\n\r\n    const delay = this.delay = this.ac.createDelay();\r\n    delay.delayTime.value = 0.8;\r\n    // navigator.mediaDevices.getUserMedia({audio: true, video: false}).then(res=> {\r\n    //   const node = this.ac.createMediaStreamSource(res);\r\n    //   $audio.autoplay = false;\r\n    //   node.connect(analyserBefore);\r\n    // });\r\n\r\n\r\n    source.connect(analyserBefore);\r\n    // 音源 -> 滤波器\r\n    // @ts-ignore;\r\n    this.biquadFilters = createBiquadFilters(this, analyserBefore, delay);\r\n\r\n    delay.connect(analyser);\r\n    analyser.connect(panner); // 最终听到的\r\n    panner.connect(gain);\r\n    gain.connect(this.ac.destination);\r\n\r\n\r\n    // ajax\r\n    this.xhr = new XMLHttpRequest();\r\n    this.draw = obj.draw;\r\n\r\n    obj.volume && this.changeVolume(obj.volume);\r\n    this.visualize();\r\n  }\r\n\r\n  load(url: string, fun: Function) {\r\n    this.stopType = '';\r\n    this.playing = false;\r\n    this.xhr.abort();\r\n    this.xhr.open(\"GET\", url);\r\n    this.xhr.responseType = \"arraybuffer\";\r\n    this.xhr.onload = () => {\r\n      fun(this.xhr.response);\r\n    };\r\n    this.xhr.send();\r\n  };\r\n  destory(){\r\n    this.$audio && this.$audio.pause();\r\n    this.ac.suspend();\r\n  }\r\n\r\n\r\n// BaseAudioContext.decodeAudioData()用来生成AudioBuffer\r\n// AudioBuffer供AudioBufferSourceNode使用，这样，AudioBufferSourceNode才可以播放音频数据\r\n  decode(arrayBuffer: ArrayBuffer, fun: Function) {\r\n    this.ac.decodeAudioData(arrayBuffer, function (buffer: any) {\r\n      fun(buffer);\r\n    }, function (err: Error) {\r\n      console.log(err);\r\n    });\r\n  };\r\n\r\n  play(path: ArrayBuffer | string) {\r\n    const n = ++this.count;\r\n    this.source && this.source[this.source.stop ? \"stop\" : \"noteOff\"](); // 开始前先暂停之前音频的播放，防止多份音频同时播放\r\n    this.resetLatestPlayTime = true;\r\n\r\n    if (path instanceof ArrayBuffer) {\r\n      this.decode(path, (buffer: ArrayBuffer) => {\r\n        if (n !== this.count) return;\r\n        const bufferSource: AudioBufferSourceNode = this.ac.createBufferSource();\r\n        // 将解码成功后的buffer赋值给bufferSource的buffer属性\r\n        // @ts-ignore;\r\n        bufferSource.buffer = buffer;\r\n        // bufferSource.loop = true;\r\n        bufferSource.connect(this.analyserBefore);\r\n        // @ts-ignore;\r\n        bufferSource[bufferSource.start ? \"start\" : \"noteOn\"](0);\r\n        this.source = bufferSource;\r\n        this.resetLatestPlayTime && (this.latestPlayTime = this.ac.currentTime);\r\n      });\r\n    } else {\r\n      // @ts-ignore;\r\n      if (window.isPhone) {\r\n        this.load(path, (arrayBuffer: ArrayBuffer) => {\r\n          if (n !== this.count) return;\r\n          this.decode(arrayBuffer, (buffer: ArrayBuffer) => {\r\n            this.playing = true;\r\n            if (n !== this.count) return;\r\n            const bufferSource: AudioBufferSourceNode = this.ac.createBufferSource();\r\n            // @ts-ignore;\r\n            bufferSource.buffer = buffer;\r\n            bufferSource.connect(this.analyserBefore);\r\n            // @ts-ignore;\r\n            bufferSource[bufferSource.start ? \"start\" : \"noteOn\"](0);\r\n            this.source = bufferSource;\r\n            bufferSource.onended = () => {\r\n              if (this.stopType) {\r\n              } else {\r\n                this.musicConfig.ended && this.musicConfig.ended();\r\n              }\r\n            };\r\n            this.resetLatestPlayTime && (this.latestPlayTime = this.ac.currentTime);\r\n          });\r\n        });\r\n      } else {\r\n        this.$audio.src = path;\r\n      }\r\n\r\n\r\n    }\r\n  };\r\n\r\n  // 主音量控制方法\r\n  changeVolume(percent: number) {\r\n    // @ts-ignore;\r\n    this.musicConfig.volume.main = percent;\r\n  };\r\n\r\n  // 左右声道控制方法\r\n  setVolume() {\r\n    const {musicConfig} = this;\r\n    const {main,} = musicConfig.volume;\r\n\r\n    this.$audio.volume = main;\r\n    const {panner} = this;\r\n\r\n    const {x, y, w, h} = musicConfig.mouseMoveConf;\r\n\r\n    const _x = (x-w/2)/w;\r\n    const _y = -(y-h/2)/h;\r\n\r\n    if (panner.positionX) {\r\n      panner.positionX.value = _x;\r\n      panner.positionY.value = _y;\r\n    } else {\r\n      panner.setPosition && panner.setPosition(_x,_y,0)\r\n    }\r\n  };\r\n\r\n  visualize() {\r\n    const realTimeData = new Uint8Array(this.analyser.frequencyBinCount);//数组长度是fftsize的一半\r\n    const originData = new Uint8Array(this.analyserBefore.frequencyBinCount);//数组长度是fftsize的一半\r\n\r\n    const requestAnimationFrame = window.requestAnimationFrame ||\r\n      // @ts-ignore;\r\n      window.webkitrequestAnimationFrame ||\r\n      // @ts-ignore;\r\n      window.mozrequestAnimationFrame;//兼容\r\n    const fn = () => {\r\n      // @ts-ignore;\r\n      if (!window.hidden) {\r\n        if (this.draw) {\r\n          this.analyser.getByteFrequencyData(realTimeData);// 将音频频域数据复制到传入的Uint8Array数组\r\n          this.analyserBefore.getByteFrequencyData(originData);// 将音频频域数据复制到传入的Uint8Array数组\r\n          this.draw({realTimeData, originData});\r\n        }\r\n        this.setVolume();\r\n      }\r\n      this.isDestoryed || requestAnimationFrame(fn);\r\n    }\r\n    requestAnimationFrame(fn);\r\n  }\r\n}\r\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"nav-bar\",class:{active: _vm.active},on:{\"click\":function($event){_vm.active =! _vm.active}}},[_c('ul',[_vm._l((_vm.navList.list),function(item,index){return _c('li',[(item.type==='fileReader')?[_c('label',{attrs:{\"for\":item.id}},[_vm._v(\" \"+_vm._s(item.name)+\" \"),_c('input',{attrs:{\"type\":\"file\",\"id\":item.id},on:{\"change\":function($event){$event.stopPropagation();item.callback && item.callback($event)}}})])]:[_c('div',{on:{\"click\":function($event){$event.stopPropagation();item.callback && item.callback()}}},[_vm._v(_vm._s(item.name))])]],2)}),_vm._t(\"default\")],2)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"nav-bar\" :class=\"{active: active}\" @click=\"active =! active\">\r\n    <ul>\r\n      <li v-for=\"(item, index) in navList.list\">\r\n        <template v-if=\"item.type==='fileReader'\">\r\n          <label :for=\"item.id\">\r\n            {{item.name}}\r\n            <input type=\"file\" :id=\"item.id\" @change.stop=\"item.callback && item.callback($event)\">\r\n          </label>\r\n        </template>\r\n        <template v-else>\r\n          <div @click.stop=\"item.callback && item.callback()\">{{item.name}}</div>\r\n        </template>\r\n      </li>\r\n      <slot></slot>\r\n    </ul>\r\n  </div>\r\n</template>\r\n<script>\r\n\r\n  export default {\r\n    name: 'BalanceView',\r\n    provide() {\r\n      return {}\r\n    },\r\n    components: {},\r\n    mixins: [],\r\n    props: [],\r\n    inject: [\r\n      'musicDataFlags',\r\n      'musicData',\r\n      'musicConfig',\r\n      'gameList',\r\n      'mv',\r\n      'modifyManager',\r\n      'navList',\r\n    ],\r\n    data() {\r\n      return {\r\n        balanceTrack: this.modifyManager.balanceTrack,\r\n        searchText: '',\r\n        active: false,\r\n      }\r\n    },\r\n    computed: {},\r\n    watch: {\r\n    },\r\n    methods: {\r\n    },\r\n    mounted() {\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" type=\"text/less\" scoped>\r\n  .nav-bar {\r\n    position: fixed;\r\n    top: 0;\r\n    right: 0;\r\n    width: 60px;\r\n    height: 60px;\r\n    padding-right: 60px;\r\n    overflow: hidden;\r\n    z-index: 3010;\r\n    transition: all .3s;\r\n    background-color: rgba(255,255,255,.3);\r\n    &.active{\r\n      width: 100%;\r\n    }\r\n    ul{\r\n      display: flex;\r\n      justify-content: flex-end;\r\n      /deep/li{\r\n        display: flex;\r\n        height: 60px;\r\n        padding: 0 10px;\r\n        align-items: center;\r\n        justify-content: center;\r\n        white-space: nowrap;\r\n        background-color: rgba(255,255,255,.3);\r\n        cursor: pointer;\r\n      }\r\n    }\r\n  }\r\n</style>\r\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./NavBar.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./NavBar.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./NavBar.vue?vue&type=template&id=d6d933a2&scoped=true&\"\nimport script from \"./NavBar.vue?vue&type=script&lang=js&\"\nexport * from \"./NavBar.vue?vue&type=script&lang=js&\"\nimport style0 from \"./NavBar.vue?vue&type=style&index=0&id=d6d933a2&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"d6d933a2\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ListBoxView',{attrs:{\"config\":_vm.config}})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","export default [\"album.js\",\"artists.js\",\"artist_album.js\",\"artist_desc.js\",\"artist_list.js\",\"artist_mv.js\",\"artist_sub.js\",\"artist_sublist.js\",\"banner.js\",\"check_music.js\",\"comment.js\",\"comment_album.js\",\"comment_dj.js\",\"comment_hot.js\",\"comment_like.js\",\"comment_music.js\",\"comment_mv.js\",\"comment_playlist.js\",\"comment_video.js\",\"daily_signin.js\",\"dj_catelist.js\",\"dj_detail.js\",\"dj_hot.js\",\"dj_paygift.js\",\"dj_program.js\",\"dj_program_detail.js\",\"dj_recommend.js\",\"dj_recommend_type.js\",\"dj_sub.js\",\"dj_sublist.js\",\"event.js\",\"fm_trash.js\",\"follow.js\",\"like.js\",\"likelist.js\",\"login.js\",\"login_cellphone.js\",\"login_refresh.js\",\"login_status.js\",\"logout.js\",\"lyric.js\",\"mv_detail.js\",\"mv_first.js\",\"mv_sub.js\",\"mv_url.js\",\"personalized.js\",\"personalized_djprogram.js\",\"personalized_mv.js\",\"personalized_newsong.js\",\"personalized_privatecontent.js\",\"personal_fm.js\",\"playlist_catlist.js\",\"playlist_create.js\",\"playlist_detail.js\",\"playlist_hot.js\",\"playlist_subscribe.js\",\"playlist_tracks.js\",\"playlist_update.js\",\"program_recommend.js\",\"recommend_resource.js\",\"recommend_songs.js\",\"related_allvideo.js\",\"related_playlist.js\",\"resource_like.js\",\"search.js\",\"search_hot.js\",\"search_multimatch.js\",\"search_suggest.js\",\"send_playlist.js\",\"send_text.js\",\"simi_artist.js\",\"simi_mv.js\",\"simi_playlist.js\",\"simi_song.js\",\"simi_user.js\",\"song_detail.js\",\"song_url.js\",\"toplist.js\",\"toplist_artist.js\",\"toplist_detail.js\",\"top_album.js\",\"top_artists.js\",\"top_list.js\",\"top_mv.js\",\"top_playlist.js\",\"top_playlist_highquality.js\",\"top_song.js\",\"user_audio.js\",\"user_cloud.js\",\"user_cloud_search.js\",\"user_detail.js\",\"user_dj.js\",\"user_event.js\",\"user_followeds.js\",\"user_follows.js\",\"user_playlist.js\",\"user_record.js\",\"user_subcount.js\",\"user_update.js\",\"video_detail.js\",\"video_sub.js\",\"video_url.js\",\"weblog.js\"]","// const fs = require(\"fs\");\r\n// const path = require(\"path\");\r\n\r\nfunction makeAjax(url) {\r\n  return function (data) {\r\n    const cb = {fn: null, then: fn => (cb.fn = fn)}\r\n    const fullUrl = `${location.protocol}//${location.hostname}:3000` + url + (data ? (\"?\" + Object.keys(data).map(item => item + \"=\" + data[item]).join(\"&\")) : \"\");\r\n    fetch(encodeURI(fullUrl), {\r\n      xhrFields: {withCredentials: true},\r\n      credentials: 'include'\r\n    }).then(res => {\r\n      res.json().then(res => cb.fn && cb.fn(res)).catch(e => console.log(e));\r\n    });\r\n    return fn => cb.fn = fn;\r\n  }\r\n}\r\n\r\nconst special = {\r\n  'daily_signin.js': '/daily_signin',\r\n  'fm_trash.js': '/fm_trash',\r\n  'personal_fm.js': '/personal_fm'\r\n}\r\nexport const ajax = {};\r\n\r\nfunction camel(str) {\r\n  return str.replace(/\\//, \"\")\r\n    .split(/\\//)\r\n    .map((item, index) =>\r\n      index ?\r\n        (item[0].toUpperCase() + item.slice(1)) :\r\n        item\r\n    ).join(\"\");\r\n}\r\nimport httpConf from './httpConf.js';\r\nhttpConf.forEach(file => {\r\n  if (!(/\\.js$/i.test(file))) return;\r\n  let route = (file in special) ? special[file] : '/' + file.replace(/\\.js$/i, '').replace(/_/g, '/');\r\n  ajax[camel(route)] = makeAjax(route)\r\n});\r\n\r\n","interface IListBoxOption {\r\n\r\n  play?: Function;\r\n  playing?: number;\r\n  current?: number;\r\n}\r\n\r\nexport class ListBox {\r\n  play?: Function;\r\n  playing: number = 0;\r\n  current: number = 0;\r\n  list: (ListBox|Object)[];\r\n  constructor(options: IListBoxOption = {}) {\r\n    // @ts-ignore;\r\n    Object.keys(options).forEach(key => this[key] = options[key]);\r\n    this.play = () => this;\r\n    if (options.play) {\r\n      this.play = () => {\r\n        options.play && options.play(...arguments);\r\n        this.playing = this.current;\r\n      }\r\n    }\r\n    this.list = [];\r\n    this.playing = 0;\r\n    this.current = 0;\r\n  }\r\n\r\n  get len() {\r\n    return this.list.length;\r\n  }\r\n\r\n  setList(list: (ListBox|Object)[], shallPlay?: boolean) {\r\n    this.list = list;\r\n    this.current = 0;\r\n    if (shallPlay) this.play && this.play();\r\n    return this;\r\n  }\r\n\r\n  setIndex(index: number) {\r\n    if (index > this.len - 1) index = this.len - 1;\r\n    if (index < 0) index = 0;\r\n    this.current = index;\r\n    return this;\r\n  }\r\n\r\n  prev(type: string) {\r\n    console.log(type)\r\n    // @ts-ignore;\r\n    this.setIndex((this.current - 1 + this.len) % this.len, ...arguments);\r\n    return this;\r\n  }\r\n\r\n  next() {\r\n    // @ts-ignore;\r\n    this.setIndex((this.current + 1) % this.len, ...arguments);\r\n    return this;\r\n  }\r\n}\r\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('label',{staticClass:\"music-wrap\",class:{focus: _vm.isFocus},attrs:{\"for\":_vm.itemId}},[_c('div',{staticClass:\"search-box\",class:{focus: _vm.isFocus}},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.config.searchText),expression:\"config.searchText\"}],ref:\"input\",attrs:{\"id\":_vm.itemId,\"type\":\"text\",\"autocomplete\":\"off\",\"placeholder\":\"网易云音乐\"},domProps:{\"value\":(_vm.config.searchText)},on:{\"focus\":_vm.focus,\"blur\":_vm.blur,\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.config, \"searchText\", $event.target.value)}}})]),_c('div',{staticClass:\"music-lists\"},[_vm._l((_vm.config.tabs.list),function(tabItem,index){return _c('div',{staticClass:\"song-list\",class:{\n        prev: index === (_vm.tabs.current - 1 + _vm.tabs.list.length) % _vm.tabs.list.length,\n        active: index === _vm.tabs.current,\n        next: index === (_vm.tabs.current + 1) % _vm.tabs.list.length,\n      }},[(_vm.getImgUrl(tabItem.list[tabItem.current]))?_c('span',{style:({backgroundImage: (\"url('\" + (_vm.getImgUrl(tabItem.list[tabItem.current])) + \"')\")})}):_vm._e(),_c('div',[_c('ul',{style:({transform: (\"translateY(-\" + (50 * tabItem.current) + \"px)\")})},_vm._l((tabItem.list),function(song,_index){return _c('li',{class:{active: tabItem.current === _index, playing: tabItem.playing === _index},on:{\"click\":function($event){$event.stopPropagation();return tabItem.setIndex(_index, 'list_box_click')}}},[_c('span',[(_vm.config.type === 'modify' && index === 1)?_c('ProgressBar',{attrs:{\"template\":\"\",\"config\":song}}):[(_vm.getImgUrl(song))?_c('img',{attrs:{\"src\":_vm.getImgUrl(song)}}):_vm._e(),_vm._v(\" \"+_vm._s(song.name)+\" \"),_c('span',{staticClass:\"button\",on:{\"click\":function($event){tabItem.setIndex(_index, 'list_box_click').play('list_box_click')}}},[_vm._v(\"play\")]),(tabItem.copy)?_c('span',{staticClass:\"button\",on:{\"click\":function($event){tabItem.setIndex(_index, 'list_box_click').copy('list_box_click')}}},[_vm._v(\"copy\")]):_vm._e(),(tabItem.delete)?_c('span',{staticClass:\"button\",on:{\"click\":function($event){tabItem.setIndex(_index, 'list_box_click').delete('list_box_click')}}},[_vm._v(\"delete\")]):_vm._e(),(song.rename)?_c('span',{staticClass:\"button\",on:{\"click\":function($event){_vm.config.searchText && song.rename(_vm.config.searchText, 'list_box_click')}}},[_vm._v(\"rename\")]):_vm._e()]],2)])}),0)])])}),_c('div',{staticClass:\"music-lists-prev\",on:{\"click\":function($event){$event.stopPropagation();return _vm.tabs.prev()}}}),_c('div',{staticClass:\"music-lists-next\",on:{\"click\":function($event){$event.stopPropagation();return _vm.tabs.next()}}})],2)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"progress-bar-wrap\"},[_c('div',{staticClass:\"progress-bar\"},[_c('span',[_vm._v(_vm._s(_vm.config.name))]),_c('span',[_vm._v(_vm._s(_vm.config.min))]),_c('div',{ref:\"drag\",on:{\"mousedown\":function($event){return _vm.touchEv($event)},\"mousemove\":function($event){return _vm.moveEv($event)},\"mouseup\":function($event){return _vm.endEv()},\"mouseleave\":function($event){return _vm.endEv()}}},[_c('span',{style:(_vm.barStyle)})]),_c('span',[_vm._v(_vm._s(_vm.config.max))]),_c('span',{on:{\"click\":function($event){return _vm.config.setMin()}}},[_vm._v(\"min\")]),_c('span',{on:{\"click\":function($event){return _vm.config.dec()}}},[_vm._v(\"dec\")]),_c('span',[_vm._v(_vm._s(_vm.config.value))]),_c('span',{on:{\"click\":function($event){return _vm.config.enc()}}},[_vm._v(\"enc\")]),_c('span',{on:{\"click\":function($event){return _vm.config.setMax()}}},[_vm._v(\"max\")]),_c('span',{on:{\"click\":function($event){return _vm.config.reset()}}},[_vm._v(\"reset\")])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","interface IPosition {\r\n  x: number;\r\n  y: number;\r\n}\r\ninterface IOption {\r\n  direction?: '' | 'x' | 'y' | 'xy';\r\n  doNotStopWhenMatch?: boolean;\r\n  position?: IPosition;\r\n  resetPositionWhenTouch?: boolean;\r\n}\r\nclass Drag {\r\n  rect?: {w: number, h: number};\r\n  position: IPosition;\r\n  $el?: EventTarget | null;\r\n  direction: '' | 'x' | 'y' | 'xy';\r\n  _direction: '' | 'x' | 'y' | 'xy';\r\n  oriPoint: IPosition;\r\n  ori: IPosition;\r\n  pre: IPosition;\r\n  now: IPosition;\r\n  doNotStopWhenMatch?: boolean;\r\n  isTouching: boolean;\r\n  touched: boolean;\r\n  cachePosition: IPosition[];\r\n  moved: boolean = false;\r\n  DOMRect?: DOMRect;\r\n  resetPositionWhenTouch: boolean;\r\n  constructor(option: IOption = {}) {\r\n    this.direction = option.direction || 'xy';\r\n    this.oriPoint = {y: 0, x: 0};\r\n    this.ori = {y: 0, x: 0};\r\n    this.pre = {y: 0, x: 0};\r\n    this.now = {y: 0, x: 0};\r\n    this.doNotStopWhenMatch = option.doNotStopWhenMatch;\r\n    this.resetPositionWhenTouch = option.resetPositionWhenTouch || false;\r\n\r\n    this.position = option.position || {x: 0, y: 0};\r\n    this.isTouching = false;\r\n    this._direction = '';\r\n    this.touched = false;\r\n    // 存储用于计算平均速度\r\n    this.cachePosition =[];\r\n  }\r\n  setEl($el: EventTarget | null){\r\n    this.$el = $el;\r\n    // @ts-ignore;\r\n    const DOMRect = this.DOMRect = $el.getBoundingClientRect();\r\n    this.rect = {h: DOMRect.bottom - DOMRect.top, w: DOMRect.right - DOMRect.left}\r\n  }\r\n\r\n  touchEv(ev: Event) {\r\n    this.setEl(ev.target);\r\n    if (this.resetPositionWhenTouch) {\r\n      const {position, DOMRect} = this;\r\n      if (DOMRect) {\r\n        // @ts-ignore;\r\n        position.x = ev.screenX - DOMRect.left;\r\n        // @ts-ignore;\r\n        position.y = ev.screenY - DOMRect.top;\r\n      }\r\n\r\n    }\r\n      // 假设不触发开始事件， 则move事件也不应该触发\r\n    this.touched = true;\r\n    // @ts-ignore;\r\n    let {clientY, clientX} = ev.touches ? ev.touches[0] : ev;\r\n    this.oriPoint = {y: clientY, x: clientX};\r\n    if (!this.direction.includes('x')) {clientX = 0;}\r\n    if (!this.direction.includes('y')) {clientY = 0;}\r\n    this.ori = {y: clientY, x: clientX};\r\n    this.pre = {y: clientY, x: clientX};\r\n    this.now = {y: clientY, x: clientX};\r\n    this.isTouching = true;\r\n    this.moved = false;\r\n    this.cachePosition = [];\r\n    this._direction = '';\r\n  }\r\n\r\n  moveEv(ev: Event) {\r\n    if (!this.touched) return;\r\n    // @ts-ignore;\r\n    const {clientY, clientX} = ev.touches ? ev.touches[0] : ev;\r\n    const now = {y: 0, x: 0};\r\n    this._direction || (this._direction = Math.abs(clientX - this.oriPoint.x) < Math.abs(clientY - this.oriPoint.y) ? 'y' : 'x');\r\n    if (this.direction.includes('x')) {now.x = clientX;}\r\n    if (this.direction.includes('y')) {now.y = clientY;}\r\n\r\n    this.cachePosition.push(now);\r\n\r\n    if (this.direction.includes(this._direction)) {\r\n      this.pre = this.now;\r\n      this.now = now;\r\n      if (!this.doNotStopWhenMatch) {\r\n        ev.cancelBubble = true;\r\n        ev.stopPropagation();\r\n        ev.preventDefault();\r\n      }\r\n    }\r\n  }\r\n\r\n  endEv() {\r\n    this.touched = false;\r\n    this.isTouching = false;\r\n    const offset = this.getOffset();\r\n    const oriPosition = this.position;\r\n    const rect = this.rect;\r\n    const position = {\r\n      x: oriPosition.x + offset.x,\r\n      y: oriPosition.y + offset.y,\r\n    };\r\n    if (rect) {\r\n      position.x < 0 && (position.x = 0);\r\n      position.y < 0 && (position.y = 0);\r\n      position.x > rect.w && (position.x = rect.w);\r\n      position.y > rect.h && (position.y = rect.h);\r\n    }\r\n    this.position = position;\r\n  }\r\n\r\n  getPercent(){\r\n    const {rect, position,isTouching} = this;\r\n    const offset = this.getOffset();\r\n    if (rect) {\r\n      return {\r\n        x: (position.x + (isTouching ? offset.x : 0)) / rect.w,\r\n        y: (position.y + (isTouching ? offset.y : 0)) / rect.h,\r\n      }\r\n    }\r\n  }\r\n  setPercent(per: IPosition){\r\n    const {rect, position} = this;\r\n    const {x, y} = per;\r\n    if (rect) {\r\n      position.x = x * rect.w;\r\n      position.y = y * rect.h;\r\n    }\r\n  }\r\n  getOffset() {\r\n    return {\r\n      y: this.now.y - this.ori.y,\r\n      x: this.now.x - this.ori.x,\r\n    }\r\n  }\r\n\r\n  getSpeed() {\r\n    return {\r\n      y: this.now.y - this.pre.y,\r\n      x: this.now.x - this.pre.x,\r\n    }\r\n  }\r\n}\r\n\r\nexport default Drag;\r\n","<template>\r\n  <div class=\"progress-bar-wrap\">\r\n    <div class=\"progress-bar\">\r\n      <span>{{config.name}}</span>\r\n      <span>{{config.min}}</span>\r\n      <div\r\n        @mousedown=\"touchEv($event)\"\r\n        @mousemove=\"moveEv($event)\"\r\n        @mouseup=\"endEv()\"\r\n        @mouseleave=\"endEv()\"\r\n        ref=\"drag\"\r\n      >\r\n        <span :style=\"barStyle\"></span>\r\n      </div>\r\n      <span>{{config.max}}</span>\r\n      <span @click=\"config.setMin()\">min</span>\r\n      <span @click=\"config.dec()\">dec</span>\r\n      <span>{{config.value}}</span>\r\n      <span @click=\"config.enc()\">enc</span>\r\n      <span @click=\"config.setMax()\">max</span>\r\n      <span @click=\"config.reset()\">reset</span>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\n  import Drag from \"../tools/Drag\";\r\n\r\n  export default {\r\n    name: 'ProgressBar',\r\n    inject: [\r\n      'musicDataFlags',\r\n      'musicData',\r\n      'musicConfig',\r\n      'gameList',\r\n      'mv',\r\n      'modifyManager',\r\n      'commonOptions_'\r\n    ],\r\n    props: ['config'],\r\n    data() {\r\n      return {\r\n        drag: new Drag({\r\n          doNotStopWhenMatch: true,\r\n          resetPositionWhenTouch: true\r\n        }),\r\n      }\r\n    },\r\n    methods: {\r\n      touchEv(ev){\r\n        this.drag.touchEv(ev);\r\n      },\r\n      moveEv(ev){\r\n        this.drag.moveEv(ev);\r\n      },\r\n      endEv(ev){\r\n        this.drag.endEv(ev);\r\n        this.setPer()\r\n      },\r\n      setPer(){\r\n        if (!this.$el || this.drag.isTouching) return;\r\n        const {config, drag} = this;\r\n        drag.setPercent({x: (this.currentVal - config.min) / (config.max - config.min), y: 0});\r\n      },\r\n    },\r\n    computed: {\r\n      percent(){\r\n        const {drag} = this;\r\n        const {isTouching, position} = drag;\r\n        const per = drag.getPercent();\r\n        return per ? per.x : 0;\r\n      },\r\n      barStyle(){\r\n        const {isTouching} = this.drag;\r\n        return {\r\n          width: `${this.percent * 100}%`,\r\n          transition: `all ${isTouching ? 0 : .3}s`\r\n        }\r\n      },\r\n      currentVal(){\r\n        const {config} = this;\r\n        if (!config) return 0;\r\n        return config.value;\r\n      }\r\n    },\r\n    watch: {\r\n      currentVal: {\r\n        immediate: true,\r\n        handler(){\r\n          this.setPer();\r\n        }\r\n      },\r\n      config: {\r\n        immediate: true,\r\n        handler(){\r\n          this.setPer();\r\n        }\r\n      },\r\n      percent(){\r\n        const {config} = this;\r\n        config.setVal(Math.round(this.percent * (config.max - config.min)) + config.min);\r\n      },\r\n    },\r\n    mounted() {\r\n      const {config, drag} = this;\r\n      config.current = 8;\r\n      drag.setEl(this.$refs.drag);\r\n      this.setPer();\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" type=\"text/less\" scoped>\r\n  .progress-bar-wrap{\r\n    padding: 0 10px;\r\n    width: 100%;\r\n    height: 100%;\r\n  }\r\n  .progress-bar {\r\n    position: relative;\r\n\r\n    width: 100%;\r\n    height: 100%;\r\n\r\n    overflow: hidden;\r\n    z-index: 5000;\r\n    user-select: none;\r\n    display: flex;\r\n    >span{\r\n      padding: 0 4px;\r\n      cursor: pointer;\r\n      min-width: 40px;\r\n      font-size: 16px;\r\n    }\r\n    >div{\r\n      position: relative;\r\n      flex: 1 1 0;\r\n      cursor: pointer;\r\n\r\n      &::before{\r\n        position: absolute;\r\n        content: '';\r\n        display: block;\r\n        width: 100%;\r\n        height: 1px;\r\n        background-color: rgba(255,255,255,.8);\r\n        top: 50%;\r\n        left: 0;\r\n        transform: translateY(-50%) scale(1, 0.5);\r\n        border-radius: 10px;\r\n      }\r\n      >span{\r\n        position: relative;\r\n        display: block;\r\n        height: 100%;\r\n        &::after{\r\n          display: block;\r\n          content: '';\r\n          position: absolute;\r\n          width: 20px;\r\n          height: 20px;\r\n          background-color: rgba(255,255,255,1);\r\n          right: 0;\r\n          top: 50%;\r\n          transform: translate(50%, -50%);\r\n          border-radius: 4px;\r\n        }\r\n\r\n      }\r\n      &::after{\r\n        position: absolute;\r\n        content: '';\r\n        display: block;\r\n        width: 100%;\r\n        height: 100%;\r\n        top: 0;\r\n        left: 0;\r\n      }\r\n    }\r\n  }\r\n\r\n</style>\r\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./ProgressBar.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./ProgressBar.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ProgressBar.vue?vue&type=template&id=3982f1bd&scoped=true&\"\nimport script from \"./ProgressBar.vue?vue&type=script&lang=js&\"\nexport * from \"./ProgressBar.vue?vue&type=script&lang=js&\"\nimport style0 from \"./ProgressBar.vue?vue&type=style&index=0&id=3982f1bd&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3982f1bd\",\n  null\n  \n)\n\nexport default component.exports","<template>\r\n  <label :for=\"itemId\" class=\"music-wrap\" :class=\"{focus: isFocus}\">\r\n    <div class=\"search-box\" :class=\"{focus: isFocus}\">\r\n      <input :id=\"itemId\" ref=\"input\" type=\"text\" v-model=\"config.searchText\" autocomplete=\"off\" placeholder=\"网易云音乐\" @focus=\"focus\" @blur=\"blur\">\r\n    </div>\r\n    <div class=\"music-lists\">\r\n      <div\r\n        class=\"song-list\"\r\n        v-for=\"(tabItem, index) in config.tabs.list\"\r\n        :class=\"{\r\n          prev: index === (tabs.current - 1 + tabs.list.length) % tabs.list.length,\r\n          active: index === tabs.current,\r\n          next: index === (tabs.current + 1) % tabs.list.length,\r\n        }\"\r\n      >\r\n        <span\r\n          v-if=\"getImgUrl(tabItem.list[tabItem.current])\"\r\n          :style=\"{backgroundImage: `url('${getImgUrl(tabItem.list[tabItem.current])}')`}\"\r\n        ></span>\r\n        <div>\r\n          <ul\r\n            :style=\"{transform: `translateY(-${50 * tabItem.current}px)`}\">\r\n            <li\r\n              v-for=\"(song, _index) in tabItem.list\"\r\n              :class=\"{active: tabItem.current === _index, playing: tabItem.playing === _index}\"\r\n              @click.stop=\"tabItem.setIndex(_index, 'list_box_click')\"\r\n            >\r\n              <span>\r\n\r\n                <ProgressBar template v-if=\"config.type === 'modify' && index === 1\" :config=\"song\"></ProgressBar>\r\n                <template v-else>\r\n                  <img :src=\"getImgUrl(song)\" v-if=\"getImgUrl(song)\"/>\r\n                  {{ song.name }}\r\n                  <span class=\"button\" @click=\"tabItem.setIndex(_index, 'list_box_click').play('list_box_click')\">play</span>\r\n                  <span v-if=\"tabItem.copy\" class=\"button\" @click=\"tabItem.setIndex(_index, 'list_box_click').copy('list_box_click')\">copy</span>\r\n                  <span v-if=\"tabItem.delete\" class=\"button\" @click=\"tabItem.setIndex(_index, 'list_box_click').delete('list_box_click')\">delete</span>\r\n                  <span\r\n                    v-if=\"song.rename\"\r\n                    class=\"button\"\r\n                    @click=\"config.searchText && song.rename(config.searchText, 'list_box_click')\"\r\n                  >rename</span>\r\n                </template>\r\n              </span>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"music-lists-prev\" @click.stop=\"tabs.prev()\">  </div>\r\n      <div class=\"music-lists-next\" @click.stop=\"tabs.next()\">  </div>\r\n    </div>\r\n  </label>\r\n</template>\r\n<script>\r\n  import {shortCut, ShortCut} from \"../tools/ShortCut\";\r\n  import ProgressBar from './ProgressBar';\r\n  export default {\r\n    name: 'ListBoxView',\r\n    provide() {\r\n      return {}\r\n    },\r\n    components: {\r\n      ProgressBar\r\n    },\r\n    mixins: [],\r\n    inject: [\r\n      'musicDataFlags',\r\n      'musicData',\r\n      'musicConfig',\r\n      'gameList',\r\n      'mv',\r\n      'modifyManager',\r\n      'navList'\r\n    ],\r\n    props: ['config'],\r\n    computed: {\r\n      tabs(){\r\n        return this.config.tabs;\r\n      },\r\n      itemId(){\r\n        return `ListBoxView_${this.config.focusKey}`;\r\n      }\r\n    },\r\n    watch: {\r\n    },\r\n    data(){;\r\n      return {\r\n        isFocus: false\r\n      }\r\n    },\r\n    methods: {\r\n      focus(){\r\n        const time = this.isFocus_ = Date.now();\r\n        setTimeout(() => {\r\n          time === this.isFocus_ && (this.isFocus = true);\r\n        }, 300)\r\n      },\r\n      blur(){\r\n        const time = this.isFocus_ = Date.now();\r\n        setTimeout(() => {\r\n          time === this.isFocus_ && (this.isFocus = false);\r\n        }, 300)\r\n      },\r\n      getImgUrl(song) {\r\n        return song && (song.coverImgUrl || song.al && song.al.picUrl || song.album && song.album.picUrl);\r\n      },\r\n    },\r\n    beforeDestory() {\r\n    },\r\n    mounted() {\r\n      this.navList.enter({\r\n        name: this.config.name,\r\n        id: this.itemId,\r\n        callback: () => {\r\n          this.$refs.input.focus()\r\n        }\r\n      });\r\n      const {musicConfig, gameList, mv, config} = this;\r\n      const {tabs} = config;\r\n      this.$shortCut = new ShortCut();\r\n\r\n      config.type === 'modify' && this.$shortCut.init(this.$refs.input, {\r\n        common: {\r\n          w: () => config.tabs.up('list_box_shortcut'),\r\n          s: () => config.tabs.down('list_box_shortcut'),\r\n          q: () => config.tabs.prev('list_box_shortcut'),\r\n          e: () => config.tabs.next('list_box_shortcut'),\r\n          enter: () => config.searchText ? tabs.search && tabs.search() : tabs.play && tabs.play(),\r\n          107: () => config.tabs.add(undefined, 'list_box_shortcut'),\r\n          delete: () => config.tabs.delete(undefined, 'list_box_shortcut'),\r\n          c: () => config.tabs.copy(undefined, 'list_box_shortcut'),\r\n          4: () => config.tabs.dec('list_box_shortcut'),\r\n          6: () => config.tabs.enc('list_box_shortcut'),\r\n          left: () => config.tabs.dec('list_box_shortcut'),\r\n          right: () => config.tabs.enc('list_box_shortcut'),\r\n          a: () => config.tabs.dec('list_box_shortcut'),\r\n          d: () => config.tabs.enc('list_box_shortcut'),\r\n          8: () => config.tabs.prevItem('list_box_shortcut'),\r\n          2: () => config.tabs.nextItem('list_box_shortcut'),\r\n          up: () => config.tabs.prevItem('list_box_shortcut'),\r\n          down: () => config.tabs.nextItem('list_box_shortcut'),\r\n          esc: () => this.$refs.input.blur('list_box_shortcut'),\r\n        },\r\n        alt: {},\r\n        shift: {},\r\n        ctrl: {}\r\n      }, {\r\n        common: {\r\n          w: `上一项`,\r\n          s: `下一项`,\r\n          q: `左翻页`,\r\n          e: `右翻页`,\r\n          107: `添加配置`,\r\n          delete: `删除配置`,\r\n          c: `复制当前配置`,\r\n          4: `参数小`,\r\n          6: `参数大`,\r\n          left: `参数小`,\r\n          right: `参数大`,\r\n          a: `参数小`,\r\n          d: `参数大`,\r\n          8: `上一项`,\r\n          2: `下一项`,\r\n          up: `上一项`,\r\n          down: `下一项`,\r\n          esc: `关闭配置页面`,\r\n        },\r\n        alt: {},\r\n        shift: {},\r\n        ctrl: {}\r\n      });\r\n\r\n\r\n      config.type === 'listBox' && this.$shortCut.init(this.$refs.input, {\r\n        common: {\r\n          up: () => config.tabs.list[config.tabs.current].prev('list_box_shortcut'),\r\n          down: () => config.tabs.list[config.tabs.current].next('list_box_shortcut'),\r\n          left: () => config.searchText || config.tabs.prev('list_box_shortcut'),\r\n          right: () => config.searchText || config.tabs.next('list_box_shortcut'),\r\n          enter: () => config.search && config.searchText ? config.search() : config.tabs.list[config.tabs.current].play(),\r\n          backspace: () => config.searchText || config.tabs.current && config.tabs.prev('list_box_shortcut'),\r\n          esc: () => this.$refs.input.blur(),\r\n        },\r\n      }, {\r\n        common: {\r\n          up: `上一项`,\r\n          down: `下一项`,\r\n          left: `上一页`,\r\n          right: `上一页`,\r\n          enter: `搜索|播放|确认`,\r\n          backspace: `删除|返回上一页`,\r\n          esc: `关闭页面`,\r\n        },\r\n      });\r\n\r\n      shortCut.init(undefined, {\r\n        alt: {\r\n          [this.config.focusKey]: () => {\r\n            this.$refs.input.focus()\r\n          },\r\n        },\r\n      }, {\r\n        alt: {\r\n          [this.config.focusKey]: `打开页面`,\r\n        },\r\n      });\r\n\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" type=\"text/less\">\r\n  .music-wrap {\r\n    user-select: none;\r\n    position: absolute;\r\n    top: 50%;\r\n    left: 50%;\r\n    width: 100vw;\r\n    height: 100vh;\r\n    transform-origin: center center;\r\n    transform: translate(-50%, -50%) scale(0.7, 0.7);\r\n    opacity: 0;\r\n    transition: all .3s;\r\n    will-change: opacity, transform, background-color;\r\n\r\n    &::before {\r\n      content: '';\r\n      display: block;\r\n      width: 400%;\r\n      height: 400%;\r\n      top: 50%;\r\n      left: 50%;\r\n      transform: translate(-50%, -50%);\r\n      background-color: rgba(0, 0, 0, 0.9);\r\n    }\r\n\r\n    .music-lists {\r\n      position: absolute;\r\n      top: 50%;\r\n      left: 50%;\r\n      transform: translate(-50%, -50%);\r\n      height: 50%;\r\n      width: 50%;\r\n      .music-lists-prev,\r\n      .music-lists-next{\r\n        position: absolute;\r\n        top: 0;\r\n        height: 100%;\r\n        width: 50%;\r\n        background-color: rgba(255,255,255,0.01);\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        padding: 0 10px;\r\n        z-index: 4;\r\n      }\r\n      .music-lists-prev{\r\n        right: 100%;\r\n      }\r\n      .music-lists-next{\r\n        left: 100%;\r\n      }\r\n      .song-list {\r\n        background-color: #222;\r\n        position: absolute;\r\n        left: 50%;\r\n        top: 50%;\r\n        width: 100%;\r\n        height: 100%;\r\n        overflow: hidden;\r\n        padding: 20px;\r\n        justify-content: center;\r\n        transition: all .3s;\r\n        border: 0;\r\n\r\n        > span {\r\n          display: block;\r\n          position: absolute;\r\n          top: 0;\r\n          left: 0;\r\n          width: 100%;\r\n          height: 100%;\r\n          background-size: cover;\r\n          background-repeat: no-repeat;\r\n          background-position: center center;\r\n          opacity: 0.5;\r\n          filter: blur(0px);\r\n          transition: all 0.4s;\r\n          will-change: opacity;\r\n        }\r\n\r\n        img {\r\n          position: relative;\r\n          opacity: 1;\r\n          width: 14px;\r\n          height: 14px;\r\n          margin-right: 6px;\r\n          border-radius: 4px;\r\n          border: 0;\r\n        }\r\n\r\n        ul {\r\n          position: relative;\r\n          transform: translateX(-100%);\r\n          top: 50%;\r\n          transition: all 1s;\r\n          opacity: 0;\r\n          transform-origin: top;\r\n\r\n          li {\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            white-space: nowrap;\r\n            color: #ccc;\r\n            font-size: 20px;\r\n            line-height: 50px;\r\n            height: 50px;\r\n            width: 100%;\r\n            overflow: hidden;\r\n            text-overflow: ellipsis;\r\n            transform: translate(0, 0, 0);\r\n            text-shadow: 0 4px 4px #000;\r\n            will-change: transform;\r\n            position: relative;\r\n            &::after{\r\n              position: absolute;\r\n              content: '';\r\n              display: block;\r\n              top: 0;\r\n              left: 0;\r\n\r\n              width: 100%;\r\n              height: 100%;\r\n            }\r\n\r\n            >span {\r\n              display: flex;\r\n              width: 100%;\r\n              align-items: center;\r\n              justify-content: center;\r\n              transform: translateY(0) scale(0.6, 0.6);\r\n              transition: all 1s;\r\n              will-change: transform;\r\n\r\n              .button{\r\n                display: block;\r\n                padding: 4px;\r\n                color: rgba(255,255,0,1);\r\n                cursor: pointer;\r\n              }\r\n            }\r\n\r\n\r\n            &.playing {\r\n              span {\r\n                transform: translateY(0) scale(0.9, 0.9);\r\n              }\r\n            }\r\n\r\n            &.active {\r\n              opacity: 1;\r\n              &::after{\r\n                display: none;\r\n              }\r\n\r\n              span {\r\n                transform: translateY(0) scale(1, 1);\r\n              }\r\n            }\r\n            &:hover{\r\n              background-color: rgba(255,255,0,.1);\r\n            }\r\n          }\r\n        }\r\n        &.prev {\r\n          z-index: 1;\r\n          border-radius: 50% 0 0 50%;\r\n          transform: translate(-100%, -50%) scale(.8, .8);\r\n        }\r\n\r\n\r\n\r\n        &.next {\r\n          z-index: 2;\r\n          border-radius: 0 50% 50% 0;\r\n          transform: translate(0, -50%) scale(.8, .8);\r\n        }\r\n        &:only-child,\r\n        &.active {\r\n          z-index: 3;\r\n          border-radius: 10%;\r\n          transform: translate(-50%, -50%);\r\n          > span {\r\n            opacity: .8;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    &.focus {\r\n      z-index: 3009 !important;\r\n      opacity: 1;\r\n      transform: translate(-50%, -50%) scale(1, 1);\r\n\r\n      .song-list {\r\n\r\n        ul {\r\n          opacity: 0.5;\r\n        }\r\n\r\n        &.active {\r\n          opacity: 1;\r\n\r\n          ul {\r\n            opacity: 1;\r\n            transform: translateX(0);\r\n          }\r\n        }\r\n\r\n        > div {\r\n          height: 100%;\r\n          overflow: hidden;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .search-box {\r\n    position: absolute;\r\n    top: 0;\r\n    right: 0;\r\n    display: flex;\r\n    align-items: flex-end;\r\n    justify-content: center;\r\n    height: 10%;\r\n    overflow: hidden;\r\n\r\n    input {\r\n      text-align: right;\r\n      border: 0;\r\n      padding: 0 20px;\r\n      outline: 0;\r\n      color: #fff;\r\n      font-size: 52px;\r\n      text-shadow: 0 0 8px #ffa800;\r\n      background-color: transparent;\r\n\r\n      &::-webkit-input-placeholder {\r\n        color: rgba(255, 255, 255, 0.8);\r\n      }\r\n    }\r\n  }\r\n</style>\r\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./ListBoxView.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./ListBoxView.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ListBoxView.vue?vue&type=template&id=93795514&\"\nimport script from \"./ListBoxView.vue?vue&type=script&lang=js&\"\nexport * from \"./ListBoxView.vue?vue&type=script&lang=js&\"\nimport style0 from \"./ListBoxView.vue?vue&type=style&index=0&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","<template>\r\n  <ListBoxView :config=\"config\"></ListBoxView>\r\n</template>\r\n<script>\r\n\r\n  import {ajax} from \"../../proxy/http\";\r\n  import {shortCut, ShortCut} from \"../tools/ShortCut\";\r\n  import {ListBox} from \"../units/ListBox\";\r\n  import ListBoxView from \"./ListBoxView\";\r\n\r\n  export default {\r\n    name: 'MusicSearchBox',\r\n    provide() {\r\n      return {}\r\n    },\r\n    components: {\r\n      ListBoxView\r\n    },\r\n    mixins: [],\r\n    inject: [\r\n      'musicDataFlags',\r\n      'musicData',\r\n      'musicConfig',\r\n      'gameList',\r\n      'mv',\r\n      'modifyManager'\r\n    ],\r\n    data() {\r\n      const tabs = new ListBox();\r\n      const lrcs = new ListBox({\r\n        play: (type) => {\r\n          const curLrc = lrcs.list[lrcs.current];\r\n          this.mv.$audio.currentTime = curLrc.time / 10;\r\n        },\r\n        setIndex(index, type = '') {\r\n          if (this.setIndexFlag && !type) return this;\r\n          if (['list_box_click', 'list_box_shortcut'].includes(type)) {\r\n            const time = this.setIndexFlag = Date.now();\r\n            setTimeout(() => {\r\n              if(time === this.setIndexFlag) {\r\n                this.setIndexFlag = undefined;\r\n              }\r\n            }, 3000);\r\n          }\r\n          if (index > this.len - 1) index = this.len - 1;\r\n          if (index < 0) index = 0;\r\n          this.current = index;\r\n          return this;\r\n        }\r\n      });\r\n      const sheet = new ListBox({\r\n        play: (message) => this.play(message),\r\n      });\r\n      const sheetList = new ListBox({\r\n        play: () => {\r\n          ajax.playlistDetail({id: this.sheetList.list[this.sheetList.current].id})(res => {\r\n            this.sheet.setList(res.playlist.tracks, true);\r\n          });\r\n        },\r\n      });\r\n      tabs.setList([sheetList, sheet, lrcs]);\r\n\r\n      return {\r\n        config: {\r\n          type: 'listBox',\r\n          name: '网易云音乐',\r\n          tabs,\r\n          searchText: '',\r\n          focusKey: 'q',\r\n          search: () => this.search()\r\n        },\r\n        currentTime: 0,\r\n        timer: null,\r\n        tabs,\r\n        lrcs,\r\n        sheet,\r\n        sheetList,\r\n        account: null,\r\n      }\r\n    },\r\n    computed: {},\r\n    watch: {\r\n      \"lrcs.current\"() {\r\n        const {list, current} = this.lrcs;\r\n        this.modifyManager.getTrackByName('CommonOptionsTrack').getVal('changeBG_When_LRC_Changed') && this.musicConfig.changePic();\r\n        this.musicConfig.setLrc(list[current] && list[current].name || '');\r\n      },\r\n      currentTime: {\r\n        immediate: true,\r\n        handler() {\r\n          const currentTime = this.mv.$audio.currentTime;\r\n          this.gameList.currentTime = currentTime * 1000;\r\n          const index = parseInt(currentTime * 10);\r\n          let curIndex = 0;\r\n          this.lrcs.list.some((item, _index) => {\r\n            if (item.time <= index) {\r\n              curIndex = _index\r\n            }\r\n            return item.time > index;\r\n          });\r\n          this.lrcs.setIndex(curIndex);\r\n        }\r\n      },\r\n      account: {\r\n        immediate: true,\r\n        handler() {\r\n          if (this.account) {\r\n            this.getUserSongList();\r\n          }\r\n        },\r\n      }\r\n    },\r\n    methods: {\r\n      getLrc() {\r\n        const song = this.sheet.list[this.sheet.current];\r\n        if (song) {\r\n          ajax.lyric({id: song.id || song.songId})(res => {\r\n            const lrcList = res.lrc.lyric.split(/\\n/).map(item => {\r\n              const info = item.match(/(?:\\[)(\\d+)(?::)([^\\]]+)(?:\\])([^\\[\\]]*)/);\r\n              // 转成百毫秒数\r\n              return {name: info ? info[3] : \"\", time: info ? parseInt((+info[1] * 60 + +info[2]) * 10) : 0,}\r\n            });\r\n            this.lrcs.setList(lrcList);\r\n          });\r\n          this.lrcs.setList([]);\r\n        }\r\n\r\n      },\r\n      login() {\r\n        const user = {phone: localStorage.getItem('userPhone'), password: localStorage.getItem('password'),};\r\n        if (!user.password || !user.password) {\r\n          ShortCut.toast(['正式环境位开放远程歌曲']);\r\n          setTimeout(() => {\r\n            ShortCut.toast(['请使用测试歌曲']);\r\n          }, 600);\r\n          return;\r\n        }\r\n        ajax.loginCellphone(user)(res => {\r\n          this.account = res.account;\r\n          this.getMySheets();\r\n        });\r\n      },\r\n      getImgUrl(song) {\r\n        return song && (song.coverImgUrl || song.al && song.al.picUrl || song.album && song.album.picUrl);\r\n      },\r\n      getSongUrl() {\r\n        const {mv} = this;\r\n        const song = this.sheet.list[this.sheet.current];\r\n        if (song) {\r\n          this.gameList.durationTime = mv.duration = mv.duration = song.duration || song.dt;\r\n          ajax.songUrl({id: song.id})(res => {\r\n            mv.play(res.data[0].url);\r\n          });\r\n        }\r\n\r\n      },\r\n      play(message) {\r\n        const {gameList, mv} = this;\r\n        const play = () => {\r\n          gameList.startSong();\r\n          mv.stopType = message;\r\n          this.getSongUrl();\r\n          this.getLrc();\r\n          this.tabs.setIndex(1);\r\n          // 清除输入\r\n          this.config.searchText = \"\";\r\n        };\r\n        if (mv.$audio.paused){\r\n          play()\r\n        } else {\r\n          mv.$audio.pause();\r\n          setTimeout(() => {\r\n            play()\r\n          }, mv.delay.delayTime.value * 1000 + gameList.buffer)\r\n        }\r\n\r\n      },\r\n      getUserSongList() {\r\n        ajax.userPlaylist({uid: this.account.id})(res => {\r\n          this.sheetList.setList(res.playlist, true);\r\n        });\r\n      },\r\n      getMySheets() {\r\n        ajax.recommendSongs()(res => {\r\n          this.sheet.setList(res.recommend || []);\r\n        });\r\n      },\r\n      like(){\r\n        const song = this.sheet.list[this.sheet.current];\r\n        const sheet = this.sheetList.list[0];\r\n\r\n        sheet && song && ajax.playlistTracks({\r\n          op: 'add',\r\n          pid: sheet.id,\r\n          tracks: song.id\r\n        })(res => {\r\n          console.log('like');\r\n        });\r\n      },\r\n      // 搜索\r\n      search() {\r\n        this.config.searchText && ajax.search({keywords: this.config.searchText})(res => {\r\n          this.sheet.setList(res.result.songs, true);\r\n          this.config.searchText = '';\r\n        })\r\n      },\r\n    },\r\n    beforeDestory() {\r\n      clearInterval(this.timer);\r\n    },\r\n    mounted() {\r\n      const {musicConfig, gameList, mv} = this;\r\n      musicConfig.ended = () => {\r\n        setTimeout(() => {\r\n          gameList.endSong();\r\n          setTimeout(() => {\r\n            this.sheet.next();\r\n            this.sheet.play();\r\n          }, 5000);\r\n        }, mv.delay.delayTime.value * 1000 + gameList.buffer + 1000)\r\n      };\r\n      this.timer = setInterval(() => (this.currentTime = Date.now()), 50);\r\n      this.login();\r\n      shortCut.init(undefined, {\r\n        alt: {\r\n          left: () => {\r\n            const nextTime = mv.$audio.currentTime - 5;\r\n            mv.$audio.currentTime = nextTime>=0 ? nextTime : 0;\r\n          },\r\n          right: () => {\r\n            const nextTime = mv.$audio.currentTime + 5;\r\n            mv.$audio.currentTime = nextTime <= mv.$audio.duration ? nextTime : mv.$audio.duration;\r\n          },\r\n          p: () => mv.$audio.paused ? mv.$audio.play() : mv.$audio.pause(),\r\n        },\r\n        ctrl: {\r\n          left: () => musicConfig.changePic(true),\r\n          right: () => musicConfig.changePic(),\r\n        }\r\n      }, {\r\n        alt: {\r\n          left: `退后5s`,\r\n          right: `前进5s`,\r\n          p: `暂停/播放`,\r\n        },\r\n        ctrl: {\r\n          left: `上一张图片`,\r\n          right: `下一张图片`,\r\n        }\r\n      });\r\n\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" type=\"text/less\">\r\n\r\n\r\n</style>\r\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./MusicSearchBox.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./MusicSearchBox.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./MusicSearchBox.vue?vue&type=template&id=702fa70c&\"\nimport script from \"./MusicSearchBox.vue?vue&type=script&lang=js&\"\nexport * from \"./MusicSearchBox.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ListBoxView',{attrs:{\"config\":_vm.config}})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <ListBoxView :config=\"config\"></ListBoxView>\r\n</template>\r\n<script>\r\n  import {shortCut, ShortCut} from \"../tools/ShortCut\";\r\n  import {ListBox} from \"../units/ListBox\";\r\n  import ListBoxView from \"./ListBoxView\";\r\n\r\n  export default {\r\n    name: 'MusicLocalBox',\r\n    provide() {\r\n      return {}\r\n    },\r\n    components: {\r\n      ListBoxView\r\n    },\r\n    mixins: [],\r\n    inject: [\r\n      'musicDataFlags',\r\n      'musicData',\r\n      'musicConfig',\r\n      'gameList',\r\n      'mv',\r\n      'modifyManager',\r\n      'navList'\r\n    ],\r\n    data() {\r\n      const tabs = new ListBox();\r\n      const songList = new ListBox({\r\n        play: () => {\r\n          this.play()\r\n        },\r\n      });\r\n      tabs.setList([songList]);\r\n      songList.setList([{name: 'testSong', url: './sound/testSound.mp3'}]);\r\n\r\n      return {\r\n        config: {\r\n          type: 'listBox',\r\n          name: '测试歌曲',\r\n          tabs,\r\n          searchText: '',\r\n          focusKey: 'w',\r\n        },\r\n        tabs,\r\n        songList,\r\n      }\r\n    },\r\n    computed: {},\r\n    watch: {\r\n    },\r\n    methods: {\r\n      play(message) {\r\n        const {gameList, mv} = this;\r\n        const play = () => {\r\n          gameList.startSong();\r\n          mv.stopType = message;\r\n          mv.play(this.songList.list[this.songList.current].url);\r\n          // 清除输入\r\n          this.searchText = \"\";\r\n        };\r\n        if (mv.$audio.paused){\r\n          play()\r\n        } else {\r\n          mv.$audio.pause();\r\n          setTimeout(() => {\r\n            play()\r\n          }, mv.delay.delayTime.value * 1000 + gameList.buffer)\r\n        }\r\n\r\n      },\r\n    },\r\n    mounted() {\r\n      const {musicConfig, gameList, mv} = this;\r\n      // musicConfig.ended = () => {\r\n      //   setTimeout(() => {\r\n      //     gameList.endSong();\r\n      //     setTimeout(() => {\r\n      //       this.songList.next();\r\n      //       this.songList.play();\r\n      //     }, 5000);\r\n      //   }, mv.delay.delayTime.value * 1000 + gameList.buffer + 1000)\r\n      // };\r\n\r\n      shortCut.init(undefined, {\r\n        alt: {\r\n          left: () => {\r\n            const nextTime = mv.$audio.currentTime - 5;\r\n            mv.$audio.currentTime = nextTime>=0 ? nextTime : 0;\r\n          },\r\n          right: () => {\r\n            const nextTime = mv.$audio.currentTime + 5;\r\n            mv.$audio.currentTime = nextTime <= mv.$audio.duration ? nextTime : mv.$audio.duration;\r\n          },\r\n          p: () => mv.$audio.paused ? mv.$audio.play() : mv.$audio.pause(),\r\n        },\r\n        ctrl: {\r\n        }\r\n      }, {\r\n        alt: {\r\n          left: `退后5s`,\r\n          right: `前进5s`,\r\n          p: `暂停/播放`,\r\n        },\r\n        ctrl: {\r\n        }\r\n      });\r\n\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" type=\"text/less\">\r\n</style>\r\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./MusicLocalBox.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./MusicLocalBox.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./MusicLocalBox.vue?vue&type=template&id=9b9b9130&\"\nimport script from \"./MusicLocalBox.vue?vue&type=script&lang=js&\"\nexport * from \"./MusicLocalBox.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ListBoxView',{attrs:{\"config\":_vm.config}})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <ListBoxView :config=\"config\"></ListBoxView>\r\n</template>\r\n<script>\r\n  import ListBoxView from \"./ListBoxView\";\r\n\r\n  export default {\r\n    name: 'ModifyBox',\r\n    provide() {\r\n      return {}\r\n    },\r\n    components: {\r\n      ListBoxView\r\n    },\r\n    mixins: [],\r\n    inject: ['modifyManager', 'navList'],\r\n    data() {\r\n      return {\r\n        config: {\r\n          type: 'modify',\r\n          name: '参数调整',\r\n          tabs: this.modifyManager,\r\n          searchText: '',\r\n          focusKey: 'e',\r\n        },\r\n      }\r\n    },\r\n    computed: {\r\n    },\r\n    watch: {},\r\n    methods: {\r\n      search() {\r\n      },\r\n    },\r\n    mounted() {\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" type=\"text/less\" scoped>\r\n  .music-wrap {\r\n    /deep/.music-lists{\r\n      .song-list {\r\n        background-color: rgba(34, 34, 34, 0.3);\r\n      }\r\n    }\r\n\r\n    &::before {\r\n      background-color: rgba(0, 0, 0, 0);\r\n    }\r\n  }\r\n</style>\r\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./ModifyBox.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./ModifyBox.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ModifyBox.vue?vue&type=template&id=a24a1548&scoped=true&\"\nimport script from \"./ModifyBox.vue?vue&type=script&lang=js&\"\nexport * from \"./ModifyBox.vue?vue&type=script&lang=js&\"\nimport style0 from \"./ModifyBox.vue?vue&type=style&index=0&id=a24a1548&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"a24a1548\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"wrap\",staticClass:\"three-view\"})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/**\n * @author qiao / https://github.com/qiao\n * @author mrdoob / http://mrdoob.com\n * @author alteredq / http://alteredqualia.com/\n * @author WestLangley / http://github.com/WestLangley\n * @author erich666 / http://erichaines.com\n * @author ScieCode / http://github.com/sciecode\n */\n\nimport {\n\tEventDispatcher,\n\tMOUSE,\n\tQuaternion,\n\tSpherical,\n\tTOUCH,\n\tVector2,\n\tVector3\n} from \"three\";\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n//\n//    Orbit - left mouse / touch: one-finger move\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - right mouse, or left mouse + ctrl/meta/shiftKey, or arrow keys / touch: two-finger move\n\nvar OrbitControls = function ( object, domElement ) {\n\n\tif ( domElement === undefined ) console.warn( 'THREE.OrbitControls: The second parameter \"domElement\" is now mandatory.' );\n\tif ( domElement === document ) console.error( 'THREE.OrbitControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.' );\n\n\tthis.object = object;\n\tthis.domElement = domElement;\n\n\t// Set to false to disable this control\n\tthis.enabled = true;\n\n\t// \"target\" sets the location of focus, where the object orbits around\n\tthis.target = new Vector3();\n\n\t// How far you can dolly in and out ( PerspectiveCamera only )\n\tthis.minDistance = 0;\n\tthis.maxDistance = Infinity;\n\n\t// How far you can zoom in and out ( OrthographicCamera only )\n\tthis.minZoom = 0;\n\tthis.maxZoom = Infinity;\n\n\t// How far you can orbit vertically, upper and lower limits.\n\t// Range is 0 to Math.PI radians.\n\tthis.minPolarAngle = 0; // radians\n\tthis.maxPolarAngle = Math.PI; // radians\n\n\t// How far you can orbit horizontally, upper and lower limits.\n\t// If set, must be a sub-interval of the interval [ - Math.PI, Math.PI ].\n\tthis.minAzimuthAngle = - Infinity; // radians\n\tthis.maxAzimuthAngle = Infinity; // radians\n\n\t// Set to true to enable damping (inertia)\n\t// If damping is enabled, you must call controls.update() in your animation loop\n\tthis.enableDamping = false;\n\tthis.dampingFactor = 0.05;\n\n\t// This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\n\t// Set to false to disable zooming\n\tthis.enableZoom = true;\n\tthis.zoomSpeed = 1.0;\n\n\t// Set to false to disable rotating\n\tthis.enableRotate = true;\n\tthis.rotateSpeed = 1.0;\n\n\t// Set to false to disable panning\n\tthis.enablePan = true;\n\tthis.panSpeed = 1.0;\n\tthis.screenSpacePanning = false; // if true, pan in screen-space\n\tthis.keyPanSpeed = 7.0;\t// pixels moved per arrow key push\n\n\t// Set to true to automatically rotate around the target\n\t// If auto-rotate is enabled, you must call controls.update() in your animation loop\n\tthis.autoRotate = false;\n\tthis.autoRotateSpeed = 2.0; // 30 seconds per round when fps is 60\n\n\t// Set to false to disable use of the keys\n\tthis.enableKeys = true;\n\n\t// The four arrow keys\n\tthis.keys = { LEFT: 37, UP: 38, RIGHT: 39, BOTTOM: 40 };\n\n\t// Mouse buttons\n\tthis.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.DOLLY, RIGHT: MOUSE.PAN };\n\n\t// Touch fingers\n\tthis.touches = { ONE: TOUCH.ROTATE, TWO: TOUCH.DOLLY_PAN };\n\n\t// for reset\n\tthis.target0 = this.target.clone();\n\tthis.position0 = this.object.position.clone();\n\tthis.zoom0 = this.object.zoom;\n\n\t//\n\t// public methods\n\t//\n\n\tthis.getPolarAngle = function () {\n\n\t\treturn spherical.phi;\n\n\t};\n\n\tthis.getAzimuthalAngle = function () {\n\n\t\treturn spherical.theta;\n\n\t};\n\n\tthis.saveState = function () {\n\n\t\tscope.target0.copy( scope.target );\n\t\tscope.position0.copy( scope.object.position );\n\t\tscope.zoom0 = scope.object.zoom;\n\n\t};\n\n\tthis.reset = function () {\n\n\t\tscope.target.copy( scope.target0 );\n\t\tscope.object.position.copy( scope.position0 );\n\t\tscope.object.zoom = scope.zoom0;\n\n\t\tscope.object.updateProjectionMatrix();\n\t\tscope.dispatchEvent( changeEvent );\n\n\t\tscope.update();\n\n\t\tstate = STATE.NONE;\n\n\t};\n\n\t// this method is exposed, but perhaps it would be better if we can make it private...\n\tthis.update = function () {\n\n\t\tvar offset = new Vector3();\n\n\t\t// so camera.up is the orbit axis\n\t\tvar quat = new Quaternion().setFromUnitVectors( object.up, new Vector3( 0, 1, 0 ) );\n\t\tvar quatInverse = quat.clone().inverse();\n\n\t\tvar lastPosition = new Vector3();\n\t\tvar lastQuaternion = new Quaternion();\n\n\t\treturn function update() {\n\n\t\t\tvar position = scope.object.position;\n\n\t\t\toffset.copy( position ).sub( scope.target );\n\n\t\t\t// rotate offset to \"y-axis-is-up\" space\n\t\t\toffset.applyQuaternion( quat );\n\n\t\t\t// angle from z-axis around y-axis\n\t\t\tspherical.setFromVector3( offset );\n\n\t\t\tif ( scope.autoRotate && state === STATE.NONE ) {\n\n\t\t\t\trotateLeft( getAutoRotationAngle() );\n\n\t\t\t}\n\n\t\t\tif ( scope.enableDamping ) {\n\n\t\t\t\tspherical.theta += sphericalDelta.theta * scope.dampingFactor;\n\t\t\t\tspherical.phi += sphericalDelta.phi * scope.dampingFactor;\n\n\t\t\t} else {\n\n\t\t\t\tspherical.theta += sphericalDelta.theta;\n\t\t\t\tspherical.phi += sphericalDelta.phi;\n\n\t\t\t}\n\n\t\t\t// restrict theta to be between desired limits\n\t\t\tspherical.theta = Math.max( scope.minAzimuthAngle, Math.min( scope.maxAzimuthAngle, spherical.theta ) );\n\n\t\t\t// restrict phi to be between desired limits\n\t\t\tspherical.phi = Math.max( scope.minPolarAngle, Math.min( scope.maxPolarAngle, spherical.phi ) );\n\n\t\t\tspherical.makeSafe();\n\n\n\t\t\tspherical.radius *= scale;\n\n\t\t\t// restrict radius to be between desired limits\n\t\t\tspherical.radius = Math.max( scope.minDistance, Math.min( scope.maxDistance, spherical.radius ) );\n\n\t\t\t// move target to panned location\n\n\t\t\tif ( scope.enableDamping === true ) {\n\n\t\t\t\tscope.target.addScaledVector( panOffset, scope.dampingFactor );\n\n\t\t\t} else {\n\n\t\t\t\tscope.target.add( panOffset );\n\n\t\t\t}\n\n\t\t\toffset.setFromSpherical( spherical );\n\n\t\t\t// rotate offset back to \"camera-up-vector-is-up\" space\n\t\t\toffset.applyQuaternion( quatInverse );\n\n\t\t\tposition.copy( scope.target ).add( offset );\n\n\t\t\tscope.object.lookAt( scope.target );\n\n\t\t\tif ( scope.enableDamping === true ) {\n\n\t\t\t\tsphericalDelta.theta *= ( 1 - scope.dampingFactor );\n\t\t\t\tsphericalDelta.phi *= ( 1 - scope.dampingFactor );\n\n\t\t\t\tpanOffset.multiplyScalar( 1 - scope.dampingFactor );\n\n\t\t\t} else {\n\n\t\t\t\tsphericalDelta.set( 0, 0, 0 );\n\n\t\t\t\tpanOffset.set( 0, 0, 0 );\n\n\t\t\t}\n\n\t\t\tscale = 1;\n\n\t\t\t// update condition is:\n\t\t\t// min(camera displacement, camera rotation in radians)^2 > EPS\n\t\t\t// using small-angle approximation cos(x/2) = 1 - x^2 / 8\n\n\t\t\tif ( zoomChanged ||\n\t\t\t\tlastPosition.distanceToSquared( scope.object.position ) > EPS ||\n\t\t\t\t8 * ( 1 - lastQuaternion.dot( scope.object.quaternion ) ) > EPS ) {\n\n\t\t\t\tscope.dispatchEvent( changeEvent );\n\n\t\t\t\tlastPosition.copy( scope.object.position );\n\t\t\t\tlastQuaternion.copy( scope.object.quaternion );\n\t\t\t\tzoomChanged = false;\n\n\t\t\t\treturn true;\n\n\t\t\t}\n\n\t\t\treturn false;\n\n\t\t};\n\n\t}();\n\n\tthis.dispose = function () {\n\n\t\tscope.domElement.removeEventListener( 'contextmenu', onContextMenu, false );\n\t\tscope.domElement.removeEventListener( 'mousedown', onMouseDown, false );\n\t\tscope.domElement.removeEventListener( 'wheel', onMouseWheel, false );\n\n\t\tscope.domElement.removeEventListener( 'touchstart', onTouchStart, false );\n\t\tscope.domElement.removeEventListener( 'touchend', onTouchEnd, false );\n\t\tscope.domElement.removeEventListener( 'touchmove', onTouchMove, false );\n\n\t\tdocument.removeEventListener( 'mousemove', onMouseMove, false );\n\t\tdocument.removeEventListener( 'mouseup', onMouseUp, false );\n\n\t\tscope.domElement.removeEventListener( 'keydown', onKeyDown, false );\n\n\t\t//scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\n\n\t};\n\n\t//\n\t// internals\n\t//\n\n\tvar scope = this;\n\n\tvar changeEvent = { type: 'change' };\n\tvar startEvent = { type: 'start' };\n\tvar endEvent = { type: 'end' };\n\n\tvar STATE = {\n\t\tNONE: - 1,\n\t\tROTATE: 0,\n\t\tDOLLY: 1,\n\t\tPAN: 2,\n\t\tTOUCH_ROTATE: 3,\n\t\tTOUCH_PAN: 4,\n\t\tTOUCH_DOLLY_PAN: 5,\n\t\tTOUCH_DOLLY_ROTATE: 6\n\t};\n\n\tvar state = STATE.NONE;\n\n\tvar EPS = 0.000001;\n\n\t// current position in spherical coordinates\n\tvar spherical = new Spherical();\n\tvar sphericalDelta = new Spherical();\n\n\tvar scale = 1;\n\tvar panOffset = new Vector3();\n\tvar zoomChanged = false;\n\n\tvar rotateStart = new Vector2();\n\tvar rotateEnd = new Vector2();\n\tvar rotateDelta = new Vector2();\n\n\tvar panStart = new Vector2();\n\tvar panEnd = new Vector2();\n\tvar panDelta = new Vector2();\n\n\tvar dollyStart = new Vector2();\n\tvar dollyEnd = new Vector2();\n\tvar dollyDelta = new Vector2();\n\n\tfunction getAutoRotationAngle() {\n\n\t\treturn 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\n\n\t}\n\n\tfunction getZoomScale() {\n\n\t\treturn Math.pow( 0.95, scope.zoomSpeed );\n\n\t}\n\n\tfunction rotateLeft( angle ) {\n\n\t\tsphericalDelta.theta -= angle;\n\n\t}\n\n\tfunction rotateUp( angle ) {\n\n\t\tsphericalDelta.phi -= angle;\n\n\t}\n\n\tvar panLeft = function () {\n\n\t\tvar v = new Vector3();\n\n\t\treturn function panLeft( distance, objectMatrix ) {\n\n\t\t\tv.setFromMatrixColumn( objectMatrix, 0 ); // get X column of objectMatrix\n\t\t\tv.multiplyScalar( - distance );\n\n\t\t\tpanOffset.add( v );\n\n\t\t};\n\n\t}();\n\n\tvar panUp = function () {\n\n\t\tvar v = new Vector3();\n\n\t\treturn function panUp( distance, objectMatrix ) {\n\n\t\t\tif ( scope.screenSpacePanning === true ) {\n\n\t\t\t\tv.setFromMatrixColumn( objectMatrix, 1 );\n\n\t\t\t} else {\n\n\t\t\t\tv.setFromMatrixColumn( objectMatrix, 0 );\n\t\t\t\tv.crossVectors( scope.object.up, v );\n\n\t\t\t}\n\n\t\t\tv.multiplyScalar( distance );\n\n\t\t\tpanOffset.add( v );\n\n\t\t};\n\n\t}();\n\n\t// deltaX and deltaY are in pixels; right and down are positive\n\tvar pan = function () {\n\n\t\tvar offset = new Vector3();\n\n\t\treturn function pan( deltaX, deltaY ) {\n\n\t\t\tvar element = scope.domElement;\n\n\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\t// perspective\n\t\t\t\tvar position = scope.object.position;\n\t\t\t\toffset.copy( position ).sub( scope.target );\n\t\t\t\tvar targetDistance = offset.length();\n\n\t\t\t\t// half of the fov is center to top of screen\n\t\t\t\ttargetDistance *= Math.tan( ( scope.object.fov / 2 ) * Math.PI / 180.0 );\n\n\t\t\t\t// we use only clientHeight here so aspect ratio does not distort speed\n\t\t\t\tpanLeft( 2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix );\n\t\t\t\tpanUp( 2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix );\n\n\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\t// orthographic\n\t\t\t\tpanLeft( deltaX * ( scope.object.right - scope.object.left ) / scope.object.zoom / element.clientWidth, scope.object.matrix );\n\t\t\t\tpanUp( deltaY * ( scope.object.top - scope.object.bottom ) / scope.object.zoom / element.clientHeight, scope.object.matrix );\n\n\t\t\t} else {\n\n\t\t\t\t// camera neither orthographic nor perspective\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.' );\n\t\t\t\tscope.enablePan = false;\n\n\t\t\t}\n\n\t\t};\n\n\t}();\n\n\tfunction dollyIn( dollyScale ) {\n\n\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\tscale /= dollyScale;\n\n\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom * dollyScale ) );\n\t\t\tscope.object.updateProjectionMatrix();\n\t\t\tzoomChanged = true;\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\tscope.enableZoom = false;\n\n\t\t}\n\n\t}\n\n\tfunction dollyOut( dollyScale ) {\n\n\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\tscale *= dollyScale;\n\n\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom / dollyScale ) );\n\t\t\tscope.object.updateProjectionMatrix();\n\t\t\tzoomChanged = true;\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\tscope.enableZoom = false;\n\n\t\t}\n\n\t}\n\n\t//\n\t// event callbacks - update the object state\n\t//\n\n\tfunction handleMouseDownRotate( event ) {\n\n\t\trotateStart.set( event.clientX, event.clientY );\n\n\t}\n\n\tfunction handleMouseDownDolly( event ) {\n\n\t\tdollyStart.set( event.clientX, event.clientY );\n\n\t}\n\n\tfunction handleMouseDownPan( event ) {\n\n\t\tpanStart.set( event.clientX, event.clientY );\n\n\t}\n\n\tfunction handleMouseMoveRotate( event ) {\n\n\t\trotateEnd.set( event.clientX, event.clientY );\n\n\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\n\n\t\tvar element = scope.domElement;\n\n\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\n\n\t\trotateStart.copy( rotateEnd );\n\n\t\tscope.update();\n\n\t}\n\n\tfunction handleMouseMoveDolly( event ) {\n\n\t\tdollyEnd.set( event.clientX, event.clientY );\n\n\t\tdollyDelta.subVectors( dollyEnd, dollyStart );\n\n\t\tif ( dollyDelta.y > 0 ) {\n\n\t\t\tdollyIn( getZoomScale() );\n\n\t\t} else if ( dollyDelta.y < 0 ) {\n\n\t\t\tdollyOut( getZoomScale() );\n\n\t\t}\n\n\t\tdollyStart.copy( dollyEnd );\n\n\t\tscope.update();\n\n\t}\n\n\tfunction handleMouseMovePan( event ) {\n\n\t\tpanEnd.set( event.clientX, event.clientY );\n\n\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\n\n\t\tpan( panDelta.x, panDelta.y );\n\n\t\tpanStart.copy( panEnd );\n\n\t\tscope.update();\n\n\t}\n\n\tfunction handleMouseUp( /*event*/ ) {\n\n\t\t// no-op\n\n\t}\n\n\tfunction handleMouseWheel( event ) {\n\n\t\tif ( event.deltaY < 0 ) {\n\n\t\t\tdollyOut( getZoomScale() );\n\n\t\t} else if ( event.deltaY > 0 ) {\n\n\t\t\tdollyIn( getZoomScale() );\n\n\t\t}\n\n\t\tscope.update();\n\n\t}\n\n\tfunction handleKeyDown( event ) {\n\n\t\tvar needsUpdate = false;\n\n\t\tswitch ( event.keyCode ) {\n\n\t\t\tcase scope.keys.UP:\n\t\t\t\tpan( 0, scope.keyPanSpeed );\n\t\t\t\tneedsUpdate = true;\n\t\t\t\tbreak;\n\n\t\t\tcase scope.keys.BOTTOM:\n\t\t\t\tpan( 0, - scope.keyPanSpeed );\n\t\t\t\tneedsUpdate = true;\n\t\t\t\tbreak;\n\n\t\t\tcase scope.keys.LEFT:\n\t\t\t\tpan( scope.keyPanSpeed, 0 );\n\t\t\t\tneedsUpdate = true;\n\t\t\t\tbreak;\n\n\t\t\tcase scope.keys.RIGHT:\n\t\t\t\tpan( - scope.keyPanSpeed, 0 );\n\t\t\t\tneedsUpdate = true;\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tif ( needsUpdate ) {\n\n\t\t\t// prevent the browser from scrolling on cursor keys\n\t\t\tevent.preventDefault();\n\n\t\t\tscope.update();\n\n\t\t}\n\n\n\t}\n\n\tfunction handleTouchStartRotate( event ) {\n\n\t\tif ( event.touches.length == 1 ) {\n\n\t\t\trotateStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\n\t\t} else {\n\n\t\t\tvar x = 0.5 * ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX );\n\t\t\tvar y = 0.5 * ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY );\n\n\t\t\trotateStart.set( x, y );\n\n\t\t}\n\n\t}\n\n\tfunction handleTouchStartPan( event ) {\n\n\t\tif ( event.touches.length == 1 ) {\n\n\t\t\tpanStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\n\t\t} else {\n\n\t\t\tvar x = 0.5 * ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX );\n\t\t\tvar y = 0.5 * ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY );\n\n\t\t\tpanStart.set( x, y );\n\n\t\t}\n\n\t}\n\n\tfunction handleTouchStartDolly( event ) {\n\n\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\n\t\tvar distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\tdollyStart.set( 0, distance );\n\n\t}\n\n\tfunction handleTouchStartDollyPan( event ) {\n\n\t\tif ( scope.enableZoom ) handleTouchStartDolly( event );\n\n\t\tif ( scope.enablePan ) handleTouchStartPan( event );\n\n\t}\n\n\tfunction handleTouchStartDollyRotate( event ) {\n\n\t\tif ( scope.enableZoom ) handleTouchStartDolly( event );\n\n\t\tif ( scope.enableRotate ) handleTouchStartRotate( event );\n\n\t}\n\n\tfunction handleTouchMoveRotate( event ) {\n\n\t\tif ( event.touches.length == 1 ) {\n\n\t\t\trotateEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\n\t\t} else {\n\n\t\t\tvar x = 0.5 * ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX );\n\t\t\tvar y = 0.5 * ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY );\n\n\t\t\trotateEnd.set( x, y );\n\n\t\t}\n\n\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\n\n\t\tvar element = scope.domElement;\n\n\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\n\n\t\trotateStart.copy( rotateEnd );\n\n\t}\n\n\tfunction handleTouchMovePan( event ) {\n\n\t\tif ( event.touches.length == 1 ) {\n\n\t\t\tpanEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\n\t\t} else {\n\n\t\t\tvar x = 0.5 * ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX );\n\t\t\tvar y = 0.5 * ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY );\n\n\t\t\tpanEnd.set( x, y );\n\n\t\t}\n\n\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\n\n\t\tpan( panDelta.x, panDelta.y );\n\n\t\tpanStart.copy( panEnd );\n\n\t}\n\n\tfunction handleTouchMoveDolly( event ) {\n\n\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\n\t\tvar distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\tdollyEnd.set( 0, distance );\n\n\t\tdollyDelta.set( 0, Math.pow( dollyEnd.y / dollyStart.y, scope.zoomSpeed ) );\n\n\t\tdollyIn( dollyDelta.y );\n\n\t\tdollyStart.copy( dollyEnd );\n\n\t}\n\n\tfunction handleTouchMoveDollyPan( event ) {\n\n\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\n\n\t\tif ( scope.enablePan ) handleTouchMovePan( event );\n\n\t}\n\n\tfunction handleTouchMoveDollyRotate( event ) {\n\n\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\n\n\t\tif ( scope.enableRotate ) handleTouchMoveRotate( event );\n\n\t}\n\n\tfunction handleTouchEnd( /*event*/ ) {\n\n\t\t// no-op\n\n\t}\n\n\t//\n\t// event handlers - FSM: listen for events and reset state\n\t//\n\n\tfunction onMouseDown( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\t// Prevent the browser from scrolling.\n\n\t\tevent.preventDefault();\n\n\t\t// Manually set the focus since calling preventDefault above\n\t\t// prevents the browser from setting it automatically.\n\n\t\tscope.domElement.focus ? scope.domElement.focus() : window.focus();\n\n\t\tswitch ( event.button ) {\n\n\t\t\tcase 0:\n\n\t\t\t\tswitch ( scope.mouseButtons.LEFT ) {\n\n\t\t\t\t\tcase MOUSE.ROTATE:\n\n\t\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\t\thandleMouseDownPan( event );\n\n\t\t\t\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\t\thandleMouseDownRotate( event );\n\n\t\t\t\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase MOUSE.PAN:\n\n\t\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\t\thandleMouseDownRotate( event );\n\n\t\t\t\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\t\thandleMouseDownPan( event );\n\n\t\t\t\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\n\t\t\tcase 1:\n\n\t\t\t\tswitch ( scope.mouseButtons.MIDDLE ) {\n\n\t\t\t\t\tcase MOUSE.DOLLY:\n\n\t\t\t\t\t\tif ( scope.enableZoom === false ) return;\n\n\t\t\t\t\t\thandleMouseDownDolly( event );\n\n\t\t\t\t\t\tstate = STATE.DOLLY;\n\n\t\t\t\t\t\tbreak;\n\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase 2:\n\n\t\t\t\tswitch ( scope.mouseButtons.RIGHT ) {\n\n\t\t\t\t\tcase MOUSE.ROTATE:\n\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\thandleMouseDownRotate( event );\n\n\t\t\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase MOUSE.PAN:\n\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\thandleMouseDownPan( event );\n\n\t\t\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tif ( state !== STATE.NONE ) {\n\n\t\t\tdocument.addEventListener( 'mousemove', onMouseMove, false );\n\t\t\tdocument.addEventListener( 'mouseup', onMouseUp, false );\n\n\t\t\tscope.dispatchEvent( startEvent );\n\n\t\t}\n\n\t}\n\n\tfunction onMouseMove( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\n\t\tswitch ( state ) {\n\n\t\t\tcase STATE.ROTATE:\n\n\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\thandleMouseMoveRotate( event );\n\n\t\t\t\tbreak;\n\n\t\t\tcase STATE.DOLLY:\n\n\t\t\t\tif ( scope.enableZoom === false ) return;\n\n\t\t\t\thandleMouseMoveDolly( event );\n\n\t\t\t\tbreak;\n\n\t\t\tcase STATE.PAN:\n\n\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\thandleMouseMovePan( event );\n\n\t\t\t\tbreak;\n\n\t\t}\n\n\t}\n\n\tfunction onMouseUp( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\thandleMouseUp( event );\n\n\t\tdocument.removeEventListener( 'mousemove', onMouseMove, false );\n\t\tdocument.removeEventListener( 'mouseup', onMouseUp, false );\n\n\t\tscope.dispatchEvent( endEvent );\n\n\t\tstate = STATE.NONE;\n\n\t}\n\n\tfunction onMouseWheel( event ) {\n\n\t\tif ( scope.enabled === false || scope.enableZoom === false || ( state !== STATE.NONE && state !== STATE.ROTATE ) ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tscope.dispatchEvent( startEvent );\n\n\t\thandleMouseWheel( event );\n\n\t\tscope.dispatchEvent( endEvent );\n\n\t}\n\n\tfunction onKeyDown( event ) {\n\n\t\tif ( scope.enabled === false || scope.enableKeys === false || scope.enablePan === false ) return;\n\n\t\thandleKeyDown( event );\n\n\t}\n\n\tfunction onTouchStart( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\n\t\tswitch ( event.touches.length ) {\n\n\t\t\tcase 1:\n\n\t\t\t\tswitch ( scope.touches.ONE ) {\n\n\t\t\t\t\tcase TOUCH.ROTATE:\n\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\thandleTouchStartRotate( event );\n\n\t\t\t\t\t\tstate = STATE.TOUCH_ROTATE;\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase TOUCH.PAN:\n\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\thandleTouchStartPan( event );\n\n\t\t\t\t\t\tstate = STATE.TOUCH_PAN;\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase 2:\n\n\t\t\t\tswitch ( scope.touches.TWO ) {\n\n\t\t\t\t\tcase TOUCH.DOLLY_PAN:\n\n\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\n\n\t\t\t\t\t\thandleTouchStartDollyPan( event );\n\n\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_PAN;\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase TOUCH.DOLLY_ROTATE:\n\n\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\n\n\t\t\t\t\t\thandleTouchStartDollyRotate( event );\n\n\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_ROTATE;\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tstate = STATE.NONE;\n\n\t\t}\n\n\t\tif ( state !== STATE.NONE ) {\n\n\t\t\tscope.dispatchEvent( startEvent );\n\n\t\t}\n\n\t}\n\n\tfunction onTouchMove( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tswitch ( state ) {\n\n\t\t\tcase STATE.TOUCH_ROTATE:\n\n\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\thandleTouchMoveRotate( event );\n\n\t\t\t\tscope.update();\n\n\t\t\t\tbreak;\n\n\t\t\tcase STATE.TOUCH_PAN:\n\n\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\thandleTouchMovePan( event );\n\n\t\t\t\tscope.update();\n\n\t\t\t\tbreak;\n\n\t\t\tcase STATE.TOUCH_DOLLY_PAN:\n\n\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\n\n\t\t\t\thandleTouchMoveDollyPan( event );\n\n\t\t\t\tscope.update();\n\n\t\t\t\tbreak;\n\n\t\t\tcase STATE.TOUCH_DOLLY_ROTATE:\n\n\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\n\n\t\t\t\thandleTouchMoveDollyRotate( event );\n\n\t\t\t\tscope.update();\n\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tstate = STATE.NONE;\n\n\t\t}\n\n\t}\n\n\tfunction onTouchEnd( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\thandleTouchEnd( event );\n\n\t\tscope.dispatchEvent( endEvent );\n\n\t\tstate = STATE.NONE;\n\n\t}\n\n\tfunction onContextMenu( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\n\t}\n\n\t//\n\n\tscope.domElement.addEventListener( 'contextmenu', onContextMenu, false );\n\n\tscope.domElement.addEventListener( 'mousedown', onMouseDown, false );\n\tscope.domElement.addEventListener( 'wheel', onMouseWheel, false );\n\n\tscope.domElement.addEventListener( 'touchstart', onTouchStart, false );\n\tscope.domElement.addEventListener( 'touchend', onTouchEnd, false );\n\tscope.domElement.addEventListener( 'touchmove', onTouchMove, false );\n\n\tscope.domElement.addEventListener( 'keydown', onKeyDown, false );\n\n\t// make sure element can receive keys.\n\n\tif ( scope.domElement.tabIndex === - 1 ) {\n\n\t\tscope.domElement.tabIndex = 0;\n\n\t}\n\n\t// force an update at start\n\n\tthis.update();\n\n};\n\nOrbitControls.prototype = Object.create( EventDispatcher.prototype );\nOrbitControls.prototype.constructor = OrbitControls;\n\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n// This is very similar to OrbitControls, another set of touch behavior\n//\n//    Orbit - right mouse, or left mouse + ctrl/meta/shiftKey / touch: two-finger rotate\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - left mouse, or arrow keys / touch: one-finger move\n\nvar MapControls = function ( object, domElement ) {\n\n\tOrbitControls.call( this, object, domElement );\n\n\tthis.mouseButtons.LEFT = MOUSE.PAN;\n\tthis.mouseButtons.RIGHT = MOUSE.ROTATE;\n\n\tthis.touches.ONE = TOUCH.PAN;\n\tthis.touches.TWO = TOUCH.DOLLY_ROTATE;\n\n};\n\nMapControls.prototype = Object.create( EventDispatcher.prototype );\nMapControls.prototype.constructor = MapControls;\n\nexport { OrbitControls, MapControls };\n","import {\r\n\tBufferGeometryLoader,\r\n\tFileLoader,\r\n\tLoader,\r\n\tObject3D,\r\n\tMeshStandardMaterial,\r\n\tMesh,\r\n\tColor,\r\n\tPoints,\r\n\tPointsMaterial,\r\n\tLine,\r\n\tLineBasicMaterial,\r\n\tMatrix4,\r\n\tDirectionalLight,\r\n\tPointLight,\r\n\tSpotLight,\r\n\tRectAreaLight,\r\n\tVector3,\r\n\tSprite,\r\n\tSpriteMaterial,\r\n\tCanvasTexture,\r\n\tLinearFilter,\r\n\tClampToEdgeWrapping,\r\n\tTextureLoader\r\n} from \"three\";\r\n\r\nvar Rhino3dmLoader = function ( manager ) {\r\n\r\n\tLoader.call( this, manager );\r\n\r\n\tthis.libraryPath = '';\r\n\tthis.libraryPending = null;\r\n\tthis.libraryBinary = null;\r\n\tthis.libraryConfig = {};\r\n\r\n\tthis.workerLimit = 4;\r\n\tthis.workerPool = [];\r\n\tthis.workerNextTaskID = 1;\r\n\tthis.workerSourceURL = '';\r\n\tthis.workerConfig = {};\r\n\r\n\tthis.materials = [];\r\n\r\n};\r\n\r\nRhino3dmLoader.taskCache = new WeakMap();\r\n\r\nRhino3dmLoader.prototype = Object.assign( Object.create( Loader.prototype ), {\r\n\r\n\tconstructor: Rhino3dmLoader,\r\n\r\n\tsetLibraryPath: function ( path ) {\r\n\r\n\t\tthis.libraryPath = path;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetWorkerLimit: function ( workerLimit ) {\r\n\r\n\t\tthis.workerLimit = workerLimit;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar loader = new FileLoader( this.manager );\r\n\r\n\t\tloader.setPath( this.path );\r\n\t\tloader.setResponseType( 'arraybuffer' );\r\n\t\tloader.setRequestHeader( this.requestHeader );\r\n\r\n\t\tloader.load( url, ( buffer ) => {\r\n\r\n\t\t\t// Check for an existing task using this buffer. A transferred buffer cannot be transferred\r\n\t\t\t// again from this thread.\r\n\t\t\tif ( Rhino3dmLoader.taskCache.has( buffer ) ) {\r\n\r\n\t\t\t\tvar cachedTask = Rhino3dmLoader.taskCache.get( buffer );\r\n\r\n\t\t\t\treturn cachedTask.promise.then( onLoad ).catch( onError );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.decodeObjects( buffer, url )\r\n\t\t\t\t.then( onLoad )\r\n\t\t\t\t.catch( onError );\r\n\r\n\t\t}, onProgress, onError );\r\n\r\n\r\n\t},\r\n\r\n\tdebug: function () {\r\n\r\n\t\tconsole.log( 'Task load: ', this.workerPool.map( ( worker ) => worker._taskLoad ) );\r\n\r\n\t},\r\n\r\n\tdecodeObjects: function ( buffer, url ) {\r\n\r\n\t\tvar worker;\r\n\t\tvar taskID;\r\n\r\n\t\tvar taskCost = buffer.byteLength;\r\n\r\n\t\tvar objectPending = this._getWorker( taskCost )\r\n\t\t\t.then( ( _worker ) => {\r\n\r\n\t\t\t\tworker = _worker;\r\n\t\t\t\ttaskID = this.workerNextTaskID ++; //hmmm\r\n\r\n\t\t\t\treturn new Promise( ( resolve, reject ) => {\r\n\r\n\t\t\t\t\tworker._callbacks[ taskID ] = { resolve, reject };\r\n\r\n\t\t\t\t\tworker.postMessage( { type: 'decode', id: taskID, buffer }, [ buffer ] );\r\n\r\n\t\t\t\t\t//this.debug();\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t} )\r\n\t\t\t.then( ( message ) => this._createGeometry( message.data ) );\r\n\r\n\t\t// Remove task from the task list.\r\n\t\t// Note: replaced '.finally()' with '.catch().then()' block - iOS 11 support (#19416)\r\n\t\tobjectPending\r\n\t\t\t.catch( () => true )\r\n\t\t\t.then( () => {\r\n\r\n\t\t\t\tif ( worker && taskID ) {\r\n\r\n\t\t\t\t\tthis._releaseTask( worker, taskID );\r\n\r\n\t\t\t\t\t//this.debug();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t// Cache the task result.\r\n\t\tRhino3dmLoader.taskCache.set( buffer, {\r\n\r\n\t\t\turl: url,\r\n\t\t\tpromise: objectPending\r\n\r\n\t\t} );\r\n\r\n\t\treturn objectPending;\r\n\r\n\t},\r\n\r\n\tparse: function ( data, onLoad, onError ) {\r\n\r\n\t\tthis.decodeObjects( data, '' )\r\n\t\t\t.then( onLoad )\r\n\t\t\t.catch( onError );\r\n\r\n\t},\r\n\r\n\t_compareMaterials: function ( material ) {\r\n\r\n\t\tvar mat = {};\r\n\t\tmat.name = material.name;\r\n\t\tmat.color = {};\r\n\t\tmat.color.r = material.color.r;\r\n\t\tmat.color.g = material.color.g;\r\n\t\tmat.color.b = material.color.b;\r\n\t\tmat.type = material.type;\r\n\r\n\t\tfor ( var i = 0; i < this.materials.length; i ++ ) {\r\n\r\n\t\t\tvar m = this.materials[ i ];\r\n\t\t\tvar _mat = {};\r\n\t\t\t_mat.name = m.name;\r\n\t\t\t_mat.color = {};\r\n\t\t\t_mat.color.r = m.color.r;\r\n\t\t\t_mat.color.g = m.color.g;\r\n\t\t\t_mat.color.b = m.color.b;\r\n\t\t\t_mat.type = m.type;\r\n\r\n\t\t\tif ( JSON.stringify( mat ) === JSON.stringify( _mat ) ) {\r\n\r\n\t\t\t\treturn m;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.materials.push( material );\r\n\r\n\t\treturn material;\r\n\r\n\t},\r\n\r\n\t_createMaterial: function ( material ) {\r\n\r\n\t\tif ( material === undefined ) {\r\n\r\n\t\t\treturn new MeshStandardMaterial( {\r\n\t\t\t\tcolor: new Color( 1, 1, 1 ),\r\n\t\t\t\tmetalness: 0.8,\r\n\t\t\t\tname: 'default',\r\n\t\t\t\tside: 2\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\tvar _diffuseColor = material.diffuseColor;\r\n\r\n\t\tvar diffusecolor = new Color( _diffuseColor.r / 255.0, _diffuseColor.g / 255.0, _diffuseColor.b / 255.0 );\r\n\r\n\t\tif ( _diffuseColor.r === 0 && _diffuseColor.g === 0 && _diffuseColor.b === 0 ) {\r\n\r\n\t\t\tdiffusecolor.r = 1;\r\n\t\t\tdiffusecolor.g = 1;\r\n\t\t\tdiffusecolor.b = 1;\r\n\r\n\t\t}\r\n\r\n\t\t// console.log( material );\r\n\r\n\t\tvar mat = new MeshStandardMaterial( {\r\n\t\t\tcolor: diffusecolor,\r\n\t\t\tname: material.name,\r\n\t\t\tside: 2,\r\n\t\t\ttransparent: material.transparency > 0 ? true : false,\r\n\t\t\topacity: 1.0 - material.transparency\r\n\t\t} );\r\n\r\n\t\tvar textureLoader = new TextureLoader();\r\n\r\n\t\tfor ( var i = 0; i < material.textures.length; i ++ ) {\r\n\r\n\t\t\tvar texture = material.textures[ i ];\r\n\r\n\t\t\tif ( texture.image !== null ) {\r\n\r\n\t\t\t\tvar map = textureLoader.load( texture.image );\r\n\r\n\t\t\t\tswitch ( texture.type ) {\r\n\r\n\t\t\t\t\tcase 'Diffuse':\r\n\r\n\t\t\t\t\t\tmat.map = map;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'Bump':\r\n\r\n\t\t\t\t\t\tmat.bumpMap = map;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'Transparency':\r\n\r\n\t\t\t\t\t\tmat.alphaMap = map;\r\n\t\t\t\t\t\tmat.transparent = true;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'Emap':\r\n\r\n\t\t\t\t\t\tmat.envMap = map;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn mat;\r\n\r\n\t},\r\n\r\n\t_createGeometry: function ( data ) {\r\n\r\n\t\t// console.log(data);\r\n\r\n\t\tvar object = new Object3D();\r\n\t\tvar instanceDefinitionObjects = [];\r\n\t\tvar instanceDefinitions = [];\r\n\t\tvar instanceReferences = [];\r\n\r\n\t\tobject.userData[ 'layers' ] = data.layers;\r\n\t\tobject.userData[ 'groups' ] = data.groups;\r\n\t\tobject.userData[ 'settings' ] = data.settings;\r\n\r\n\t\tvar objects = data.objects;\r\n\t\tvar materials = data.materials;\r\n\r\n\t\tfor ( var i = 0; i < objects.length; i ++ ) {\r\n\r\n\t\t\tvar obj = objects[ i ];\r\n\t\t\tvar attributes = obj.attributes;\r\n\r\n\t\t\tswitch ( obj.objectType ) {\r\n\r\n\t\t\t\tcase 'InstanceDefinition':\r\n\r\n\t\t\t\t\tinstanceDefinitions.push( obj );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'InstanceReference':\r\n\r\n\t\t\t\t\tinstanceReferences.push( obj );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\r\n\t\t\t\t\tif ( attributes.hasOwnProperty( 'materialUUID' ) ) {\r\n\r\n\t\t\t\t\t\tvar rMaterial = materials.find( m => m.id === attributes.materialUUID );\r\n\t\t\t\t\t\tvar material = this._createMaterial( rMaterial );\r\n\t\t\t\t\t\tmaterial = this._compareMaterials( material );\r\n\t\t\t\t\t\tvar _object = this._createObject( obj, material );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tvar _object = this._createObject( obj, null );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( _object === undefined ) {\r\n\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar layer = data.layers[ attributes.layerIndex ];\r\n\r\n\t\t\t\t\t_object.visible = layer ? data.layers[ attributes.layerIndex ].visible : true;\r\n\r\n\t\t\t\t\tif ( attributes.isInstanceDefinitionObject ) {\r\n\r\n\t\t\t\t\t\tinstanceDefinitionObjects.push( _object );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tobject.add( _object );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0; i < instanceDefinitions.length; i ++ ) {\r\n\r\n\t\t\tvar iDef = instanceDefinitions[ i ];\r\n\r\n\t\t\tvar objects = [];\r\n\r\n\t\t\tfor ( var j = 0; j < iDef.attributes.objectIds.length; j ++ ) {\r\n\r\n\t\t\t\tvar objId = iDef.attributes.objectIds[ j ];\r\n\r\n\t\t\t\tfor ( var p = 0; p < instanceDefinitionObjects.length; p ++ ) {\r\n\r\n\t\t\t\t\tvar idoId = instanceDefinitionObjects[ p ].userData.attributes.id;\r\n\r\n\t\t\t\t\tif ( objId === idoId ) {\r\n\r\n\t\t\t\t\t\tobjects.push( instanceDefinitionObjects[ p ] );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Currently clones geometry and does not take advantage of instancing\r\n\r\n\t\t\tfor ( var j = 0; j < instanceReferences.length; j ++ ) {\r\n\r\n\t\t\t\tvar iRef = instanceReferences[ j ];\r\n\r\n\t\t\t\tif ( iRef.geometry.parentIdefId === iDef.attributes.id ) {\r\n\r\n\t\t\t\t\tvar iRefObject = new Object3D();\r\n\t\t\t\t\tvar xf = iRef.geometry.xform.array;\r\n\r\n\t\t\t\t\tvar matrix = new Matrix4();\r\n          \t\t\tmatrix.set( xf[ 0 ], xf[ 1 ], xf[ 2 ], xf[ 3 ], xf[ 4 ], xf[ 5 ], xf[ 6 ], xf[ 7 ], xf[ 8 ], xf[ 9 ], xf[ 10 ], xf[ 11 ], xf[ 12 ], xf[ 13 ], xf[ 14 ], xf[ 15 ] );\r\n\r\n\t\t\t\t\tiRefObject.applyMatrix4( matrix );\r\n\r\n\t\t\t\t\tfor ( var p = 0; p < objects.length; p ++ ) {\r\n\r\n\t\t\t\t\t\tiRefObject.add( objects[ p ].clone( true ) );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tobject.add( iRefObject );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.materials = [];\r\n\r\n\t\treturn object;\r\n\r\n\t},\r\n\r\n\t_createObject: function ( obj, mat ) {\r\n\r\n\t\tvar loader = new BufferGeometryLoader();\r\n\r\n\t\tvar attributes = obj.attributes;\r\n\r\n\t\tswitch ( obj.objectType ) {\r\n\r\n\t\t\tcase 'Point':\r\n\t\t\tcase 'PointSet':\r\n\r\n\t\t\t\tvar geometry = loader.parse( obj.geometry );\r\n\t\t\t\tvar _color = attributes.drawColor;\r\n\t\t\t\tvar color = new Color( _color.r / 255.0, _color.g / 255.0, _color.b / 255.0 );\r\n\t\t\t\tvar material = new PointsMaterial( { color: color, sizeAttenuation: false, size: 2 } );\r\n\r\n\t\t\t\tif ( geometry.attributes.hasOwnProperty( 'color' ) ) {\r\n\r\n\t\t\t\t\tmaterial.vertexColors = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmaterial = this._compareMaterials( material );\r\n\r\n\t\t\t\tvar points = new Points( geometry, material );\r\n\t\t\t\tpoints.userData[ 'attributes' ] = attributes;\r\n\t\t\t\tpoints.userData[ 'objectType' ] = obj.objectType;\r\n\t\t\t\treturn points;\r\n\r\n\t\t\tcase 'Mesh':\r\n\t\t\tcase 'Extrusion':\r\n\r\n\t\t\t\tvar geometry = loader.parse( obj.geometry );\r\n\r\n\t\t\t\tif ( geometry.attributes.hasOwnProperty( 'color' ) ) {\r\n\r\n\t\t\t\t\tmat.vertexColors = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar mesh = new Mesh( geometry, mat );\r\n\t\t\t\tmesh.castShadow = attributes.castsShadows;\r\n\t\t\t\tmesh.receiveShadow = attributes.receivesShadows;\r\n\t\t\t\tmesh.userData[ 'attributes' ] = attributes;\r\n\t\t\t\tmesh.userData[ 'objectType' ] = obj.objectType;\r\n\r\n\t\t\t\treturn mesh;\r\n\r\n\t\t\tcase 'Brep':\r\n\r\n\t\t\t\tvar brepObject = new Object3D();\r\n\r\n\t\t\t\tfor ( var j = 0; j < obj.geometry.length; j ++ ) {\r\n\r\n\t\t\t\t\tgeometry = loader.parse( obj.geometry[ j ] );\r\n\t\t\t\t\tvar mesh = new Mesh( geometry, mat );\r\n\t\t\t\t\tmesh.castShadow = attributes.castsShadows;\r\n\t\t\t\t\tmesh.receiveShadow = attributes.receivesShadows;\r\n\r\n\t\t\t\t\tbrepObject.add( mesh );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbrepObject.userData[ 'attributes' ] = attributes;\r\n\t\t\t\tbrepObject.userData[ 'objectType' ] = obj.objectType;\r\n\r\n\t\t\t\treturn brepObject;\r\n\r\n\t\t\tcase 'Curve':\r\n\r\n\t\t\t\tgeometry = loader.parse( obj.geometry );\r\n\r\n\t\t\t\tvar _color = attributes.drawColor;\r\n\t\t\t\tvar color = new Color( _color.r / 255.0, _color.g / 255.0, _color.b / 255.0 );\r\n\r\n\t\t\t\tvar material = new LineBasicMaterial( { color: color } );\r\n\t\t\t\tmaterial = this._compareMaterials( material );\r\n\r\n\t\t\t\tvar lines = new Line( geometry, material );\r\n\t\t\t\tlines.userData[ 'attributes' ] = attributes;\r\n\t\t\t\tlines.userData[ 'objectType' ] = obj.objectType;\r\n\r\n\t\t\t\treturn lines;\r\n\r\n\t\t\tcase 'TextDot':\r\n\r\n\t\t\t\tgeometry = obj.geometry;\r\n\r\n\t\t\t\tvar ctx = document.createElement( 'canvas' ).getContext( '2d' );\r\n\t\t\t\tvar font = `${geometry.fontHeight}px ${geometry.fontFace}`;\r\n\t\t\t\tctx.font = font;\r\n\t\t\t\tvar width = ctx.measureText( geometry.text ).width + 10;\r\n\t\t\t\tvar height = geometry.fontHeight + 10;\r\n\r\n\t\t\t\tctx.canvas.width = width;\r\n\t\t\t\tctx.canvas.height = height;\r\n\r\n\t\t\t\tctx.font = font;\r\n\t\t\t\tctx.textBaseline = 'middle';\r\n\t\t\t\tctx.textAlign = 'center';\r\n\t\t\t\tvar color = attributes.drawColor;\r\n\t\t\t\tctx.fillStyle = `rgba(${color.r},${color.g},${color.b},${color.a})`;\r\n\t\t\t\tctx.fillRect( 0, 0, width, height );\r\n\t\t\t\tctx.fillStyle = 'white';\r\n\t\t\t\tctx.fillText( geometry.text, width / 2, height / 2 );\r\n\r\n\t\t\t\tvar texture = new CanvasTexture( ctx.canvas );\r\n\t\t\t\ttexture.minFilter = LinearFilter;\r\n\t\t\t\ttexture.wrapS = ClampToEdgeWrapping;\r\n\t\t\t\ttexture.wrapT = ClampToEdgeWrapping;\r\n\r\n\t\t\t\tvar material = new SpriteMaterial( { map: texture, depthTest: false } );\r\n\t\t\t\tvar sprite = new Sprite( material );\r\n\t\t\t\tsprite.position.set( geometry.point[ 0 ], geometry.point[ 1 ], geometry.point[ 2 ] );\r\n\t\t\t\tsprite.scale.set( width / 10, height / 10, 1.0 );\r\n\r\n\t\t\t\tsprite.userData[ 'attributes' ] = attributes;\r\n\t\t\t\tsprite.userData[ 'objectType' ] = obj.objectType;\r\n\r\n\t\t\t\treturn sprite;\r\n\r\n\t\t\tcase 'Light':\r\n\r\n\t\t\t\tgeometry = obj.geometry;\r\n\r\n\t\t\t\tvar light;\r\n\r\n\t\t\t\tif ( geometry.isDirectionalLight ) {\r\n\r\n\t\t\t\t\tlight = new DirectionalLight();\r\n\t\t\t\t\tlight.castShadow = attributes.castsShadows;\r\n\t\t\t\t\tlight.position.set( geometry.location[ 0 ], geometry.location[ 1 ], geometry.location[ 2 ] );\r\n\t\t\t\t\tlight.target.position.set( geometry.direction[ 0 ], geometry.direction[ 1 ], geometry.direction[ 2 ] );\r\n\r\n\t\t\t\t\tlight.shadow.normalBias = 0.1;\r\n\r\n\t\t\t\t} else if ( geometry.isPointLight ) {\r\n\r\n\t\t\t\t\tlight = new PointLight();\r\n\t\t\t\t\tlight.castShadow = attributes.castsShadows;\r\n\t\t\t\t\tlight.position.set( geometry.location[ 0 ], geometry.location[ 1 ], geometry.location[ 2 ] );\r\n\t\t\t\t\tlight.shadow.normalBias = 0.1;\r\n\r\n\t\t\t\t} else if ( geometry.isRectangularLight ) {\r\n\r\n\t\t\t\t\tlight = new RectAreaLight();\r\n\r\n\t\t\t\t\tvar width = Math.abs( geometry.width[ 2 ] );\r\n\t\t\t\t\tvar height = Math.abs( geometry.length[ 0 ] );\r\n\r\n\t\t\t\t\tlight.position.set( geometry.location[ 0 ] - ( height / 2 ), geometry.location[ 1 ], geometry.location[ 2 ] - ( width / 2 ) );\r\n\r\n\t\t\t\t\tlight.height = height;\r\n\t\t\t\t\tlight.width = width;\r\n\r\n\t\t\t\t\tlight.lookAt( new Vector3( geometry.direction[ 0 ], geometry.direction[ 1 ], geometry.direction[ 2 ] ) );\r\n\r\n\t\t\t\t} else if ( geometry.isSpotLight ) {\r\n\r\n\t\t\t\t\tlight = new SpotLight();\r\n\t\t\t\t\tlight.castShadow = attributes.castsShadows;\r\n\t\t\t\t\tlight.position.set( geometry.location[ 0 ], geometry.location[ 1 ], geometry.location[ 2 ] );\r\n\t\t\t\t\tlight.target.position.set( geometry.direction[ 0 ], geometry.direction[ 1 ], geometry.direction[ 2 ] );\r\n\t\t\t\t\tlight.angle = geometry.spotAngleRadians;\r\n\t\t\t\t\tlight.shadow.normalBias = 0.1;\r\n\r\n\t\t\t\t} else if ( geometry.isLinearLight ) {\r\n\r\n\t\t\t\t\tconsole.warn( `THREE.3DMLoader:  No conversion exists for linear lights.` );\r\n\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( light ) {\r\n\r\n\t\t\t\t\tlight.intensity = geometry.intensity;\r\n\t\t\t\t\tlight.userData[ 'attributes' ] = attributes;\r\n\t\t\t\t\tlight.userData[ 'objectType' ] = obj.objectType;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn light;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t_initLibrary: function () {\r\n\r\n\t\tif ( ! this.libraryPending ) {\r\n\r\n\t\t\t// Load rhino3dm wrapper.\r\n\t\t\tvar jsLoader = new FileLoader( this.manager );\r\n\t\t\tjsLoader.setPath( this.libraryPath );\r\n\t\t\tvar jsContent = new Promise( ( resolve, reject ) => {\r\n\r\n\t\t\t\tjsLoader.load( 'rhino3dm.js', resolve, undefined, reject );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\t// Load rhino3dm WASM binary.\r\n\t\t\tvar binaryLoader = new FileLoader( this.manager );\r\n\t\t\tbinaryLoader.setPath( this.libraryPath );\r\n\t\t\tbinaryLoader.setResponseType( 'arraybuffer' );\r\n\t\t\tvar binaryContent = new Promise( ( resolve, reject ) => {\r\n\r\n\t\t\t\tbinaryLoader.load( 'rhino3dm.wasm', resolve, undefined, reject );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tthis.libraryPending = Promise.all( [ jsContent, binaryContent ] )\r\n\t\t\t\t.then( ( [ jsContent, binaryContent ] ) => {\r\n\r\n\t\t\t\t\t//this.libraryBinary = binaryContent;\r\n\t\t\t\t\tthis.libraryConfig.wasmBinary = binaryContent;\r\n\r\n\t\t\t\t\tvar fn = Rhino3dmLoader.Rhino3dmWorker.toString();\r\n\r\n\t\t\t\t\tvar body = [\r\n\t\t\t\t\t\t'/* rhino3dm.js */',\r\n\t\t\t\t\t\tjsContent,\r\n\t\t\t\t\t\t'/* worker */',\r\n\t\t\t\t\t\tfn.substring( fn.indexOf( '{' ) + 1, fn.lastIndexOf( '}' ) )\r\n\t\t\t\t\t].join( '\\n' );\r\n\r\n\t\t\t\t\tthis.workerSourceURL = URL.createObjectURL( new Blob( [ body ] ) );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\treturn this.libraryPending;\r\n\r\n\t},\r\n\r\n\t_getWorker: function ( taskCost ) {\r\n\r\n\t\treturn this._initLibrary().then( () => {\r\n\r\n\t\t\tif ( this.workerPool.length < this.workerLimit ) {\r\n\r\n\t\t\t\tvar worker = new Worker( this.workerSourceURL );\r\n\r\n\t\t\t\tworker._callbacks = {};\r\n\t\t\t\tworker._taskCosts = {};\r\n\t\t\t\tworker._taskLoad = 0;\r\n\r\n\t\t\t\tworker.postMessage( {\r\n\t\t\t\t\ttype: 'init',\r\n\t\t\t\t\tlibraryConfig: this.libraryConfig\r\n\t\t\t\t} );\r\n\r\n\t\t\t\tworker.onmessage = function ( e ) {\r\n\r\n\t\t\t\t\tvar message = e.data;\r\n\r\n\t\t\t\t\tswitch ( message.type ) {\r\n\r\n\t\t\t\t\t\tcase 'decode':\r\n\t\t\t\t\t\t\tworker._callbacks[ message.id ].resolve( message );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 'error':\r\n\t\t\t\t\t\t\tworker._callbacks[ message.id ].reject( message );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tconsole.error( 'THREE.Rhino3dmLoader: Unexpected message, \"' + message.type + '\"' );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\t\tthis.workerPool.push( worker );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.workerPool.sort( function ( a, b ) {\r\n\r\n\t\t\t\t\treturn a._taskLoad > b._taskLoad ? - 1 : 1;\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar worker = this.workerPool[ this.workerPool.length - 1 ];\r\n\r\n\t\t\tworker._taskLoad += taskCost;\r\n\r\n\t\t\treturn worker;\r\n\r\n\t\t} );\r\n\r\n\t},\r\n\r\n\t_releaseTask: function ( worker, taskID ) {\r\n\r\n\t\tworker._taskLoad -= worker._taskCosts[ taskID ];\r\n\t\tdelete worker._callbacks[ taskID ];\r\n\t\tdelete worker._taskCosts[ taskID ];\r\n\r\n\t},\r\n\r\n\tdispose: function () {\r\n\r\n\t\tfor ( var i = 0; i < this.workerPool.length; ++ i ) {\r\n\r\n\t\t\tthis.workerPool[ i ].terminate();\r\n\r\n\t\t}\r\n\r\n\t\tthis.workerPool.length = 0;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n} );\r\n\r\n/* WEB WORKER */\r\n\r\nRhino3dmLoader.Rhino3dmWorker = function () {\r\n\r\n\tvar libraryPending;\r\n\tvar libraryConfig;\r\n\tvar rhino;\r\n\r\n\tonmessage = function ( e ) {\r\n\r\n\t\tvar message = e.data;\r\n\r\n\t\tswitch ( message.type ) {\r\n\r\n\t\t\tcase 'init':\r\n\r\n\t\t\t\tlibraryConfig = message.libraryConfig;\r\n\t\t\t\tvar wasmBinary = libraryConfig.wasmBinary;\r\n\t\t\t\tvar RhinoModule;\r\n\t\t\t\tlibraryPending = new Promise( function ( resolve ) {\r\n\r\n\t\t\t\t\t/* Like Basis Loader */\r\n\t\t\t\t\tRhinoModule = { wasmBinary, onRuntimeInitialized: resolve };\r\n\r\n\t\t\t\t\trhino3dm( RhinoModule );\r\n\r\n\t\t\t\t } ).then( () => {\r\n\r\n\t\t\t\t\trhino = RhinoModule;\r\n\r\n\t\t\t\t } );\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'decode':\r\n\r\n\t\t\t\tvar buffer = message.buffer;\r\n\t\t\t\tlibraryPending.then( () => {\r\n\r\n\t\t\t\t\tvar data = decodeObjects( rhino, buffer );\r\n\r\n\t\t\t\t\tself.postMessage( { type: 'decode', id: message.id, data } );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tfunction decodeObjects( rhino, buffer ) {\r\n\r\n\t\tvar arr = new Uint8Array( buffer );\r\n\t\tvar doc = rhino.File3dm.fromByteArray( arr );\r\n\r\n\t\tvar objects = [];\r\n\t\tvar materials = [];\r\n\t\tvar layers = [];\r\n\t\tvar views = [];\r\n\t\tvar namedViews = [];\r\n\t\tvar groups = [];\r\n\r\n\t\t//Handle objects\r\n\r\n\t\tfor ( var i = 0; i < doc.objects().count; i ++ ) {\r\n\r\n\t\t\tvar _object = doc.objects().get( i );\r\n\r\n\t\t\tvar object = extractObjectData( _object, doc );\r\n\r\n\t\t\tif ( object !== undefined ) {\r\n\r\n\t\t\t\tif ( object.attributes.materialIndex >= 0 ) {\r\n\r\n\t\t\t\t\tvar mId = doc.materials().findIndex( object.attributes.materialIndex ).id;\r\n\t\t\t\t\tobject.attributes.materialUUID = mId;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tobjects.push( object );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_object.delete();\r\n\r\n\t\t}\r\n\r\n\t\t// Handle instance definitions\r\n\t\t// console.log( `Instance Definitions Count: ${doc.instanceDefinitions().count()}` );\r\n\r\n\t\tfor ( var i = 0; i < doc.instanceDefinitions().count(); i ++ ) {\r\n\r\n\t\t\tvar idef = doc.instanceDefinitions().get( i );\r\n\t\t\tvar idefAttributes = extractProperties( idef );\r\n\t\t\tidefAttributes.objectIds = idef.getObjectIds();\r\n\r\n\t\t\tobjects.push( { geometry: null, attributes: idefAttributes, objectType: 'InstanceDefinition' } );\r\n\r\n\t\t}\r\n\r\n\t\t// Handle materials\r\n\r\n\t\tvar textureTypes = [\r\n\t\t\t// rhino.TextureType.Bitmap,\r\n\t\t\trhino.TextureType.Diffuse,\r\n\t\t\trhino.TextureType.Bump,\r\n\t\t\trhino.TextureType.Transparency,\r\n\t\t\trhino.TextureType.Opacity,\r\n\t\t\trhino.TextureType.Emap\r\n\t\t];\r\n\r\n\t\tvar pbrTextureTypes = [\r\n\t\t\trhino.TextureType.PBR_BaseColor,\r\n\t\t\trhino.TextureType.PBR_Subsurface,\r\n\t\t\trhino.TextureType.PBR_SubsurfaceScattering,\r\n\t\t\trhino.TextureType.PBR_SubsurfaceScatteringRadius,\r\n\t\t\trhino.TextureType.PBR_Metallic,\r\n\t\t\trhino.TextureType.PBR_Specular,\r\n\t\t\trhino.TextureType.PBR_SpecularTint,\r\n\t\t\trhino.TextureType.PBR_Roughness,\r\n\t\t\trhino.TextureType.PBR_Anisotropic,\r\n\t\t\trhino.TextureType.PBR_Anisotropic_Rotation,\r\n\t\t\trhino.TextureType.PBR_Sheen,\r\n\t\t\trhino.TextureType.PBR_SheenTint,\r\n\t\t\trhino.TextureType.PBR_Clearcoat,\r\n\t\t\trhino.TextureType.PBR_ClearcoatBump,\r\n\t\t\trhino.TextureType.PBR_ClearcoatRoughness,\r\n\t\t\trhino.TextureType.PBR_OpacityIor,\r\n\t\t\trhino.TextureType.PBR_OpacityRoughness,\r\n\t\t\trhino.TextureType.PBR_Emission,\r\n\t\t\trhino.TextureType.PBR_AmbientOcclusion,\r\n\t\t\trhino.TextureType.PBR_Displacement\r\n\t\t];\r\n\r\n\t\tfor ( var i = 0; i < doc.materials().count(); i ++ ) {\r\n\r\n\t\t\tvar _material = doc.materials().get( i );\r\n\t\t\tvar _pbrMaterial = _material.physicallyBased();\r\n\r\n\t\t\tvar material = extractProperties( _material );\r\n\r\n\t\t\tvar textures = [];\r\n\r\n\t\t\tfor ( var j = 0; j < textureTypes.length; j ++ ) {\r\n\r\n\t\t\t\tvar _texture = _material.getTexture( textureTypes[ j ] );\r\n\t\t\t\tif ( _texture ) {\r\n\r\n\t\t\t\t\tvar textureType = textureTypes[ j ].constructor.name;\r\n\t\t\t\t\ttextureType = textureType.substring( 12, textureType.length );\r\n\t\t\t\t\tvar texture = { type: textureType };\r\n\r\n\t\t\t\t\tvar image = doc.getEmbeddedFileAsBase64( _texture.fileName );\r\n\r\n\t\t\t\t\tif ( image ) {\r\n\r\n\t\t\t\t\t\ttexture.image = 'data:image/png;base64,' + image;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tconsole.warn( `THREE.3DMLoader: Image for ${textureType} texture not embedded in file.` );\r\n\t\t\t\t\t\ttexture.image = null;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttextures.push( texture );\r\n\r\n\t\t\t\t\t_texture.delete();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterial.textures = textures;\r\n\r\n\t\t\tif ( _pbrMaterial.supported ) {\r\n\r\n\t\t\t\tconsole.log( 'pbr true' );\r\n\r\n\t\t\t\tfor ( var j = 0; j < pbrTextureTypes.length; j ++ ) {\r\n\r\n\t\t\t\t\tvar _texture = _material.getTexture( textureTypes[ j ] );\r\n\t\t\t\t\tif ( _texture ) {\r\n\r\n\t\t\t\t\t\tvar image = doc.getEmbeddedFileAsBase64( _texture.fileName );\r\n\t\t\t\t\t\tvar textureType = textureTypes[ j ].constructor.name;\r\n\t\t\t\t\t\ttextureType = textureType.substring( 12, textureType.length );\r\n\t\t\t\t\t\tvar texture = { type: textureType, image: 'data:image/png;base64,' + image };\r\n\t\t\t\t\t\ttextures.push( texture );\r\n\r\n\t\t\t\t\t\t_texture.delete();\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar pbMaterialProperties = extractProperties( _material.physicallyBased() );\r\n\r\n\t\t\t\tmaterial = Object.assign( pbMaterialProperties, material );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterials.push( material );\r\n\r\n\t\t\t_material.delete();\r\n\t\t\t_pbrMaterial.delete();\r\n\r\n\t\t}\r\n\r\n\t\t// Handle layers\r\n\r\n\t\tfor ( var i = 0; i < doc.layers().count(); i ++ ) {\r\n\r\n\t\t\tvar _layer = doc.layers().get( i );\r\n\t\t\tvar layer = extractProperties( _layer );\r\n\r\n\t\t\tlayers.push( layer );\r\n\r\n\t\t\t_layer.delete();\r\n\r\n\t\t}\r\n\r\n\t\t// Handle views\r\n\r\n\t\tfor ( var i = 0; i < doc.views().count(); i ++ ) {\r\n\r\n\t\t\tvar _view = doc.views().get( i );\r\n\t\t\tvar view = extractProperties( _view );\r\n\r\n\t\t\tviews.push( view );\r\n\r\n\t\t\t_view.delete();\r\n\r\n\t\t}\r\n\r\n\t\t// Handle named views\r\n\r\n\t\tfor ( var i = 0; i < doc.namedViews().count(); i ++ ) {\r\n\r\n\t\t\tvar _namedView = doc.namedViews().get( i );\r\n\t\t\tvar namedView = extractProperties( _namedView );\r\n\r\n\t\t\tnamedViews.push( namedView );\r\n\r\n\t\t\t_namedView.delete();\r\n\r\n\t\t}\r\n\r\n\t\t// Handle groups\r\n\r\n\t\tfor ( var i = 0; i < doc.groups().count(); i ++ ) {\r\n\r\n\t\t\tvar _group = doc.groups().get( i );\r\n\t\t\tvar group = extractProperties( _group );\r\n\r\n\t\t\tgroups.push( group );\r\n\r\n\t\t\t_group.delete();\r\n\r\n\t\t}\r\n\r\n\t\t// Handle settings\r\n\r\n\t\tvar settings = extractProperties( doc.settings() );\r\n\r\n\t\t//TODO: Handle other document stuff like dimstyles, instance definitions, bitmaps etc.\r\n\r\n\t\t// Handle dimstyles\r\n\t\t// console.log( `Dimstyle Count: ${doc.dimstyles().count()}` );\r\n\r\n\t\t// Handle bitmaps\r\n\t\t// console.log( `Bitmap Count: ${doc.bitmaps().count()}` );\r\n\r\n\t\t// Handle strings -- this seems to be broken at the moment in rhino3dm\r\n\t\t// console.log( `Document Strings Count: ${doc.strings().count()}` );\r\n\r\n\t\t/*\r\n\t\tfor( var i = 0; i < doc.strings().count(); i++ ){\r\n\r\n\t\t\tvar _string= doc.strings().get( i );\r\n\r\n\t\t\tconsole.log(_string);\r\n\t\t\tvar string = extractProperties( _group );\r\n\r\n\t\t\tstrings.push( string );\r\n\r\n\t\t\t_string.delete();\r\n\r\n\t\t}\r\n\t\t*/\r\n\r\n\t\tdoc.delete();\r\n\r\n\t\treturn { objects, materials, layers, views, namedViews, groups, settings };\r\n\r\n\t}\r\n\r\n\tfunction extractObjectData( object, doc ) {\r\n\r\n\t\tvar _geometry = object.geometry();\r\n\t\tvar _attributes = object.attributes();\r\n\t\tvar objectType = _geometry.objectType;\r\n\t\tvar geometry = null;\r\n\t\tvar attributes = null;\r\n\r\n\t\t// skip instance definition objects\r\n\t\t//if( _attributes.isInstanceDefinitionObject ) { continue; }\r\n\r\n\t\t// TODO: handle other geometry types\r\n\t\tswitch ( objectType ) {\r\n\r\n\t\t\tcase rhino.ObjectType.Curve:\r\n\r\n\t\t\t\tvar pts = curveToPoints( _geometry, 100 );\r\n\r\n\t\t\t\tvar position = {};\r\n\t\t\t\tvar attributes = {};\r\n\t\t\t\tvar data = {};\r\n\r\n\t\t\t\tposition.itemSize = 3;\r\n\t\t\t\tposition.type = 'Float32Array';\r\n\t\t\t\tposition.array = [];\r\n\r\n\t\t\t\tfor ( var j = 0; j < pts.length; j ++ ) {\r\n\r\n\t\t\t\t\tposition.array.push( pts[ j ][ 0 ] );\r\n\t\t\t\t\tposition.array.push( pts[ j ][ 1 ] );\r\n\t\t\t\t\tposition.array.push( pts[ j ][ 2 ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tattributes.position = position;\r\n\t\t\t\tdata.attributes = attributes;\r\n\r\n\t\t\t\tgeometry = { data };\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase rhino.ObjectType.Point:\r\n\r\n\t\t\t\tvar pt = _geometry.location;\r\n\r\n\t\t\t\tvar position = {};\r\n\t\t\t\tvar color = {};\r\n\t\t\t\tvar attributes = {};\r\n\t\t\t\tvar data = {};\r\n\r\n\t\t\t\tposition.itemSize = 3;\r\n\t\t\t\tposition.type = 'Float32Array';\r\n\t\t\t\tposition.array = [ pt[ 0 ], pt[ 1 ], pt[ 2 ] ];\r\n\r\n\t\t\t\tvar _color = _attributes.drawColor( doc );\r\n\r\n\t\t\t\tcolor.itemSize = 3;\r\n\t\t\t\tcolor.type = 'Float32Array';\r\n\t\t\t\tcolor.array = [ _color.r / 255.0, _color.g / 255.0, _color.b / 255.0 ];\r\n\r\n\t\t\t\tattributes.position = position;\r\n\t\t\t\tattributes.color = color;\r\n\t\t\t\tdata.attributes = attributes;\r\n\r\n\t\t\t\tgeometry = { data };\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase rhino.ObjectType.PointSet:\r\n\t\t\tcase rhino.ObjectType.Mesh:\r\n\r\n\t\t\t\tgeometry = _geometry.toThreejsJSON();\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase rhino.ObjectType.Brep:\r\n\r\n\t\t\t\tvar faces = _geometry.faces();\r\n\t\t\t\tgeometry = [];\r\n\r\n\t\t\t\tfor ( var faceIndex = 0; faceIndex < faces.count; faceIndex ++ ) {\r\n\r\n\t\t\t\t\tvar face = faces.get( faceIndex );\r\n\t\t\t\t\tvar mesh = face.getMesh( rhino.MeshType.Any );\r\n\r\n\t\t\t\t\tif ( mesh ) {\r\n\r\n\t\t\t\t\t\tgeometry.push( mesh.toThreejsJSON() );\r\n\t\t\t\t\t\tmesh.delete();\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tface.delete();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfaces.delete();\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase rhino.ObjectType.Extrusion:\r\n\r\n\t\t\t\tvar mesh = _geometry.getMesh( rhino.MeshType.Any );\r\n\r\n\t\t\t\tif ( mesh ) {\r\n\r\n\t\t\t\t\tgeometry = mesh.toThreejsJSON();\r\n\t\t\t\t\tmesh.delete();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase rhino.ObjectType.TextDot:\r\n\r\n\t\t\t\tgeometry = extractProperties( _geometry );\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase rhino.ObjectType.Light:\r\n\r\n\t\t\t\tgeometry = extractProperties( _geometry );\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase rhino.ObjectType.InstanceReference:\r\n\r\n\t\t\t\tgeometry = extractProperties( _geometry );\r\n\t\t\t\tgeometry.xform = extractProperties( _geometry.xform );\r\n\t\t\t\tgeometry.xform.array = _geometry.xform.toFloatArray( true );\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t\t/*\r\n\t\t\t\tcase rhino.ObjectType.Annotation:\r\n\t\t\t\tcase rhino.ObjectType.Hatch:\r\n\t\t\t\tcase rhino.ObjectType.SubD:\r\n\t\t\t\tcase rhino.ObjectType.ClipPlane:\r\n\t\t\t\t*/\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.warn( `THREE.3DMLoader: TODO: Implement ${objectType.constructor.name}` );\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\tif ( geometry ) {\r\n\r\n\t\t\tvar attributes = extractProperties( _attributes );\r\n\t\t\tattributes.geometry = extractProperties( _geometry );\r\n\r\n\t\t\tif ( _attributes.groupCount > 0 ) {\r\n\r\n\t\t\t\tattributes.groupIds = _attributes.getGroupList();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( _attributes.userStringCount > 0 ) {\r\n\r\n\t\t\t\tattributes.userStrings = _attributes.getUserStrings();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tattributes.drawColor = _attributes.drawColor( doc );\r\n\r\n\t\t\tobjectType = objectType.constructor.name;\r\n\t\t\tobjectType = objectType.substring( 11, objectType.length );\r\n\t\t\tattributes.geometry.objectType = objectType;\r\n\r\n\t\t\treturn { geometry, attributes, objectType };\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction extractProperties( object ) {\r\n\r\n\t\tvar result = {};\r\n\r\n\t\tfor ( var property in object ) {\r\n\r\n\t\t\tif ( typeof object[ property ] !== 'function' ) {\r\n\r\n\t\t\t\tresult[ property ] = object[ property ];\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// console.log( `${property}: ${object[ property ]}` );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\r\n\t}\r\n\r\n\tfunction curveToPoints( curve, pointLimit ) {\r\n\r\n\t\tvar pointCount = pointLimit;\r\n\t\tvar rc = [];\r\n\t\tvar ts = [];\r\n\r\n\t\tif ( curve instanceof rhino.LineCurve ) {\r\n\r\n\t\t\treturn [ curve.pointAtStart, curve.pointAtEnd ];\r\n\r\n\t\t}\r\n\r\n\t\tif ( curve instanceof rhino.PolylineCurve ) {\r\n\r\n\t\t\tpointCount = curve.pointCount;\r\n\t\t\tfor ( var i = 0; i < pointCount; i ++ ) {\r\n\r\n\t\t\t\trc.push( curve.point( i ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn rc;\r\n\r\n\t\t}\r\n\r\n\t\tif ( curve instanceof rhino.PolyCurve ) {\r\n\r\n\t\t\tvar segmentCount = curve.segmentCount;\r\n\r\n\t\t\tfor ( var i = 0; i < segmentCount; i ++ ) {\r\n\r\n\t\t\t\tvar segment = curve.segmentCurve( i );\r\n\t\t\t\tvar segmentArray = curveToPoints( segment, pointCount );\r\n\t\t\t\trc = rc.concat( segmentArray );\r\n\t\t\t\tsegment.delete();\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn rc;\r\n\r\n\t\t}\r\n\r\n\t\tif ( curve instanceof rhino.ArcCurve ) {\r\n\r\n\t\t\tpointCount = Math.floor( curve.angleDegrees / 5 );\r\n\t\t\tpointCount = pointCount < 1 ? 2 : pointCount;\r\n\t\t\t// alternative to this hardcoded version: https://stackoverflow.com/a/18499923/2179399\r\n\r\n\t\t}\r\n\r\n\t\tif ( curve instanceof rhino.NurbsCurve && curve.degree === 1 ) {\r\n\r\n\t\t\tif ( curve.segmentCount === undefined || curve.segmentCount === 1 ) {\r\n\r\n\t\t\t\treturn [ curve.pointAtStart, curve.pointAtEnd ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar domain = curve.domain;\r\n\t\tvar divisions = pointCount - 1.0;\r\n\r\n\t\tfor ( var j = 0; j < pointCount; j ++ ) {\r\n\r\n\t\t\tvar t = domain[ 0 ] + ( j / divisions ) * ( domain[ 1 ] - domain[ 0 ] );\r\n\r\n\t\t\tif ( t === domain[ 0 ] || t === domain[ 1 ] ) {\r\n\r\n\t\t\t\tts.push( t );\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar tan = curve.tangentAt( t );\r\n\t\t\tvar prevTan = curve.tangentAt( ts.slice( - 1 )[ 0 ] );\r\n\r\n\t\t\t// Duplicaated from THREE.Vector3\r\n\t\t\t// How to pass imports to worker?\r\n\r\n\t\t\tvar tS = tan[ 0 ] * tan[ 0 ] + tan[ 1 ] * tan[ 1 ] + tan[ 2 ] * tan[ 2 ];\r\n\t\t\tvar ptS = prevTan[ 0 ] * prevTan[ 0 ] + prevTan[ 1 ] * prevTan[ 1 ] + prevTan[ 2 ] * prevTan[ 2 ];\r\n\r\n\t\t\tvar denominator = Math.sqrt( tS * ptS );\r\n\r\n\t\t\tvar angle;\r\n\r\n\t\t\tif ( denominator === 0 ) {\r\n\r\n\t\t\t\tangle = Math.PI / 2;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar theta = ( tan.x * prevTan.x + tan.y * prevTan.y + tan.z * prevTan.z ) / denominator;\r\n\t\t\t\tangle = Math.acos( Math.max( - 1, Math.min( 1, theta ) ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( angle < 0.1 ) continue;\r\n\r\n\t\t\tts.push( t );\r\n\r\n\t\t}\r\n\r\n\t\trc = ts.map( t => curve.pointAt( t ) );\r\n\t\treturn rc;\r\n\r\n\t}\r\n\r\n};\r\n\r\nexport { Rhino3dmLoader };\r\n","import {\r\n\tAnimationClip,\r\n\tBufferGeometry,\r\n\tFileLoader,\r\n\tFloat32BufferAttribute,\r\n\tLoader,\r\n\tVector3\r\n} from \"three\";\r\n\r\nvar MD2Loader = function ( manager ) {\r\n\r\n\tLoader.call( this, manager );\r\n\r\n};\r\n\r\nMD2Loader.prototype = Object.assign( Object.create( Loader.prototype ), {\r\n\r\n\tconstructor: MD2Loader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar loader = new FileLoader( scope.manager );\r\n\t\tloader.setPath( scope.path );\r\n\t\tloader.setResponseType( 'arraybuffer' );\r\n\t\tloader.setRequestHeader( scope.requestHeader );\r\n\t\tloader.setWithCredentials( scope.withCredentials );\r\n\t\tloader.load( url, function ( buffer ) {\r\n\r\n\t\t\ttry {\r\n\r\n\t\t\t\tonLoad( scope.parse( buffer ) );\r\n\r\n\t\t\t} catch ( e ) {\r\n\r\n\t\t\t\tif ( onError ) {\r\n\r\n\t\t\t\t\tonError( e );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.error( e );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tscope.manager.itemError( url );\r\n\r\n\t\t\t}\r\n\r\n\t\t}, onProgress, onError );\r\n\r\n\t},\r\n\r\n\tparse: ( function () {\r\n\r\n\t\tvar normalData = [\r\n\t\t\t[ - 0.525731, 0.000000, 0.850651 ], [ - 0.442863, 0.238856, 0.864188 ],\r\n\t\t\t[ - 0.295242, 0.000000, 0.955423 ], [ - 0.309017, 0.500000, 0.809017 ],\r\n\t\t\t[ - 0.162460, 0.262866, 0.951056 ], [ 0.000000, 0.000000, 1.000000 ],\r\n\t\t\t[ 0.000000, 0.850651, 0.525731 ], [ - 0.147621, 0.716567, 0.681718 ],\r\n\t\t\t[ 0.147621, 0.716567, 0.681718 ], [ 0.000000, 0.525731, 0.850651 ],\r\n\t\t\t[ 0.309017, 0.500000, 0.809017 ], [ 0.525731, 0.000000, 0.850651 ],\r\n\t\t\t[ 0.295242, 0.000000, 0.955423 ], [ 0.442863, 0.238856, 0.864188 ],\r\n\t\t\t[ 0.162460, 0.262866, 0.951056 ], [ - 0.681718, 0.147621, 0.716567 ],\r\n\t\t\t[ - 0.809017, 0.309017, 0.500000 ], [ - 0.587785, 0.425325, 0.688191 ],\r\n\t\t\t[ - 0.850651, 0.525731, 0.000000 ], [ - 0.864188, 0.442863, 0.238856 ],\r\n\t\t\t[ - 0.716567, 0.681718, 0.147621 ], [ - 0.688191, 0.587785, 0.425325 ],\r\n\t\t\t[ - 0.500000, 0.809017, 0.309017 ], [ - 0.238856, 0.864188, 0.442863 ],\r\n\t\t\t[ - 0.425325, 0.688191, 0.587785 ], [ - 0.716567, 0.681718, - 0.147621 ],\r\n\t\t\t[ - 0.500000, 0.809017, - 0.309017 ], [ - 0.525731, 0.850651, 0.000000 ],\r\n\t\t\t[ 0.000000, 0.850651, - 0.525731 ], [ - 0.238856, 0.864188, - 0.442863 ],\r\n\t\t\t[ 0.000000, 0.955423, - 0.295242 ], [ - 0.262866, 0.951056, - 0.162460 ],\r\n\t\t\t[ 0.000000, 1.000000, 0.000000 ], [ 0.000000, 0.955423, 0.295242 ],\r\n\t\t\t[ - 0.262866, 0.951056, 0.162460 ], [ 0.238856, 0.864188, 0.442863 ],\r\n\t\t\t[ 0.262866, 0.951056, 0.162460 ], [ 0.500000, 0.809017, 0.309017 ],\r\n\t\t\t[ 0.238856, 0.864188, - 0.442863 ], [ 0.262866, 0.951056, - 0.162460 ],\r\n\t\t\t[ 0.500000, 0.809017, - 0.309017 ], [ 0.850651, 0.525731, 0.000000 ],\r\n\t\t\t[ 0.716567, 0.681718, 0.147621 ], [ 0.716567, 0.681718, - 0.147621 ],\r\n\t\t\t[ 0.525731, 0.850651, 0.000000 ], [ 0.425325, 0.688191, 0.587785 ],\r\n\t\t\t[ 0.864188, 0.442863, 0.238856 ], [ 0.688191, 0.587785, 0.425325 ],\r\n\t\t\t[ 0.809017, 0.309017, 0.500000 ], [ 0.681718, 0.147621, 0.716567 ],\r\n\t\t\t[ 0.587785, 0.425325, 0.688191 ], [ 0.955423, 0.295242, 0.000000 ],\r\n\t\t\t[ 1.000000, 0.000000, 0.000000 ], [ 0.951056, 0.162460, 0.262866 ],\r\n\t\t\t[ 0.850651, - 0.525731, 0.000000 ], [ 0.955423, - 0.295242, 0.000000 ],\r\n\t\t\t[ 0.864188, - 0.442863, 0.238856 ], [ 0.951056, - 0.162460, 0.262866 ],\r\n\t\t\t[ 0.809017, - 0.309017, 0.500000 ], [ 0.681718, - 0.147621, 0.716567 ],\r\n\t\t\t[ 0.850651, 0.000000, 0.525731 ], [ 0.864188, 0.442863, - 0.238856 ],\r\n\t\t\t[ 0.809017, 0.309017, - 0.500000 ], [ 0.951056, 0.162460, - 0.262866 ],\r\n\t\t\t[ 0.525731, 0.000000, - 0.850651 ], [ 0.681718, 0.147621, - 0.716567 ],\r\n\t\t\t[ 0.681718, - 0.147621, - 0.716567 ], [ 0.850651, 0.000000, - 0.525731 ],\r\n\t\t\t[ 0.809017, - 0.309017, - 0.500000 ], [ 0.864188, - 0.442863, - 0.238856 ],\r\n\t\t\t[ 0.951056, - 0.162460, - 0.262866 ], [ 0.147621, 0.716567, - 0.681718 ],\r\n\t\t\t[ 0.309017, 0.500000, - 0.809017 ], [ 0.425325, 0.688191, - 0.587785 ],\r\n\t\t\t[ 0.442863, 0.238856, - 0.864188 ], [ 0.587785, 0.425325, - 0.688191 ],\r\n\t\t\t[ 0.688191, 0.587785, - 0.425325 ], [ - 0.147621, 0.716567, - 0.681718 ],\r\n\t\t\t[ - 0.309017, 0.500000, - 0.809017 ], [ 0.000000, 0.525731, - 0.850651 ],\r\n\t\t\t[ - 0.525731, 0.000000, - 0.850651 ], [ - 0.442863, 0.238856, - 0.864188 ],\r\n\t\t\t[ - 0.295242, 0.000000, - 0.955423 ], [ - 0.162460, 0.262866, - 0.951056 ],\r\n\t\t\t[ 0.000000, 0.000000, - 1.000000 ], [ 0.295242, 0.000000, - 0.955423 ],\r\n\t\t\t[ 0.162460, 0.262866, - 0.951056 ], [ - 0.442863, - 0.238856, - 0.864188 ],\r\n\t\t\t[ - 0.309017, - 0.500000, - 0.809017 ], [ - 0.162460, - 0.262866, - 0.951056 ],\r\n\t\t\t[ 0.000000, - 0.850651, - 0.525731 ], [ - 0.147621, - 0.716567, - 0.681718 ],\r\n\t\t\t[ 0.147621, - 0.716567, - 0.681718 ], [ 0.000000, - 0.525731, - 0.850651 ],\r\n\t\t\t[ 0.309017, - 0.500000, - 0.809017 ], [ 0.442863, - 0.238856, - 0.864188 ],\r\n\t\t\t[ 0.162460, - 0.262866, - 0.951056 ], [ 0.238856, - 0.864188, - 0.442863 ],\r\n\t\t\t[ 0.500000, - 0.809017, - 0.309017 ], [ 0.425325, - 0.688191, - 0.587785 ],\r\n\t\t\t[ 0.716567, - 0.681718, - 0.147621 ], [ 0.688191, - 0.587785, - 0.425325 ],\r\n\t\t\t[ 0.587785, - 0.425325, - 0.688191 ], [ 0.000000, - 0.955423, - 0.295242 ],\r\n\t\t\t[ 0.000000, - 1.000000, 0.000000 ], [ 0.262866, - 0.951056, - 0.162460 ],\r\n\t\t\t[ 0.000000, - 0.850651, 0.525731 ], [ 0.000000, - 0.955423, 0.295242 ],\r\n\t\t\t[ 0.238856, - 0.864188, 0.442863 ], [ 0.262866, - 0.951056, 0.162460 ],\r\n\t\t\t[ 0.500000, - 0.809017, 0.309017 ], [ 0.716567, - 0.681718, 0.147621 ],\r\n\t\t\t[ 0.525731, - 0.850651, 0.000000 ], [ - 0.238856, - 0.864188, - 0.442863 ],\r\n\t\t\t[ - 0.500000, - 0.809017, - 0.309017 ], [ - 0.262866, - 0.951056, - 0.162460 ],\r\n\t\t\t[ - 0.850651, - 0.525731, 0.000000 ], [ - 0.716567, - 0.681718, - 0.147621 ],\r\n\t\t\t[ - 0.716567, - 0.681718, 0.147621 ], [ - 0.525731, - 0.850651, 0.000000 ],\r\n\t\t\t[ - 0.500000, - 0.809017, 0.309017 ], [ - 0.238856, - 0.864188, 0.442863 ],\r\n\t\t\t[ - 0.262866, - 0.951056, 0.162460 ], [ - 0.864188, - 0.442863, 0.238856 ],\r\n\t\t\t[ - 0.809017, - 0.309017, 0.500000 ], [ - 0.688191, - 0.587785, 0.425325 ],\r\n\t\t\t[ - 0.681718, - 0.147621, 0.716567 ], [ - 0.442863, - 0.238856, 0.864188 ],\r\n\t\t\t[ - 0.587785, - 0.425325, 0.688191 ], [ - 0.309017, - 0.500000, 0.809017 ],\r\n\t\t\t[ - 0.147621, - 0.716567, 0.681718 ], [ - 0.425325, - 0.688191, 0.587785 ],\r\n\t\t\t[ - 0.162460, - 0.262866, 0.951056 ], [ 0.442863, - 0.238856, 0.864188 ],\r\n\t\t\t[ 0.162460, - 0.262866, 0.951056 ], [ 0.309017, - 0.500000, 0.809017 ],\r\n\t\t\t[ 0.147621, - 0.716567, 0.681718 ], [ 0.000000, - 0.525731, 0.850651 ],\r\n\t\t\t[ 0.425325, - 0.688191, 0.587785 ], [ 0.587785, - 0.425325, 0.688191 ],\r\n\t\t\t[ 0.688191, - 0.587785, 0.425325 ], [ - 0.955423, 0.295242, 0.000000 ],\r\n\t\t\t[ - 0.951056, 0.162460, 0.262866 ], [ - 1.000000, 0.000000, 0.000000 ],\r\n\t\t\t[ - 0.850651, 0.000000, 0.525731 ], [ - 0.955423, - 0.295242, 0.000000 ],\r\n\t\t\t[ - 0.951056, - 0.162460, 0.262866 ], [ - 0.864188, 0.442863, - 0.238856 ],\r\n\t\t\t[ - 0.951056, 0.162460, - 0.262866 ], [ - 0.809017, 0.309017, - 0.500000 ],\r\n\t\t\t[ - 0.864188, - 0.442863, - 0.238856 ], [ - 0.951056, - 0.162460, - 0.262866 ],\r\n\t\t\t[ - 0.809017, - 0.309017, - 0.500000 ], [ - 0.681718, 0.147621, - 0.716567 ],\r\n\t\t\t[ - 0.681718, - 0.147621, - 0.716567 ], [ - 0.850651, 0.000000, - 0.525731 ],\r\n\t\t\t[ - 0.688191, 0.587785, - 0.425325 ], [ - 0.587785, 0.425325, - 0.688191 ],\r\n\t\t\t[ - 0.425325, 0.688191, - 0.587785 ], [ - 0.425325, - 0.688191, - 0.587785 ],\r\n\t\t\t[ - 0.587785, - 0.425325, - 0.688191 ], [ - 0.688191, - 0.587785, - 0.425325 ]\r\n\t\t];\r\n\r\n\t\treturn function ( buffer ) {\r\n\r\n\t\t\tvar data = new DataView( buffer );\r\n\r\n\t\t\t// http://tfc.duke.free.fr/coding/md2-specs-en.html\r\n\r\n\t\t\tvar header = {};\r\n\t\t\tvar headerNames = [\r\n\t\t\t\t'ident', 'version',\r\n\t\t\t\t'skinwidth', 'skinheight',\r\n\t\t\t\t'framesize',\r\n\t\t\t\t'num_skins', 'num_vertices', 'num_st', 'num_tris', 'num_glcmds', 'num_frames',\r\n\t\t\t\t'offset_skins', 'offset_st', 'offset_tris', 'offset_frames', 'offset_glcmds', 'offset_end'\r\n\t\t\t];\r\n\r\n\t\t\tfor ( var i = 0; i < headerNames.length; i ++ ) {\r\n\r\n\t\t\t\theader[ headerNames[ i ] ] = data.getInt32( i * 4, true );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( header.ident !== 844121161 || header.version !== 8 ) {\r\n\r\n\t\t\t\tconsole.error( 'Not a valid MD2 file' );\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( header.offset_end !== data.byteLength ) {\r\n\r\n\t\t\t\tconsole.error( 'Corrupted MD2 file' );\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\tvar geometry = new BufferGeometry();\r\n\r\n\t\t\t// uvs\r\n\r\n\t\t\tvar uvsTemp = [];\r\n\t\t\tvar offset = header.offset_st;\r\n\r\n\t\t\tfor ( var i = 0, l = header.num_st; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar u = data.getInt16( offset + 0, true );\r\n\t\t\t\tvar v = data.getInt16( offset + 2, true );\r\n\r\n\t\t\t\tuvsTemp.push( u / header.skinwidth, 1 - ( v / header.skinheight ) );\r\n\r\n\t\t\t\toffset += 4;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// triangles\r\n\r\n\t\t\toffset = header.offset_tris;\r\n\r\n\t\t\tvar vertexIndices = [];\r\n\t\t\tvar uvIndices = [];\r\n\r\n\t\t\tfor ( var i = 0, l = header.num_tris; i < l; i ++ ) {\r\n\r\n\t\t\t\tvertexIndices.push(\r\n\t\t\t\t\tdata.getUint16( offset + 0, true ),\r\n\t\t\t\t\tdata.getUint16( offset + 2, true ),\r\n\t\t\t\t\tdata.getUint16( offset + 4, true )\r\n\t\t\t\t);\r\n\r\n\t\t\t\tuvIndices.push(\r\n\t\t\t\t\tdata.getUint16( offset + 6, true ),\r\n\t\t\t\t\tdata.getUint16( offset + 8, true ),\r\n\t\t\t\t\tdata.getUint16( offset + 10, true )\r\n\t\t\t\t);\r\n\r\n\t\t\t\toffset += 12;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// frames\r\n\r\n\t\t\tvar translation = new Vector3();\r\n\t\t\tvar scale = new Vector3();\r\n\t\t\tvar string = [];\r\n\r\n\t\t\tvar frames = [];\r\n\r\n\t\t\toffset = header.offset_frames;\r\n\r\n\t\t\tfor ( var i = 0, l = header.num_frames; i < l; i ++ ) {\r\n\r\n\t\t\t\tscale.set(\r\n\t\t\t\t\tdata.getFloat32( offset + 0, true ),\r\n\t\t\t\t\tdata.getFloat32( offset + 4, true ),\r\n\t\t\t\t\tdata.getFloat32( offset + 8, true )\r\n\t\t\t\t);\r\n\r\n\t\t\t\ttranslation.set(\r\n\t\t\t\t\tdata.getFloat32( offset + 12, true ),\r\n\t\t\t\t\tdata.getFloat32( offset + 16, true ),\r\n\t\t\t\t\tdata.getFloat32( offset + 20, true )\r\n\t\t\t\t);\r\n\r\n\t\t\t\toffset += 24;\r\n\r\n\t\t\t\tfor ( var j = 0; j < 16; j ++ ) {\r\n\r\n\t\t\t\t\tvar character = data.getUint8( offset + j, true );\r\n\t\t\t\t\tif ( character === 0 ) break;\r\n\r\n\t\t\t\t\tstring[ j ] = character;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar frame = {\r\n\t\t\t\t\tname: String.fromCharCode.apply( null, string ),\r\n\t\t\t\t\tvertices: [],\r\n\t\t\t\t\tnormals: []\r\n\t\t\t\t};\r\n\r\n\t\t\t\toffset += 16;\r\n\r\n\t\t\t\tfor ( var j = 0; j < header.num_vertices; j ++ ) {\r\n\r\n\t\t\t\t\tvar x = data.getUint8( offset ++, true );\r\n\t\t\t\t\tvar y = data.getUint8( offset ++, true );\r\n\t\t\t\t\tvar z = data.getUint8( offset ++, true );\r\n\t\t\t\t\tvar n = normalData[ data.getUint8( offset ++, true ) ];\r\n\r\n\t\t\t\t\tx = x * scale.x + translation.x;\r\n\t\t\t\t\ty = y * scale.y + translation.y;\r\n\t\t\t\t\tz = z * scale.z + translation.z;\r\n\r\n\t\t\t\t\tframe.vertices.push( x, z, y ); // convert to Y-up\r\n\t\t\t\t\tframe.normals.push( n[ 0 ], n[ 2 ], n[ 1 ] ); // convert to Y-up\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tframes.push( frame );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// static\r\n\r\n\t\t\tvar positions = [];\r\n\t\t\tvar normals = [];\r\n\t\t\tvar uvs = [];\r\n\r\n\t\t\tvar verticesTemp = frames[ 0 ].vertices;\r\n\t\t\tvar normalsTemp = frames[ 0 ].normals;\r\n\r\n\t\t\tfor ( var i = 0, l = vertexIndices.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar vertexIndex = vertexIndices[ i ];\r\n\t\t\t\tvar stride = vertexIndex * 3;\r\n\r\n\t\t\t\t//\r\n\r\n\t\t\t\tvar x = verticesTemp[ stride ];\r\n\t\t\t\tvar y = verticesTemp[ stride + 1 ];\r\n\t\t\t\tvar z = verticesTemp[ stride + 2 ];\r\n\r\n\t\t\t\tpositions.push( x, y, z );\r\n\r\n\t\t\t\t//\r\n\r\n\t\t\t\tvar nx = normalsTemp[ stride ];\r\n\t\t\t\tvar ny = normalsTemp[ stride + 1 ];\r\n\t\t\t\tvar nz = normalsTemp[ stride + 2 ];\r\n\r\n\t\t\t\tnormals.push( nx, ny, nz );\r\n\r\n\t\t\t\t//\r\n\r\n\t\t\t\tvar uvIndex = uvIndices[ i ];\r\n\t\t\t\tstride = uvIndex * 2;\r\n\r\n\t\t\t\tvar u = uvsTemp[ stride ];\r\n\t\t\t\tvar v = uvsTemp[ stride + 1 ];\r\n\r\n\t\t\t\tuvs.push( u, v );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgeometry.setAttribute( 'position', new Float32BufferAttribute( positions, 3 ) );\r\n\t\t\tgeometry.setAttribute( 'normal', new Float32BufferAttribute( normals, 3 ) );\r\n\t\t\tgeometry.setAttribute( 'uv', new Float32BufferAttribute( uvs, 2 ) );\r\n\r\n\t\t\t// animation\r\n\r\n\t\t\tvar morphPositions = [];\r\n\t\t\tvar morphNormals = [];\r\n\r\n\t\t\tfor ( var i = 0, l = frames.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar frame = frames[ i ];\r\n\t\t\t\tvar attributeName = frame.name;\r\n\r\n\t\t\t\tif ( frame.vertices.length > 0 ) {\r\n\r\n\t\t\t\t\tvar positions = [];\r\n\r\n\t\t\t\t\tfor ( var j = 0, jl = vertexIndices.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\t\tvar vertexIndex = vertexIndices[ j ];\r\n\t\t\t\t\t\tvar stride = vertexIndex * 3;\r\n\r\n\t\t\t\t\t\tvar x = frame.vertices[ stride ];\r\n\t\t\t\t\t\tvar y = frame.vertices[ stride + 1 ];\r\n\t\t\t\t\t\tvar z = frame.vertices[ stride + 2 ];\r\n\r\n\t\t\t\t\t\tpositions.push( x, y, z );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar positionAttribute = new Float32BufferAttribute( positions, 3 );\r\n\t\t\t\t\tpositionAttribute.name = attributeName;\r\n\r\n\t\t\t\t\tmorphPositions.push( positionAttribute );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( frame.normals.length > 0 ) {\r\n\r\n\t\t\t\t\tvar normals = [];\r\n\r\n\t\t\t\t\tfor ( var j = 0, jl = vertexIndices.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\t\tvar vertexIndex = vertexIndices[ j ];\r\n\t\t\t\t\t\tvar stride = vertexIndex * 3;\r\n\r\n\t\t\t\t\t\tvar nx = frame.normals[ stride ];\r\n\t\t\t\t\t\tvar ny = frame.normals[ stride + 1 ];\r\n\t\t\t\t\t\tvar nz = frame.normals[ stride + 2 ];\r\n\r\n\t\t\t\t\t\tnormals.push( nx, ny, nz );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar normalAttribute = new Float32BufferAttribute( normals, 3 );\r\n\t\t\t\t\tnormalAttribute.name = attributeName;\r\n\r\n\t\t\t\t\tmorphNormals.push( normalAttribute );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgeometry.morphAttributes.position = morphPositions;\r\n\t\t\tgeometry.morphAttributes.normal = morphNormals;\r\n\t\t\tgeometry.morphTargetsRelative = false;\r\n\r\n\t\t\tgeometry.animations = AnimationClip.CreateClipsFromMorphTargetSequences( frames, 10 );\r\n\r\n\t\t\treturn geometry;\r\n\r\n\t\t};\r\n\r\n\t} )()\r\n\r\n} );\r\n\r\nexport { MD2Loader };\r\n","/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */var mod={}, l=void 0,aa=mod;function r(c,d){var a=c.split(\".\"),b=aa;!(a[0]in b)&&b.execScript&&b.execScript(\"var \"+a[0]);for(var e;a.length&&(e=a.shift());)!a.length&&d!==l?b[e]=d:b=b[e]?b[e]:b[e]={}};var t=\"undefined\"!==typeof Uint8Array&&\"undefined\"!==typeof Uint16Array&&\"undefined\"!==typeof Uint32Array&&\"undefined\"!==typeof DataView;function v(c){var d=c.length,a=0,b=Number.POSITIVE_INFINITY,e,f,g,h,k,m,n,p,s,x;for(p=0;p<d;++p)c[p]>a&&(a=c[p]),c[p]<b&&(b=c[p]);e=1<<a;f=new (t?Uint32Array:Array)(e);g=1;h=0;for(k=2;g<=a;){for(p=0;p<d;++p)if(c[p]===g){m=0;n=h;for(s=0;s<g;++s)m=m<<1|n&1,n>>=1;x=g<<16|p;for(s=m;s<e;s+=k)f[s]=x;++h}++g;h<<=1;k<<=1}return[f,a,b]};function w(c,d){this.g=[];this.h=32768;this.d=this.f=this.a=this.l=0;this.input=t?new Uint8Array(c):c;this.m=!1;this.i=y;this.r=!1;if(d||!(d={}))d.index&&(this.a=d.index),d.bufferSize&&(this.h=d.bufferSize),d.bufferType&&(this.i=d.bufferType),d.resize&&(this.r=d.resize);switch(this.i){case A:this.b=32768;this.c=new (t?Uint8Array:Array)(32768+this.h+258);break;case y:this.b=0;this.c=new (t?Uint8Array:Array)(this.h);this.e=this.z;this.n=this.v;this.j=this.w;break;default:throw Error(\"invalid inflate mode\");\r\n}}var A=0,y=1,B={t:A,s:y};\r\nw.prototype.k=function(){for(;!this.m;){var c=C(this,3);c&1&&(this.m=!0);c>>>=1;switch(c){case 0:var d=this.input,a=this.a,b=this.c,e=this.b,f=d.length,g=l,h=l,k=b.length,m=l;this.d=this.f=0;if(a+1>=f)throw Error(\"invalid uncompressed block header: LEN\");g=d[a++]|d[a++]<<8;if(a+1>=f)throw Error(\"invalid uncompressed block header: NLEN\");h=d[a++]|d[a++]<<8;if(g===~h)throw Error(\"invalid uncompressed block header: length verify\");if(a+g>d.length)throw Error(\"input buffer is broken\");switch(this.i){case A:for(;e+\r\ng>b.length;){m=k-e;g-=m;if(t)b.set(d.subarray(a,a+m),e),e+=m,a+=m;else for(;m--;)b[e++]=d[a++];this.b=e;b=this.e();e=this.b}break;case y:for(;e+g>b.length;)b=this.e({p:2});break;default:throw Error(\"invalid inflate mode\");}if(t)b.set(d.subarray(a,a+g),e),e+=g,a+=g;else for(;g--;)b[e++]=d[a++];this.a=a;this.b=e;this.c=b;break;case 1:this.j(ba,ca);break;case 2:for(var n=C(this,5)+257,p=C(this,5)+1,s=C(this,4)+4,x=new (t?Uint8Array:Array)(D.length),S=l,T=l,U=l,u=l,M=l,F=l,z=l,q=l,V=l,q=0;q<s;++q)x[D[q]]=\r\nC(this,3);if(!t){q=s;for(s=x.length;q<s;++q)x[D[q]]=0}S=v(x);u=new (t?Uint8Array:Array)(n+p);q=0;for(V=n+p;q<V;)switch(M=E(this,S),M){case 16:for(z=3+C(this,2);z--;)u[q++]=F;break;case 17:for(z=3+C(this,3);z--;)u[q++]=0;F=0;break;case 18:for(z=11+C(this,7);z--;)u[q++]=0;F=0;break;default:F=u[q++]=M}T=t?v(u.subarray(0,n)):v(u.slice(0,n));U=t?v(u.subarray(n)):v(u.slice(n));this.j(T,U);break;default:throw Error(\"unknown BTYPE: \"+c);}}return this.n()};\r\nvar G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],D=t?new Uint16Array(G):G,H=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],I=t?new Uint16Array(H):H,J=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],K=t?new Uint8Array(J):J,L=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],da=t?new Uint16Array(L):L,ea=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,\r\n13,13],N=t?new Uint8Array(ea):ea,O=new (t?Uint8Array:Array)(288),P,fa;P=0;for(fa=O.length;P<fa;++P)O[P]=143>=P?8:255>=P?9:279>=P?7:8;var ba=v(O),Q=new (t?Uint8Array:Array)(30),R,ga;R=0;for(ga=Q.length;R<ga;++R)Q[R]=5;var ca=v(Q);function C(c,d){for(var a=c.f,b=c.d,e=c.input,f=c.a,g=e.length,h;b<d;){if(f>=g)throw Error(\"input buffer is broken\");a|=e[f++]<<b;b+=8}h=a&(1<<d)-1;c.f=a>>>d;c.d=b-d;c.a=f;return h}\r\nfunction E(c,d){for(var a=c.f,b=c.d,e=c.input,f=c.a,g=e.length,h=d[0],k=d[1],m,n;b<k&&!(f>=g);)a|=e[f++]<<b,b+=8;m=h[a&(1<<k)-1];n=m>>>16;if(n>b)throw Error(\"invalid code length: \"+n);c.f=a>>n;c.d=b-n;c.a=f;return m&65535}\r\nw.prototype.j=function(c,d){var a=this.c,b=this.b;this.o=c;for(var e=a.length-258,f,g,h,k;256!==(f=E(this,c));)if(256>f)b>=e&&(this.b=b,a=this.e(),b=this.b),a[b++]=f;else{g=f-257;k=I[g];0<K[g]&&(k+=C(this,K[g]));f=E(this,d);h=da[f];0<N[f]&&(h+=C(this,N[f]));b>=e&&(this.b=b,a=this.e(),b=this.b);for(;k--;)a[b]=a[b++-h]}for(;8<=this.d;)this.d-=8,this.a--;this.b=b};\r\nw.prototype.w=function(c,d){var a=this.c,b=this.b;this.o=c;for(var e=a.length,f,g,h,k;256!==(f=E(this,c));)if(256>f)b>=e&&(a=this.e(),e=a.length),a[b++]=f;else{g=f-257;k=I[g];0<K[g]&&(k+=C(this,K[g]));f=E(this,d);h=da[f];0<N[f]&&(h+=C(this,N[f]));b+k>e&&(a=this.e(),e=a.length);for(;k--;)a[b]=a[b++-h]}for(;8<=this.d;)this.d-=8,this.a--;this.b=b};\r\nw.prototype.e=function(){var c=new (t?Uint8Array:Array)(this.b-32768),d=this.b-32768,a,b,e=this.c;if(t)c.set(e.subarray(32768,c.length));else{a=0;for(b=c.length;a<b;++a)c[a]=e[a+32768]}this.g.push(c);this.l+=c.length;if(t)e.set(e.subarray(d,d+32768));else for(a=0;32768>a;++a)e[a]=e[d+a];this.b=32768;return e};\r\nw.prototype.z=function(c){var d,a=this.input.length/this.a+1|0,b,e,f,g=this.input,h=this.c;c&&(\"number\"===typeof c.p&&(a=c.p),\"number\"===typeof c.u&&(a+=c.u));2>a?(b=(g.length-this.a)/this.o[2],f=258*(b/2)|0,e=f<h.length?h.length+f:h.length<<1):e=h.length*a;t?(d=new Uint8Array(e),d.set(h)):d=h;return this.c=d};\r\nw.prototype.n=function(){var c=0,d=this.c,a=this.g,b,e=new (t?Uint8Array:Array)(this.l+(this.b-32768)),f,g,h,k;if(0===a.length)return t?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);f=0;for(g=a.length;f<g;++f){b=a[f];h=0;for(k=b.length;h<k;++h)e[c++]=b[h]}f=32768;for(g=this.b;f<g;++f)e[c++]=d[f];this.g=[];return this.buffer=e};\r\nw.prototype.v=function(){var c,d=this.b;t?this.r?(c=new Uint8Array(d),c.set(this.c.subarray(0,d))):c=this.c.subarray(0,d):(this.c.length>d&&(this.c.length=d),c=this.c);return this.buffer=c};function W(c,d){var a,b;this.input=c;this.a=0;if(d||!(d={}))d.index&&(this.a=d.index),d.verify&&(this.A=d.verify);a=c[this.a++];b=c[this.a++];switch(a&15){case ha:this.method=ha;break;default:throw Error(\"unsupported compression method\");}if(0!==((a<<8)+b)%31)throw Error(\"invalid fcheck flag:\"+((a<<8)+b)%31);if(b&32)throw Error(\"fdict flag is not supported\");this.q=new w(c,{index:this.a,bufferSize:d.bufferSize,bufferType:d.bufferType,resize:d.resize})}\r\nW.prototype.k=function(){var c=this.input,d,a;d=this.q.k();this.a=this.q.a;if(this.A){a=(c[this.a++]<<24|c[this.a++]<<16|c[this.a++]<<8|c[this.a++])>>>0;var b=d;if(\"string\"===typeof b){var e=b.split(\"\"),f,g;f=0;for(g=e.length;f<g;f++)e[f]=(e[f].charCodeAt(0)&255)>>>0;b=e}for(var h=1,k=0,m=b.length,n,p=0;0<m;){n=1024<m?1024:m;m-=n;do h+=b[p++],k+=h;while(--n);h%=65521;k%=65521}if(a!==(k<<16|h)>>>0)throw Error(\"invalid adler-32 checksum\");}return d};var ha=8;r(\"Zlib.Inflate\",W);r(\"Zlib.Inflate.prototype.decompress\",W.prototype.k);var X={ADAPTIVE:B.s,BLOCK:B.t},Y,Z,$,ia;if(Object.keys)Y=Object.keys(X);else for(Z in Y=[],$=0,X)Y[$++]=Z;$=0;for(ia=Y.length;$<ia;++$)Z=Y[$],r(\"Zlib.Inflate.BufferType.\"+Z,X[Z]);\r\nvar Inflate=mod.Zlib.Inflate;\r\nexport { Inflate }\r\n","import {\r\n\tVector3,\r\n\tVector4\r\n} from \"three\";\r\n/**\r\n * NURBS utils\r\n *\r\n * See NURBSCurve and NURBSSurface.\r\n **/\r\n\r\n\r\n/**************************************************************\r\n *\tNURBS Utils\r\n **************************************************************/\r\n\r\nvar NURBSUtils = {\r\n\r\n\t/*\r\n\tFinds knot vector span.\r\n\r\n\tp : degree\r\n\tu : parametric value\r\n\tU : knot vector\r\n\r\n\treturns the span\r\n\t*/\r\n\tfindSpan: function ( p, u, U ) {\r\n\r\n\t\tvar n = U.length - p - 1;\r\n\r\n\t\tif ( u >= U[ n ] ) {\r\n\r\n\t\t\treturn n - 1;\r\n\r\n\t\t}\r\n\r\n\t\tif ( u <= U[ p ] ) {\r\n\r\n\t\t\treturn p;\r\n\r\n\t\t}\r\n\r\n\t\tvar low = p;\r\n\t\tvar high = n;\r\n\t\tvar mid = Math.floor( ( low + high ) / 2 );\r\n\r\n\t\twhile ( u < U[ mid ] || u >= U[ mid + 1 ] ) {\r\n\r\n\t\t\tif ( u < U[ mid ] ) {\r\n\r\n\t\t\t\thigh = mid;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tlow = mid;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmid = Math.floor( ( low + high ) / 2 );\r\n\r\n\t\t}\r\n\r\n\t\treturn mid;\r\n\r\n\t},\r\n\r\n\r\n\t/*\r\n\tCalculate basis functions. See The NURBS Book, page 70, algorithm A2.2\r\n\r\n\tspan : span in which u lies\r\n\tu    : parametric point\r\n\tp    : degree\r\n\tU    : knot vector\r\n\r\n\treturns array[p+1] with basis functions values.\r\n\t*/\r\n\tcalcBasisFunctions: function ( span, u, p, U ) {\r\n\r\n\t\tvar N = [];\r\n\t\tvar left = [];\r\n\t\tvar right = [];\r\n\t\tN[ 0 ] = 1.0;\r\n\r\n\t\tfor ( var j = 1; j <= p; ++ j ) {\r\n\r\n\t\t\tleft[ j ] = u - U[ span + 1 - j ];\r\n\t\t\tright[ j ] = U[ span + j ] - u;\r\n\r\n\t\t\tvar saved = 0.0;\r\n\r\n\t\t\tfor ( var r = 0; r < j; ++ r ) {\r\n\r\n\t\t\t\tvar rv = right[ r + 1 ];\r\n\t\t\t\tvar lv = left[ j - r ];\r\n\t\t\t\tvar temp = N[ r ] / ( rv + lv );\r\n\t\t\t\tN[ r ] = saved + rv * temp;\r\n\t\t\t\tsaved = lv * temp;\r\n\r\n\t\t\t }\r\n\r\n\t\t\t N[ j ] = saved;\r\n\r\n\t\t }\r\n\r\n\t\t return N;\r\n\r\n\t},\r\n\r\n\r\n\t/*\r\n\tCalculate B-Spline curve points. See The NURBS Book, page 82, algorithm A3.1.\r\n\r\n\tp : degree of B-Spline\r\n\tU : knot vector\r\n\tP : control points (x, y, z, w)\r\n\tu : parametric point\r\n\r\n\treturns point for given u\r\n\t*/\r\n\tcalcBSplinePoint: function ( p, U, P, u ) {\r\n\r\n\t\tvar span = this.findSpan( p, u, U );\r\n\t\tvar N = this.calcBasisFunctions( span, u, p, U );\r\n\t\tvar C = new Vector4( 0, 0, 0, 0 );\r\n\r\n\t\tfor ( var j = 0; j <= p; ++ j ) {\r\n\r\n\t\t\tvar point = P[ span - p + j ];\r\n\t\t\tvar Nj = N[ j ];\r\n\t\t\tvar wNj = point.w * Nj;\r\n\t\t\tC.x += point.x * wNj;\r\n\t\t\tC.y += point.y * wNj;\r\n\t\t\tC.z += point.z * wNj;\r\n\t\t\tC.w += point.w * Nj;\r\n\r\n\t\t}\r\n\r\n\t\treturn C;\r\n\r\n\t},\r\n\r\n\r\n\t/*\r\n\tCalculate basis functions derivatives. See The NURBS Book, page 72, algorithm A2.3.\r\n\r\n\tspan : span in which u lies\r\n\tu    : parametric point\r\n\tp    : degree\r\n\tn    : number of derivatives to calculate\r\n\tU    : knot vector\r\n\r\n\treturns array[n+1][p+1] with basis functions derivatives\r\n\t*/\r\n\tcalcBasisFunctionDerivatives: function ( span, u, p, n, U ) {\r\n\r\n\t\tvar zeroArr = [];\r\n\t\tfor ( var i = 0; i <= p; ++ i )\r\n\t\t\tzeroArr[ i ] = 0.0;\r\n\r\n\t\tvar ders = [];\r\n\t\tfor ( var i = 0; i <= n; ++ i )\r\n\t\t\tders[ i ] = zeroArr.slice( 0 );\r\n\r\n\t\tvar ndu = [];\r\n\t\tfor ( var i = 0; i <= p; ++ i )\r\n\t\t\tndu[ i ] = zeroArr.slice( 0 );\r\n\r\n\t\tndu[ 0 ][ 0 ] = 1.0;\r\n\r\n\t\tvar left = zeroArr.slice( 0 );\r\n\t\tvar right = zeroArr.slice( 0 );\r\n\r\n\t\tfor ( var j = 1; j <= p; ++ j ) {\r\n\r\n\t\t\tleft[ j ] = u - U[ span + 1 - j ];\r\n\t\t\tright[ j ] = U[ span + j ] - u;\r\n\r\n\t\t\tvar saved = 0.0;\r\n\r\n\t\t\tfor ( var r = 0; r < j; ++ r ) {\r\n\r\n\t\t\t\tvar rv = right[ r + 1 ];\r\n\t\t\t\tvar lv = left[ j - r ];\r\n\t\t\t\tndu[ j ][ r ] = rv + lv;\r\n\r\n\t\t\t\tvar temp = ndu[ r ][ j - 1 ] / ndu[ j ][ r ];\r\n\t\t\t\tndu[ r ][ j ] = saved + rv * temp;\r\n\t\t\t\tsaved = lv * temp;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tndu[ j ][ j ] = saved;\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var j = 0; j <= p; ++ j ) {\r\n\r\n\t\t\tders[ 0 ][ j ] = ndu[ j ][ p ];\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var r = 0; r <= p; ++ r ) {\r\n\r\n\t\t\tvar s1 = 0;\r\n\t\t\tvar s2 = 1;\r\n\r\n\t\t\tvar a = [];\r\n\t\t\tfor ( var i = 0; i <= p; ++ i ) {\r\n\r\n\t\t\t\ta[ i ] = zeroArr.slice( 0 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\ta[ 0 ][ 0 ] = 1.0;\r\n\r\n\t\t\tfor ( var k = 1; k <= n; ++ k ) {\r\n\r\n\t\t\t\tvar d = 0.0;\r\n\t\t\t\tvar rk = r - k;\r\n\t\t\t\tvar pk = p - k;\r\n\r\n\t\t\t\tif ( r >= k ) {\r\n\r\n\t\t\t\t\ta[ s2 ][ 0 ] = a[ s1 ][ 0 ] / ndu[ pk + 1 ][ rk ];\r\n\t\t\t\t\td = a[ s2 ][ 0 ] * ndu[ rk ][ pk ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar j1 = ( rk >= - 1 ) ? 1 : - rk;\r\n\t\t\t\tvar j2 = ( r - 1 <= pk ) ? k - 1 : p - r;\r\n\r\n\t\t\t\tfor ( var j = j1; j <= j2; ++ j ) {\r\n\r\n\t\t\t\t\ta[ s2 ][ j ] = ( a[ s1 ][ j ] - a[ s1 ][ j - 1 ] ) / ndu[ pk + 1 ][ rk + j ];\r\n\t\t\t\t\td += a[ s2 ][ j ] * ndu[ rk + j ][ pk ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( r <= pk ) {\r\n\r\n\t\t\t\t\ta[ s2 ][ k ] = - a[ s1 ][ k - 1 ] / ndu[ pk + 1 ][ r ];\r\n\t\t\t\t\td += a[ s2 ][ k ] * ndu[ r ][ pk ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tders[ k ][ r ] = d;\r\n\r\n\t\t\t\tvar j = s1;\r\n\t\t\t\ts1 = s2;\r\n\t\t\t\ts2 = j;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar r = p;\r\n\r\n\t\tfor ( var k = 1; k <= n; ++ k ) {\r\n\r\n\t\t\tfor ( var j = 0; j <= p; ++ j ) {\r\n\r\n\t\t\t\tders[ k ][ j ] *= r;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tr *= p - k;\r\n\r\n\t\t}\r\n\r\n\t\treturn ders;\r\n\r\n\t},\r\n\r\n\r\n\t/*\r\n\t\tCalculate derivatives of a B-Spline. See The NURBS Book, page 93, algorithm A3.2.\r\n\r\n\t\tp  : degree\r\n\t\tU  : knot vector\r\n\t\tP  : control points\r\n\t\tu  : Parametric points\r\n\t\tnd : number of derivatives\r\n\r\n\t\treturns array[d+1] with derivatives\r\n\t\t*/\r\n\tcalcBSplineDerivatives: function ( p, U, P, u, nd ) {\r\n\r\n\t\tvar du = nd < p ? nd : p;\r\n\t\tvar CK = [];\r\n\t\tvar span = this.findSpan( p, u, U );\r\n\t\tvar nders = this.calcBasisFunctionDerivatives( span, u, p, du, U );\r\n\t\tvar Pw = [];\r\n\r\n\t\tfor ( var i = 0; i < P.length; ++ i ) {\r\n\r\n\t\t\tvar point = P[ i ].clone();\r\n\t\t\tvar w = point.w;\r\n\r\n\t\t\tpoint.x *= w;\r\n\t\t\tpoint.y *= w;\r\n\t\t\tpoint.z *= w;\r\n\r\n\t\t\tPw[ i ] = point;\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var k = 0; k <= du; ++ k ) {\r\n\r\n\t\t\tvar point = Pw[ span - p ].clone().multiplyScalar( nders[ k ][ 0 ] );\r\n\r\n\t\t\tfor ( var j = 1; j <= p; ++ j ) {\r\n\r\n\t\t\t\tpoint.add( Pw[ span - p + j ].clone().multiplyScalar( nders[ k ][ j ] ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tCK[ k ] = point;\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var k = du + 1; k <= nd + 1; ++ k ) {\r\n\r\n\t\t\tCK[ k ] = new Vector4( 0, 0, 0 );\r\n\r\n\t\t}\r\n\r\n\t\treturn CK;\r\n\r\n\t},\r\n\r\n\r\n\t/*\r\n\tCalculate \"K over I\"\r\n\r\n\treturns k!/(i!(k-i)!)\r\n\t*/\r\n\tcalcKoverI: function ( k, i ) {\r\n\r\n\t\tvar nom = 1;\r\n\r\n\t\tfor ( var j = 2; j <= k; ++ j ) {\r\n\r\n\t\t\tnom *= j;\r\n\r\n\t\t}\r\n\r\n\t\tvar denom = 1;\r\n\r\n\t\tfor ( var j = 2; j <= i; ++ j ) {\r\n\r\n\t\t\tdenom *= j;\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var j = 2; j <= k - i; ++ j ) {\r\n\r\n\t\t\tdenom *= j;\r\n\r\n\t\t}\r\n\r\n\t\treturn nom / denom;\r\n\r\n\t},\r\n\r\n\r\n\t/*\r\n\tCalculate derivatives (0-nd) of rational curve. See The NURBS Book, page 127, algorithm A4.2.\r\n\r\n\tPders : result of function calcBSplineDerivatives\r\n\r\n\treturns array with derivatives for rational curve.\r\n\t*/\r\n\tcalcRationalCurveDerivatives: function ( Pders ) {\r\n\r\n\t\tvar nd = Pders.length;\r\n\t\tvar Aders = [];\r\n\t\tvar wders = [];\r\n\r\n\t\tfor ( var i = 0; i < nd; ++ i ) {\r\n\r\n\t\t\tvar point = Pders[ i ];\r\n\t\t\tAders[ i ] = new Vector3( point.x, point.y, point.z );\r\n\t\t\twders[ i ] = point.w;\r\n\r\n\t\t}\r\n\r\n\t\tvar CK = [];\r\n\r\n\t\tfor ( var k = 0; k < nd; ++ k ) {\r\n\r\n\t\t\tvar v = Aders[ k ].clone();\r\n\r\n\t\t\tfor ( var i = 1; i <= k; ++ i ) {\r\n\r\n\t\t\t\tv.sub( CK[ k - i ].clone().multiplyScalar( this.calcKoverI( k, i ) * wders[ i ] ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tCK[ k ] = v.divideScalar( wders[ 0 ] );\r\n\r\n\t\t}\r\n\r\n\t\treturn CK;\r\n\r\n\t},\r\n\r\n\r\n\t/*\r\n\tCalculate NURBS curve derivatives. See The NURBS Book, page 127, algorithm A4.2.\r\n\r\n\tp  : degree\r\n\tU  : knot vector\r\n\tP  : control points in homogeneous space\r\n\tu  : parametric points\r\n\tnd : number of derivatives\r\n\r\n\treturns array with derivatives.\r\n\t*/\r\n\tcalcNURBSDerivatives: function ( p, U, P, u, nd ) {\r\n\r\n\t\tvar Pders = this.calcBSplineDerivatives( p, U, P, u, nd );\r\n\t\treturn this.calcRationalCurveDerivatives( Pders );\r\n\r\n\t},\r\n\r\n\r\n\t/*\r\n\tCalculate rational B-Spline surface point. See The NURBS Book, page 134, algorithm A4.3.\r\n\r\n\tp1, p2 : degrees of B-Spline surface\r\n\tU1, U2 : knot vectors\r\n\tP      : control points (x, y, z, w)\r\n\tu, v   : parametric values\r\n\r\n\treturns point for given (u, v)\r\n\t*/\r\n\tcalcSurfacePoint: function ( p, q, U, V, P, u, v, target ) {\r\n\r\n\t\tvar uspan = this.findSpan( p, u, U );\r\n\t\tvar vspan = this.findSpan( q, v, V );\r\n\t\tvar Nu = this.calcBasisFunctions( uspan, u, p, U );\r\n\t\tvar Nv = this.calcBasisFunctions( vspan, v, q, V );\r\n\t\tvar temp = [];\r\n\r\n\t\tfor ( var l = 0; l <= q; ++ l ) {\r\n\r\n\t\t\ttemp[ l ] = new Vector4( 0, 0, 0, 0 );\r\n\t\t\tfor ( var k = 0; k <= p; ++ k ) {\r\n\r\n\t\t\t\tvar point = P[ uspan - p + k ][ vspan - q + l ].clone();\r\n\t\t\t\tvar w = point.w;\r\n\t\t\t\tpoint.x *= w;\r\n\t\t\t\tpoint.y *= w;\r\n\t\t\t\tpoint.z *= w;\r\n\t\t\t\ttemp[ l ].add( point.multiplyScalar( Nu[ k ] ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar Sw = new Vector4( 0, 0, 0, 0 );\r\n\t\tfor ( var l = 0; l <= q; ++ l ) {\r\n\r\n\t\t\tSw.add( temp[ l ].multiplyScalar( Nv[ l ] ) );\r\n\r\n\t\t}\r\n\r\n\t\tSw.divideScalar( Sw.w );\r\n\t\ttarget.set( Sw.x, Sw.y, Sw.z );\r\n\r\n\t}\r\n\r\n};\r\n\r\nexport { NURBSUtils };\r\n","import {\r\n\tCurve,\r\n\tVector3,\r\n\tVector4\r\n} from \"three\";\r\nimport { NURBSUtils } from \"../curves/NURBSUtils.js\";\r\n/**\r\n * NURBS curve object\r\n *\r\n * Derives from Curve, overriding getPoint and getTangent.\r\n *\r\n * Implementation is based on (x, y [, z=0 [, w=1]]) control points with w=weight.\r\n *\r\n **/\r\n\r\nvar NURBSCurve = function ( degree, knots /* array of reals */, controlPoints /* array of Vector(2|3|4) */, startKnot /* index in knots */, endKnot /* index in knots */ ) {\r\n\r\n\tCurve.call( this );\r\n\r\n\tthis.degree = degree;\r\n\tthis.knots = knots;\r\n\tthis.controlPoints = [];\r\n\t// Used by periodic NURBS to remove hidden spans\r\n\tthis.startKnot = startKnot || 0;\r\n\tthis.endKnot = endKnot || ( this.knots.length - 1 );\r\n\tfor ( var i = 0; i < controlPoints.length; ++ i ) {\r\n\r\n\t\t// ensure Vector4 for control points\r\n\t\tvar point = controlPoints[ i ];\r\n\t\tthis.controlPoints[ i ] = new Vector4( point.x, point.y, point.z, point.w );\r\n\r\n\t}\r\n\r\n};\r\n\r\n\r\nNURBSCurve.prototype = Object.create( Curve.prototype );\r\nNURBSCurve.prototype.constructor = NURBSCurve;\r\n\r\n\r\nNURBSCurve.prototype.getPoint = function ( t, optionalTarget ) {\r\n\r\n\tvar point = optionalTarget || new Vector3();\r\n\r\n\tvar u = this.knots[ this.startKnot ] + t * ( this.knots[ this.endKnot ] - this.knots[ this.startKnot ] ); // linear mapping t->u\r\n\r\n\t// following results in (wx, wy, wz, w) homogeneous point\r\n\tvar hpoint = NURBSUtils.calcBSplinePoint( this.degree, this.knots, this.controlPoints, u );\r\n\r\n\tif ( hpoint.w != 1.0 ) {\r\n\r\n\t\t// project to 3D space: (wx, wy, wz, w) -> (x, y, z, 1)\r\n\t\thpoint.divideScalar( hpoint.w );\r\n\r\n\t}\r\n\r\n\treturn point.set( hpoint.x, hpoint.y, hpoint.z );\r\n\r\n};\r\n\r\n\r\nNURBSCurve.prototype.getTangent = function ( t, optionalTarget ) {\r\n\r\n\tvar tangent = optionalTarget || new Vector3();\r\n\r\n\tvar u = this.knots[ 0 ] + t * ( this.knots[ this.knots.length - 1 ] - this.knots[ 0 ] );\r\n\tvar ders = NURBSUtils.calcNURBSDerivatives( this.degree, this.knots, this.controlPoints, u, 1 );\r\n\ttangent.copy( ders[ 1 ] ).normalize();\r\n\r\n\treturn tangent;\r\n\r\n};\r\n\r\nexport { NURBSCurve };\r\n","import {\r\n\tAmbientLight,\r\n\tAnimationClip,\r\n\tBone,\r\n\tBufferAttribute,\r\n\tBufferGeometry,\r\n\tClampToEdgeWrapping,\r\n\tColor,\r\n\tDirectionalLight,\r\n\tEquirectangularReflectionMapping,\r\n\tEuler,\r\n\tFileLoader,\r\n\tFloat32BufferAttribute,\r\n\tGroup,\r\n\tLine,\r\n\tLineBasicMaterial,\r\n\tLoader,\r\n\tLoaderUtils,\r\n\tMathUtils,\r\n\tMatrix3,\r\n\tMatrix4,\r\n\tMesh,\r\n\tMeshLambertMaterial,\r\n\tMeshPhongMaterial,\r\n\tNumberKeyframeTrack,\r\n\tObject3D,\r\n\tOrthographicCamera,\r\n\tPerspectiveCamera,\r\n\tPointLight,\r\n\tPropertyBinding,\r\n\tQuaternion,\r\n\tQuaternionKeyframeTrack,\r\n\tRepeatWrapping,\r\n\tSkeleton,\r\n\tSkinnedMesh,\r\n\tSpotLight,\r\n\tTexture,\r\n\tTextureLoader,\r\n\tUint16BufferAttribute,\r\n\tVector3,\r\n\tVector4,\r\n\tVectorKeyframeTrack,\r\n\tsRGBEncoding\r\n} from \"three\";\r\nimport { Inflate } from \"../libs/inflate.module.min.js\";\r\nimport { NURBSCurve } from \"../curves/NURBSCurve.js\";\r\n/**\r\n * Loader loads FBX file and generates Group representing FBX scene.\r\n * Requires FBX file to be >= 7.0 and in ASCII or >= 6400 in Binary format\r\n * Versions lower than this may load but will probably have errors\r\n *\r\n * Needs Support:\r\n *  Morph normals / blend shape normals\r\n *\r\n * FBX format references:\r\n * \thttps://wiki.blender.org/index.php/User:Mont29/Foundation/FBX_File_Structure\r\n * \thttp://help.autodesk.com/view/FBX/2017/ENU/?guid=__cpp_ref_index_html (C++ SDK reference)\r\n *\r\n * \tBinary format specification:\r\n *\t\thttps://code.blender.org/2013/08/fbx-binary-file-format-specification/\r\n */\r\n\r\n\r\nvar FBXLoader = ( function () {\r\n\r\n\tvar fbxTree;\r\n\tvar connections;\r\n\tvar sceneGraph;\r\n\r\n\tfunction FBXLoader( manager ) {\r\n\r\n\t\tLoader.call( this, manager );\r\n\r\n\t}\r\n\r\n\tFBXLoader.prototype = Object.assign( Object.create( Loader.prototype ), {\r\n\r\n\t\tconstructor: FBXLoader,\r\n\r\n\t\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\t\tvar scope = this;\r\n\r\n\t\t\tvar path = ( scope.path === '' ) ? LoaderUtils.extractUrlBase( url ) : scope.path;\r\n\r\n\t\t\tvar loader = new FileLoader( this.manager );\r\n\t\t\tloader.setPath( scope.path );\r\n\t\t\tloader.setResponseType( 'arraybuffer' );\r\n\t\t\tloader.setRequestHeader( scope.requestHeader );\r\n\t\t\tloader.setWithCredentials( scope.withCredentials );\r\n\r\n\t\t\tloader.load( url, function ( buffer ) {\r\n\r\n\t\t\t\ttry {\r\n\r\n\t\t\t\t\tonLoad( scope.parse( buffer, path ) );\r\n\r\n\t\t\t\t} catch ( e ) {\r\n\r\n\t\t\t\t\tif ( onError ) {\r\n\r\n\t\t\t\t\t\tonError( e );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tconsole.error( e );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tscope.manager.itemError( url );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}, onProgress, onError );\r\n\r\n\t\t},\r\n\r\n\t\tparse: function ( FBXBuffer, path ) {\r\n\r\n\t\t\tif ( isFbxFormatBinary( FBXBuffer ) ) {\r\n\r\n\t\t\t\tfbxTree = new BinaryParser().parse( FBXBuffer );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar FBXText = convertArrayBufferToString( FBXBuffer );\r\n\r\n\t\t\t\tif ( ! isFbxFormatASCII( FBXText ) ) {\r\n\r\n\t\t\t\t\tthrow new Error( 'THREE.FBXLoader: Unknown format.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( getFbxVersion( FBXText ) < 7000 ) {\r\n\r\n\t\t\t\t\tthrow new Error( 'THREE.FBXLoader: FBX version not supported, FileVersion: ' + getFbxVersion( FBXText ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfbxTree = new TextParser().parse( FBXText );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// console.log( fbxTree );\r\n\r\n\t\t\tvar textureLoader = new TextureLoader( this.manager ).setPath( this.resourcePath || path ).setCrossOrigin( this.crossOrigin );\r\n\r\n\t\t\treturn new FBXTreeParser( textureLoader, this.manager ).parse( fbxTree );\r\n\r\n\t\t}\r\n\r\n\t} );\r\n\r\n\t// Parse the FBXTree object returned by the BinaryParser or TextParser and return a Group\r\n\tfunction FBXTreeParser( textureLoader, manager ) {\r\n\r\n\t\tthis.textureLoader = textureLoader;\r\n\t\tthis.manager = manager;\r\n\r\n\t}\r\n\r\n\tFBXTreeParser.prototype = {\r\n\r\n\t\tconstructor: FBXTreeParser,\r\n\r\n\t\tparse: function () {\r\n\r\n\t\t\tconnections = this.parseConnections();\r\n\r\n\t\t\tvar images = this.parseImages();\r\n\t\t\tvar textures = this.parseTextures( images );\r\n\t\t\tvar materials = this.parseMaterials( textures );\r\n\t\t\tvar deformers = this.parseDeformers();\r\n\t\t\tvar geometryMap = new GeometryParser().parse( deformers );\r\n\r\n\t\t\tthis.parseScene( deformers, geometryMap, materials );\r\n\r\n\t\t\treturn sceneGraph;\r\n\r\n\t\t},\r\n\r\n\t\t// Parses FBXTree.Connections which holds parent-child connections between objects (e.g. material -> texture, model->geometry )\r\n\t\t// and details the connection type\r\n\t\tparseConnections: function () {\r\n\r\n\t\t\tvar connectionMap = new Map();\r\n\r\n\t\t\tif ( 'Connections' in fbxTree ) {\r\n\r\n\t\t\t\tvar rawConnections = fbxTree.Connections.connections;\r\n\r\n\t\t\t\trawConnections.forEach( function ( rawConnection ) {\r\n\r\n\t\t\t\t\tvar fromID = rawConnection[ 0 ];\r\n\t\t\t\t\tvar toID = rawConnection[ 1 ];\r\n\t\t\t\t\tvar relationship = rawConnection[ 2 ];\r\n\r\n\t\t\t\t\tif ( ! connectionMap.has( fromID ) ) {\r\n\r\n\t\t\t\t\t\tconnectionMap.set( fromID, {\r\n\t\t\t\t\t\t\tparents: [],\r\n\t\t\t\t\t\t\tchildren: []\r\n\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar parentRelationship = { ID: toID, relationship: relationship };\r\n\t\t\t\t\tconnectionMap.get( fromID ).parents.push( parentRelationship );\r\n\r\n\t\t\t\t\tif ( ! connectionMap.has( toID ) ) {\r\n\r\n\t\t\t\t\t\tconnectionMap.set( toID, {\r\n\t\t\t\t\t\t\tparents: [],\r\n\t\t\t\t\t\t\tchildren: []\r\n\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar childRelationship = { ID: fromID, relationship: relationship };\r\n\t\t\t\t\tconnectionMap.get( toID ).children.push( childRelationship );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn connectionMap;\r\n\r\n\t\t},\r\n\r\n\t\t// Parse FBXTree.Objects.Video for embedded image data\r\n\t\t// These images are connected to textures in FBXTree.Objects.Textures\r\n\t\t// via FBXTree.Connections.\r\n\t\tparseImages: function () {\r\n\r\n\t\t\tvar images = {};\r\n\t\t\tvar blobs = {};\r\n\r\n\t\t\tif ( 'Video' in fbxTree.Objects ) {\r\n\r\n\t\t\t\tvar videoNodes = fbxTree.Objects.Video;\r\n\r\n\t\t\t\tfor ( var nodeID in videoNodes ) {\r\n\r\n\t\t\t\t\tvar videoNode = videoNodes[ nodeID ];\r\n\r\n\t\t\t\t\tvar id = parseInt( nodeID );\r\n\r\n\t\t\t\t\timages[ id ] = videoNode.RelativeFilename || videoNode.Filename;\r\n\r\n\t\t\t\t\t// raw image data is in videoNode.Content\r\n\t\t\t\t\tif ( 'Content' in videoNode ) {\r\n\r\n\t\t\t\t\t\tvar arrayBufferContent = ( videoNode.Content instanceof ArrayBuffer ) && ( videoNode.Content.byteLength > 0 );\r\n\t\t\t\t\t\tvar base64Content = ( typeof videoNode.Content === 'string' ) && ( videoNode.Content !== '' );\r\n\r\n\t\t\t\t\t\tif ( arrayBufferContent || base64Content ) {\r\n\r\n\t\t\t\t\t\t\tvar image = this.parseImage( videoNodes[ nodeID ] );\r\n\r\n\t\t\t\t\t\t\tblobs[ videoNode.RelativeFilename || videoNode.Filename ] = image;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var id in images ) {\r\n\r\n\t\t\t\tvar filename = images[ id ];\r\n\r\n\t\t\t\tif ( blobs[ filename ] !== undefined ) images[ id ] = blobs[ filename ];\r\n\t\t\t\telse images[ id ] = images[ id ].split( '\\\\' ).pop();\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn images;\r\n\r\n\t\t},\r\n\r\n\t\t// Parse embedded image data in FBXTree.Video.Content\r\n\t\tparseImage: function ( videoNode ) {\r\n\r\n\t\t\tvar content = videoNode.Content;\r\n\t\t\tvar fileName = videoNode.RelativeFilename || videoNode.Filename;\r\n\t\t\tvar extension = fileName.slice( fileName.lastIndexOf( '.' ) + 1 ).toLowerCase();\r\n\r\n\t\t\tvar type;\r\n\r\n\t\t\tswitch ( extension ) {\r\n\r\n\t\t\t\tcase 'bmp':\r\n\r\n\t\t\t\t\ttype = 'image/bmp';\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'jpg':\r\n\t\t\t\tcase 'jpeg':\r\n\r\n\t\t\t\t\ttype = 'image/jpeg';\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'png':\r\n\r\n\t\t\t\t\ttype = 'image/png';\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'tif':\r\n\r\n\t\t\t\t\ttype = 'image/tiff';\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'tga':\r\n\r\n\t\t\t\t\tif ( this.manager.getHandler( '.tga' ) === null ) {\r\n\r\n\t\t\t\t\t\tconsole.warn( 'FBXLoader: TGA loader not found, skipping ', fileName );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttype = 'image/tga';\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\r\n\t\t\t\t\tconsole.warn( 'FBXLoader: Image type \"' + extension + '\" is not supported.' );\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( typeof content === 'string' ) { // ASCII format\r\n\r\n\t\t\t\treturn 'data:' + type + ';base64,' + content;\r\n\r\n\t\t\t} else { // Binary Format\r\n\r\n\t\t\t\tvar array = new Uint8Array( content );\r\n\t\t\t\treturn window.URL.createObjectURL( new Blob( [ array ], { type: type } ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\t// Parse nodes in FBXTree.Objects.Texture\r\n\t\t// These contain details such as UV scaling, cropping, rotation etc and are connected\r\n\t\t// to images in FBXTree.Objects.Video\r\n\t\tparseTextures: function ( images ) {\r\n\r\n\t\t\tvar textureMap = new Map();\r\n\r\n\t\t\tif ( 'Texture' in fbxTree.Objects ) {\r\n\r\n\t\t\t\tvar textureNodes = fbxTree.Objects.Texture;\r\n\t\t\t\tfor ( var nodeID in textureNodes ) {\r\n\r\n\t\t\t\t\tvar texture = this.parseTexture( textureNodes[ nodeID ], images );\r\n\t\t\t\t\ttextureMap.set( parseInt( nodeID ), texture );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn textureMap;\r\n\r\n\t\t},\r\n\r\n\t\t// Parse individual node in FBXTree.Objects.Texture\r\n\t\tparseTexture: function ( textureNode, images ) {\r\n\r\n\t\t\tvar texture = this.loadTexture( textureNode, images );\r\n\r\n\t\t\ttexture.ID = textureNode.id;\r\n\r\n\t\t\ttexture.name = textureNode.attrName;\r\n\r\n\t\t\tvar wrapModeU = textureNode.WrapModeU;\r\n\t\t\tvar wrapModeV = textureNode.WrapModeV;\r\n\r\n\t\t\tvar valueU = wrapModeU !== undefined ? wrapModeU.value : 0;\r\n\t\t\tvar valueV = wrapModeV !== undefined ? wrapModeV.value : 0;\r\n\r\n\t\t\t// http://download.autodesk.com/us/fbx/SDKdocs/FBX_SDK_Help/files/fbxsdkref/class_k_fbx_texture.html#889640e63e2e681259ea81061b85143a\r\n\t\t\t// 0: repeat(default), 1: clamp\r\n\r\n\t\t\ttexture.wrapS = valueU === 0 ? RepeatWrapping : ClampToEdgeWrapping;\r\n\t\t\ttexture.wrapT = valueV === 0 ? RepeatWrapping : ClampToEdgeWrapping;\r\n\r\n\t\t\tif ( 'Scaling' in textureNode ) {\r\n\r\n\t\t\t\tvar values = textureNode.Scaling.value;\r\n\r\n\t\t\t\ttexture.repeat.x = values[ 0 ];\r\n\t\t\t\ttexture.repeat.y = values[ 1 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn texture;\r\n\r\n\t\t},\r\n\r\n\t\t// load a texture specified as a blob or data URI, or via an external URL using TextureLoader\r\n\t\tloadTexture: function ( textureNode, images ) {\r\n\r\n\t\t\tvar fileName;\r\n\r\n\t\t\tvar currentPath = this.textureLoader.path;\r\n\r\n\t\t\tvar children = connections.get( textureNode.id ).children;\r\n\r\n\t\t\tif ( children !== undefined && children.length > 0 && images[ children[ 0 ].ID ] !== undefined ) {\r\n\r\n\t\t\t\tfileName = images[ children[ 0 ].ID ];\r\n\r\n\t\t\t\tif ( fileName.indexOf( 'blob:' ) === 0 || fileName.indexOf( 'data:' ) === 0 ) {\r\n\r\n\t\t\t\t\tthis.textureLoader.setPath( undefined );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar texture;\r\n\r\n\t\t\tvar extension = textureNode.FileName.slice( - 3 ).toLowerCase();\r\n\r\n\t\t\tif ( extension === 'tga' ) {\r\n\r\n\t\t\t\tvar loader = this.manager.getHandler( '.tga' );\r\n\r\n\t\t\t\tif ( loader === null ) {\r\n\r\n\t\t\t\t\tconsole.warn( 'FBXLoader: TGA loader not found, creating placeholder texture for', textureNode.RelativeFilename );\r\n\t\t\t\t\ttexture = new Texture();\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\ttexture = loader.load( fileName );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( extension === 'psd' ) {\r\n\r\n\t\t\t\tconsole.warn( 'FBXLoader: PSD textures are not supported, creating placeholder texture for', textureNode.RelativeFilename );\r\n\t\t\t\ttexture = new Texture();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\ttexture = this.textureLoader.load( fileName );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.textureLoader.setPath( currentPath );\r\n\r\n\t\t\treturn texture;\r\n\r\n\t\t},\r\n\r\n\t\t// Parse nodes in FBXTree.Objects.Material\r\n\t\tparseMaterials: function ( textureMap ) {\r\n\r\n\t\t\tvar materialMap = new Map();\r\n\r\n\t\t\tif ( 'Material' in fbxTree.Objects ) {\r\n\r\n\t\t\t\tvar materialNodes = fbxTree.Objects.Material;\r\n\r\n\t\t\t\tfor ( var nodeID in materialNodes ) {\r\n\r\n\t\t\t\t\tvar material = this.parseMaterial( materialNodes[ nodeID ], textureMap );\r\n\r\n\t\t\t\t\tif ( material !== null ) materialMap.set( parseInt( nodeID ), material );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn materialMap;\r\n\r\n\t\t},\r\n\r\n\t\t// Parse single node in FBXTree.Objects.Material\r\n\t\t// Materials are connected to texture maps in FBXTree.Objects.Textures\r\n\t\t// FBX format currently only supports Lambert and Phong shading models\r\n\t\tparseMaterial: function ( materialNode, textureMap ) {\r\n\r\n\t\t\tvar ID = materialNode.id;\r\n\t\t\tvar name = materialNode.attrName;\r\n\t\t\tvar type = materialNode.ShadingModel;\r\n\r\n\t\t\t// Case where FBX wraps shading model in property object.\r\n\t\t\tif ( typeof type === 'object' ) {\r\n\r\n\t\t\t\ttype = type.value;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Ignore unused materials which don't have any connections.\r\n\t\t\tif ( ! connections.has( ID ) ) return null;\r\n\r\n\t\t\tvar parameters = this.parseParameters( materialNode, textureMap, ID );\r\n\r\n\t\t\tvar material;\r\n\r\n\t\t\tswitch ( type.toLowerCase() ) {\r\n\r\n\t\t\t\tcase 'phong':\r\n\t\t\t\t\tmaterial = new MeshPhongMaterial();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'lambert':\r\n\t\t\t\t\tmaterial = new MeshLambertMaterial();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: unknown material type \"%s\". Defaulting to MeshPhongMaterial.', type );\r\n\t\t\t\t\tmaterial = new MeshPhongMaterial();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterial.setValues( parameters );\r\n\t\t\tmaterial.name = name;\r\n\r\n\t\t\treturn material;\r\n\r\n\t\t},\r\n\r\n\t\t// Parse FBX material and return parameters suitable for a three.js material\r\n\t\t// Also parse the texture map and return any textures associated with the material\r\n\t\tparseParameters: function ( materialNode, textureMap, ID ) {\r\n\r\n\t\t\tvar parameters = {};\r\n\r\n\t\t\tif ( materialNode.BumpFactor ) {\r\n\r\n\t\t\t\tparameters.bumpScale = materialNode.BumpFactor.value;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( materialNode.Diffuse ) {\r\n\r\n\t\t\t\tparameters.color = new Color().fromArray( materialNode.Diffuse.value );\r\n\r\n\t\t\t} else if ( materialNode.DiffuseColor && materialNode.DiffuseColor.type === 'Color' ) {\r\n\r\n\t\t\t\t// The blender exporter exports diffuse here instead of in materialNode.Diffuse\r\n\t\t\t\tparameters.color = new Color().fromArray( materialNode.DiffuseColor.value );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( materialNode.DisplacementFactor ) {\r\n\r\n\t\t\t\tparameters.displacementScale = materialNode.DisplacementFactor.value;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( materialNode.Emissive ) {\r\n\r\n\t\t\t\tparameters.emissive = new Color().fromArray( materialNode.Emissive.value );\r\n\r\n\t\t\t} else if ( materialNode.EmissiveColor && materialNode.EmissiveColor.type === 'Color' ) {\r\n\r\n\t\t\t\t// The blender exporter exports emissive color here instead of in materialNode.Emissive\r\n\t\t\t\tparameters.emissive = new Color().fromArray( materialNode.EmissiveColor.value );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( materialNode.EmissiveFactor ) {\r\n\r\n\t\t\t\tparameters.emissiveIntensity = parseFloat( materialNode.EmissiveFactor.value );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( materialNode.Opacity ) {\r\n\r\n\t\t\t\tparameters.opacity = parseFloat( materialNode.Opacity.value );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( parameters.opacity < 1.0 ) {\r\n\r\n\t\t\t\tparameters.transparent = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( materialNode.ReflectionFactor ) {\r\n\r\n\t\t\t\tparameters.reflectivity = materialNode.ReflectionFactor.value;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( materialNode.Shininess ) {\r\n\r\n\t\t\t\tparameters.shininess = materialNode.Shininess.value;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( materialNode.Specular ) {\r\n\r\n\t\t\t\tparameters.specular = new Color().fromArray( materialNode.Specular.value );\r\n\r\n\t\t\t} else if ( materialNode.SpecularColor && materialNode.SpecularColor.type === 'Color' ) {\r\n\r\n\t\t\t\t// The blender exporter exports specular color here instead of in materialNode.Specular\r\n\t\t\t\tparameters.specular = new Color().fromArray( materialNode.SpecularColor.value );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar scope = this;\r\n\t\t\tconnections.get( ID ).children.forEach( function ( child ) {\r\n\r\n\t\t\t\tvar type = child.relationship;\r\n\r\n\t\t\t\tswitch ( type ) {\r\n\r\n\t\t\t\t\tcase 'Bump':\r\n\t\t\t\t\t\tparameters.bumpMap = scope.getTexture( textureMap, child.ID );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'Maya|TEX_ao_map':\r\n\t\t\t\t\t\tparameters.aoMap = scope.getTexture( textureMap, child.ID );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'DiffuseColor':\r\n\t\t\t\t\tcase 'Maya|TEX_color_map':\r\n\t\t\t\t\t\tparameters.map = scope.getTexture( textureMap, child.ID );\r\n\t\t\t\t\t\tparameters.map.encoding = sRGBEncoding;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'DisplacementColor':\r\n\t\t\t\t\t\tparameters.displacementMap = scope.getTexture( textureMap, child.ID );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'EmissiveColor':\r\n\t\t\t\t\t\tparameters.emissiveMap = scope.getTexture( textureMap, child.ID );\r\n\t\t\t\t\t\tparameters.emissiveMap.encoding = sRGBEncoding;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'NormalMap':\r\n\t\t\t\t\tcase 'Maya|TEX_normal_map':\r\n\t\t\t\t\t\tparameters.normalMap = scope.getTexture( textureMap, child.ID );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'ReflectionColor':\r\n\t\t\t\t\t\tparameters.envMap = scope.getTexture( textureMap, child.ID );\r\n\t\t\t\t\t\tparameters.envMap.mapping = EquirectangularReflectionMapping;\r\n\t\t\t\t\t\tparameters.envMap.encoding = sRGBEncoding;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'SpecularColor':\r\n\t\t\t\t\t\tparameters.specularMap = scope.getTexture( textureMap, child.ID );\r\n\t\t\t\t\t\tparameters.specularMap.encoding = sRGBEncoding;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'TransparentColor':\r\n\t\t\t\t\tcase 'TransparencyFactor':\r\n\t\t\t\t\t\tparameters.alphaMap = scope.getTexture( textureMap, child.ID );\r\n\t\t\t\t\t\tparameters.transparent = true;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'AmbientColor':\r\n\t\t\t\t\tcase 'ShininessExponent': // AKA glossiness map\r\n\t\t\t\t\tcase 'SpecularFactor': // AKA specularLevel\r\n\t\t\t\t\tcase 'VectorDisplacementColor': // NOTE: Seems to be a copy of DisplacementColor\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: %s map is not supported in three.js, skipping texture.', type );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t\treturn parameters;\r\n\r\n\t\t},\r\n\r\n\t\t// get a texture from the textureMap for use by a material.\r\n\t\tgetTexture: function ( textureMap, id ) {\r\n\r\n\t\t\t// if the texture is a layered texture, just use the first layer and issue a warning\r\n\t\t\tif ( 'LayeredTexture' in fbxTree.Objects && id in fbxTree.Objects.LayeredTexture ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer.' );\r\n\t\t\t\tid = connections.get( id ).children[ 0 ].ID;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn textureMap.get( id );\r\n\r\n\t\t},\r\n\r\n\t\t// Parse nodes in FBXTree.Objects.Deformer\r\n\t\t// Deformer node can contain skinning or Vertex Cache animation data, however only skinning is supported here\r\n\t\t// Generates map of Skeleton-like objects for use later when generating and binding skeletons.\r\n\t\tparseDeformers: function () {\r\n\r\n\t\t\tvar skeletons = {};\r\n\t\t\tvar morphTargets = {};\r\n\r\n\t\t\tif ( 'Deformer' in fbxTree.Objects ) {\r\n\r\n\t\t\t\tvar DeformerNodes = fbxTree.Objects.Deformer;\r\n\r\n\t\t\t\tfor ( var nodeID in DeformerNodes ) {\r\n\r\n\t\t\t\t\tvar deformerNode = DeformerNodes[ nodeID ];\r\n\r\n\t\t\t\t\tvar relationships = connections.get( parseInt( nodeID ) );\r\n\r\n\t\t\t\t\tif ( deformerNode.attrType === 'Skin' ) {\r\n\r\n\t\t\t\t\t\tvar skeleton = this.parseSkeleton( relationships, DeformerNodes );\r\n\t\t\t\t\t\tskeleton.ID = nodeID;\r\n\r\n\t\t\t\t\t\tif ( relationships.parents.length > 1 ) console.warn( 'THREE.FBXLoader: skeleton attached to more than one geometry is not supported.' );\r\n\t\t\t\t\t\tskeleton.geometryID = relationships.parents[ 0 ].ID;\r\n\r\n\t\t\t\t\t\tskeletons[ nodeID ] = skeleton;\r\n\r\n\t\t\t\t\t} else if ( deformerNode.attrType === 'BlendShape' ) {\r\n\r\n\t\t\t\t\t\tvar morphTarget = {\r\n\t\t\t\t\t\t\tid: nodeID,\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tmorphTarget.rawTargets = this.parseMorphTargets( relationships, DeformerNodes );\r\n\t\t\t\t\t\tmorphTarget.id = nodeID;\r\n\r\n\t\t\t\t\t\tif ( relationships.parents.length > 1 ) console.warn( 'THREE.FBXLoader: morph target attached to more than one geometry is not supported.' );\r\n\r\n\t\t\t\t\t\tmorphTargets[ nodeID ] = morphTarget;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\r\n\t\t\t\tskeletons: skeletons,\r\n\t\t\t\tmorphTargets: morphTargets,\r\n\r\n\t\t\t};\r\n\r\n\t\t},\r\n\r\n\t\t// Parse single nodes in FBXTree.Objects.Deformer\r\n\t\t// The top level skeleton node has type 'Skin' and sub nodes have type 'Cluster'\r\n\t\t// Each skin node represents a skeleton and each cluster node represents a bone\r\n\t\tparseSkeleton: function ( relationships, deformerNodes ) {\r\n\r\n\t\t\tvar rawBones = [];\r\n\r\n\t\t\trelationships.children.forEach( function ( child ) {\r\n\r\n\t\t\t\tvar boneNode = deformerNodes[ child.ID ];\r\n\r\n\t\t\t\tif ( boneNode.attrType !== 'Cluster' ) return;\r\n\r\n\t\t\t\tvar rawBone = {\r\n\r\n\t\t\t\t\tID: child.ID,\r\n\t\t\t\t\tindices: [],\r\n\t\t\t\t\tweights: [],\r\n\t\t\t\t\ttransformLink: new Matrix4().fromArray( boneNode.TransformLink.a ),\r\n\t\t\t\t\t// transform: new Matrix4().fromArray( boneNode.Transform.a ),\r\n\t\t\t\t\t// linkMode: boneNode.Mode,\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif ( 'Indexes' in boneNode ) {\r\n\r\n\t\t\t\t\trawBone.indices = boneNode.Indexes.a;\r\n\t\t\t\t\trawBone.weights = boneNode.Weights.a;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\trawBones.push( rawBone );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\treturn {\r\n\r\n\t\t\t\trawBones: rawBones,\r\n\t\t\t\tbones: []\r\n\r\n\t\t\t};\r\n\r\n\t\t},\r\n\r\n\t\t// The top level morph deformer node has type \"BlendShape\" and sub nodes have type \"BlendShapeChannel\"\r\n\t\tparseMorphTargets: function ( relationships, deformerNodes ) {\r\n\r\n\t\t\tvar rawMorphTargets = [];\r\n\r\n\t\t\tfor ( var i = 0; i < relationships.children.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = relationships.children[ i ];\r\n\r\n\t\t\t\tvar morphTargetNode = deformerNodes[ child.ID ];\r\n\r\n\t\t\t\tvar rawMorphTarget = {\r\n\r\n\t\t\t\t\tname: morphTargetNode.attrName,\r\n\t\t\t\t\tinitialWeight: morphTargetNode.DeformPercent,\r\n\t\t\t\t\tid: morphTargetNode.id,\r\n\t\t\t\t\tfullWeights: morphTargetNode.FullWeights.a\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif ( morphTargetNode.attrType !== 'BlendShapeChannel' ) return;\r\n\r\n\t\t\t\trawMorphTarget.geoID = connections.get( parseInt( child.ID ) ).children.filter( function ( child ) {\r\n\r\n\t\t\t\t\treturn child.relationship === undefined;\r\n\r\n\t\t\t\t} )[ 0 ].ID;\r\n\r\n\t\t\t\trawMorphTargets.push( rawMorphTarget );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn rawMorphTargets;\r\n\r\n\t\t},\r\n\r\n\t\t// create the main Group() to be returned by the loader\r\n\t\tparseScene: function ( deformers, geometryMap, materialMap ) {\r\n\r\n\t\t\tsceneGraph = new Group();\r\n\r\n\t\t\tvar modelMap = this.parseModels( deformers.skeletons, geometryMap, materialMap );\r\n\r\n\t\t\tvar modelNodes = fbxTree.Objects.Model;\r\n\r\n\t\t\tvar scope = this;\r\n\t\t\tmodelMap.forEach( function ( model ) {\r\n\r\n\t\t\t\tvar modelNode = modelNodes[ model.ID ];\r\n\t\t\t\tscope.setLookAtProperties( model, modelNode );\r\n\r\n\t\t\t\tvar parentConnections = connections.get( model.ID ).parents;\r\n\r\n\t\t\t\tparentConnections.forEach( function ( connection ) {\r\n\r\n\t\t\t\t\tvar parent = modelMap.get( connection.ID );\r\n\t\t\t\t\tif ( parent !== undefined ) parent.add( model );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t\tif ( model.parent === null ) {\r\n\r\n\t\t\t\t\tsceneGraph.add( model );\r\n\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tthis.bindSkeleton( deformers.skeletons, geometryMap, modelMap );\r\n\r\n\t\t\tthis.createAmbientLight();\r\n\r\n\t\t\tthis.setupMorphMaterials();\r\n\r\n\t\t\tsceneGraph.traverse( function ( node ) {\r\n\r\n\t\t\t\tif ( node.userData.transformData ) {\r\n\r\n\t\t\t\t\tif ( node.parent ) node.userData.transformData.parentMatrixWorld = node.parent.matrix;\r\n\r\n\t\t\t\t\tvar transform = generateTransform( node.userData.transformData );\r\n\r\n\t\t\t\t\tnode.applyMatrix4( transform );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tvar animations = new AnimationParser().parse();\r\n\r\n\t\t\t// if all the models where already combined in a single group, just return that\r\n\t\t\tif ( sceneGraph.children.length === 1 && sceneGraph.children[ 0 ].isGroup ) {\r\n\r\n\t\t\t\tsceneGraph.children[ 0 ].animations = animations;\r\n\t\t\t\tsceneGraph = sceneGraph.children[ 0 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tsceneGraph.animations = animations;\r\n\r\n\t\t},\r\n\r\n\t\t// parse nodes in FBXTree.Objects.Model\r\n\t\tparseModels: function ( skeletons, geometryMap, materialMap ) {\r\n\r\n\t\t\tvar modelMap = new Map();\r\n\t\t\tvar modelNodes = fbxTree.Objects.Model;\r\n\r\n\t\t\tfor ( var nodeID in modelNodes ) {\r\n\r\n\t\t\t\tvar id = parseInt( nodeID );\r\n\t\t\t\tvar node = modelNodes[ nodeID ];\r\n\t\t\t\tvar relationships = connections.get( id );\r\n\r\n\t\t\t\tvar model = this.buildSkeleton( relationships, skeletons, id, node.attrName );\r\n\r\n\t\t\t\tif ( ! model ) {\r\n\r\n\t\t\t\t\tswitch ( node.attrType ) {\r\n\r\n\t\t\t\t\t\tcase 'Camera':\r\n\t\t\t\t\t\t\tmodel = this.createCamera( relationships );\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'Light':\r\n\t\t\t\t\t\t\tmodel = this.createLight( relationships );\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'Mesh':\r\n\t\t\t\t\t\t\tmodel = this.createMesh( relationships, geometryMap, materialMap );\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'NurbsCurve':\r\n\t\t\t\t\t\t\tmodel = this.createCurve( relationships, geometryMap );\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'LimbNode':\r\n\t\t\t\t\t\tcase 'Root':\r\n\t\t\t\t\t\t\tmodel = new Bone();\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'Null':\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tmodel = new Group();\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tmodel.name = node.attrName ? PropertyBinding.sanitizeNodeName( node.attrName ) : '';\r\n\r\n\t\t\t\t\tmodel.ID = id;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.getTransformData( model, node );\r\n\t\t\t\tmodelMap.set( id, model );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn modelMap;\r\n\r\n\t\t},\r\n\r\n\t\tbuildSkeleton: function ( relationships, skeletons, id, name ) {\r\n\r\n\t\t\tvar bone = null;\r\n\r\n\t\t\trelationships.parents.forEach( function ( parent ) {\r\n\r\n\t\t\t\tfor ( var ID in skeletons ) {\r\n\r\n\t\t\t\t\tvar skeleton = skeletons[ ID ];\r\n\r\n\t\t\t\t\tskeleton.rawBones.forEach( function ( rawBone, i ) {\r\n\r\n\t\t\t\t\t\tif ( rawBone.ID === parent.ID ) {\r\n\r\n\t\t\t\t\t\t\tvar subBone = bone;\r\n\t\t\t\t\t\t\tbone = new Bone();\r\n\r\n\t\t\t\t\t\t\tbone.matrixWorld.copy( rawBone.transformLink );\r\n\r\n\t\t\t\t\t\t\t// set name and id here - otherwise in cases where \"subBone\" is created it will not have a name / id\r\n\r\n\t\t\t\t\t\t\tbone.name = name ? PropertyBinding.sanitizeNodeName( name ) : '';\r\n\t\t\t\t\t\t\tbone.ID = id;\r\n\r\n\t\t\t\t\t\t\tskeleton.bones[ i ] = bone;\r\n\r\n\t\t\t\t\t\t\t// In cases where a bone is shared between multiple meshes\r\n\t\t\t\t\t\t\t// duplicate the bone here and and it as a child of the first bone\r\n\t\t\t\t\t\t\tif ( subBone !== null ) {\r\n\r\n\t\t\t\t\t\t\t\tbone.add( subBone );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t\treturn bone;\r\n\r\n\t\t},\r\n\r\n\t\t// create a PerspectiveCamera or OrthographicCamera\r\n\t\tcreateCamera: function ( relationships ) {\r\n\r\n\t\t\tvar model;\r\n\t\t\tvar cameraAttribute;\r\n\r\n\t\t\trelationships.children.forEach( function ( child ) {\r\n\r\n\t\t\t\tvar attr = fbxTree.Objects.NodeAttribute[ child.ID ];\r\n\r\n\t\t\t\tif ( attr !== undefined ) {\r\n\r\n\t\t\t\t\tcameraAttribute = attr;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tif ( cameraAttribute === undefined ) {\r\n\r\n\t\t\t\tmodel = new Object3D();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar type = 0;\r\n\t\t\t\tif ( cameraAttribute.CameraProjectionType !== undefined && cameraAttribute.CameraProjectionType.value === 1 ) {\r\n\r\n\t\t\t\t\ttype = 1;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar nearClippingPlane = 1;\r\n\t\t\t\tif ( cameraAttribute.NearPlane !== undefined ) {\r\n\r\n\t\t\t\t\tnearClippingPlane = cameraAttribute.NearPlane.value / 1000;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar farClippingPlane = 1000;\r\n\t\t\t\tif ( cameraAttribute.FarPlane !== undefined ) {\r\n\r\n\t\t\t\t\tfarClippingPlane = cameraAttribute.FarPlane.value / 1000;\r\n\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tvar width = window.innerWidth;\r\n\t\t\t\tvar height = window.innerHeight;\r\n\r\n\t\t\t\tif ( cameraAttribute.AspectWidth !== undefined && cameraAttribute.AspectHeight !== undefined ) {\r\n\r\n\t\t\t\t\twidth = cameraAttribute.AspectWidth.value;\r\n\t\t\t\t\theight = cameraAttribute.AspectHeight.value;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar aspect = width / height;\r\n\r\n\t\t\t\tvar fov = 45;\r\n\t\t\t\tif ( cameraAttribute.FieldOfView !== undefined ) {\r\n\r\n\t\t\t\t\tfov = cameraAttribute.FieldOfView.value;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar focalLength = cameraAttribute.FocalLength ? cameraAttribute.FocalLength.value : null;\r\n\r\n\t\t\t\tswitch ( type ) {\r\n\r\n\t\t\t\t\tcase 0: // Perspective\r\n\t\t\t\t\t\tmodel = new PerspectiveCamera( fov, aspect, nearClippingPlane, farClippingPlane );\r\n\t\t\t\t\t\tif ( focalLength !== null ) model.setFocalLength( focalLength );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 1: // Orthographic\r\n\t\t\t\t\t\tmodel = new OrthographicCamera( - width / 2, width / 2, height / 2, - height / 2, nearClippingPlane, farClippingPlane );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: Unknown camera type ' + type + '.' );\r\n\t\t\t\t\t\tmodel = new Object3D();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn model;\r\n\r\n\t\t},\r\n\r\n\t\t// Create a DirectionalLight, PointLight or SpotLight\r\n\t\tcreateLight: function ( relationships ) {\r\n\r\n\t\t\tvar model;\r\n\t\t\tvar lightAttribute;\r\n\r\n\t\t\trelationships.children.forEach( function ( child ) {\r\n\r\n\t\t\t\tvar attr = fbxTree.Objects.NodeAttribute[ child.ID ];\r\n\r\n\t\t\t\tif ( attr !== undefined ) {\r\n\r\n\t\t\t\t\tlightAttribute = attr;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tif ( lightAttribute === undefined ) {\r\n\r\n\t\t\t\tmodel = new Object3D();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar type;\r\n\r\n\t\t\t\t// LightType can be undefined for Point lights\r\n\t\t\t\tif ( lightAttribute.LightType === undefined ) {\r\n\r\n\t\t\t\t\ttype = 0;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\ttype = lightAttribute.LightType.value;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar color = 0xffffff;\r\n\r\n\t\t\t\tif ( lightAttribute.Color !== undefined ) {\r\n\r\n\t\t\t\t\tcolor = new Color().fromArray( lightAttribute.Color.value );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar intensity = ( lightAttribute.Intensity === undefined ) ? 1 : lightAttribute.Intensity.value / 100;\r\n\r\n\t\t\t\t// light disabled\r\n\t\t\t\tif ( lightAttribute.CastLightOnObject !== undefined && lightAttribute.CastLightOnObject.value === 0 ) {\r\n\r\n\t\t\t\t\tintensity = 0;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar distance = 0;\r\n\t\t\t\tif ( lightAttribute.FarAttenuationEnd !== undefined ) {\r\n\r\n\t\t\t\t\tif ( lightAttribute.EnableFarAttenuation !== undefined && lightAttribute.EnableFarAttenuation.value === 0 ) {\r\n\r\n\t\t\t\t\t\tdistance = 0;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tdistance = lightAttribute.FarAttenuationEnd.value;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// TODO: could this be calculated linearly from FarAttenuationStart to FarAttenuationEnd?\r\n\t\t\t\tvar decay = 1;\r\n\r\n\t\t\t\tswitch ( type ) {\r\n\r\n\t\t\t\t\tcase 0: // Point\r\n\t\t\t\t\t\tmodel = new PointLight( color, intensity, distance, decay );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 1: // Directional\r\n\t\t\t\t\t\tmodel = new DirectionalLight( color, intensity );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 2: // Spot\r\n\t\t\t\t\t\tvar angle = Math.PI / 3;\r\n\r\n\t\t\t\t\t\tif ( lightAttribute.InnerAngle !== undefined ) {\r\n\r\n\t\t\t\t\t\t\tangle = MathUtils.degToRad( lightAttribute.InnerAngle.value );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar penumbra = 0;\r\n\t\t\t\t\t\tif ( lightAttribute.OuterAngle !== undefined ) {\r\n\r\n\t\t\t\t\t\t\t// TODO: this is not correct - FBX calculates outer and inner angle in degrees\r\n\t\t\t\t\t\t\t// with OuterAngle > InnerAngle && OuterAngle <= Math.PI\r\n\t\t\t\t\t\t\t// while three.js uses a penumbra between (0, 1) to attenuate the inner angle\r\n\t\t\t\t\t\t\tpenumbra = MathUtils.degToRad( lightAttribute.OuterAngle.value );\r\n\t\t\t\t\t\t\tpenumbra = Math.max( penumbra, 1 );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tmodel = new SpotLight( color, intensity, distance, angle, penumbra, decay );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: Unknown light type ' + lightAttribute.LightType.value + ', defaulting to a PointLight.' );\r\n\t\t\t\t\t\tmodel = new PointLight( color, intensity );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( lightAttribute.CastShadows !== undefined && lightAttribute.CastShadows.value === 1 ) {\r\n\r\n\t\t\t\t\tmodel.castShadow = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn model;\r\n\r\n\t\t},\r\n\r\n\t\tcreateMesh: function ( relationships, geometryMap, materialMap ) {\r\n\r\n\t\t\tvar model;\r\n\t\t\tvar geometry = null;\r\n\t\t\tvar material = null;\r\n\t\t\tvar materials = [];\r\n\r\n\t\t\t// get geometry and materials(s) from connections\r\n\t\t\trelationships.children.forEach( function ( child ) {\r\n\r\n\t\t\t\tif ( geometryMap.has( child.ID ) ) {\r\n\r\n\t\t\t\t\tgeometry = geometryMap.get( child.ID );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( materialMap.has( child.ID ) ) {\r\n\r\n\t\t\t\t\tmaterials.push( materialMap.get( child.ID ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tif ( materials.length > 1 ) {\r\n\r\n\t\t\t\tmaterial = materials;\r\n\r\n\t\t\t} else if ( materials.length > 0 ) {\r\n\r\n\t\t\t\tmaterial = materials[ 0 ];\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tmaterial = new MeshPhongMaterial( { color: 0xcccccc } );\r\n\t\t\t\tmaterials.push( material );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( 'color' in geometry.attributes ) {\r\n\r\n\t\t\t\tmaterials.forEach( function ( material ) {\r\n\r\n\t\t\t\t\tmaterial.vertexColors = true;\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( geometry.FBX_Deformer ) {\r\n\r\n\t\t\t\tmaterials.forEach( function ( material ) {\r\n\r\n\t\t\t\t\tmaterial.skinning = true;\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t\tmodel = new SkinnedMesh( geometry, material );\r\n\t\t\t\tmodel.normalizeSkinWeights();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tmodel = new Mesh( geometry, material );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn model;\r\n\r\n\t\t},\r\n\r\n\t\tcreateCurve: function ( relationships, geometryMap ) {\r\n\r\n\t\t\tvar geometry = relationships.children.reduce( function ( geo, child ) {\r\n\r\n\t\t\t\tif ( geometryMap.has( child.ID ) ) geo = geometryMap.get( child.ID );\r\n\r\n\t\t\t\treturn geo;\r\n\r\n\t\t\t}, null );\r\n\r\n\t\t\t// FBX does not list materials for Nurbs lines, so we'll just put our own in here.\r\n\t\t\tvar material = new LineBasicMaterial( { color: 0x3300ff, linewidth: 1 } );\r\n\t\t\treturn new Line( geometry, material );\r\n\r\n\t\t},\r\n\r\n\t\t// parse the model node for transform data\r\n\t\tgetTransformData: function ( model, modelNode ) {\r\n\r\n\t\t\tvar transformData = {};\r\n\r\n\t\t\tif ( 'InheritType' in modelNode ) transformData.inheritType = parseInt( modelNode.InheritType.value );\r\n\r\n\t\t\tif ( 'RotationOrder' in modelNode ) transformData.eulerOrder = getEulerOrder( modelNode.RotationOrder.value );\r\n\t\t\telse transformData.eulerOrder = 'ZYX';\r\n\r\n\t\t\tif ( 'Lcl_Translation' in modelNode ) transformData.translation = modelNode.Lcl_Translation.value;\r\n\r\n\t\t\tif ( 'PreRotation' in modelNode ) transformData.preRotation = modelNode.PreRotation.value;\r\n\t\t\tif ( 'Lcl_Rotation' in modelNode ) transformData.rotation = modelNode.Lcl_Rotation.value;\r\n\t\t\tif ( 'PostRotation' in modelNode ) transformData.postRotation = modelNode.PostRotation.value;\r\n\r\n\t\t\tif ( 'Lcl_Scaling' in modelNode ) transformData.scale = modelNode.Lcl_Scaling.value;\r\n\r\n\t\t\tif ( 'ScalingOffset' in modelNode ) transformData.scalingOffset = modelNode.ScalingOffset.value;\r\n\t\t\tif ( 'ScalingPivot' in modelNode ) transformData.scalingPivot = modelNode.ScalingPivot.value;\r\n\r\n\t\t\tif ( 'RotationOffset' in modelNode ) transformData.rotationOffset = modelNode.RotationOffset.value;\r\n\t\t\tif ( 'RotationPivot' in modelNode ) transformData.rotationPivot = modelNode.RotationPivot.value;\r\n\r\n\t\t\tmodel.userData.transformData = transformData;\r\n\r\n\t\t},\r\n\r\n\t\tsetLookAtProperties: function ( model, modelNode ) {\r\n\r\n\t\t\tif ( 'LookAtProperty' in modelNode ) {\r\n\r\n\t\t\t\tvar children = connections.get( model.ID ).children;\r\n\r\n\t\t\t\tchildren.forEach( function ( child ) {\r\n\r\n\t\t\t\t\tif ( child.relationship === 'LookAtProperty' ) {\r\n\r\n\t\t\t\t\t\tvar lookAtTarget = fbxTree.Objects.Model[ child.ID ];\r\n\r\n\t\t\t\t\t\tif ( 'Lcl_Translation' in lookAtTarget ) {\r\n\r\n\t\t\t\t\t\t\tvar pos = lookAtTarget.Lcl_Translation.value;\r\n\r\n\t\t\t\t\t\t\t// DirectionalLight, SpotLight\r\n\t\t\t\t\t\t\tif ( model.target !== undefined ) {\r\n\r\n\t\t\t\t\t\t\t\tmodel.target.position.fromArray( pos );\r\n\t\t\t\t\t\t\t\tsceneGraph.add( model.target );\r\n\r\n\t\t\t\t\t\t\t} else { // Cameras and other Object3Ds\r\n\r\n\t\t\t\t\t\t\t\tmodel.lookAt( new Vector3().fromArray( pos ) );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\tbindSkeleton: function ( skeletons, geometryMap, modelMap ) {\r\n\r\n\t\t\tvar bindMatrices = this.parsePoseNodes();\r\n\r\n\t\t\tfor ( var ID in skeletons ) {\r\n\r\n\t\t\t\tvar skeleton = skeletons[ ID ];\r\n\r\n\t\t\t\tvar parents = connections.get( parseInt( skeleton.ID ) ).parents;\r\n\r\n\t\t\t\tparents.forEach( function ( parent ) {\r\n\r\n\t\t\t\t\tif ( geometryMap.has( parent.ID ) ) {\r\n\r\n\t\t\t\t\t\tvar geoID = parent.ID;\r\n\t\t\t\t\t\tvar geoRelationships = connections.get( geoID );\r\n\r\n\t\t\t\t\t\tgeoRelationships.parents.forEach( function ( geoConnParent ) {\r\n\r\n\t\t\t\t\t\t\tif ( modelMap.has( geoConnParent.ID ) ) {\r\n\r\n\t\t\t\t\t\t\t\tvar model = modelMap.get( geoConnParent.ID );\r\n\r\n\t\t\t\t\t\t\t\tmodel.bind( new Skeleton( skeleton.bones ), bindMatrices[ geoConnParent.ID ] );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\tparsePoseNodes: function () {\r\n\r\n\t\t\tvar bindMatrices = {};\r\n\r\n\t\t\tif ( 'Pose' in fbxTree.Objects ) {\r\n\r\n\t\t\t\tvar BindPoseNode = fbxTree.Objects.Pose;\r\n\r\n\t\t\t\tfor ( var nodeID in BindPoseNode ) {\r\n\r\n\t\t\t\t\tif ( BindPoseNode[ nodeID ].attrType === 'BindPose' ) {\r\n\r\n\t\t\t\t\t\tvar poseNodes = BindPoseNode[ nodeID ].PoseNode;\r\n\r\n\t\t\t\t\t\tif ( Array.isArray( poseNodes ) ) {\r\n\r\n\t\t\t\t\t\t\tposeNodes.forEach( function ( poseNode ) {\r\n\r\n\t\t\t\t\t\t\t\tbindMatrices[ poseNode.Node ] = new Matrix4().fromArray( poseNode.Matrix.a );\r\n\r\n\t\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tbindMatrices[ poseNodes.Node ] = new Matrix4().fromArray( poseNodes.Matrix.a );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn bindMatrices;\r\n\r\n\t\t},\r\n\r\n\t\t// Parse ambient color in FBXTree.GlobalSettings - if it's not set to black (default), create an ambient light\r\n\t\tcreateAmbientLight: function () {\r\n\r\n\t\t\tif ( 'GlobalSettings' in fbxTree && 'AmbientColor' in fbxTree.GlobalSettings ) {\r\n\r\n\t\t\t\tvar ambientColor = fbxTree.GlobalSettings.AmbientColor.value;\r\n\t\t\t\tvar r = ambientColor[ 0 ];\r\n\t\t\t\tvar g = ambientColor[ 1 ];\r\n\t\t\t\tvar b = ambientColor[ 2 ];\r\n\r\n\t\t\t\tif ( r !== 0 || g !== 0 || b !== 0 ) {\r\n\r\n\t\t\t\t\tvar color = new Color( r, g, b );\r\n\t\t\t\t\tsceneGraph.add( new AmbientLight( color, 1 ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\tsetupMorphMaterials: function () {\r\n\r\n\t\t\tvar scope = this;\r\n\t\t\tsceneGraph.traverse( function ( child ) {\r\n\r\n\t\t\t\tif ( child.isMesh ) {\r\n\r\n\t\t\t\t\tif ( child.geometry.morphAttributes.position && child.geometry.morphAttributes.position.length ) {\r\n\r\n\t\t\t\t\t\tif ( Array.isArray( child.material ) ) {\r\n\r\n\t\t\t\t\t\t\tchild.material.forEach( function ( material, i ) {\r\n\r\n\t\t\t\t\t\t\t\tscope.setupMorphMaterial( child, material, i );\r\n\r\n\t\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tscope.setupMorphMaterial( child, child.material );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t},\r\n\r\n\t\tsetupMorphMaterial: function ( child, material, index ) {\r\n\r\n\t\t\tvar uuid = child.uuid;\r\n\t\t\tvar matUuid = material.uuid;\r\n\r\n\t\t\t// if a geometry has morph targets, it cannot share the material with other geometries\r\n\t\t\tvar sharedMat = false;\r\n\r\n\t\t\tsceneGraph.traverse( function ( node ) {\r\n\r\n\t\t\t\tif ( node.isMesh ) {\r\n\r\n\t\t\t\t\tif ( Array.isArray( node.material ) ) {\r\n\r\n\t\t\t\t\t\tnode.material.forEach( function ( mat ) {\r\n\r\n\t\t\t\t\t\t\tif ( mat.uuid === matUuid && node.uuid !== uuid ) sharedMat = true;\r\n\r\n\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t} else if ( node.material.uuid === matUuid && node.uuid !== uuid ) sharedMat = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tif ( sharedMat === true ) {\r\n\r\n\t\t\t\tvar clonedMat = material.clone();\r\n\t\t\t\tclonedMat.morphTargets = true;\r\n\r\n\t\t\t\tif ( index === undefined ) child.material = clonedMat;\r\n\t\t\t\telse child.material[ index ] = clonedMat;\r\n\r\n\t\t\t} else material.morphTargets = true;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t// parse Geometry data from FBXTree and return map of BufferGeometries\r\n\tfunction GeometryParser() {}\r\n\r\n\tGeometryParser.prototype = {\r\n\r\n\t\tconstructor: GeometryParser,\r\n\r\n\t\t// Parse nodes in FBXTree.Objects.Geometry\r\n\t\tparse: function ( deformers ) {\r\n\r\n\t\t\tvar geometryMap = new Map();\r\n\r\n\t\t\tif ( 'Geometry' in fbxTree.Objects ) {\r\n\r\n\t\t\t\tvar geoNodes = fbxTree.Objects.Geometry;\r\n\r\n\t\t\t\tfor ( var nodeID in geoNodes ) {\r\n\r\n\t\t\t\t\tvar relationships = connections.get( parseInt( nodeID ) );\r\n\t\t\t\t\tvar geo = this.parseGeometry( relationships, geoNodes[ nodeID ], deformers );\r\n\r\n\t\t\t\t\tgeometryMap.set( parseInt( nodeID ), geo );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn geometryMap;\r\n\r\n\t\t},\r\n\r\n\t\t// Parse single node in FBXTree.Objects.Geometry\r\n\t\tparseGeometry: function ( relationships, geoNode, deformers ) {\r\n\r\n\t\t\tswitch ( geoNode.attrType ) {\r\n\r\n\t\t\t\tcase 'Mesh':\r\n\t\t\t\t\treturn this.parseMeshGeometry( relationships, geoNode, deformers );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'NurbsCurve':\r\n\t\t\t\t\treturn this.parseNurbsGeometry( geoNode );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\r\n\t\t// Parse single node mesh geometry in FBXTree.Objects.Geometry\r\n\t\tparseMeshGeometry: function ( relationships, geoNode, deformers ) {\r\n\r\n\t\t\tvar skeletons = deformers.skeletons;\r\n\t\t\tvar morphTargets = [];\r\n\r\n\t\t\tvar modelNodes = relationships.parents.map( function ( parent ) {\r\n\r\n\t\t\t\treturn fbxTree.Objects.Model[ parent.ID ];\r\n\r\n\t\t\t} );\r\n\r\n\t\t\t// don't create geometry if it is not associated with any models\r\n\t\t\tif ( modelNodes.length === 0 ) return;\r\n\r\n\t\t\tvar skeleton = relationships.children.reduce( function ( skeleton, child ) {\r\n\r\n\t\t\t\tif ( skeletons[ child.ID ] !== undefined ) skeleton = skeletons[ child.ID ];\r\n\r\n\t\t\t\treturn skeleton;\r\n\r\n\t\t\t}, null );\r\n\r\n\t\t\trelationships.children.forEach( function ( child ) {\r\n\r\n\t\t\t\tif ( deformers.morphTargets[ child.ID ] !== undefined ) {\r\n\r\n\t\t\t\t\tmorphTargets.push( deformers.morphTargets[ child.ID ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t\t// Assume one model and get the preRotation from that\r\n\t\t\t// if there is more than one model associated with the geometry this may cause problems\r\n\t\t\tvar modelNode = modelNodes[ 0 ];\r\n\r\n\t\t\tvar transformData = {};\r\n\r\n\t\t\tif ( 'RotationOrder' in modelNode ) transformData.eulerOrder = getEulerOrder( modelNode.RotationOrder.value );\r\n\t\t\tif ( 'InheritType' in modelNode ) transformData.inheritType = parseInt( modelNode.InheritType.value );\r\n\r\n\t\t\tif ( 'GeometricTranslation' in modelNode ) transformData.translation = modelNode.GeometricTranslation.value;\r\n\t\t\tif ( 'GeometricRotation' in modelNode ) transformData.rotation = modelNode.GeometricRotation.value;\r\n\t\t\tif ( 'GeometricScaling' in modelNode ) transformData.scale = modelNode.GeometricScaling.value;\r\n\r\n\t\t\tvar transform = generateTransform( transformData );\r\n\r\n\t\t\treturn this.genGeometry( geoNode, skeleton, morphTargets, transform );\r\n\r\n\t\t},\r\n\r\n\t\t// Generate a BufferGeometry from a node in FBXTree.Objects.Geometry\r\n\t\tgenGeometry: function ( geoNode, skeleton, morphTargets, preTransform ) {\r\n\r\n\t\t\tvar geo = new BufferGeometry();\r\n\t\t\tif ( geoNode.attrName ) geo.name = geoNode.attrName;\r\n\r\n\t\t\tvar geoInfo = this.parseGeoNode( geoNode, skeleton );\r\n\t\t\tvar buffers = this.genBuffers( geoInfo );\r\n\r\n\t\t\tvar positionAttribute = new Float32BufferAttribute( buffers.vertex, 3 );\r\n\r\n\t\t\tpositionAttribute.applyMatrix4( preTransform );\r\n\r\n\t\t\tgeo.setAttribute( 'position', positionAttribute );\r\n\r\n\t\t\tif ( buffers.colors.length > 0 ) {\r\n\r\n\t\t\t\tgeo.setAttribute( 'color', new Float32BufferAttribute( buffers.colors, 3 ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( skeleton ) {\r\n\r\n\t\t\t\tgeo.setAttribute( 'skinIndex', new Uint16BufferAttribute( buffers.weightsIndices, 4 ) );\r\n\r\n\t\t\t\tgeo.setAttribute( 'skinWeight', new Float32BufferAttribute( buffers.vertexWeights, 4 ) );\r\n\r\n\t\t\t\t// used later to bind the skeleton to the model\r\n\t\t\t\tgeo.FBX_Deformer = skeleton;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( buffers.normal.length > 0 ) {\r\n\r\n\t\t\t\tvar normalMatrix = new Matrix3().getNormalMatrix( preTransform );\r\n\r\n\t\t\t\tvar normalAttribute = new Float32BufferAttribute( buffers.normal, 3 );\r\n\t\t\t\tnormalAttribute.applyNormalMatrix( normalMatrix );\r\n\r\n\t\t\t\tgeo.setAttribute( 'normal', normalAttribute );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tbuffers.uvs.forEach( function ( uvBuffer, i ) {\r\n\r\n\t\t\t\t// subsequent uv buffers are called 'uv1', 'uv2', ...\r\n\t\t\t\tvar name = 'uv' + ( i + 1 ).toString();\r\n\r\n\t\t\t\t// the first uv buffer is just called 'uv'\r\n\t\t\t\tif ( i === 0 ) {\r\n\r\n\t\t\t\t\tname = 'uv';\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgeo.setAttribute( name, new Float32BufferAttribute( buffers.uvs[ i ], 2 ) );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tif ( geoInfo.material && geoInfo.material.mappingType !== 'AllSame' ) {\r\n\r\n\t\t\t\t// Convert the material indices of each vertex into rendering groups on the geometry.\r\n\t\t\t\tvar prevMaterialIndex = buffers.materialIndex[ 0 ];\r\n\t\t\t\tvar startIndex = 0;\r\n\r\n\t\t\t\tbuffers.materialIndex.forEach( function ( currentIndex, i ) {\r\n\r\n\t\t\t\t\tif ( currentIndex !== prevMaterialIndex ) {\r\n\r\n\t\t\t\t\t\tgeo.addGroup( startIndex, i - startIndex, prevMaterialIndex );\r\n\r\n\t\t\t\t\t\tprevMaterialIndex = currentIndex;\r\n\t\t\t\t\t\tstartIndex = i;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t\t// the loop above doesn't add the last group, do that here.\r\n\t\t\t\tif ( geo.groups.length > 0 ) {\r\n\r\n\t\t\t\t\tvar lastGroup = geo.groups[ geo.groups.length - 1 ];\r\n\t\t\t\t\tvar lastIndex = lastGroup.start + lastGroup.count;\r\n\r\n\t\t\t\t\tif ( lastIndex !== buffers.materialIndex.length ) {\r\n\r\n\t\t\t\t\t\tgeo.addGroup( lastIndex, buffers.materialIndex.length - lastIndex, prevMaterialIndex );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// case where there are multiple materials but the whole geometry is only\r\n\t\t\t\t// using one of them\r\n\t\t\t\tif ( geo.groups.length === 0 ) {\r\n\r\n\t\t\t\t\tgeo.addGroup( 0, buffers.materialIndex.length, buffers.materialIndex[ 0 ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.addMorphTargets( geo, geoNode, morphTargets, preTransform );\r\n\r\n\t\t\treturn geo;\r\n\r\n\t\t},\r\n\r\n\t\tparseGeoNode: function ( geoNode, skeleton ) {\r\n\r\n\t\t\tvar geoInfo = {};\r\n\r\n\t\t\tgeoInfo.vertexPositions = ( geoNode.Vertices !== undefined ) ? geoNode.Vertices.a : [];\r\n\t\t\tgeoInfo.vertexIndices = ( geoNode.PolygonVertexIndex !== undefined ) ? geoNode.PolygonVertexIndex.a : [];\r\n\r\n\t\t\tif ( geoNode.LayerElementColor ) {\r\n\r\n\t\t\t\tgeoInfo.color = this.parseVertexColors( geoNode.LayerElementColor[ 0 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( geoNode.LayerElementMaterial ) {\r\n\r\n\t\t\t\tgeoInfo.material = this.parseMaterialIndices( geoNode.LayerElementMaterial[ 0 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( geoNode.LayerElementNormal ) {\r\n\r\n\t\t\t\tgeoInfo.normal = this.parseNormals( geoNode.LayerElementNormal[ 0 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( geoNode.LayerElementUV ) {\r\n\r\n\t\t\t\tgeoInfo.uv = [];\r\n\r\n\t\t\t\tvar i = 0;\r\n\t\t\t\twhile ( geoNode.LayerElementUV[ i ] ) {\r\n\r\n\t\t\t\t\tif ( geoNode.LayerElementUV[ i ].UV ) {\r\n\r\n\t\t\t\t\t\tgeoInfo.uv.push( this.parseUVs( geoNode.LayerElementUV[ i ] ) );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ti ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgeoInfo.weightTable = {};\r\n\r\n\t\t\tif ( skeleton !== null ) {\r\n\r\n\t\t\t\tgeoInfo.skeleton = skeleton;\r\n\r\n\t\t\t\tskeleton.rawBones.forEach( function ( rawBone, i ) {\r\n\r\n\t\t\t\t\t// loop over the bone's vertex indices and weights\r\n\t\t\t\t\trawBone.indices.forEach( function ( index, j ) {\r\n\r\n\t\t\t\t\t\tif ( geoInfo.weightTable[ index ] === undefined ) geoInfo.weightTable[ index ] = [];\r\n\r\n\t\t\t\t\t\tgeoInfo.weightTable[ index ].push( {\r\n\r\n\t\t\t\t\t\t\tid: i,\r\n\t\t\t\t\t\t\tweight: rawBone.weights[ j ],\r\n\r\n\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn geoInfo;\r\n\r\n\t\t},\r\n\r\n\t\tgenBuffers: function ( geoInfo ) {\r\n\r\n\t\t\tvar buffers = {\r\n\t\t\t\tvertex: [],\r\n\t\t\t\tnormal: [],\r\n\t\t\t\tcolors: [],\r\n\t\t\t\tuvs: [],\r\n\t\t\t\tmaterialIndex: [],\r\n\t\t\t\tvertexWeights: [],\r\n\t\t\t\tweightsIndices: [],\r\n\t\t\t};\r\n\r\n\t\t\tvar polygonIndex = 0;\r\n\t\t\tvar faceLength = 0;\r\n\t\t\tvar displayedWeightsWarning = false;\r\n\r\n\t\t\t// these will hold data for a single face\r\n\t\t\tvar facePositionIndexes = [];\r\n\t\t\tvar faceNormals = [];\r\n\t\t\tvar faceColors = [];\r\n\t\t\tvar faceUVs = [];\r\n\t\t\tvar faceWeights = [];\r\n\t\t\tvar faceWeightIndices = [];\r\n\r\n\t\t\tvar scope = this;\r\n\t\t\tgeoInfo.vertexIndices.forEach( function ( vertexIndex, polygonVertexIndex ) {\r\n\r\n\t\t\t\tvar endOfFace = false;\r\n\r\n\t\t\t\t// Face index and vertex index arrays are combined in a single array\r\n\t\t\t\t// A cube with quad faces looks like this:\r\n\t\t\t\t// PolygonVertexIndex: *24 {\r\n\t\t\t\t//  a: 0, 1, 3, -3, 2, 3, 5, -5, 4, 5, 7, -7, 6, 7, 1, -1, 1, 7, 5, -4, 6, 0, 2, -5\r\n\t\t\t\t//  }\r\n\t\t\t\t// Negative numbers mark the end of a face - first face here is 0, 1, 3, -3\r\n\t\t\t\t// to find index of last vertex bit shift the index: ^ - 1\r\n\t\t\t\tif ( vertexIndex < 0 ) {\r\n\r\n\t\t\t\t\tvertexIndex = vertexIndex ^ - 1; // equivalent to ( x * -1 ) - 1\r\n\t\t\t\t\tendOfFace = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar weightIndices = [];\r\n\t\t\t\tvar weights = [];\r\n\r\n\t\t\t\tfacePositionIndexes.push( vertexIndex * 3, vertexIndex * 3 + 1, vertexIndex * 3 + 2 );\r\n\r\n\t\t\t\tif ( geoInfo.color ) {\r\n\r\n\t\t\t\t\tvar data = getData( polygonVertexIndex, polygonIndex, vertexIndex, geoInfo.color );\r\n\r\n\t\t\t\t\tfaceColors.push( data[ 0 ], data[ 1 ], data[ 2 ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( geoInfo.skeleton ) {\r\n\r\n\t\t\t\t\tif ( geoInfo.weightTable[ vertexIndex ] !== undefined ) {\r\n\r\n\t\t\t\t\t\tgeoInfo.weightTable[ vertexIndex ].forEach( function ( wt ) {\r\n\r\n\t\t\t\t\t\t\tweights.push( wt.weight );\r\n\t\t\t\t\t\t\tweightIndices.push( wt.id );\r\n\r\n\t\t\t\t\t\t} );\r\n\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( weights.length > 4 ) {\r\n\r\n\t\t\t\t\t\tif ( ! displayedWeightsWarning ) {\r\n\r\n\t\t\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights.' );\r\n\t\t\t\t\t\t\tdisplayedWeightsWarning = true;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar wIndex = [ 0, 0, 0, 0 ];\r\n\t\t\t\t\t\tvar Weight = [ 0, 0, 0, 0 ];\r\n\r\n\t\t\t\t\t\tweights.forEach( function ( weight, weightIndex ) {\r\n\r\n\t\t\t\t\t\t\tvar currentWeight = weight;\r\n\t\t\t\t\t\t\tvar currentIndex = weightIndices[ weightIndex ];\r\n\r\n\t\t\t\t\t\t\tWeight.forEach( function ( comparedWeight, comparedWeightIndex, comparedWeightArray ) {\r\n\r\n\t\t\t\t\t\t\t\tif ( currentWeight > comparedWeight ) {\r\n\r\n\t\t\t\t\t\t\t\t\tcomparedWeightArray[ comparedWeightIndex ] = currentWeight;\r\n\t\t\t\t\t\t\t\t\tcurrentWeight = comparedWeight;\r\n\r\n\t\t\t\t\t\t\t\t\tvar tmp = wIndex[ comparedWeightIndex ];\r\n\t\t\t\t\t\t\t\t\twIndex[ comparedWeightIndex ] = currentIndex;\r\n\t\t\t\t\t\t\t\t\tcurrentIndex = tmp;\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t\tweightIndices = wIndex;\r\n\t\t\t\t\t\tweights = Weight;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// if the weight array is shorter than 4 pad with 0s\r\n\t\t\t\t\twhile ( weights.length < 4 ) {\r\n\r\n\t\t\t\t\t\tweights.push( 0 );\r\n\t\t\t\t\t\tweightIndices.push( 0 );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor ( var i = 0; i < 4; ++ i ) {\r\n\r\n\t\t\t\t\t\tfaceWeights.push( weights[ i ] );\r\n\t\t\t\t\t\tfaceWeightIndices.push( weightIndices[ i ] );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( geoInfo.normal ) {\r\n\r\n\t\t\t\t\tvar data = getData( polygonVertexIndex, polygonIndex, vertexIndex, geoInfo.normal );\r\n\r\n\t\t\t\t\tfaceNormals.push( data[ 0 ], data[ 1 ], data[ 2 ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( geoInfo.material && geoInfo.material.mappingType !== 'AllSame' ) {\r\n\r\n\t\t\t\t\tvar materialIndex = getData( polygonVertexIndex, polygonIndex, vertexIndex, geoInfo.material )[ 0 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( geoInfo.uv ) {\r\n\r\n\t\t\t\t\tgeoInfo.uv.forEach( function ( uv, i ) {\r\n\r\n\t\t\t\t\t\tvar data = getData( polygonVertexIndex, polygonIndex, vertexIndex, uv );\r\n\r\n\t\t\t\t\t\tif ( faceUVs[ i ] === undefined ) {\r\n\r\n\t\t\t\t\t\t\tfaceUVs[ i ] = [];\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfaceUVs[ i ].push( data[ 0 ] );\r\n\t\t\t\t\t\tfaceUVs[ i ].push( data[ 1 ] );\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfaceLength ++;\r\n\r\n\t\t\t\tif ( endOfFace ) {\r\n\r\n\t\t\t\t\tscope.genFace( buffers, geoInfo, facePositionIndexes, materialIndex, faceNormals, faceColors, faceUVs, faceWeights, faceWeightIndices, faceLength );\r\n\r\n\t\t\t\t\tpolygonIndex ++;\r\n\t\t\t\t\tfaceLength = 0;\r\n\r\n\t\t\t\t\t// reset arrays for the next face\r\n\t\t\t\t\tfacePositionIndexes = [];\r\n\t\t\t\t\tfaceNormals = [];\r\n\t\t\t\t\tfaceColors = [];\r\n\t\t\t\t\tfaceUVs = [];\r\n\t\t\t\t\tfaceWeights = [];\r\n\t\t\t\t\tfaceWeightIndices = [];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t\treturn buffers;\r\n\r\n\t\t},\r\n\r\n\t\t// Generate data for a single face in a geometry. If the face is a quad then split it into 2 tris\r\n\t\tgenFace: function ( buffers, geoInfo, facePositionIndexes, materialIndex, faceNormals, faceColors, faceUVs, faceWeights, faceWeightIndices, faceLength ) {\r\n\r\n\t\t\tfor ( var i = 2; i < faceLength; i ++ ) {\r\n\r\n\t\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ 0 ] ] );\r\n\t\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ 1 ] ] );\r\n\t\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ 2 ] ] );\r\n\r\n\t\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ ( i - 1 ) * 3 ] ] );\r\n\t\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ ( i - 1 ) * 3 + 1 ] ] );\r\n\t\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ ( i - 1 ) * 3 + 2 ] ] );\r\n\r\n\t\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ i * 3 ] ] );\r\n\t\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ i * 3 + 1 ] ] );\r\n\t\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ i * 3 + 2 ] ] );\r\n\r\n\t\t\t\tif ( geoInfo.skeleton ) {\r\n\r\n\t\t\t\t\tbuffers.vertexWeights.push( faceWeights[ 0 ] );\r\n\t\t\t\t\tbuffers.vertexWeights.push( faceWeights[ 1 ] );\r\n\t\t\t\t\tbuffers.vertexWeights.push( faceWeights[ 2 ] );\r\n\t\t\t\t\tbuffers.vertexWeights.push( faceWeights[ 3 ] );\r\n\r\n\t\t\t\t\tbuffers.vertexWeights.push( faceWeights[ ( i - 1 ) * 4 ] );\r\n\t\t\t\t\tbuffers.vertexWeights.push( faceWeights[ ( i - 1 ) * 4 + 1 ] );\r\n\t\t\t\t\tbuffers.vertexWeights.push( faceWeights[ ( i - 1 ) * 4 + 2 ] );\r\n\t\t\t\t\tbuffers.vertexWeights.push( faceWeights[ ( i - 1 ) * 4 + 3 ] );\r\n\r\n\t\t\t\t\tbuffers.vertexWeights.push( faceWeights[ i * 4 ] );\r\n\t\t\t\t\tbuffers.vertexWeights.push( faceWeights[ i * 4 + 1 ] );\r\n\t\t\t\t\tbuffers.vertexWeights.push( faceWeights[ i * 4 + 2 ] );\r\n\t\t\t\t\tbuffers.vertexWeights.push( faceWeights[ i * 4 + 3 ] );\r\n\r\n\t\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ 0 ] );\r\n\t\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ 1 ] );\r\n\t\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ 2 ] );\r\n\t\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ 3 ] );\r\n\r\n\t\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ ( i - 1 ) * 4 ] );\r\n\t\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ ( i - 1 ) * 4 + 1 ] );\r\n\t\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ ( i - 1 ) * 4 + 2 ] );\r\n\t\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ ( i - 1 ) * 4 + 3 ] );\r\n\r\n\t\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ i * 4 ] );\r\n\t\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ i * 4 + 1 ] );\r\n\t\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ i * 4 + 2 ] );\r\n\t\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ i * 4 + 3 ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( geoInfo.color ) {\r\n\r\n\t\t\t\t\tbuffers.colors.push( faceColors[ 0 ] );\r\n\t\t\t\t\tbuffers.colors.push( faceColors[ 1 ] );\r\n\t\t\t\t\tbuffers.colors.push( faceColors[ 2 ] );\r\n\r\n\t\t\t\t\tbuffers.colors.push( faceColors[ ( i - 1 ) * 3 ] );\r\n\t\t\t\t\tbuffers.colors.push( faceColors[ ( i - 1 ) * 3 + 1 ] );\r\n\t\t\t\t\tbuffers.colors.push( faceColors[ ( i - 1 ) * 3 + 2 ] );\r\n\r\n\t\t\t\t\tbuffers.colors.push( faceColors[ i * 3 ] );\r\n\t\t\t\t\tbuffers.colors.push( faceColors[ i * 3 + 1 ] );\r\n\t\t\t\t\tbuffers.colors.push( faceColors[ i * 3 + 2 ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( geoInfo.material && geoInfo.material.mappingType !== 'AllSame' ) {\r\n\r\n\t\t\t\t\tbuffers.materialIndex.push( materialIndex );\r\n\t\t\t\t\tbuffers.materialIndex.push( materialIndex );\r\n\t\t\t\t\tbuffers.materialIndex.push( materialIndex );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( geoInfo.normal ) {\r\n\r\n\t\t\t\t\tbuffers.normal.push( faceNormals[ 0 ] );\r\n\t\t\t\t\tbuffers.normal.push( faceNormals[ 1 ] );\r\n\t\t\t\t\tbuffers.normal.push( faceNormals[ 2 ] );\r\n\r\n\t\t\t\t\tbuffers.normal.push( faceNormals[ ( i - 1 ) * 3 ] );\r\n\t\t\t\t\tbuffers.normal.push( faceNormals[ ( i - 1 ) * 3 + 1 ] );\r\n\t\t\t\t\tbuffers.normal.push( faceNormals[ ( i - 1 ) * 3 + 2 ] );\r\n\r\n\t\t\t\t\tbuffers.normal.push( faceNormals[ i * 3 ] );\r\n\t\t\t\t\tbuffers.normal.push( faceNormals[ i * 3 + 1 ] );\r\n\t\t\t\t\tbuffers.normal.push( faceNormals[ i * 3 + 2 ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( geoInfo.uv ) {\r\n\r\n\t\t\t\t\tgeoInfo.uv.forEach( function ( uv, j ) {\r\n\r\n\t\t\t\t\t\tif ( buffers.uvs[ j ] === undefined ) buffers.uvs[ j ] = [];\r\n\r\n\t\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ 0 ] );\r\n\t\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ 1 ] );\r\n\r\n\t\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ ( i - 1 ) * 2 ] );\r\n\t\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ ( i - 1 ) * 2 + 1 ] );\r\n\r\n\t\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ i * 2 ] );\r\n\t\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ i * 2 + 1 ] );\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\taddMorphTargets: function ( parentGeo, parentGeoNode, morphTargets, preTransform ) {\r\n\r\n\t\t\tif ( morphTargets.length === 0 ) return;\r\n\r\n\t\t\tparentGeo.morphTargetsRelative = true;\r\n\r\n\t\t\tparentGeo.morphAttributes.position = [];\r\n\t\t\t// parentGeo.morphAttributes.normal = []; // not implemented\r\n\r\n\t\t\tvar scope = this;\r\n\t\t\tmorphTargets.forEach( function ( morphTarget ) {\r\n\r\n\t\t\t\tmorphTarget.rawTargets.forEach( function ( rawTarget ) {\r\n\r\n\t\t\t\t\tvar morphGeoNode = fbxTree.Objects.Geometry[ rawTarget.geoID ];\r\n\r\n\t\t\t\t\tif ( morphGeoNode !== undefined ) {\r\n\r\n\t\t\t\t\t\tscope.genMorphGeometry( parentGeo, parentGeoNode, morphGeoNode, preTransform, rawTarget.name );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t} );\r\n\r\n\t\t},\r\n\r\n\t\t// a morph geometry node is similar to a standard  node, and the node is also contained\r\n\t\t// in FBXTree.Objects.Geometry, however it can only have attributes for position, normal\r\n\t\t// and a special attribute Index defining which vertices of the original geometry are affected\r\n\t\t// Normal and position attributes only have data for the vertices that are affected by the morph\r\n\t\tgenMorphGeometry: function ( parentGeo, parentGeoNode, morphGeoNode, preTransform, name ) {\r\n\r\n\t\t\tvar vertexIndices = ( parentGeoNode.PolygonVertexIndex !== undefined ) ? parentGeoNode.PolygonVertexIndex.a : [];\r\n\r\n\t\t\tvar morphPositionsSparse = ( morphGeoNode.Vertices !== undefined ) ? morphGeoNode.Vertices.a : [];\r\n\t\t\tvar indices = ( morphGeoNode.Indexes !== undefined ) ? morphGeoNode.Indexes.a : [];\r\n\r\n\t\t\tvar length = parentGeo.attributes.position.count * 3;\r\n\t\t\tvar morphPositions = new Float32Array( length );\r\n\r\n\t\t\tfor ( var i = 0; i < indices.length; i ++ ) {\r\n\r\n\t\t\t\tvar morphIndex = indices[ i ] * 3;\r\n\r\n\t\t\t\tmorphPositions[ morphIndex ] = morphPositionsSparse[ i * 3 ];\r\n\t\t\t\tmorphPositions[ morphIndex + 1 ] = morphPositionsSparse[ i * 3 + 1 ];\r\n\t\t\t\tmorphPositions[ morphIndex + 2 ] = morphPositionsSparse[ i * 3 + 2 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// TODO: add morph normal support\r\n\t\t\tvar morphGeoInfo = {\r\n\t\t\t\tvertexIndices: vertexIndices,\r\n\t\t\t\tvertexPositions: morphPositions,\r\n\r\n\t\t\t};\r\n\r\n\t\t\tvar morphBuffers = this.genBuffers( morphGeoInfo );\r\n\r\n\t\t\tvar positionAttribute = new Float32BufferAttribute( morphBuffers.vertex, 3 );\r\n\t\t\tpositionAttribute.name = name || morphGeoNode.attrName;\r\n\r\n\t\t\tpositionAttribute.applyMatrix4( preTransform );\r\n\r\n\t\t\tparentGeo.morphAttributes.position.push( positionAttribute );\r\n\r\n\t\t},\r\n\r\n\t\t// Parse normal from FBXTree.Objects.Geometry.LayerElementNormal if it exists\r\n\t\tparseNormals: function ( NormalNode ) {\r\n\r\n\t\t\tvar mappingType = NormalNode.MappingInformationType;\r\n\t\t\tvar referenceType = NormalNode.ReferenceInformationType;\r\n\t\t\tvar buffer = NormalNode.Normals.a;\r\n\t\t\tvar indexBuffer = [];\r\n\t\t\tif ( referenceType === 'IndexToDirect' ) {\r\n\r\n\t\t\t\tif ( 'NormalIndex' in NormalNode ) {\r\n\r\n\t\t\t\t\tindexBuffer = NormalNode.NormalIndex.a;\r\n\r\n\t\t\t\t} else if ( 'NormalsIndex' in NormalNode ) {\r\n\r\n\t\t\t\t\tindexBuffer = NormalNode.NormalsIndex.a;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tdataSize: 3,\r\n\t\t\t\tbuffer: buffer,\r\n\t\t\t\tindices: indexBuffer,\r\n\t\t\t\tmappingType: mappingType,\r\n\t\t\t\treferenceType: referenceType\r\n\t\t\t};\r\n\r\n\t\t},\r\n\r\n\t\t// Parse UVs from FBXTree.Objects.Geometry.LayerElementUV if it exists\r\n\t\tparseUVs: function ( UVNode ) {\r\n\r\n\t\t\tvar mappingType = UVNode.MappingInformationType;\r\n\t\t\tvar referenceType = UVNode.ReferenceInformationType;\r\n\t\t\tvar buffer = UVNode.UV.a;\r\n\t\t\tvar indexBuffer = [];\r\n\t\t\tif ( referenceType === 'IndexToDirect' ) {\r\n\r\n\t\t\t\tindexBuffer = UVNode.UVIndex.a;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tdataSize: 2,\r\n\t\t\t\tbuffer: buffer,\r\n\t\t\t\tindices: indexBuffer,\r\n\t\t\t\tmappingType: mappingType,\r\n\t\t\t\treferenceType: referenceType\r\n\t\t\t};\r\n\r\n\t\t},\r\n\r\n\t\t// Parse Vertex Colors from FBXTree.Objects.Geometry.LayerElementColor if it exists\r\n\t\tparseVertexColors: function ( ColorNode ) {\r\n\r\n\t\t\tvar mappingType = ColorNode.MappingInformationType;\r\n\t\t\tvar referenceType = ColorNode.ReferenceInformationType;\r\n\t\t\tvar buffer = ColorNode.Colors.a;\r\n\t\t\tvar indexBuffer = [];\r\n\t\t\tif ( referenceType === 'IndexToDirect' ) {\r\n\r\n\t\t\t\tindexBuffer = ColorNode.ColorIndex.a;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tdataSize: 4,\r\n\t\t\t\tbuffer: buffer,\r\n\t\t\t\tindices: indexBuffer,\r\n\t\t\t\tmappingType: mappingType,\r\n\t\t\t\treferenceType: referenceType\r\n\t\t\t};\r\n\r\n\t\t},\r\n\r\n\t\t// Parse mapping and material data in FBXTree.Objects.Geometry.LayerElementMaterial if it exists\r\n\t\tparseMaterialIndices: function ( MaterialNode ) {\r\n\r\n\t\t\tvar mappingType = MaterialNode.MappingInformationType;\r\n\t\t\tvar referenceType = MaterialNode.ReferenceInformationType;\r\n\r\n\t\t\tif ( mappingType === 'NoMappingInformation' ) {\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdataSize: 1,\r\n\t\t\t\t\tbuffer: [ 0 ],\r\n\t\t\t\t\tindices: [ 0 ],\r\n\t\t\t\t\tmappingType: 'AllSame',\r\n\t\t\t\t\treferenceType: referenceType\r\n\t\t\t\t};\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar materialIndexBuffer = MaterialNode.Materials.a;\r\n\r\n\t\t\t// Since materials are stored as indices, there's a bit of a mismatch between FBX and what\r\n\t\t\t// we expect.So we create an intermediate buffer that points to the index in the buffer,\r\n\t\t\t// for conforming with the other functions we've written for other data.\r\n\t\t\tvar materialIndices = [];\r\n\r\n\t\t\tfor ( var i = 0; i < materialIndexBuffer.length; ++ i ) {\r\n\r\n\t\t\t\tmaterialIndices.push( i );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tdataSize: 1,\r\n\t\t\t\tbuffer: materialIndexBuffer,\r\n\t\t\t\tindices: materialIndices,\r\n\t\t\t\tmappingType: mappingType,\r\n\t\t\t\treferenceType: referenceType\r\n\t\t\t};\r\n\r\n\t\t},\r\n\r\n\t\t// Generate a NurbGeometry from a node in FBXTree.Objects.Geometry\r\n\t\tparseNurbsGeometry: function ( geoNode ) {\r\n\r\n\t\t\tif ( NURBSCurve === undefined ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry.' );\r\n\t\t\t\treturn new BufferGeometry();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar order = parseInt( geoNode.Order );\r\n\r\n\t\t\tif ( isNaN( order ) ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.FBXLoader: Invalid Order %s given for geometry ID: %s', geoNode.Order, geoNode.id );\r\n\t\t\t\treturn new BufferGeometry();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar degree = order - 1;\r\n\r\n\t\t\tvar knots = geoNode.KnotVector.a;\r\n\t\t\tvar controlPoints = [];\r\n\t\t\tvar pointsValues = geoNode.Points.a;\r\n\r\n\t\t\tfor ( var i = 0, l = pointsValues.length; i < l; i += 4 ) {\r\n\r\n\t\t\t\tcontrolPoints.push( new Vector4().fromArray( pointsValues, i ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar startKnot, endKnot;\r\n\r\n\t\t\tif ( geoNode.Form === 'Closed' ) {\r\n\r\n\t\t\t\tcontrolPoints.push( controlPoints[ 0 ] );\r\n\r\n\t\t\t} else if ( geoNode.Form === 'Periodic' ) {\r\n\r\n\t\t\t\tstartKnot = degree;\r\n\t\t\t\tendKnot = knots.length - 1 - startKnot;\r\n\r\n\t\t\t\tfor ( var i = 0; i < degree; ++ i ) {\r\n\r\n\t\t\t\t\tcontrolPoints.push( controlPoints[ i ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar curve = new NURBSCurve( degree, knots, controlPoints, startKnot, endKnot );\r\n\t\t\tvar vertices = curve.getPoints( controlPoints.length * 7 );\r\n\r\n\t\t\tvar positions = new Float32Array( vertices.length * 3 );\r\n\r\n\t\t\tvertices.forEach( function ( vertex, i ) {\r\n\r\n\t\t\t\tvertex.toArray( positions, i * 3 );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tvar geometry = new BufferGeometry();\r\n\t\t\tgeometry.setAttribute( 'position', new BufferAttribute( positions, 3 ) );\r\n\r\n\t\t\treturn geometry;\r\n\r\n\t\t},\r\n\r\n\t};\r\n\r\n\t// parse animation data from FBXTree\r\n\tfunction AnimationParser() {}\r\n\r\n\tAnimationParser.prototype = {\r\n\r\n\t\tconstructor: AnimationParser,\r\n\r\n\t\t// take raw animation clips and turn them into three.js animation clips\r\n\t\tparse: function () {\r\n\r\n\t\t\tvar animationClips = [];\r\n\r\n\t\t\tvar rawClips = this.parseClips();\r\n\r\n\t\t\tif ( rawClips !== undefined ) {\r\n\r\n\t\t\t\tfor ( var key in rawClips ) {\r\n\r\n\t\t\t\t\tvar rawClip = rawClips[ key ];\r\n\r\n\t\t\t\t\tvar clip = this.addClip( rawClip );\r\n\r\n\t\t\t\t\tanimationClips.push( clip );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn animationClips;\r\n\r\n\t\t},\r\n\r\n\t\tparseClips: function () {\r\n\r\n\t\t\t// since the actual transformation data is stored in FBXTree.Objects.AnimationCurve,\r\n\t\t\t// if this is undefined we can safely assume there are no animations\r\n\t\t\tif ( fbxTree.Objects.AnimationCurve === undefined ) return undefined;\r\n\r\n\t\t\tvar curveNodesMap = this.parseAnimationCurveNodes();\r\n\r\n\t\t\tthis.parseAnimationCurves( curveNodesMap );\r\n\r\n\t\t\tvar layersMap = this.parseAnimationLayers( curveNodesMap );\r\n\t\t\tvar rawClips = this.parseAnimStacks( layersMap );\r\n\r\n\t\t\treturn rawClips;\r\n\r\n\t\t},\r\n\r\n\t\t// parse nodes in FBXTree.Objects.AnimationCurveNode\r\n\t\t// each AnimationCurveNode holds data for an animation transform for a model (e.g. left arm rotation )\r\n\t\t// and is referenced by an AnimationLayer\r\n\t\tparseAnimationCurveNodes: function () {\r\n\r\n\t\t\tvar rawCurveNodes = fbxTree.Objects.AnimationCurveNode;\r\n\r\n\t\t\tvar curveNodesMap = new Map();\r\n\r\n\t\t\tfor ( var nodeID in rawCurveNodes ) {\r\n\r\n\t\t\t\tvar rawCurveNode = rawCurveNodes[ nodeID ];\r\n\r\n\t\t\t\tif ( rawCurveNode.attrName.match( /S|R|T|DeformPercent/ ) !== null ) {\r\n\r\n\t\t\t\t\tvar curveNode = {\r\n\r\n\t\t\t\t\t\tid: rawCurveNode.id,\r\n\t\t\t\t\t\tattr: rawCurveNode.attrName,\r\n\t\t\t\t\t\tcurves: {},\r\n\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tcurveNodesMap.set( curveNode.id, curveNode );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn curveNodesMap;\r\n\r\n\t\t},\r\n\r\n\t\t// parse nodes in FBXTree.Objects.AnimationCurve and connect them up to\r\n\t\t// previously parsed AnimationCurveNodes. Each AnimationCurve holds data for a single animated\r\n\t\t// axis ( e.g. times and values of x rotation)\r\n\t\tparseAnimationCurves: function ( curveNodesMap ) {\r\n\r\n\t\t\tvar rawCurves = fbxTree.Objects.AnimationCurve;\r\n\r\n\t\t\t// TODO: Many values are identical up to roundoff error, but won't be optimised\r\n\t\t\t// e.g. position times: [0, 0.4, 0. 8]\r\n\t\t\t// position values: [7.23538335023477e-7, 93.67518615722656, -0.9982695579528809, 7.23538335023477e-7, 93.67518615722656, -0.9982695579528809, 7.235384487103147e-7, 93.67520904541016, -0.9982695579528809]\r\n\t\t\t// clearly, this should be optimised to\r\n\t\t\t// times: [0], positions [7.23538335023477e-7, 93.67518615722656, -0.9982695579528809]\r\n\t\t\t// this shows up in nearly every FBX file, and generally time array is length > 100\r\n\r\n\t\t\tfor ( var nodeID in rawCurves ) {\r\n\r\n\t\t\t\tvar animationCurve = {\r\n\r\n\t\t\t\t\tid: rawCurves[ nodeID ].id,\r\n\t\t\t\t\ttimes: rawCurves[ nodeID ].KeyTime.a.map( convertFBXTimeToSeconds ),\r\n\t\t\t\t\tvalues: rawCurves[ nodeID ].KeyValueFloat.a,\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\t\tvar relationships = connections.get( animationCurve.id );\r\n\r\n\t\t\t\tif ( relationships !== undefined ) {\r\n\r\n\t\t\t\t\tvar animationCurveID = relationships.parents[ 0 ].ID;\r\n\t\t\t\t\tvar animationCurveRelationship = relationships.parents[ 0 ].relationship;\r\n\r\n\t\t\t\t\tif ( animationCurveRelationship.match( /X/ ) ) {\r\n\r\n\t\t\t\t\t\tcurveNodesMap.get( animationCurveID ).curves[ 'x' ] = animationCurve;\r\n\r\n\t\t\t\t\t} else if ( animationCurveRelationship.match( /Y/ ) ) {\r\n\r\n\t\t\t\t\t\tcurveNodesMap.get( animationCurveID ).curves[ 'y' ] = animationCurve;\r\n\r\n\t\t\t\t\t} else if ( animationCurveRelationship.match( /Z/ ) ) {\r\n\r\n\t\t\t\t\t\tcurveNodesMap.get( animationCurveID ).curves[ 'z' ] = animationCurve;\r\n\r\n\t\t\t\t\t} else if ( animationCurveRelationship.match( /d|DeformPercent/ ) && curveNodesMap.has( animationCurveID ) ) {\r\n\r\n\t\t\t\t\t\tcurveNodesMap.get( animationCurveID ).curves[ 'morph' ] = animationCurve;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\t// parse nodes in FBXTree.Objects.AnimationLayer. Each layers holds references\r\n\t\t// to various AnimationCurveNodes and is referenced by an AnimationStack node\r\n\t\t// note: theoretically a stack can have multiple layers, however in practice there always seems to be one per stack\r\n\t\tparseAnimationLayers: function ( curveNodesMap ) {\r\n\r\n\t\t\tvar rawLayers = fbxTree.Objects.AnimationLayer;\r\n\r\n\t\t\tvar layersMap = new Map();\r\n\r\n\t\t\tfor ( var nodeID in rawLayers ) {\r\n\r\n\t\t\t\tvar layerCurveNodes = [];\r\n\r\n\t\t\t\tvar connection = connections.get( parseInt( nodeID ) );\r\n\r\n\t\t\t\tif ( connection !== undefined ) {\r\n\r\n\t\t\t\t\t// all the animationCurveNodes used in the layer\r\n\t\t\t\t\tvar children = connection.children;\r\n\r\n\t\t\t\t\tchildren.forEach( function ( child, i ) {\r\n\r\n\t\t\t\t\t\tif ( curveNodesMap.has( child.ID ) ) {\r\n\r\n\t\t\t\t\t\t\tvar curveNode = curveNodesMap.get( child.ID );\r\n\r\n\t\t\t\t\t\t\t// check that the curves are defined for at least one axis, otherwise ignore the curveNode\r\n\t\t\t\t\t\t\tif ( curveNode.curves.x !== undefined || curveNode.curves.y !== undefined || curveNode.curves.z !== undefined ) {\r\n\r\n\t\t\t\t\t\t\t\tif ( layerCurveNodes[ i ] === undefined ) {\r\n\r\n\t\t\t\t\t\t\t\t\tvar modelID = connections.get( child.ID ).parents.filter( function ( parent ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\treturn parent.relationship !== undefined;\r\n\r\n\t\t\t\t\t\t\t\t\t} )[ 0 ].ID;\r\n\r\n\t\t\t\t\t\t\t\t\tif ( modelID !== undefined ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\tvar rawModel = fbxTree.Objects.Model[ modelID.toString() ];\r\n\r\n\t\t\t\t\t\t\t\t\t\tif ( rawModel === undefined ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: Encountered a unused curve.', child );\r\n\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tvar node = {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tmodelName: rawModel.attrName ? PropertyBinding.sanitizeNodeName( rawModel.attrName ) : '',\r\n\t\t\t\t\t\t\t\t\t\t\tID: rawModel.id,\r\n\t\t\t\t\t\t\t\t\t\t\tinitialPosition: [ 0, 0, 0 ],\r\n\t\t\t\t\t\t\t\t\t\t\tinitialRotation: [ 0, 0, 0 ],\r\n\t\t\t\t\t\t\t\t\t\t\tinitialScale: [ 1, 1, 1 ],\r\n\r\n\t\t\t\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t\t\t\t\tsceneGraph.traverse( function ( child ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif ( child.ID === rawModel.id ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tnode.transform = child.matrix;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tif ( child.userData.transformData ) node.eulerOrder = child.userData.transformData.eulerOrder;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t\t\t\t\t\tif ( ! node.transform ) node.transform = new Matrix4();\r\n\r\n\t\t\t\t\t\t\t\t\t\t// if the animated model is pre rotated, we'll have to apply the pre rotations to every\r\n\t\t\t\t\t\t\t\t\t\t// animation value as well\r\n\t\t\t\t\t\t\t\t\t\tif ( 'PreRotation' in rawModel ) node.preRotation = rawModel.PreRotation.value;\r\n\t\t\t\t\t\t\t\t\t\tif ( 'PostRotation' in rawModel ) node.postRotation = rawModel.PostRotation.value;\r\n\r\n\t\t\t\t\t\t\t\t\t\tlayerCurveNodes[ i ] = node;\r\n\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif ( layerCurveNodes[ i ] ) layerCurveNodes[ i ][ curveNode.attr ] = curveNode;\r\n\r\n\t\t\t\t\t\t\t} else if ( curveNode.curves.morph !== undefined ) {\r\n\r\n\t\t\t\t\t\t\t\tif ( layerCurveNodes[ i ] === undefined ) {\r\n\r\n\t\t\t\t\t\t\t\t\tvar deformerID = connections.get( child.ID ).parents.filter( function ( parent ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\treturn parent.relationship !== undefined;\r\n\r\n\t\t\t\t\t\t\t\t\t} )[ 0 ].ID;\r\n\r\n\t\t\t\t\t\t\t\t\tvar morpherID = connections.get( deformerID ).parents[ 0 ].ID;\r\n\t\t\t\t\t\t\t\t\tvar geoID = connections.get( morpherID ).parents[ 0 ].ID;\r\n\r\n\t\t\t\t\t\t\t\t\t// assuming geometry is not used in more than one model\r\n\t\t\t\t\t\t\t\t\tvar modelID = connections.get( geoID ).parents[ 0 ].ID;\r\n\r\n\t\t\t\t\t\t\t\t\tvar rawModel = fbxTree.Objects.Model[ modelID ];\r\n\r\n\t\t\t\t\t\t\t\t\tvar node = {\r\n\r\n\t\t\t\t\t\t\t\t\t\tmodelName: rawModel.attrName ? PropertyBinding.sanitizeNodeName( rawModel.attrName ) : '',\r\n\t\t\t\t\t\t\t\t\t\tmorphName: fbxTree.Objects.Deformer[ deformerID ].attrName,\r\n\r\n\t\t\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t\t\t\tlayerCurveNodes[ i ] = node;\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tlayerCurveNodes[ i ][ curveNode.attr ] = curveNode;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t\tlayersMap.set( parseInt( nodeID ), layerCurveNodes );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn layersMap;\r\n\r\n\t\t},\r\n\r\n\t\t// parse nodes in FBXTree.Objects.AnimationStack. These are the top level node in the animation\r\n\t\t// hierarchy. Each Stack node will be used to create a AnimationClip\r\n\t\tparseAnimStacks: function ( layersMap ) {\r\n\r\n\t\t\tvar rawStacks = fbxTree.Objects.AnimationStack;\r\n\r\n\t\t\t// connect the stacks (clips) up to the layers\r\n\t\t\tvar rawClips = {};\r\n\r\n\t\t\tfor ( var nodeID in rawStacks ) {\r\n\r\n\t\t\t\tvar children = connections.get( parseInt( nodeID ) ).children;\r\n\r\n\t\t\t\tif ( children.length > 1 ) {\r\n\r\n\t\t\t\t\t// it seems like stacks will always be associated with a single layer. But just in case there are files\r\n\t\t\t\t\t// where there are multiple layers per stack, we'll display a warning\r\n\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar layer = layersMap.get( children[ 0 ].ID );\r\n\r\n\t\t\t\trawClips[ nodeID ] = {\r\n\r\n\t\t\t\t\tname: rawStacks[ nodeID ].attrName,\r\n\t\t\t\t\tlayer: layer,\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn rawClips;\r\n\r\n\t\t},\r\n\r\n\t\taddClip: function ( rawClip ) {\r\n\r\n\t\t\tvar tracks = [];\r\n\r\n\t\t\tvar scope = this;\r\n\t\t\trawClip.layer.forEach( function ( rawTracks ) {\r\n\r\n\t\t\t\ttracks = tracks.concat( scope.generateTracks( rawTracks ) );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\treturn new AnimationClip( rawClip.name, - 1, tracks );\r\n\r\n\t\t},\r\n\r\n\t\tgenerateTracks: function ( rawTracks ) {\r\n\r\n\t\t\tvar tracks = [];\r\n\r\n\t\t\tvar initialPosition = new Vector3();\r\n\t\t\tvar initialRotation = new Quaternion();\r\n\t\t\tvar initialScale = new Vector3();\r\n\r\n\t\t\tif ( rawTracks.transform ) rawTracks.transform.decompose( initialPosition, initialRotation, initialScale );\r\n\r\n\t\t\tinitialPosition = initialPosition.toArray();\r\n\t\t\tinitialRotation = new Euler().setFromQuaternion( initialRotation, rawTracks.eulerOrder ).toArray();\r\n\t\t\tinitialScale = initialScale.toArray();\r\n\r\n\t\t\tif ( rawTracks.T !== undefined && Object.keys( rawTracks.T.curves ).length > 0 ) {\r\n\r\n\t\t\t\tvar positionTrack = this.generateVectorTrack( rawTracks.modelName, rawTracks.T.curves, initialPosition, 'position' );\r\n\t\t\t\tif ( positionTrack !== undefined ) tracks.push( positionTrack );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( rawTracks.R !== undefined && Object.keys( rawTracks.R.curves ).length > 0 ) {\r\n\r\n\t\t\t\tvar rotationTrack = this.generateRotationTrack( rawTracks.modelName, rawTracks.R.curves, initialRotation, rawTracks.preRotation, rawTracks.postRotation, rawTracks.eulerOrder );\r\n\t\t\t\tif ( rotationTrack !== undefined ) tracks.push( rotationTrack );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( rawTracks.S !== undefined && Object.keys( rawTracks.S.curves ).length > 0 ) {\r\n\r\n\t\t\t\tvar scaleTrack = this.generateVectorTrack( rawTracks.modelName, rawTracks.S.curves, initialScale, 'scale' );\r\n\t\t\t\tif ( scaleTrack !== undefined ) tracks.push( scaleTrack );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( rawTracks.DeformPercent !== undefined ) {\r\n\r\n\t\t\t\tvar morphTrack = this.generateMorphTrack( rawTracks );\r\n\t\t\t\tif ( morphTrack !== undefined ) tracks.push( morphTrack );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn tracks;\r\n\r\n\t\t},\r\n\r\n\t\tgenerateVectorTrack: function ( modelName, curves, initialValue, type ) {\r\n\r\n\t\t\tvar times = this.getTimesForAllAxes( curves );\r\n\t\t\tvar values = this.getKeyframeTrackValues( times, curves, initialValue );\r\n\r\n\t\t\treturn new VectorKeyframeTrack( modelName + '.' + type, times, values );\r\n\r\n\t\t},\r\n\r\n\t\tgenerateRotationTrack: function ( modelName, curves, initialValue, preRotation, postRotation, eulerOrder ) {\r\n\r\n\t\t\tif ( curves.x !== undefined ) {\r\n\r\n\t\t\t\tthis.interpolateRotations( curves.x );\r\n\t\t\t\tcurves.x.values = curves.x.values.map( MathUtils.degToRad );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( curves.y !== undefined ) {\r\n\r\n\t\t\t\tthis.interpolateRotations( curves.y );\r\n\t\t\t\tcurves.y.values = curves.y.values.map( MathUtils.degToRad );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( curves.z !== undefined ) {\r\n\r\n\t\t\t\tthis.interpolateRotations( curves.z );\r\n\t\t\t\tcurves.z.values = curves.z.values.map( MathUtils.degToRad );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar times = this.getTimesForAllAxes( curves );\r\n\t\t\tvar values = this.getKeyframeTrackValues( times, curves, initialValue );\r\n\r\n\t\t\tif ( preRotation !== undefined ) {\r\n\r\n\t\t\t\tpreRotation = preRotation.map( MathUtils.degToRad );\r\n\t\t\t\tpreRotation.push( eulerOrder );\r\n\r\n\t\t\t\tpreRotation = new Euler().fromArray( preRotation );\r\n\t\t\t\tpreRotation = new Quaternion().setFromEuler( preRotation );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( postRotation !== undefined ) {\r\n\r\n\t\t\t\tpostRotation = postRotation.map( MathUtils.degToRad );\r\n\t\t\t\tpostRotation.push( eulerOrder );\r\n\r\n\t\t\t\tpostRotation = new Euler().fromArray( postRotation );\r\n\t\t\t\tpostRotation = new Quaternion().setFromEuler( postRotation ).inverse();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar quaternion = new Quaternion();\r\n\t\t\tvar euler = new Euler();\r\n\r\n\t\t\tvar quaternionValues = [];\r\n\r\n\t\t\tfor ( var i = 0; i < values.length; i += 3 ) {\r\n\r\n\t\t\t\teuler.set( values[ i ], values[ i + 1 ], values[ i + 2 ], eulerOrder );\r\n\r\n\t\t\t\tquaternion.setFromEuler( euler );\r\n\r\n\t\t\t\tif ( preRotation !== undefined ) quaternion.premultiply( preRotation );\r\n\t\t\t\tif ( postRotation !== undefined ) quaternion.multiply( postRotation );\r\n\r\n\t\t\t\tquaternion.toArray( quaternionValues, ( i / 3 ) * 4 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn new QuaternionKeyframeTrack( modelName + '.quaternion', times, quaternionValues );\r\n\r\n\t\t},\r\n\r\n\t\tgenerateMorphTrack: function ( rawTracks ) {\r\n\r\n\t\t\tvar curves = rawTracks.DeformPercent.curves.morph;\r\n\t\t\tvar values = curves.values.map( function ( val ) {\r\n\r\n\t\t\t\treturn val / 100;\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tvar morphNum = sceneGraph.getObjectByName( rawTracks.modelName ).morphTargetDictionary[ rawTracks.morphName ];\r\n\r\n\t\t\treturn new NumberKeyframeTrack( rawTracks.modelName + '.morphTargetInfluences[' + morphNum + ']', curves.times, values );\r\n\r\n\t\t},\r\n\r\n\t\t// For all animated objects, times are defined separately for each axis\r\n\t\t// Here we'll combine the times into one sorted array without duplicates\r\n\t\tgetTimesForAllAxes: function ( curves ) {\r\n\r\n\t\t\tvar times = [];\r\n\r\n\t\t\t// first join together the times for each axis, if defined\r\n\t\t\tif ( curves.x !== undefined ) times = times.concat( curves.x.times );\r\n\t\t\tif ( curves.y !== undefined ) times = times.concat( curves.y.times );\r\n\t\t\tif ( curves.z !== undefined ) times = times.concat( curves.z.times );\r\n\r\n\t\t\t// then sort them and remove duplicates\r\n\t\t\ttimes = times.sort( function ( a, b ) {\r\n\r\n\t\t\t\treturn a - b;\r\n\r\n\t\t\t} ).filter( function ( elem, index, array ) {\r\n\r\n\t\t\t\treturn array.indexOf( elem ) == index;\r\n\r\n\t\t\t} );\r\n\r\n\t\t\treturn times;\r\n\r\n\t\t},\r\n\r\n\t\tgetKeyframeTrackValues: function ( times, curves, initialValue ) {\r\n\r\n\t\t\tvar prevValue = initialValue;\r\n\r\n\t\t\tvar values = [];\r\n\r\n\t\t\tvar xIndex = - 1;\r\n\t\t\tvar yIndex = - 1;\r\n\t\t\tvar zIndex = - 1;\r\n\r\n\t\t\ttimes.forEach( function ( time ) {\r\n\r\n\t\t\t\tif ( curves.x ) xIndex = curves.x.times.indexOf( time );\r\n\t\t\t\tif ( curves.y ) yIndex = curves.y.times.indexOf( time );\r\n\t\t\t\tif ( curves.z ) zIndex = curves.z.times.indexOf( time );\r\n\r\n\t\t\t\t// if there is an x value defined for this frame, use that\r\n\t\t\t\tif ( xIndex !== - 1 ) {\r\n\r\n\t\t\t\t\tvar xValue = curves.x.values[ xIndex ];\r\n\t\t\t\t\tvalues.push( xValue );\r\n\t\t\t\t\tprevValue[ 0 ] = xValue;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// otherwise use the x value from the previous frame\r\n\t\t\t\t\tvalues.push( prevValue[ 0 ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( yIndex !== - 1 ) {\r\n\r\n\t\t\t\t\tvar yValue = curves.y.values[ yIndex ];\r\n\t\t\t\t\tvalues.push( yValue );\r\n\t\t\t\t\tprevValue[ 1 ] = yValue;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tvalues.push( prevValue[ 1 ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( zIndex !== - 1 ) {\r\n\r\n\t\t\t\t\tvar zValue = curves.z.values[ zIndex ];\r\n\t\t\t\t\tvalues.push( zValue );\r\n\t\t\t\t\tprevValue[ 2 ] = zValue;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tvalues.push( prevValue[ 2 ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t\treturn values;\r\n\r\n\t\t},\r\n\r\n\t\t// Rotations are defined as Euler angles which can have values  of any size\r\n\t\t// These will be converted to quaternions which don't support values greater than\r\n\t\t// PI, so we'll interpolate large rotations\r\n\t\tinterpolateRotations: function ( curve ) {\r\n\r\n\t\t\tfor ( var i = 1; i < curve.values.length; i ++ ) {\r\n\r\n\t\t\t\tvar initialValue = curve.values[ i - 1 ];\r\n\t\t\t\tvar valuesSpan = curve.values[ i ] - initialValue;\r\n\r\n\t\t\t\tvar absoluteSpan = Math.abs( valuesSpan );\r\n\r\n\t\t\t\tif ( absoluteSpan >= 180 ) {\r\n\r\n\t\t\t\t\tvar numSubIntervals = absoluteSpan / 180;\r\n\r\n\t\t\t\t\tvar step = valuesSpan / numSubIntervals;\r\n\t\t\t\t\tvar nextValue = initialValue + step;\r\n\r\n\t\t\t\t\tvar initialTime = curve.times[ i - 1 ];\r\n\t\t\t\t\tvar timeSpan = curve.times[ i ] - initialTime;\r\n\t\t\t\t\tvar interval = timeSpan / numSubIntervals;\r\n\t\t\t\t\tvar nextTime = initialTime + interval;\r\n\r\n\t\t\t\t\tvar interpolatedTimes = [];\r\n\t\t\t\t\tvar interpolatedValues = [];\r\n\r\n\t\t\t\t\twhile ( nextTime < curve.times[ i ] ) {\r\n\r\n\t\t\t\t\t\tinterpolatedTimes.push( nextTime );\r\n\t\t\t\t\t\tnextTime += interval;\r\n\r\n\t\t\t\t\t\tinterpolatedValues.push( nextValue );\r\n\t\t\t\t\t\tnextValue += step;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcurve.times = inject( curve.times, i, interpolatedTimes );\r\n\t\t\t\t\tcurve.values = inject( curve.values, i, interpolatedValues );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t};\r\n\r\n\t// parse an FBX file in ASCII format\r\n\tfunction TextParser() {}\r\n\r\n\tTextParser.prototype = {\r\n\r\n\t\tconstructor: TextParser,\r\n\r\n\t\tgetPrevNode: function () {\r\n\r\n\t\t\treturn this.nodeStack[ this.currentIndent - 2 ];\r\n\r\n\t\t},\r\n\r\n\t\tgetCurrentNode: function () {\r\n\r\n\t\t\treturn this.nodeStack[ this.currentIndent - 1 ];\r\n\r\n\t\t},\r\n\r\n\t\tgetCurrentProp: function () {\r\n\r\n\t\t\treturn this.currentProp;\r\n\r\n\t\t},\r\n\r\n\t\tpushStack: function ( node ) {\r\n\r\n\t\t\tthis.nodeStack.push( node );\r\n\t\t\tthis.currentIndent += 1;\r\n\r\n\t\t},\r\n\r\n\t\tpopStack: function () {\r\n\r\n\t\t\tthis.nodeStack.pop();\r\n\t\t\tthis.currentIndent -= 1;\r\n\r\n\t\t},\r\n\r\n\t\tsetCurrentProp: function ( val, name ) {\r\n\r\n\t\t\tthis.currentProp = val;\r\n\t\t\tthis.currentPropName = name;\r\n\r\n\t\t},\r\n\r\n\t\tparse: function ( text ) {\r\n\r\n\t\t\tthis.currentIndent = 0;\r\n\r\n\t\t\tthis.allNodes = new FBXTree();\r\n\t\t\tthis.nodeStack = [];\r\n\t\t\tthis.currentProp = [];\r\n\t\t\tthis.currentPropName = '';\r\n\r\n\t\t\tvar scope = this;\r\n\r\n\t\t\tvar split = text.split( /[\\r\\n]+/ );\r\n\r\n\t\t\tsplit.forEach( function ( line, i ) {\r\n\r\n\t\t\t\tvar matchComment = line.match( /^[\\s\\t]*;/ );\r\n\t\t\t\tvar matchEmpty = line.match( /^[\\s\\t]*$/ );\r\n\r\n\t\t\t\tif ( matchComment || matchEmpty ) return;\r\n\r\n\t\t\t\tvar matchBeginning = line.match( '^\\\\t{' + scope.currentIndent + '}(\\\\w+):(.*){', '' );\r\n\t\t\t\tvar matchProperty = line.match( '^\\\\t{' + ( scope.currentIndent ) + '}(\\\\w+):[\\\\s\\\\t\\\\r\\\\n](.*)' );\r\n\t\t\t\tvar matchEnd = line.match( '^\\\\t{' + ( scope.currentIndent - 1 ) + '}}' );\r\n\r\n\t\t\t\tif ( matchBeginning ) {\r\n\r\n\t\t\t\t\tscope.parseNodeBegin( line, matchBeginning );\r\n\r\n\t\t\t\t} else if ( matchProperty ) {\r\n\r\n\t\t\t\t\tscope.parseNodeProperty( line, matchProperty, split[ ++ i ] );\r\n\r\n\t\t\t\t} else if ( matchEnd ) {\r\n\r\n\t\t\t\t\tscope.popStack();\r\n\r\n\t\t\t\t} else if ( line.match( /^[^\\s\\t}]/ ) ) {\r\n\r\n\t\t\t\t\t// large arrays are split over multiple lines terminated with a ',' character\r\n\t\t\t\t\t// if this is encountered the line needs to be joined to the previous line\r\n\t\t\t\t\tscope.parseNodePropertyContinued( line );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t\treturn this.allNodes;\r\n\r\n\t\t},\r\n\r\n\t\tparseNodeBegin: function ( line, property ) {\r\n\r\n\t\t\tvar nodeName = property[ 1 ].trim().replace( /^\"/, '' ).replace( /\"$/, '' );\r\n\r\n\t\t\tvar nodeAttrs = property[ 2 ].split( ',' ).map( function ( attr ) {\r\n\r\n\t\t\t\treturn attr.trim().replace( /^\"/, '' ).replace( /\"$/, '' );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tvar node = { name: nodeName };\r\n\t\t\tvar attrs = this.parseNodeAttr( nodeAttrs );\r\n\r\n\t\t\tvar currentNode = this.getCurrentNode();\r\n\r\n\t\t\t// a top node\r\n\t\t\tif ( this.currentIndent === 0 ) {\r\n\r\n\t\t\t\tthis.allNodes.add( nodeName, node );\r\n\r\n\t\t\t} else { // a subnode\r\n\r\n\t\t\t\t// if the subnode already exists, append it\r\n\t\t\t\tif ( nodeName in currentNode ) {\r\n\r\n\t\t\t\t\t// special case Pose needs PoseNodes as an array\r\n\t\t\t\t\tif ( nodeName === 'PoseNode' ) {\r\n\r\n\t\t\t\t\t\tcurrentNode.PoseNode.push( node );\r\n\r\n\t\t\t\t\t} else if ( currentNode[ nodeName ].id !== undefined ) {\r\n\r\n\t\t\t\t\t\tcurrentNode[ nodeName ] = {};\r\n\t\t\t\t\t\tcurrentNode[ nodeName ][ currentNode[ nodeName ].id ] = currentNode[ nodeName ];\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( attrs.id !== '' ) currentNode[ nodeName ][ attrs.id ] = node;\r\n\r\n\t\t\t\t} else if ( typeof attrs.id === 'number' ) {\r\n\r\n\t\t\t\t\tcurrentNode[ nodeName ] = {};\r\n\t\t\t\t\tcurrentNode[ nodeName ][ attrs.id ] = node;\r\n\r\n\t\t\t\t} else if ( nodeName !== 'Properties70' ) {\r\n\r\n\t\t\t\t\tif ( nodeName === 'PoseNode' )\tcurrentNode[ nodeName ] = [ node ];\r\n\t\t\t\t\telse currentNode[ nodeName ] = node;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( typeof attrs.id === 'number' ) node.id = attrs.id;\r\n\t\t\tif ( attrs.name !== '' ) node.attrName = attrs.name;\r\n\t\t\tif ( attrs.type !== '' ) node.attrType = attrs.type;\r\n\r\n\t\t\tthis.pushStack( node );\r\n\r\n\t\t},\r\n\r\n\t\tparseNodeAttr: function ( attrs ) {\r\n\r\n\t\t\tvar id = attrs[ 0 ];\r\n\r\n\t\t\tif ( attrs[ 0 ] !== '' ) {\r\n\r\n\t\t\t\tid = parseInt( attrs[ 0 ] );\r\n\r\n\t\t\t\tif ( isNaN( id ) ) {\r\n\r\n\t\t\t\t\tid = attrs[ 0 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar name = '', type = '';\r\n\r\n\t\t\tif ( attrs.length > 1 ) {\r\n\r\n\t\t\t\tname = attrs[ 1 ].replace( /^(\\w+)::/, '' );\r\n\t\t\t\ttype = attrs[ 2 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn { id: id, name: name, type: type };\r\n\r\n\t\t},\r\n\r\n\t\tparseNodeProperty: function ( line, property, contentLine ) {\r\n\r\n\t\t\tvar propName = property[ 1 ].replace( /^\"/, '' ).replace( /\"$/, '' ).trim();\r\n\t\t\tvar propValue = property[ 2 ].replace( /^\"/, '' ).replace( /\"$/, '' ).trim();\r\n\r\n\t\t\t// for special case: base64 image data follows \"Content: ,\" line\r\n\t\t\t//\tContent: ,\r\n\t\t\t//\t \"/9j/4RDaRXhpZgAATU0A...\"\r\n\t\t\tif ( propName === 'Content' && propValue === ',' ) {\r\n\r\n\t\t\t\tpropValue = contentLine.replace( /\"/g, '' ).replace( /,$/, '' ).trim();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar currentNode = this.getCurrentNode();\r\n\t\t\tvar parentName = currentNode.name;\r\n\r\n\t\t\tif ( parentName === 'Properties70' ) {\r\n\r\n\t\t\t\tthis.parseNodeSpecialProperty( line, propName, propValue );\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Connections\r\n\t\t\tif ( propName === 'C' ) {\r\n\r\n\t\t\t\tvar connProps = propValue.split( ',' ).slice( 1 );\r\n\t\t\t\tvar from = parseInt( connProps[ 0 ] );\r\n\t\t\t\tvar to = parseInt( connProps[ 1 ] );\r\n\r\n\t\t\t\tvar rest = propValue.split( ',' ).slice( 3 );\r\n\r\n\t\t\t\trest = rest.map( function ( elem ) {\r\n\r\n\t\t\t\t\treturn elem.trim().replace( /^\"/, '' );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t\tpropName = 'connections';\r\n\t\t\t\tpropValue = [ from, to ];\r\n\t\t\t\tappend( propValue, rest );\r\n\r\n\t\t\t\tif ( currentNode[ propName ] === undefined ) {\r\n\r\n\t\t\t\t\tcurrentNode[ propName ] = [];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Node\r\n\t\t\tif ( propName === 'Node' ) currentNode.id = propValue;\r\n\r\n\t\t\t// connections\r\n\t\t\tif ( propName in currentNode && Array.isArray( currentNode[ propName ] ) ) {\r\n\r\n\t\t\t\tcurrentNode[ propName ].push( propValue );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( propName !== 'a' ) currentNode[ propName ] = propValue;\r\n\t\t\t\telse currentNode.a = propValue;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.setCurrentProp( currentNode, propName );\r\n\r\n\t\t\t// convert string to array, unless it ends in ',' in which case more will be added to it\r\n\t\t\tif ( propName === 'a' && propValue.slice( - 1 ) !== ',' ) {\r\n\r\n\t\t\t\tcurrentNode.a = parseNumberArray( propValue );\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\tparseNodePropertyContinued: function ( line ) {\r\n\r\n\t\t\tvar currentNode = this.getCurrentNode();\r\n\r\n\t\t\tcurrentNode.a += line;\r\n\r\n\t\t\t// if the line doesn't end in ',' we have reached the end of the property value\r\n\t\t\t// so convert the string to an array\r\n\t\t\tif ( line.slice( - 1 ) !== ',' ) {\r\n\r\n\t\t\t\tcurrentNode.a = parseNumberArray( currentNode.a );\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\t// parse \"Property70\"\r\n\t\tparseNodeSpecialProperty: function ( line, propName, propValue ) {\r\n\r\n\t\t\t// split this\r\n\t\t\t// P: \"Lcl Scaling\", \"Lcl Scaling\", \"\", \"A\",1,1,1\r\n\t\t\t// into array like below\r\n\t\t\t// [\"Lcl Scaling\", \"Lcl Scaling\", \"\", \"A\", \"1,1,1\" ]\r\n\t\t\tvar props = propValue.split( '\",' ).map( function ( prop ) {\r\n\r\n\t\t\t\treturn prop.trim().replace( /^\\\"/, '' ).replace( /\\s/, '_' );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tvar innerPropName = props[ 0 ];\r\n\t\t\tvar innerPropType1 = props[ 1 ];\r\n\t\t\tvar innerPropType2 = props[ 2 ];\r\n\t\t\tvar innerPropFlag = props[ 3 ];\r\n\t\t\tvar innerPropValue = props[ 4 ];\r\n\r\n\t\t\t// cast values where needed, otherwise leave as strings\r\n\t\t\tswitch ( innerPropType1 ) {\r\n\r\n\t\t\t\tcase 'int':\r\n\t\t\t\tcase 'enum':\r\n\t\t\t\tcase 'bool':\r\n\t\t\t\tcase 'ULongLong':\r\n\t\t\t\tcase 'double':\r\n\t\t\t\tcase 'Number':\r\n\t\t\t\tcase 'FieldOfView':\r\n\t\t\t\t\tinnerPropValue = parseFloat( innerPropValue );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'Color':\r\n\t\t\t\tcase 'ColorRGB':\r\n\t\t\t\tcase 'Vector3D':\r\n\t\t\t\tcase 'Lcl_Translation':\r\n\t\t\t\tcase 'Lcl_Rotation':\r\n\t\t\t\tcase 'Lcl_Scaling':\r\n\t\t\t\t\tinnerPropValue = parseNumberArray( innerPropValue );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// CAUTION: these props must append to parent's parent\r\n\t\t\tthis.getPrevNode()[ innerPropName ] = {\r\n\r\n\t\t\t\t'type': innerPropType1,\r\n\t\t\t\t'type2': innerPropType2,\r\n\t\t\t\t'flag': innerPropFlag,\r\n\t\t\t\t'value': innerPropValue\r\n\r\n\t\t\t};\r\n\r\n\t\t\tthis.setCurrentProp( this.getPrevNode(), innerPropName );\r\n\r\n\t\t},\r\n\r\n\t};\r\n\r\n\t// Parse an FBX file in Binary format\r\n\tfunction BinaryParser() {}\r\n\r\n\tBinaryParser.prototype = {\r\n\r\n\t\tconstructor: BinaryParser,\r\n\r\n\t\tparse: function ( buffer ) {\r\n\r\n\t\t\tvar reader = new BinaryReader( buffer );\r\n\t\t\treader.skip( 23 ); // skip magic 23 bytes\r\n\r\n\t\t\tvar version = reader.getUint32();\r\n\r\n\t\t\tif ( version < 6400 ) {\r\n\r\n\t\t\t\tthrow new Error( 'THREE.FBXLoader: FBX version not supported, FileVersion: ' + version );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar allNodes = new FBXTree();\r\n\r\n\t\t\twhile ( ! this.endOfContent( reader ) ) {\r\n\r\n\t\t\t\tvar node = this.parseNode( reader, version );\r\n\t\t\t\tif ( node !== null ) allNodes.add( node.name, node );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn allNodes;\r\n\r\n\t\t},\r\n\r\n\t\t// Check if reader has reached the end of content.\r\n\t\tendOfContent: function ( reader ) {\r\n\r\n\t\t\t// footer size: 160bytes + 16-byte alignment padding\r\n\t\t\t// - 16bytes: magic\r\n\t\t\t// - padding til 16-byte alignment (at least 1byte?)\r\n\t\t\t//\t(seems like some exporters embed fixed 15 or 16bytes?)\r\n\t\t\t// - 4bytes: magic\r\n\t\t\t// - 4bytes: version\r\n\t\t\t// - 120bytes: zero\r\n\t\t\t// - 16bytes: magic\r\n\t\t\tif ( reader.size() % 16 === 0 ) {\r\n\r\n\t\t\t\treturn ( ( reader.getOffset() + 160 + 16 ) & ~ 0xf ) >= reader.size();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\treturn reader.getOffset() + 160 + 16 >= reader.size();\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\t// recursively parse nodes until the end of the file is reached\r\n\t\tparseNode: function ( reader, version ) {\r\n\r\n\t\t\tvar node = {};\r\n\r\n\t\t\t// The first three data sizes depends on version.\r\n\t\t\tvar endOffset = ( version >= 7500 ) ? reader.getUint64() : reader.getUint32();\r\n\t\t\tvar numProperties = ( version >= 7500 ) ? reader.getUint64() : reader.getUint32();\r\n\r\n\t\t\t( version >= 7500 ) ? reader.getUint64() : reader.getUint32(); // the returned propertyListLen is not used\r\n\r\n\t\t\tvar nameLen = reader.getUint8();\r\n\t\t\tvar name = reader.getString( nameLen );\r\n\r\n\t\t\t// Regards this node as NULL-record if endOffset is zero\r\n\t\t\tif ( endOffset === 0 ) return null;\r\n\r\n\t\t\tvar propertyList = [];\r\n\r\n\t\t\tfor ( var i = 0; i < numProperties; i ++ ) {\r\n\r\n\t\t\t\tpropertyList.push( this.parseProperty( reader ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Regards the first three elements in propertyList as id, attrName, and attrType\r\n\t\t\tvar id = propertyList.length > 0 ? propertyList[ 0 ] : '';\r\n\t\t\tvar attrName = propertyList.length > 1 ? propertyList[ 1 ] : '';\r\n\t\t\tvar attrType = propertyList.length > 2 ? propertyList[ 2 ] : '';\r\n\r\n\t\t\t// check if this node represents just a single property\r\n\t\t\t// like (name, 0) set or (name2, [0, 1, 2]) set of {name: 0, name2: [0, 1, 2]}\r\n\t\t\tnode.singleProperty = ( numProperties === 1 && reader.getOffset() === endOffset ) ? true : false;\r\n\r\n\t\t\twhile ( endOffset > reader.getOffset() ) {\r\n\r\n\t\t\t\tvar subNode = this.parseNode( reader, version );\r\n\r\n\t\t\t\tif ( subNode !== null ) this.parseSubNode( name, node, subNode );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tnode.propertyList = propertyList; // raw property list used by parent\r\n\r\n\t\t\tif ( typeof id === 'number' ) node.id = id;\r\n\t\t\tif ( attrName !== '' ) node.attrName = attrName;\r\n\t\t\tif ( attrType !== '' ) node.attrType = attrType;\r\n\t\t\tif ( name !== '' ) node.name = name;\r\n\r\n\t\t\treturn node;\r\n\r\n\t\t},\r\n\r\n\t\tparseSubNode: function ( name, node, subNode ) {\r\n\r\n\t\t\t// special case: child node is single property\r\n\t\t\tif ( subNode.singleProperty === true ) {\r\n\r\n\t\t\t\tvar value = subNode.propertyList[ 0 ];\r\n\r\n\t\t\t\tif ( Array.isArray( value ) ) {\r\n\r\n\t\t\t\t\tnode[ subNode.name ] = subNode;\r\n\r\n\t\t\t\t\tsubNode.a = value;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tnode[ subNode.name ] = value;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( name === 'Connections' && subNode.name === 'C' ) {\r\n\r\n\t\t\t\tvar array = [];\r\n\r\n\t\t\t\tsubNode.propertyList.forEach( function ( property, i ) {\r\n\r\n\t\t\t\t\t// first Connection is FBX type (OO, OP, etc.). We'll discard these\r\n\t\t\t\t\tif ( i !== 0 ) array.push( property );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t\tif ( node.connections === undefined ) {\r\n\r\n\t\t\t\t\tnode.connections = [];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnode.connections.push( array );\r\n\r\n\t\t\t} else if ( subNode.name === 'Properties70' ) {\r\n\r\n\t\t\t\tvar keys = Object.keys( subNode );\r\n\r\n\t\t\t\tkeys.forEach( function ( key ) {\r\n\r\n\t\t\t\t\tnode[ key ] = subNode[ key ];\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t} else if ( name === 'Properties70' && subNode.name === 'P' ) {\r\n\r\n\t\t\t\tvar innerPropName = subNode.propertyList[ 0 ];\r\n\t\t\t\tvar innerPropType1 = subNode.propertyList[ 1 ];\r\n\t\t\t\tvar innerPropType2 = subNode.propertyList[ 2 ];\r\n\t\t\t\tvar innerPropFlag = subNode.propertyList[ 3 ];\r\n\t\t\t\tvar innerPropValue;\r\n\r\n\t\t\t\tif ( innerPropName.indexOf( 'Lcl ' ) === 0 ) innerPropName = innerPropName.replace( 'Lcl ', 'Lcl_' );\r\n\t\t\t\tif ( innerPropType1.indexOf( 'Lcl ' ) === 0 ) innerPropType1 = innerPropType1.replace( 'Lcl ', 'Lcl_' );\r\n\r\n\t\t\t\tif ( innerPropType1 === 'Color' || innerPropType1 === 'ColorRGB' || innerPropType1 === 'Vector' || innerPropType1 === 'Vector3D' || innerPropType1.indexOf( 'Lcl_' ) === 0 ) {\r\n\r\n\t\t\t\t\tinnerPropValue = [\r\n\t\t\t\t\t\tsubNode.propertyList[ 4 ],\r\n\t\t\t\t\t\tsubNode.propertyList[ 5 ],\r\n\t\t\t\t\t\tsubNode.propertyList[ 6 ]\r\n\t\t\t\t\t];\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tinnerPropValue = subNode.propertyList[ 4 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// this will be copied to parent, see above\r\n\t\t\t\tnode[ innerPropName ] = {\r\n\r\n\t\t\t\t\t'type': innerPropType1,\r\n\t\t\t\t\t'type2': innerPropType2,\r\n\t\t\t\t\t'flag': innerPropFlag,\r\n\t\t\t\t\t'value': innerPropValue\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\t} else if ( node[ subNode.name ] === undefined ) {\r\n\r\n\t\t\t\tif ( typeof subNode.id === 'number' ) {\r\n\r\n\t\t\t\t\tnode[ subNode.name ] = {};\r\n\t\t\t\t\tnode[ subNode.name ][ subNode.id ] = subNode;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tnode[ subNode.name ] = subNode;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( subNode.name === 'PoseNode' ) {\r\n\r\n\t\t\t\t\tif ( ! Array.isArray( node[ subNode.name ] ) ) {\r\n\r\n\t\t\t\t\t\tnode[ subNode.name ] = [ node[ subNode.name ] ];\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnode[ subNode.name ].push( subNode );\r\n\r\n\t\t\t\t} else if ( node[ subNode.name ][ subNode.id ] === undefined ) {\r\n\r\n\t\t\t\t\tnode[ subNode.name ][ subNode.id ] = subNode;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\tparseProperty: function ( reader ) {\r\n\r\n\t\t\tvar type = reader.getString( 1 );\r\n\r\n\t\t\tswitch ( type ) {\r\n\r\n\t\t\t\tcase 'C':\r\n\t\t\t\t\treturn reader.getBoolean();\r\n\r\n\t\t\t\tcase 'D':\r\n\t\t\t\t\treturn reader.getFloat64();\r\n\r\n\t\t\t\tcase 'F':\r\n\t\t\t\t\treturn reader.getFloat32();\r\n\r\n\t\t\t\tcase 'I':\r\n\t\t\t\t\treturn reader.getInt32();\r\n\r\n\t\t\t\tcase 'L':\r\n\t\t\t\t\treturn reader.getInt64();\r\n\r\n\t\t\t\tcase 'R':\r\n\t\t\t\t\tvar length = reader.getUint32();\r\n\t\t\t\t\treturn reader.getArrayBuffer( length );\r\n\r\n\t\t\t\tcase 'S':\r\n\t\t\t\t\tvar length = reader.getUint32();\r\n\t\t\t\t\treturn reader.getString( length );\r\n\r\n\t\t\t\tcase 'Y':\r\n\t\t\t\t\treturn reader.getInt16();\r\n\r\n\t\t\t\tcase 'b':\r\n\t\t\t\tcase 'c':\r\n\t\t\t\tcase 'd':\r\n\t\t\t\tcase 'f':\r\n\t\t\t\tcase 'i':\r\n\t\t\t\tcase 'l':\r\n\r\n\t\t\t\t\tvar arrayLength = reader.getUint32();\r\n\t\t\t\t\tvar encoding = reader.getUint32(); // 0: non-compressed, 1: compressed\r\n\t\t\t\t\tvar compressedLength = reader.getUint32();\r\n\r\n\t\t\t\t\tif ( encoding === 0 ) {\r\n\r\n\t\t\t\t\t\tswitch ( type ) {\r\n\r\n\t\t\t\t\t\t\tcase 'b':\r\n\t\t\t\t\t\t\tcase 'c':\r\n\t\t\t\t\t\t\t\treturn reader.getBooleanArray( arrayLength );\r\n\r\n\t\t\t\t\t\t\tcase 'd':\r\n\t\t\t\t\t\t\t\treturn reader.getFloat64Array( arrayLength );\r\n\r\n\t\t\t\t\t\t\tcase 'f':\r\n\t\t\t\t\t\t\t\treturn reader.getFloat32Array( arrayLength );\r\n\r\n\t\t\t\t\t\t\tcase 'i':\r\n\t\t\t\t\t\t\t\treturn reader.getInt32Array( arrayLength );\r\n\r\n\t\t\t\t\t\t\tcase 'l':\r\n\t\t\t\t\t\t\t\treturn reader.getInt64Array( arrayLength );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( typeof Inflate === 'undefined' ) {\r\n\r\n\t\t\t\t\t\tconsole.error( 'THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js' );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar inflate = new Inflate( new Uint8Array( reader.getArrayBuffer( compressedLength ) ) ); // eslint-disable-line no-undef\r\n\t\t\t\t\tvar reader2 = new BinaryReader( inflate.decompress().buffer );\r\n\r\n\t\t\t\t\tswitch ( type ) {\r\n\r\n\t\t\t\t\t\tcase 'b':\r\n\t\t\t\t\t\tcase 'c':\r\n\t\t\t\t\t\t\treturn reader2.getBooleanArray( arrayLength );\r\n\r\n\t\t\t\t\t\tcase 'd':\r\n\t\t\t\t\t\t\treturn reader2.getFloat64Array( arrayLength );\r\n\r\n\t\t\t\t\t\tcase 'f':\r\n\t\t\t\t\t\t\treturn reader2.getFloat32Array( arrayLength );\r\n\r\n\t\t\t\t\t\tcase 'i':\r\n\t\t\t\t\t\t\treturn reader2.getInt32Array( arrayLength );\r\n\r\n\t\t\t\t\t\tcase 'l':\r\n\t\t\t\t\t\t\treturn reader2.getInt64Array( arrayLength );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow new Error( 'THREE.FBXLoader: Unknown property type ' + type );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tfunction BinaryReader( buffer, littleEndian ) {\r\n\r\n\t\tthis.dv = new DataView( buffer );\r\n\t\tthis.offset = 0;\r\n\t\tthis.littleEndian = ( littleEndian !== undefined ) ? littleEndian : true;\r\n\r\n\t}\r\n\r\n\tBinaryReader.prototype = {\r\n\r\n\t\tconstructor: BinaryReader,\r\n\r\n\t\tgetOffset: function () {\r\n\r\n\t\t\treturn this.offset;\r\n\r\n\t\t},\r\n\r\n\t\tsize: function () {\r\n\r\n\t\t\treturn this.dv.buffer.byteLength;\r\n\r\n\t\t},\r\n\r\n\t\tskip: function ( length ) {\r\n\r\n\t\t\tthis.offset += length;\r\n\r\n\t\t},\r\n\r\n\t\t// seems like true/false representation depends on exporter.\r\n\t\t// true: 1 or 'Y'(=0x59), false: 0 or 'T'(=0x54)\r\n\t\t// then sees LSB.\r\n\t\tgetBoolean: function () {\r\n\r\n\t\t\treturn ( this.getUint8() & 1 ) === 1;\r\n\r\n\t\t},\r\n\r\n\t\tgetBooleanArray: function ( size ) {\r\n\r\n\t\t\tvar a = [];\r\n\r\n\t\t\tfor ( var i = 0; i < size; i ++ ) {\r\n\r\n\t\t\t\ta.push( this.getBoolean() );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn a;\r\n\r\n\t\t},\r\n\r\n\t\tgetUint8: function () {\r\n\r\n\t\t\tvar value = this.dv.getUint8( this.offset );\r\n\t\t\tthis.offset += 1;\r\n\t\t\treturn value;\r\n\r\n\t\t},\r\n\r\n\t\tgetInt16: function () {\r\n\r\n\t\t\tvar value = this.dv.getInt16( this.offset, this.littleEndian );\r\n\t\t\tthis.offset += 2;\r\n\t\t\treturn value;\r\n\r\n\t\t},\r\n\r\n\t\tgetInt32: function () {\r\n\r\n\t\t\tvar value = this.dv.getInt32( this.offset, this.littleEndian );\r\n\t\t\tthis.offset += 4;\r\n\t\t\treturn value;\r\n\r\n\t\t},\r\n\r\n\t\tgetInt32Array: function ( size ) {\r\n\r\n\t\t\tvar a = [];\r\n\r\n\t\t\tfor ( var i = 0; i < size; i ++ ) {\r\n\r\n\t\t\t\ta.push( this.getInt32() );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn a;\r\n\r\n\t\t},\r\n\r\n\t\tgetUint32: function () {\r\n\r\n\t\t\tvar value = this.dv.getUint32( this.offset, this.littleEndian );\r\n\t\t\tthis.offset += 4;\r\n\t\t\treturn value;\r\n\r\n\t\t},\r\n\r\n\t\t// JavaScript doesn't support 64-bit integer so calculate this here\r\n\t\t// 1 << 32 will return 1 so using multiply operation instead here.\r\n\t\t// There's a possibility that this method returns wrong value if the value\r\n\t\t// is out of the range between Number.MAX_SAFE_INTEGER and Number.MIN_SAFE_INTEGER.\r\n\t\t// TODO: safely handle 64-bit integer\r\n\t\tgetInt64: function () {\r\n\r\n\t\t\tvar low, high;\r\n\r\n\t\t\tif ( this.littleEndian ) {\r\n\r\n\t\t\t\tlow = this.getUint32();\r\n\t\t\t\thigh = this.getUint32();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\thigh = this.getUint32();\r\n\t\t\t\tlow = this.getUint32();\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// calculate negative value\r\n\t\t\tif ( high & 0x80000000 ) {\r\n\r\n\t\t\t\thigh = ~ high & 0xFFFFFFFF;\r\n\t\t\t\tlow = ~ low & 0xFFFFFFFF;\r\n\r\n\t\t\t\tif ( low === 0xFFFFFFFF ) high = ( high + 1 ) & 0xFFFFFFFF;\r\n\r\n\t\t\t\tlow = ( low + 1 ) & 0xFFFFFFFF;\r\n\r\n\t\t\t\treturn - ( high * 0x100000000 + low );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn high * 0x100000000 + low;\r\n\r\n\t\t},\r\n\r\n\t\tgetInt64Array: function ( size ) {\r\n\r\n\t\t\tvar a = [];\r\n\r\n\t\t\tfor ( var i = 0; i < size; i ++ ) {\r\n\r\n\t\t\t\ta.push( this.getInt64() );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn a;\r\n\r\n\t\t},\r\n\r\n\t\t// Note: see getInt64() comment\r\n\t\tgetUint64: function () {\r\n\r\n\t\t\tvar low, high;\r\n\r\n\t\t\tif ( this.littleEndian ) {\r\n\r\n\t\t\t\tlow = this.getUint32();\r\n\t\t\t\thigh = this.getUint32();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\thigh = this.getUint32();\r\n\t\t\t\tlow = this.getUint32();\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn high * 0x100000000 + low;\r\n\r\n\t\t},\r\n\r\n\t\tgetFloat32: function () {\r\n\r\n\t\t\tvar value = this.dv.getFloat32( this.offset, this.littleEndian );\r\n\t\t\tthis.offset += 4;\r\n\t\t\treturn value;\r\n\r\n\t\t},\r\n\r\n\t\tgetFloat32Array: function ( size ) {\r\n\r\n\t\t\tvar a = [];\r\n\r\n\t\t\tfor ( var i = 0; i < size; i ++ ) {\r\n\r\n\t\t\t\ta.push( this.getFloat32() );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn a;\r\n\r\n\t\t},\r\n\r\n\t\tgetFloat64: function () {\r\n\r\n\t\t\tvar value = this.dv.getFloat64( this.offset, this.littleEndian );\r\n\t\t\tthis.offset += 8;\r\n\t\t\treturn value;\r\n\r\n\t\t},\r\n\r\n\t\tgetFloat64Array: function ( size ) {\r\n\r\n\t\t\tvar a = [];\r\n\r\n\t\t\tfor ( var i = 0; i < size; i ++ ) {\r\n\r\n\t\t\t\ta.push( this.getFloat64() );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn a;\r\n\r\n\t\t},\r\n\r\n\t\tgetArrayBuffer: function ( size ) {\r\n\r\n\t\t\tvar value = this.dv.buffer.slice( this.offset, this.offset + size );\r\n\t\t\tthis.offset += size;\r\n\t\t\treturn value;\r\n\r\n\t\t},\r\n\r\n\t\tgetString: function ( size ) {\r\n\r\n\t\t\t// note: safari 9 doesn't support Uint8Array.indexOf; create intermediate array instead\r\n\t\t\tvar a = [];\r\n\r\n\t\t\tfor ( var i = 0; i < size; i ++ ) {\r\n\r\n\t\t\t\ta[ i ] = this.getUint8();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar nullByte = a.indexOf( 0 );\r\n\t\t\tif ( nullByte >= 0 ) a = a.slice( 0, nullByte );\r\n\r\n\t\t\treturn LoaderUtils.decodeText( new Uint8Array( a ) );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t// FBXTree holds a representation of the FBX data, returned by the TextParser ( FBX ASCII format)\r\n\t// and BinaryParser( FBX Binary format)\r\n\tfunction FBXTree() {}\r\n\r\n\tFBXTree.prototype = {\r\n\r\n\t\tconstructor: FBXTree,\r\n\r\n\t\tadd: function ( key, val ) {\r\n\r\n\t\t\tthis[ key ] = val;\r\n\r\n\t\t},\r\n\r\n\t};\r\n\r\n\t// ************** UTILITY FUNCTIONS **************\r\n\r\n\tfunction isFbxFormatBinary( buffer ) {\r\n\r\n\t\tvar CORRECT = 'Kaydara FBX Binary  \\0';\r\n\r\n\t\treturn buffer.byteLength >= CORRECT.length && CORRECT === convertArrayBufferToString( buffer, 0, CORRECT.length );\r\n\r\n\t}\r\n\r\n\tfunction isFbxFormatASCII( text ) {\r\n\r\n\t\tvar CORRECT = [ 'K', 'a', 'y', 'd', 'a', 'r', 'a', '\\\\', 'F', 'B', 'X', '\\\\', 'B', 'i', 'n', 'a', 'r', 'y', '\\\\', '\\\\' ];\r\n\r\n\t\tvar cursor = 0;\r\n\r\n\t\tfunction read( offset ) {\r\n\r\n\t\t\tvar result = text[ offset - 1 ];\r\n\t\t\ttext = text.slice( cursor + offset );\r\n\t\t\tcursor ++;\r\n\t\t\treturn result;\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0; i < CORRECT.length; ++ i ) {\r\n\r\n\t\t\tvar num = read( 1 );\r\n\t\t\tif ( num === CORRECT[ i ] ) {\r\n\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\tfunction getFbxVersion( text ) {\r\n\r\n\t\tvar versionRegExp = /FBXVersion: (\\d+)/;\r\n\t\tvar match = text.match( versionRegExp );\r\n\r\n\t\tif ( match ) {\r\n\r\n\t\t\tvar version = parseInt( match[ 1 ] );\r\n\t\t\treturn version;\r\n\r\n\t\t}\r\n\r\n\t\tthrow new Error( 'THREE.FBXLoader: Cannot find the version number for the file given.' );\r\n\r\n\t}\r\n\r\n\t// Converts FBX ticks into real time seconds.\r\n\tfunction convertFBXTimeToSeconds( time ) {\r\n\r\n\t\treturn time / 46186158000;\r\n\r\n\t}\r\n\r\n\tvar dataArray = [];\r\n\r\n\t// extracts the data from the correct position in the FBX array based on indexing type\r\n\tfunction getData( polygonVertexIndex, polygonIndex, vertexIndex, infoObject ) {\r\n\r\n\t\tvar index;\r\n\r\n\t\tswitch ( infoObject.mappingType ) {\r\n\r\n\t\t\tcase 'ByPolygonVertex' :\r\n\t\t\t\tindex = polygonVertexIndex;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'ByPolygon' :\r\n\t\t\t\tindex = polygonIndex;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'ByVertice' :\r\n\t\t\t\tindex = vertexIndex;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'AllSame' :\r\n\t\t\t\tindex = infoObject.indices[ 0 ];\r\n\t\t\t\tbreak;\r\n\t\t\tdefault :\r\n\t\t\t\tconsole.warn( 'THREE.FBXLoader: unknown attribute mapping type ' + infoObject.mappingType );\r\n\r\n\t\t}\r\n\r\n\t\tif ( infoObject.referenceType === 'IndexToDirect' ) index = infoObject.indices[ index ];\r\n\r\n\t\tvar from = index * infoObject.dataSize;\r\n\t\tvar to = from + infoObject.dataSize;\r\n\r\n\t\treturn slice( dataArray, infoObject.buffer, from, to );\r\n\r\n\t}\r\n\r\n\tvar tempEuler = new Euler();\r\n\tvar tempVec = new Vector3();\r\n\r\n\t// generate transformation from FBX transform data\r\n\t// ref: https://help.autodesk.com/view/FBX/2017/ENU/?guid=__files_GUID_10CDD63C_79C1_4F2D_BB28_AD2BE65A02ED_htm\r\n\t// ref: http://docs.autodesk.com/FBX/2014/ENU/FBX-SDK-Documentation/index.html?url=cpp_ref/_transformations_2main_8cxx-example.html,topicNumber=cpp_ref__transformations_2main_8cxx_example_htmlfc10a1e1-b18d-4e72-9dc0-70d0f1959f5e\r\n\tfunction generateTransform( transformData ) {\r\n\r\n\t\tvar lTranslationM = new Matrix4();\r\n\t\tvar lPreRotationM = new Matrix4();\r\n\t\tvar lRotationM = new Matrix4();\r\n\t\tvar lPostRotationM = new Matrix4();\r\n\r\n\t\tvar lScalingM = new Matrix4();\r\n\t\tvar lScalingPivotM = new Matrix4();\r\n\t\tvar lScalingOffsetM = new Matrix4();\r\n\t\tvar lRotationOffsetM = new Matrix4();\r\n\t\tvar lRotationPivotM = new Matrix4();\r\n\r\n\t\tvar lParentGX = new Matrix4();\r\n\t\tvar lGlobalT = new Matrix4();\r\n\r\n\t\tvar inheritType = ( transformData.inheritType ) ? transformData.inheritType : 0;\r\n\r\n\t\tif ( transformData.translation ) lTranslationM.setPosition( tempVec.fromArray( transformData.translation ) );\r\n\r\n\t\tif ( transformData.preRotation ) {\r\n\r\n\t\t\tvar array = transformData.preRotation.map( MathUtils.degToRad );\r\n\t\t\tarray.push( transformData.eulerOrder );\r\n\t\t\tlPreRotationM.makeRotationFromEuler( tempEuler.fromArray( array ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( transformData.rotation ) {\r\n\r\n\t\t\tvar array = transformData.rotation.map( MathUtils.degToRad );\r\n\t\t\tarray.push( transformData.eulerOrder );\r\n\t\t\tlRotationM.makeRotationFromEuler( tempEuler.fromArray( array ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( transformData.postRotation ) {\r\n\r\n\t\t\tvar array = transformData.postRotation.map( MathUtils.degToRad );\r\n\t\t\tarray.push( transformData.eulerOrder );\r\n\t\t\tlPostRotationM.makeRotationFromEuler( tempEuler.fromArray( array ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( transformData.scale ) lScalingM.scale( tempVec.fromArray( transformData.scale ) );\r\n\r\n\t\t// Pivots and offsets\r\n\t\tif ( transformData.scalingOffset ) lScalingOffsetM.setPosition( tempVec.fromArray( transformData.scalingOffset ) );\r\n\t\tif ( transformData.scalingPivot ) lScalingPivotM.setPosition( tempVec.fromArray( transformData.scalingPivot ) );\r\n\t\tif ( transformData.rotationOffset ) lRotationOffsetM.setPosition( tempVec.fromArray( transformData.rotationOffset ) );\r\n\t\tif ( transformData.rotationPivot ) lRotationPivotM.setPosition( tempVec.fromArray( transformData.rotationPivot ) );\r\n\r\n\t\t// parent transform\r\n\t\tif ( transformData.parentMatrixWorld ) lParentGX = transformData.parentMatrixWorld;\r\n\r\n\t\t// Global Rotation\r\n\t\tvar lLRM = lPreRotationM.multiply( lRotationM ).multiply( lPostRotationM );\r\n\t\tvar lParentGRM = new Matrix4();\r\n\t\tlParentGX.extractRotation( lParentGRM );\r\n\r\n\t\t// Global Shear*Scaling\r\n\t\tvar lParentTM = new Matrix4();\r\n\t\tlParentTM.copyPosition( lParentGX );\r\n\r\n\t\tvar lParentGSM = new Matrix4();\r\n\t\tlParentGSM.getInverse( lParentGRM ).multiply( lParentGX );\r\n\r\n\t\tvar lGlobalRS = new Matrix4();\r\n\r\n\t\tif ( inheritType === 0 ) {\r\n\r\n\t\t\tlGlobalRS.copy( lParentGRM ).multiply( lLRM ).multiply( lParentGSM ).multiply( lScalingM );\r\n\r\n\t\t} else if ( inheritType === 1 ) {\r\n\r\n\t\t\tlGlobalRS.copy( lParentGRM ).multiply( lParentGSM ).multiply( lLRM ).multiply( lScalingM );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar lParentLSM_inv = new Matrix4().getInverse( lScalingM );\r\n\t\t\tvar lParentGSM_noLocal = new Matrix4().multiply( lParentGSM ).multiply( lParentLSM_inv );\r\n\r\n\t\t\tlGlobalRS.copy( lParentGRM ).multiply( lLRM ).multiply( lParentGSM_noLocal ).multiply( lScalingM );\r\n\r\n\t\t}\r\n\r\n\t\tvar lRotationPivotM_inv = new Matrix4().getInverse( lRotationPivotM );\r\n\t\tvar lScalingPivotM_inv = new Matrix4().getInverse( lScalingPivotM );\r\n\t\t// Calculate the local transform matrix\r\n\t\tvar lTransform = new Matrix4();\r\n\t\tlTransform.copy( lTranslationM ).multiply( lRotationOffsetM ).multiply( lRotationPivotM ).multiply( lPreRotationM ).multiply( lRotationM ).multiply( lPostRotationM ).multiply( lRotationPivotM_inv ).multiply( lScalingOffsetM ).multiply( lScalingPivotM ).multiply( lScalingM ).multiply( lScalingPivotM_inv );\r\n\r\n\t\tvar lLocalTWithAllPivotAndOffsetInfo = new Matrix4().copyPosition( lTransform );\r\n\r\n\t\tvar lGlobalTranslation = new Matrix4().copy( lParentGX ).multiply( lLocalTWithAllPivotAndOffsetInfo );\r\n\t\tlGlobalT.copyPosition( lGlobalTranslation );\r\n\r\n\t\tlTransform = new Matrix4().multiply( lGlobalT ).multiply( lGlobalRS );\r\n\r\n\t\treturn lTransform;\r\n\r\n\t}\r\n\r\n\t// Returns the three.js intrinsic Euler order corresponding to FBX extrinsic Euler order\r\n\t// ref: http://help.autodesk.com/view/FBX/2017/ENU/?guid=__cpp_ref_class_fbx_euler_html\r\n\tfunction getEulerOrder( order ) {\r\n\r\n\t\torder = order || 0;\r\n\r\n\t\tvar enums = [\r\n\t\t\t'ZYX', // -> XYZ extrinsic\r\n\t\t\t'YZX', // -> XZY extrinsic\r\n\t\t\t'XZY', // -> YZX extrinsic\r\n\t\t\t'ZXY', // -> YXZ extrinsic\r\n\t\t\t'YXZ', // -> ZXY extrinsic\r\n\t\t\t'XYZ', // -> ZYX extrinsic\r\n\t\t\t//'SphericXYZ', // not possible to support\r\n\t\t];\r\n\r\n\t\tif ( order === 6 ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect.' );\r\n\t\t\treturn enums[ 0 ];\r\n\r\n\t\t}\r\n\r\n\t\treturn enums[ order ];\r\n\r\n\t}\r\n\r\n\t// Parses comma separated list of numbers and returns them an array.\r\n\t// Used internally by the TextParser\r\n\tfunction parseNumberArray( value ) {\r\n\r\n\t\tvar array = value.split( ',' ).map( function ( val ) {\r\n\r\n\t\t\treturn parseFloat( val );\r\n\r\n\t\t} );\r\n\r\n\t\treturn array;\r\n\r\n\t}\r\n\r\n\tfunction convertArrayBufferToString( buffer, from, to ) {\r\n\r\n\t\tif ( from === undefined ) from = 0;\r\n\t\tif ( to === undefined ) to = buffer.byteLength;\r\n\r\n\t\treturn LoaderUtils.decodeText( new Uint8Array( buffer, from, to ) );\r\n\r\n\t}\r\n\r\n\tfunction append( a, b ) {\r\n\r\n\t\tfor ( var i = 0, j = a.length, l = b.length; i < l; i ++, j ++ ) {\r\n\r\n\t\t\ta[ j ] = b[ i ];\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction slice( a, b, from, to ) {\r\n\r\n\t\tfor ( var i = from, j = 0; i < to; i ++, j ++ ) {\r\n\r\n\t\t\ta[ j ] = b[ i ];\r\n\r\n\t\t}\r\n\r\n\t\treturn a;\r\n\r\n\t}\r\n\r\n\t// inject array a2 into array a1 at index\r\n\tfunction inject( a1, index, a2 ) {\r\n\r\n\t\treturn a1.slice( 0, index ).concat( a2 ).concat( a1.slice( index ) );\r\n\r\n\t}\r\n\r\n\treturn FBXLoader;\r\n\r\n} )();\r\n\r\nexport { FBXLoader };\r\n","import {\r\n\tFileLoader,\r\n\tLoader,\r\n\tTexture\r\n} from \"three\";\r\n\r\nvar TGALoader = function ( manager ) {\r\n\r\n\tLoader.call( this, manager );\r\n\r\n};\r\n\r\nTGALoader.prototype = Object.assign( Object.create( Loader.prototype ), {\r\n\r\n\tconstructor: TGALoader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar texture = new Texture();\r\n\r\n\t\tvar loader = new FileLoader( this.manager );\r\n\t\tloader.setResponseType( 'arraybuffer' );\r\n\t\tloader.setPath( this.path );\r\n\t\tloader.setWithCredentials( this.withCredentials );\r\n\r\n\t\tloader.load( url, function ( buffer ) {\r\n\r\n\t\t\ttexture.image = scope.parse( buffer );\r\n\t\t\ttexture.needsUpdate = true;\r\n\r\n\t\t\tif ( onLoad !== undefined ) {\r\n\r\n\t\t\t\tonLoad( texture );\r\n\r\n\t\t\t}\r\n\r\n\t\t}, onProgress, onError );\r\n\r\n\t\treturn texture;\r\n\r\n\t},\r\n\r\n\tparse: function ( buffer ) {\r\n\r\n\t\t// reference from vthibault, https://github.com/vthibault/roBrowser/blob/master/src/Loaders/Targa.js\r\n\r\n\t\tfunction tgaCheckHeader( header ) {\r\n\r\n\t\t\tswitch ( header.image_type ) {\r\n\r\n\t\t\t\t// check indexed type\r\n\r\n\t\t\t\tcase TGA_TYPE_INDEXED:\r\n\t\t\t\tcase TGA_TYPE_RLE_INDEXED:\r\n\t\t\t\t\tif ( header.colormap_length > 256 || header.colormap_size !== 24 || header.colormap_type !== 1 ) {\r\n\r\n\t\t\t\t\t\tconsole.error( 'THREE.TGALoader: Invalid type colormap data for indexed type.' );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t// check colormap type\r\n\r\n\t\t\t\tcase TGA_TYPE_RGB:\r\n\t\t\t\tcase TGA_TYPE_GREY:\r\n\t\t\t\tcase TGA_TYPE_RLE_RGB:\r\n\t\t\t\tcase TGA_TYPE_RLE_GREY:\r\n\t\t\t\t\tif ( header.colormap_type ) {\r\n\r\n\t\t\t\t\t\tconsole.error( 'THREE.TGALoader: Invalid type colormap data for colormap type.' );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t// What the need of a file without data ?\r\n\r\n\t\t\t\tcase TGA_TYPE_NO_DATA:\r\n\t\t\t\t\tconsole.error( 'THREE.TGALoader: No data.' );\r\n\r\n\t\t\t\t\t// Invalid type ?\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.error( 'THREE.TGALoader: Invalid type \"%s\".', header.image_type );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// check image width and height\r\n\r\n\t\t\tif ( header.width <= 0 || header.height <= 0 ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.TGALoader: Invalid image size.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// check image pixel size\r\n\r\n\t\t\tif ( header.pixel_size !== 8 && header.pixel_size !== 16 &&\r\n\t\t\t\theader.pixel_size !== 24 && header.pixel_size !== 32 ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.TGALoader: Invalid pixel size \"%s\".', header.pixel_size );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// parse tga image buffer\r\n\r\n\t\tfunction tgaParse( use_rle, use_pal, header, offset, data ) {\r\n\r\n\t\t\tvar pixel_data,\r\n\t\t\t\tpixel_size,\r\n\t\t\t\tpixel_total,\r\n\t\t\t\tpalettes;\r\n\r\n\t\t\tpixel_size = header.pixel_size >> 3;\r\n\t\t\tpixel_total = header.width * header.height * pixel_size;\r\n\r\n\t\t\t // read palettes\r\n\r\n\t\t\t if ( use_pal ) {\r\n\r\n\t\t\t\t palettes = data.subarray( offset, offset += header.colormap_length * ( header.colormap_size >> 3 ) );\r\n\r\n\t\t\t }\r\n\r\n\t\t\t // read RLE\r\n\r\n\t\t\t if ( use_rle ) {\r\n\r\n\t\t\t\t pixel_data = new Uint8Array( pixel_total );\r\n\r\n\t\t\t\tvar c, count, i;\r\n\t\t\t\tvar shift = 0;\r\n\t\t\t\tvar pixels = new Uint8Array( pixel_size );\r\n\r\n\t\t\t\twhile ( shift < pixel_total ) {\r\n\r\n\t\t\t\t\tc = data[ offset ++ ];\r\n\t\t\t\t\tcount = ( c & 0x7f ) + 1;\r\n\r\n\t\t\t\t\t// RLE pixels\r\n\r\n\t\t\t\t\tif ( c & 0x80 ) {\r\n\r\n\t\t\t\t\t\t// bind pixel tmp array\r\n\r\n\t\t\t\t\t\tfor ( i = 0; i < pixel_size; ++ i ) {\r\n\r\n\t\t\t\t\t\t\tpixels[ i ] = data[ offset ++ ];\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// copy pixel array\r\n\r\n\t\t\t\t\t\tfor ( i = 0; i < count; ++ i ) {\r\n\r\n\t\t\t\t\t\t\tpixel_data.set( pixels, shift + i * pixel_size );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tshift += pixel_size * count;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t// raw pixels\r\n\r\n\t\t\t\t\t\tcount *= pixel_size;\r\n\r\n\t\t\t\t\t\tfor ( i = 0; i < count; ++ i ) {\r\n\r\n\t\t\t\t\t\t\tpixel_data[ shift + i ] = data[ offset ++ ];\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tshift += count;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t } else {\r\n\r\n\t\t\t\t// raw pixels\r\n\r\n\t\t\t\tpixel_data = data.subarray(\r\n\t\t\t\t\t offset, offset += ( use_pal ? header.width * header.height : pixel_total )\r\n\t\t\t\t);\r\n\r\n\t\t\t }\r\n\r\n\t\t\t return {\r\n\t\t\t\tpixel_data: pixel_data,\r\n\t\t\t\tpalettes: palettes\r\n\t\t\t };\r\n\r\n\t\t}\r\n\r\n\t\tfunction tgaGetImageData8bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image, palettes ) {\r\n\r\n\t\t\tvar colormap = palettes;\r\n\t\t\tvar color, i = 0, x, y;\r\n\t\t\tvar width = header.width;\r\n\r\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\r\n\r\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i ++ ) {\r\n\r\n\t\t\t\t\tcolor = image[ i ];\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = 255;\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = colormap[ ( color * 3 ) + 0 ];\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = colormap[ ( color * 3 ) + 1 ];\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = colormap[ ( color * 3 ) + 2 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn imageData;\r\n\r\n\t\t}\r\n\r\n\t\tfunction tgaGetImageData16bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image ) {\r\n\r\n\t\t\tvar color, i = 0, x, y;\r\n\t\t\tvar width = header.width;\r\n\r\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\r\n\r\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i += 2 ) {\r\n\r\n\t\t\t\t\tcolor = image[ i + 0 ] + ( image[ i + 1 ] << 8 ); // Inversed ?\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = ( color & 0x7C00 ) >> 7;\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = ( color & 0x03E0 ) >> 2;\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = ( color & 0x001F ) >> 3;\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = ( color & 0x8000 ) ? 0 : 255;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn imageData;\r\n\r\n\t\t}\r\n\r\n\t\tfunction tgaGetImageData24bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image ) {\r\n\r\n\t\t\tvar i = 0, x, y;\r\n\t\t\tvar width = header.width;\r\n\r\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\r\n\r\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i += 3 ) {\r\n\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = 255;\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = image[ i + 0 ];\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = image[ i + 1 ];\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = image[ i + 2 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn imageData;\r\n\r\n\t\t}\r\n\r\n\t\tfunction tgaGetImageData32bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image ) {\r\n\r\n\t\t\tvar i = 0, x, y;\r\n\t\t\tvar width = header.width;\r\n\r\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\r\n\r\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i += 4 ) {\r\n\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = image[ i + 0 ];\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = image[ i + 1 ];\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = image[ i + 2 ];\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = image[ i + 3 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn imageData;\r\n\r\n\t\t}\r\n\r\n\t\tfunction tgaGetImageDataGrey8bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image ) {\r\n\r\n\t\t\tvar color, i = 0, x, y;\r\n\t\t\tvar width = header.width;\r\n\r\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\r\n\r\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i ++ ) {\r\n\r\n\t\t\t\t\tcolor = image[ i ];\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = color;\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = color;\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = color;\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = 255;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn imageData;\r\n\r\n\t\t}\r\n\r\n\t\tfunction tgaGetImageDataGrey16bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image ) {\r\n\r\n\t\t\tvar i = 0, x, y;\r\n\t\t\tvar width = header.width;\r\n\r\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\r\n\r\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i += 2 ) {\r\n\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = image[ i + 0 ];\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = image[ i + 0 ];\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = image[ i + 0 ];\r\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = image[ i + 1 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn imageData;\r\n\r\n\t\t}\r\n\r\n\t\tfunction getTgaRGBA( data, width, height, image, palette ) {\r\n\r\n\t\t\tvar x_start,\r\n\t\t\t\ty_start,\r\n\t\t\t\tx_step,\r\n\t\t\t\ty_step,\r\n\t\t\t\tx_end,\r\n\t\t\t\ty_end;\r\n\r\n\t\t\tswitch ( ( header.flags & TGA_ORIGIN_MASK ) >> TGA_ORIGIN_SHIFT ) {\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\tcase TGA_ORIGIN_UL:\r\n\t\t\t\t\tx_start = 0;\r\n\t\t\t\t\tx_step = 1;\r\n\t\t\t\t\tx_end = width;\r\n\t\t\t\t\ty_start = 0;\r\n\t\t\t\t\ty_step = 1;\r\n\t\t\t\t\ty_end = height;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase TGA_ORIGIN_BL:\r\n\t\t\t\t\tx_start = 0;\r\n\t\t\t\t\tx_step = 1;\r\n\t\t\t\t\tx_end = width;\r\n\t\t\t\t\ty_start = height - 1;\r\n\t\t\t\t\ty_step = - 1;\r\n\t\t\t\t\ty_end = - 1;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase TGA_ORIGIN_UR:\r\n\t\t\t\t\tx_start = width - 1;\r\n\t\t\t\t\tx_step = - 1;\r\n\t\t\t\t\tx_end = - 1;\r\n\t\t\t\t\ty_start = 0;\r\n\t\t\t\t\ty_step = 1;\r\n\t\t\t\t\ty_end = height;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase TGA_ORIGIN_BR:\r\n\t\t\t\t\tx_start = width - 1;\r\n\t\t\t\t\tx_step = - 1;\r\n\t\t\t\t\tx_end = - 1;\r\n\t\t\t\t\ty_start = height - 1;\r\n\t\t\t\t\ty_step = - 1;\r\n\t\t\t\t\ty_end = - 1;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( use_grey ) {\r\n\r\n\t\t\t\tswitch ( header.pixel_size ) {\r\n\r\n\t\t\t\t\tcase 8:\r\n\t\t\t\t\t\ttgaGetImageDataGrey8bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 16:\r\n\t\t\t\t\t\ttgaGetImageDataGrey16bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tconsole.error( 'THREE.TGALoader: Format not supported.' );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tswitch ( header.pixel_size ) {\r\n\r\n\t\t\t\t\tcase 8:\r\n\t\t\t\t\t\ttgaGetImageData8bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image, palette );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 16:\r\n\t\t\t\t\t\ttgaGetImageData16bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 24:\r\n\t\t\t\t\t\ttgaGetImageData24bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 32:\r\n\t\t\t\t\t\ttgaGetImageData32bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tconsole.error( 'THREE.TGALoader: Format not supported.' );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Load image data according to specific method\r\n\t\t\t// var func = 'tgaGetImageData' + (use_grey ? 'Grey' : '') + (header.pixel_size) + 'bits';\r\n\t\t\t// func(data, y_start, y_step, y_end, x_start, x_step, x_end, width, image, palette );\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\t// TGA constants\r\n\r\n\t\tvar TGA_TYPE_NO_DATA = 0,\r\n\t\t\tTGA_TYPE_INDEXED = 1,\r\n\t\t\tTGA_TYPE_RGB = 2,\r\n\t\t\tTGA_TYPE_GREY = 3,\r\n\t\t\tTGA_TYPE_RLE_INDEXED = 9,\r\n\t\t\tTGA_TYPE_RLE_RGB = 10,\r\n\t\t\tTGA_TYPE_RLE_GREY = 11,\r\n\r\n\t\t\tTGA_ORIGIN_MASK = 0x30,\r\n\t\t\tTGA_ORIGIN_SHIFT = 0x04,\r\n\t\t\tTGA_ORIGIN_BL = 0x00,\r\n\t\t\tTGA_ORIGIN_BR = 0x01,\r\n\t\t\tTGA_ORIGIN_UL = 0x02,\r\n\t\t\tTGA_ORIGIN_UR = 0x03;\r\n\r\n\t\tif ( buffer.length < 19 ) console.error( 'THREE.TGALoader: Not enough data to contain header.' );\r\n\r\n\t\tvar content = new Uint8Array( buffer ),\r\n\t\t\toffset = 0,\r\n\t\t\theader = {\r\n\t\t\t\tid_length: content[ offset ++ ],\r\n\t\t\t\tcolormap_type: content[ offset ++ ],\r\n\t\t\t\timage_type: content[ offset ++ ],\r\n\t\t\t\tcolormap_index: content[ offset ++ ] | content[ offset ++ ] << 8,\r\n\t\t\t\tcolormap_length: content[ offset ++ ] | content[ offset ++ ] << 8,\r\n\t\t\t\tcolormap_size: content[ offset ++ ],\r\n\t\t\t\torigin: [\r\n\t\t\t\t\tcontent[ offset ++ ] | content[ offset ++ ] << 8,\r\n\t\t\t\t\tcontent[ offset ++ ] | content[ offset ++ ] << 8\r\n\t\t\t\t],\r\n\t\t\t\twidth: content[ offset ++ ] | content[ offset ++ ] << 8,\r\n\t\t\t\theight: content[ offset ++ ] | content[ offset ++ ] << 8,\r\n\t\t\t\tpixel_size: content[ offset ++ ],\r\n\t\t\t\tflags: content[ offset ++ ]\r\n\t\t\t};\r\n\r\n\t\t// check tga if it is valid format\r\n\r\n\t\ttgaCheckHeader( header );\r\n\r\n\t\tif ( header.id_length + offset > buffer.length ) {\r\n\r\n\t\t\tconsole.error( 'THREE.TGALoader: No data.' );\r\n\r\n\t\t}\r\n\r\n\t\t// skip the needn't data\r\n\r\n\t\toffset += header.id_length;\r\n\r\n\t\t// get targa information about RLE compression and palette\r\n\r\n\t\tvar use_rle = false,\r\n\t\t\tuse_pal = false,\r\n\t\t\tuse_grey = false;\r\n\r\n\t\tswitch ( header.image_type ) {\r\n\r\n\t\t\tcase TGA_TYPE_RLE_INDEXED:\r\n\t\t\t\tuse_rle = true;\r\n\t\t\t\tuse_pal = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase TGA_TYPE_INDEXED:\r\n\t\t\t\tuse_pal = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase TGA_TYPE_RLE_RGB:\r\n\t\t\t\tuse_rle = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase TGA_TYPE_RGB:\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase TGA_TYPE_RLE_GREY:\r\n\t\t\t\tuse_rle = true;\r\n\t\t\t\tuse_grey = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase TGA_TYPE_GREY:\r\n\t\t\t\tuse_grey = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tvar useOffscreen = typeof OffscreenCanvas !== 'undefined';\r\n\r\n\t\tvar canvas = useOffscreen ? new OffscreenCanvas( header.width, header.height ) : document.createElement( 'canvas' );\r\n\t\tcanvas.width = header.width;\r\n\t\tcanvas.height = header.height;\r\n\r\n\t\tvar context = canvas.getContext( '2d' );\r\n\t\tvar imageData = context.createImageData( header.width, header.height );\r\n\r\n\t\tvar result = tgaParse( use_rle, use_pal, header, offset, content );\r\n\t\tgetTgaRGBA( imageData.data, header.width, header.height, result.pixel_data, result.palettes );\r\n\r\n\t\tcontext.putImageData( imageData, 0, 0 );\r\n\r\n\t\treturn canvas;\r\n\r\n\t}\r\n\r\n} );\r\n\r\nexport { TGALoader };\r\n","// @ts-ignore;\r\nimport * as THREE from 'three';\r\nexport class ThreeViewUtils{\r\n  static makeCubes(scene: THREE.Scene, material: THREE.Material, data: number[]) {\r\n    const cubes = [];\r\n\r\n    const directions = [[0, 1], [1, 0], [0, -1], [-1, 0],];\r\n    const currentPosi = [0, 0];\r\n    let current = 0;\r\n    let open = directions[0];\r\n    const start = directions[0];\r\n    while(data.length) {\r\n      // @ts-ignore;\r\n      open = directions.shift();\r\n      open === start && (current+=1);\r\n      while (\r\n        data.length && (\r\n          (open[1] === 1 && currentPosi[1] < current) ||\r\n          (open[1] === -1 && currentPosi[1] > -current) ||\r\n          (open[0] === 1 && currentPosi[0] < current) ||\r\n          (open[0] === -1 && currentPosi[0] > -current)\r\n        )\r\n        ) {\r\n        data.shift();\r\n        const geometry = new THREE.BoxBufferGeometry(0.8, 1, 0.8);\r\n        // const geometry = new THREE.CylinderBufferGeometry( 0.4, 0.4, 1, 32 );\r\n        const cube = new THREE.Mesh(geometry, material);\r\n        cube.position.x = currentPosi[0];\r\n        cube.position.z = currentPosi[1];\r\n        currentPosi[0] = (currentPosi[0] + open[0]);\r\n        currentPosi[1] = (currentPosi[1] + open[1]);\r\n        scene.add(cube);\r\n        cubes.push(cube);\r\n      }\r\n      directions.push(open);\r\n    }\r\n    return cubes;\r\n  }\r\n  static makeCircles(scene: THREE.Scene, material: THREE.Material, data: number[]){\r\n    const circles: THREE.CylinderBufferGeometry = [];\r\n    const perDeg =  Math.PI * 2 / data.length;\r\n    data.forEach((data_, index) => {\r\n      const geometry = new THREE.CylinderBufferGeometry( 0.7, 0.7, 5, 32 );\r\n      const circle = new THREE.Mesh(geometry, material);\r\n      circle.position.x = Math.sin(perDeg * index) * 15;\r\n      circle.position.z = Math.cos(perDeg * index) * 15;\r\n      scene.add(circle);\r\n      circles.push(circle);\r\n    });\r\n    return circles;\r\n  }\r\n  static makePointLight(scene: THREE.Scene, color: number) {\r\n    const sphere = new THREE.SphereBufferGeometry( 0.1, 16, 8 );\r\n    const light = new THREE.PointLight( color, 2, 50 );\r\n    light.add( new THREE.Mesh( sphere, new THREE.MeshBasicMaterial( { color: color } ) ) );\r\n    scene.add( light );\r\n    return light;\r\n  }\r\n}\r\n","<template>\r\n  <div class=\"three-view\" ref=\"wrap\"></div>\r\n</template>\r\n<script>\r\n  import * as THREE from 'three';\r\n  import {ObjectLoader} from \"three/src/loaders/ObjectLoader\";\r\n  import {OrbitControls} from \"../tools/three/ctrl/OrbitControls\";\r\n  import {Rhino3dmLoader} from \"@/tools/three/jsm/loaders/3DMLoader\";\r\n  import {MD2Loader} from \"@/tools/three/jsm/loaders/MD2Loader\";\r\n  import {FBXLoader} from \"@/tools/three/jsm/loaders/FBXLoader\";\r\n  import {TGALoader} from \"@/tools/three/jsm/loaders/TGALoader\";\r\n  import {LineGeometry} from \"three/examples/jsm/lines/LineGeometry\";\r\n  import { GeometryUtils } from 'three/examples/jsm/utils/GeometryUtils';\r\n  import { LineMaterial } from 'three/examples/jsm/lines/LineMaterial';\r\n  import {ThreeViewUtils} from \"./ThreeViewUtils\";\r\n\r\n  export default {\r\n    name: 'ThreeView',\r\n    provide() {\r\n      return {}\r\n    },\r\n    components: {},\r\n    mixins: [],\r\n    props: ['index'],\r\n    inject: ['musicData'],\r\n    data() {\r\n      return {\r\n        camera: null,\r\n        scene: null,\r\n        renderer: null,\r\n        mesh: null,\r\n        light1: null,\r\n\r\n        time: 0,\r\n        width: 0, height: 0,\r\n        hasInit: false\r\n      }\r\n    },\r\n    computed: {},\r\n    methods: {\r\n      init() {\r\n\r\n        const {musicData} = this;\r\n\r\n        const container = this.$el;\r\n        const width = container.clientWidth;\r\n        const height = container.clientHeight;\r\n\r\n        const camera = this.camera = new THREE.PerspectiveCamera(30, width / height, 1, 10000);\r\n        camera.position.set(50, 50, 50);\r\n\r\n        const scene = this.scene = new THREE.Scene();\r\n\r\n        // Lights\r\n\r\n        // 环境光\r\n        scene.add(new THREE.AmbientLight(0xffffff, .3));\r\n\r\n        // 点光\r\n        this.pointLights = {\r\n          r: ThreeViewUtils.makePointLight(scene, 0xff00),\r\n          g: ThreeViewUtils.makePointLight(scene, 0x00ff00),\r\n          b: ThreeViewUtils.makePointLight(scene, 0x00ff),\r\n          rg: ThreeViewUtils.makePointLight(scene, 0xffff00),\r\n          rb: ThreeViewUtils.makePointLight(scene, 0xff00ff),\r\n          gb: ThreeViewUtils.makePointLight(scene, 0x00ffff),\r\n        };\r\n\r\n\r\n\r\n        // Renderer\r\n        const renderer = this.renderer = new THREE.WebGLRenderer();\r\n        renderer.shadowMap.enabled = true;\r\n        renderer.setPixelRatio(window.devicePixelRatio);\r\n        renderer.setSize(window.innerWidth, window.innerHeight);\r\n        renderer.domElement.className = 'three-view-canvas';\r\n        document.body.appendChild(renderer.domElement);\r\n\r\n\r\n        // Controls\r\n        const controls = new OrbitControls(camera, renderer.domElement);\r\n        controls.target.set(0, 1, 0);\r\n        controls.update();\r\n\r\n\r\n        const groundMaterial = new THREE.MeshPhongMaterial({color: 0x333333, shininess: 0});\r\n        // 地面\r\n        const ground = new THREE.Mesh(\r\n          new THREE.PlaneBufferGeometry(200, 200, 1, 1),\r\n          groundMaterial\r\n        );\r\n\r\n        ground.rotation.x = -Math.PI / 2; // rotates X/Y to X/Z\r\n        ground.receiveShadow = true;\r\n        scene.add(ground);\r\n\r\n        const material = new THREE.MeshPhysicalMaterial({\r\n          color: 0xffffff,\r\n          shininess: 10\r\n        });\r\n        this.cubes = ThreeViewUtils.makeCubes(scene, material, [...musicData.realTimeData.data]);\r\n        this.circles = ThreeViewUtils.makeCircles(scene, material, [...musicData.realTimeData.data]);\r\n\r\n        this.hasInit = true;\r\n      },\r\n      threeRenderer() {\r\n        if (this.hasInit) {\r\n          const {renderer, scene, camera, cubes, circles, time} = this;\r\n\r\n          const {avrLevel} = this.musicData.realTimeData;\r\n          const avrPer = avrLevel / 255;\r\n\r\n          this.time += avrLevel / 255 * .8 + 0.2;\r\n\r\n          Object.values(this.pointLights).forEach((light, index) => {\r\n            const index_ = index / 3 + 1;\r\n            const oriDeg = index * 120;\r\n            light.position.x = Math.sin(oriDeg + time / 30 * index_ * 1.5) * 15;\r\n            light.position.y = Math.cos(oriDeg + time / 30 * index_ * 2) * 10 + 20;\r\n            light.position.z = Math.cos(oriDeg + time / 30 * index_ * 3) * 15;\r\n          });\r\n\r\n          const data = [...this.musicData.realTimeData.data];\r\n          const perDeg =  Math.PI * 2 / data.length;\r\n          cubes && cubes.forEach((cube, index) => {\r\n            cube && (cube.scale.y = data[index] / 255 * 2.7 + 0.3);\r\n          });\r\n\r\n          circles && circles.forEach((circle, index) => {\r\n            if (circle) {\r\n              circle.scale.y = data[index] / 255 * 2.9 + 0.1;\r\n              circle.position.x = Math.sin(perDeg * index) * 30;\r\n              circle.position.z = Math.cos(perDeg * index) * 30;\r\n            }\r\n\r\n          });\r\n\r\n\r\n          renderer.render(scene, camera);\r\n        }\r\n      },\r\n    },\r\n    watch: {\r\n    },\r\n    beforeDestroy() {\r\n    },\r\n    mounted() {\r\n      this.width = this.$el.offsetWidth;\r\n      this.height = this.$el.offsetHeight;\r\n      this.init();\r\n      this.musicData.realTimeData.event.addEventListener('update', () => {\r\n        this.threeRenderer()\r\n      })\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n  .three-view {\r\n    position: absolute;\r\n    opacity: 1;\r\n    width: 100%;\r\n    height: 100%;\r\n    flex: 1 1 0;\r\n    top: 0;\r\n    left: 0;\r\n    overflow: hidden;\r\n    z-index: 2999;\r\n  }\r\n\r\n  .three-view canvas {\r\n    position: absolute;\r\n    width: 100%;\r\n    height: 100%;\r\n    left: 0;\r\n    top: 0;\r\n    z-index: 4000;\r\n  }\r\n</style>\r\n<style>\r\n  .three-view-canvas {\r\n    position: absolute;\r\n    width: 100%;\r\n    height: 100%;\r\n    left: 0;\r\n    top: 0;\r\n    z-index: 3000;\r\n  }\r\n</style>\r\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./ThreeView.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./ThreeView.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ThreeView.vue?vue&type=template&id=aaad4802&scoped=true&\"\nimport script from \"./ThreeView.vue?vue&type=script&lang=js&\"\nexport * from \"./ThreeView.vue?vue&type=script&lang=js&\"\nimport style0 from \"./ThreeView.vue?vue&type=style&index=0&id=aaad4802&lang=less&scoped=true&\"\nimport style1 from \"./ThreeView.vue?vue&type=style&index=1&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"aaad4802\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"canvas-view\"},[_c('canvas',{ref:\"canvas\",attrs:{\"width\":_vm.width,\"height\":_vm.height}})])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"canvas-view\">\r\n    <canvas ref=\"canvas\" :width=\"width\" :height=\"height\"></canvas>\r\n  </div>\r\n</template>\r\n<script>\r\n\r\n\r\n  export default {\r\n    name: 'CanvasView',\r\n    inject: [\r\n      'musicDataFlags',\r\n      'musicData',\r\n      'musicConfig',\r\n      'gameList',\r\n      'mv'\r\n    ],\r\n    data() {\r\n      return {\r\n        width: 0, height: 0,\r\n      }\r\n    },\r\n    computed: {\r\n    },\r\n    props: ['config'],\r\n    watch: {\r\n      'musicDataFlags.dataFlag': {\r\n        immediate: true,\r\n        deep: true,\r\n        handler() {\r\n          // 重新渲染的时候， 可能没初始化? // 其实是之前的被销毁了\r\n          this.$canvas && this.ctx && this.renderCanvas()\r\n        }\r\n      }\r\n    },\r\n    methods: {\r\n      renderCanvas() {\r\n        const {mv, musicData, config, musicConfig} = this;\r\n        const canvasConfig = config;\r\n        this.$canvasHidded.width = this.width = this.$el.offsetWidth;\r\n        this.$canvasHidded.height = this.height = this.$el.offsetHeight;\r\n        mv.size = canvasConfig.dataSize * 8;\r\n\r\n        const {height, width, ctx, viewCtx} = this;\r\n\r\n        const {originData, realTimeData, calculateColors} = musicData;\r\n\r\n        const {avrLevel, data} = realTimeData;\r\n        const dataBefore = originData.data;\r\n\r\n        // 拷贝并反向数据\r\n        const data1 = [...(canvasConfig.copyData ? data : [])];\r\n        data1.reverse();\r\n\r\n        let dataBefore_= [];\r\n        if (canvasConfig.showDataBefore) {\r\n          const data2 = [...(canvasConfig.copyData ? dataBefore : [])];\r\n          data2.reverse();\r\n          dataBefore_ = [...dataBefore, ...data2];\r\n          dataBefore_.reverse();\r\n        }\r\n\r\n        const renderData = [...data, ...data1, ...dataBefore_].filter(i=> canvasConfig.noZero ? i : true);\r\n        const {currentImgAviColor,  mouseMoveConf} = musicConfig;\r\n\r\n        const baseSize = [Math.min(height, width), Math.max(height, width)][canvasConfig.baseSizeType];\r\n\r\n        const midPosition = {\r\n          x: width * canvasConfig.midPositionX / 100,\r\n          y: height * canvasConfig.midPositionY / 100,\r\n        };\r\n\r\n        const mainRadius = baseSize * canvasConfig.mainRadius / 100 * (\r\n          100 - canvasConfig.avrLevelMainRadiusModify +\r\n          canvasConfig.avrLevelMainRadiusModify * avrLevel / 256\r\n        ) / 100;\r\n\r\n        const floatRange = baseSize * canvasConfig.floatRange / 100 * (\r\n          100 - canvasConfig.avrLevelFloatRangeModify +\r\n          canvasConfig.avrLevelFloatRangeModify * avrLevel / 256\r\n        ) / 100;\r\n\r\n        // 绘制背景色 // 半透明 是想保留一部分之前的绘制；\r\n        ctx.fillStyle = `rgba(0, 0, 0, ${canvasConfig.disable ? 1 : (1 - canvasConfig.clearPrevView / 100)})`;\r\n        ctx.fillRect(0, 0, this.width, this.height);\r\n\r\n        ctx.clearRect(0, 0, width, height);\r\n        viewCtx.clearRect(0, 0, width, height);\r\n\r\n        if (canvasConfig.disable) {\r\n          viewCtx.drawImage(this.$canvasHidded, 0, 0);\r\n          return;\r\n        }\r\n\r\n\r\n        // 中心区域园\r\n        ctx.fillStyle = ctx.strokeStyle = `rgba(${calculateColors[0].join(', ')}, ${canvasConfig.mainRadiusOpacity / 100})`;\r\n        ctx.lineWidth = baseSize * canvasConfig.mainRadiusLineWidth / 1000;\r\n        ctx.beginPath();\r\n        if (canvasConfig.direction === 0) {\r\n          ctx.arc(midPosition.x, midPosition.y, Math.abs(mainRadius), 0, 2 * Math.PI);\r\n        } else {\r\n\r\n        }\r\n        ctx.closePath();\r\n        ctx.stroke();\r\n\r\n\r\n        const len = renderData.length || 1; // 防 除以0 报错；\r\n        const perDeg = Math.PI * 2 / (len || 1) * canvasConfig.stepModify / 10;\r\n\r\n        const halfPerDeg = perDeg / 2;\r\n        const rotate = Math.PI * 0;\r\n\r\n        ctx.lineWidth = baseSize * canvasConfig.lineLineWidth / 1000;\r\n        const rate = canvasConfig.dataModify / 10;\r\n        const offset = 1 + canvasConfig.dataOffsetModify / 100;\r\n        ctx.closePath();\r\n        const length  = renderData.length;\r\n        const minHeight =  canvasConfig.minHeightModify / 100;\r\n        renderData.forEach((val, index) => {\r\n\r\n          val = val / 256 + minHeight;\r\n          const  nextVal = renderData[(index + 1) % length] / 256 + minHeight;\r\n          const deg = perDeg * index + rotate;\r\n\r\n          function lin1() {\r\n            const _x = (index - len/2) * canvasConfig.stepModify;\r\n            // x, y;\r\n            const point1 = [\r\n              [\r\n                Math.sin(deg) * (val * rate  + offset * mainRadius) + midPosition.x,\r\n                Math.cos(deg) * (val * rate  + offset * mainRadius)+ midPosition.y\r\n              ], [\r\n                midPosition.x + _x,\r\n                -(val * rate  + offset * mainRadius)+ midPosition.y,\r\n              ]\r\n            ][canvasConfig.direction];\r\n            const point2 = [\r\n              [\r\n                Math.sin(deg) * (val * rate * floatRange * 3 + offset*mainRadius) + midPosition.x,\r\n                Math.cos(deg) * (val * rate * floatRange * 3 + offset*mainRadius)+ midPosition.y\r\n              ],[\r\n                midPosition.x + _x,\r\n                -(val * rate * floatRange * 3 + offset*mainRadius)+ midPosition.y,\r\n              ]\r\n            ][canvasConfig.direction];\r\n            const lr = ctx.createLinearGradient(\r\n              point1[0],\r\n              point1[1],\r\n              point2[0],\r\n              point2[1],\r\n            );\r\n            lr.addColorStop(1, `rgba(${calculateColors[0].join(', ')}, 1)`);\r\n            lr.addColorStop(.75, `rgba(${calculateColors[1].join(', ')}, 1)`);\r\n            lr.addColorStop(0, `rgba(${calculateColors[1].join(', ')}, 1)`);\r\n            ctx.strokeStyle = lr;\r\n            ctx.beginPath();\r\n            ctx.moveTo(point1[0], point1[1]);\r\n            ctx.lineTo(point2[0], point2[1]);\r\n            ctx.closePath();\r\n            ctx.stroke();\r\n          }\r\n\r\n          const edge = val * rate * floatRange * 3+ mainRadius;\r\n          function line(){\r\n            ctx.strokeStyle = `rgba(${calculateColors[1].join(', ')}, ${avrLevel * 2/255 + 0.25})`;\r\n            const nextEdge = nextVal * rate * floatRange * 3 + mainRadius;\r\n            ctx.beginPath();\r\n            ctx.moveTo(\r\n              Math.sin(deg) *edge + midPosition.x,\r\n              Math.cos(deg) * edge+ midPosition.y\r\n            );\r\n            ctx.bezierCurveTo(\r\n              Math.sin(deg+perDeg/3) * edge + midPosition.x,\r\n              Math.cos(deg+perDeg/3) * edge+ midPosition.y,\r\n              Math.sin(deg+perDeg/3*2) * nextEdge + midPosition.x,\r\n              Math.cos(deg+perDeg/3*2) * nextEdge+ midPosition.y,\r\n              Math.sin(deg+perDeg) * nextEdge + midPosition.x,\r\n              Math.cos(deg+perDeg) * nextEdge+ midPosition.y,\r\n            );\r\n\r\n            ctx.closePath();\r\n            ctx.stroke();\r\n          }\r\n          // lin1();\r\n          // line();\r\n          // dot();\r\n\r\n          ;[\r\n            lin1,\r\n            line,\r\n            rect,\r\n            dot\r\n          ][canvasConfig.renderType]()\r\n\r\n          function dot() {\r\n            ctx.fillStyle = `rgba(${calculateColors[1].join(', ')}, 1)`;\r\n            ctx.beginPath();\r\n\r\n            const _x = (index - len/2) * canvasConfig.stepModify + midPosition.x;\r\n            const position =[\r\n              [\r\n                Math.sin(deg) * edge + midPosition.x,\r\n                Math.cos(deg) * edge+ midPosition.y,\r\n              ],[\r\n                _x,\r\n                -(val * rate * floatRange * 3 + offset*mainRadius)+ midPosition.y\r\n              ]\r\n            ][canvasConfig.direction] || [];\r\n            const x = position[0];\r\n            const y = position[1];\r\n            ctx.arc(\r\n              x, y,\r\n              baseSize * canvasConfig.lineLineWidth / 1000,\r\n              0, 2 * Math.PI\r\n            );\r\n            ctx.closePath();\r\n            ctx.fill();\r\n          }\r\n          function rect() {\r\n            ctx.strokeStyle = `rgba(${calculateColors[1].join(', ')}, 1)`;\r\n            ctx.beginPath();\r\n            let renderVal = (val * rate  - canvasConfig.threshold / 10) * floatRange;\r\n            renderVal < 0 &&(renderVal = 0);\r\n            const dots = [\r\n              [ // 左\r\n                Math.sin(deg-halfPerDeg) * (mainRadius) + midPosition.x,\r\n                Math.cos(deg-halfPerDeg) * (mainRadius)+ midPosition.y\r\n              ],\r\n              [ // 右\r\n                Math.sin(deg+halfPerDeg) * (mainRadius) + midPosition.x,\r\n                Math.cos(deg+halfPerDeg) * (mainRadius)+ midPosition.y\r\n              ],\r\n              [ // 上\r\n                Math.sin(deg) * (-renderVal+ mainRadius) + midPosition.x,\r\n                Math.cos(deg) * (-renderVal+ mainRadius)+ midPosition.y\r\n              ],\r\n              [ // 下\r\n                Math.sin(deg) * (renderVal+ mainRadius) + midPosition.x,\r\n                Math.cos(deg) * (renderVal+ mainRadius)+ midPosition.y\r\n              ],\r\n            ];\r\n            ;[0,2,1,3,0,2].forEach(item => {\r\n              ctx.lineTo.apply(ctx, dots[item]);\r\n            })\r\n            ctx.closePath();\r\n            ctx.stroke();\r\n          }\r\n        });\r\n        ctx.closePath();\r\n        viewCtx.drawImage(this.$canvasHidded, 0, 0);\r\n      }\r\n    },\r\n    mounted() {\r\n      this.$canvas = this.$refs.canvas;\r\n      this.viewCtx = this.$canvas.getContext(\"2d\");\r\n      this.$canvasHidded = window.OffscreenCanvas ?\r\n        new OffscreenCanvas(this.$canvas.width, this.$canvas.height) :\r\n        document.createElement('canvas');\r\n\r\n      this.ctx = this.$canvasHidded.getContext(\"2d\");\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n  .canvas-view {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    opacity: 1;\r\n    width: 100%;\r\n    height: 100%;\r\n    flex: 1 1 0;\r\n    overflow: hidden;\r\n    z-index: 2900;\r\n  }\r\n\r\n  .canvas-view canvas {\r\n    position: relative;\r\n    width: 100%;\r\n    height: 100%;\r\n  }\r\n</style>\r\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./CanvasView.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./CanvasView.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./CanvasView.vue?vue&type=template&id=bd352cee&scoped=true&\"\nimport script from \"./CanvasView.vue?vue&type=script&lang=js&\"\nexport * from \"./CanvasView.vue?vue&type=script&lang=js&\"\nimport style0 from \"./CanvasView.vue?vue&type=style&index=0&id=bd352cee&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"bd352cee\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"canvas-view\"},[_c('canvas',{ref:\"canvas\",attrs:{\"width\":_vm.width,\"height\":_vm.height}})])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\r\nimport {GetType} from \"@/tools/GetType\";\r\nexport class Random {\r\n  exec() {\r\n    const {max_, min_, sign_} = this;\r\n    return Random.exec(max_, min_, sign_);\r\n  }\r\n  sign() {\r\n    this.sign_ = -1;\r\n    return this;\r\n  }\r\n  min(min) {\r\n    GetType.isNumber(min) && (this.min_ = min);\r\n    return this;\r\n  }\r\n\r\n  max(max) {\r\n    GetType.isNumber(max) && (this.max_ = max);\r\n    return this;\r\n  }\r\n\r\n  int(size, unique) {\r\n    const {max_, min_, sign_,} = this;\r\n    return Random.int(max_, min_, sign_, size, unique)\r\n  }\r\n\r\n  static exec(max_, min_, sign_) {\r\n    let val = Math.random();\r\n    GetType.isNumber(max_) && (val = val * max_);\r\n    GetType.isNumber(min_) && (val = val + min_);\r\n    sign_ && (val = val * -1);\r\n    return val;\r\n  }\r\n\r\n  static int(max = 1, min = 0, sign){\r\n    return (sign && Random.boolean() ? -1 : 1) * Math.round(Math.random() * max + min)\r\n  }\r\n  static boolean() {\r\n    return Math.round(Math.random());\r\n  }\r\n  static time(){\r\n    return Date.now().toString();\r\n  }\r\n  boolean(){\r\n    return  Random.boolean(size, rate)\r\n  }\r\n}\r\n\r\nexport function random() {\r\n  return new Random()\r\n}\r\n\r\n","const aisleMap = {\r\n  r: 0, g: 1, b: 2, a: 3\r\n};\r\ntype TAisleType = keyof typeof aisleMap;\r\n// @ts-ignore;\r\nimport {Random, random} from \"@/tools/random\";\r\nexport class PS {\r\n  aisleMap = aisleMap;\r\n  imageData: ImageData;\r\n\r\n  static cutFnMap: {[index: number]: () => number} = {\r\n    1: () => 255,\r\n    2: () => 0,\r\n    3: () => Random.int(255,0)\r\n  };\r\n  constructor(imageData: ImageData) {\r\n    this.imageData = imageData;\r\n  }\r\n\r\n  getAisle(aisleType: TAisleType, cutType: number = 0) {\r\n    const offset = this.aisleMap[aisleType];\r\n    if (offset === undefined) return [];\r\n    const {data, width, height} = this.imageData;\r\n\r\n    const ret: number[][] = [];\r\n    for (let y = 0; y < height; y++) {\r\n      const line: number[] = [];\r\n      ret.push(line);\r\n      const cur = width * y;\r\n      for (let x = 0; x < width; x++) {\r\n        line.push(data[(cur + x) * 4 + offset]);\r\n        cutType && (data[(cur + x) * 4 + offset] = PS.cutFnMap[cutType] &&  PS.cutFnMap[cutType]() || 255);\r\n      }\r\n    }\r\n    return ret;\r\n  }\r\n\r\n  aisleOffset(aisleType: TAisleType, xOffset = 0, yOffset = 0, zoom: number = 1, cutType: number = 0) {\r\n    const offset = this.aisleMap[aisleType];\r\n    if (offset === undefined) return;\r\n    const aisleData = this.getAisle(aisleType, cutType);\r\n    const {data, width, height} = this.imageData;\r\n    for (let y = 0; y < height; y++) {\r\n      const line = aisleData[y + yOffset] || {};\r\n      const cur = width * (y + yOffset) + xOffset;\r\n      for (let x = 0; x < width; x++) {\r\n        data[(cur + x) * 4 + offset] = (line[x] || 0) * zoom;\r\n      }\r\n    }\r\n  }\r\n}\r\n","<template>\r\n  <div class=\"canvas-view\">\r\n    <canvas ref=\"canvas\" :width=\"width\" :height=\"height\"></canvas>\r\n  </div>\r\n</template>\r\n<script>\r\n  import {Random, random} from \"../tools/random\";\r\n  import {PS} from \"../tools/PS\";\r\n\r\n\r\n  export default {\r\n    name: 'CanvasPic',\r\n    inject: [\r\n      'musicDataFlags',\r\n      'musicData',\r\n      'musicConfig',\r\n      'gameList',\r\n      'mv',\r\n      'modifyManager',\r\n      'commonOptions_'\r\n    ],\r\n    data() {\r\n      return {\r\n        width: 0,\r\n        height: 0,\r\n        count: 0,\r\n        thisCount: 0,\r\n        imgCtx: null,\r\n        shallMalfunction: 0,\r\n      }\r\n    },\r\n    watch: {\r\n      'musicDataFlags.shockFlag': {\r\n        immediate: true,\r\n        handler() {\r\n          // 重新渲染的时候， 可能没初始化? // 其实是之前的被销毁了\r\n          this.commonOptions_.CanvasPicMalfunction && (this.shallMalfunction = 2);\r\n        }\r\n      },\r\n\r\n      'musicDataFlags.dataFlag': {\r\n        immediate: true,\r\n        handler() {\r\n          // 重新渲染的时候， 可能没初始化? // 其实是之前的被销毁了\r\n          this.$canvas && this.ctx && this.renderCanvas();\r\n        }\r\n      }\r\n    },\r\n    methods: {\r\n      renderCanvas() {\r\n\r\n        const {height, width, ctx, imgCtx, musicConfig, musicData} = this;\r\n        const {realTimeData} = musicData;\r\n        const {avrLevel} = realTimeData;\r\n        ctx.putImageData(musicConfig.getImageData(0, 0, width, height), 0, 0);\r\n\r\n        if (this.shallMalfunction) {\r\n          const list = [0, 1, 2, 3, 4, 5];\r\n\r\n          function blur(id, x, y) {\r\n            return `<filter id=\"${id}\"><feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"${x},${y}\"></feGaussianBlur></filter>`;\r\n          }\r\n          document.querySelector('#svg-all').innerHTML = `<defs>${\r\n            list.map(item => blur(`blur${item * 2}`, 0, item ? avrLevel / 255 / item * 20 : 0)).join('')\r\n          }${\r\n            list.map(item => blur(`blur${item * 2}-v`, item ? avrLevel / 255 / item * 20 : 0, 0)).join('')\r\n          }${\r\n            list.map(item => blur(`blur${item * 2}--45`, item ? avrLevel / 255 / item * 20 : 0, 0)).join('')\r\n          }</defs>`;\r\n        }\r\n        const des = (index_ = 0) => {\r\n\r\n          const w = index_ ? Random.int(width, width / (index_ + index_ * .2)) : width;\r\n          const h = index_ ? Random.int(height, height / (index_ * 5)) : height / 10;\r\n          const x = (width - w) / 2;\r\n          const y = (height - h) / 2 + Random.int(h / 2, 0, true);\r\n\r\n          const imageData = musicConfig.getImageData(x, y, w, h);\r\n          if (!imageData) return;\r\n\r\n          const ps = new PS(imageData);\r\n          const dirR = Random.boolean();\r\n          const max = avrLevel / 4;\r\n\r\n          if (this.shallMalfunction) {\r\n            const fnMap = [\r\n              (off) => ps.aisleOffset('r', dirR ? off : 0, dirR ? 0 : off, undefined, Random.int(3, 0)),\r\n              (off) => ps.aisleOffset('g', dirR ? off : 0, dirR ? 0 : off, undefined, Random.int(3, 0)),\r\n              (off) => ps.aisleOffset('b', dirR ? off : 0, dirR ? 0 : off, undefined, Random.int(3, 0)),\r\n            ];\r\n\r\n            const index = Random.int(2, 0);\r\n            fnMap[index](Random.int(max, max / 2, true));\r\n            Random.boolean() && fnMap[(index + 1) % fnMap.length](Random.int(max, max / 3, true));\r\n            Random.boolean() && fnMap[(index + 2) % fnMap.length](Random.int(max, max / 4, true));\r\n            ctx.putImageData(ps.imageData, x + Random.int(20 * index_, 0, true), y + Random.int(10 * index_, 0, true));\r\n          }\r\n          ctx.putImageData(imageData, x, y);\r\n\r\n\r\n        }\r\n        if (musicConfig.picDom && this.shallMalfunction === 2) {\r\n          des(0);\r\n          // des(1);\r\n          // des(2);\r\n        }\r\n\r\n        this.viewCtx.drawImage(this.$canvasHidded, 0, 0);\r\n        this.shallMalfunction && (this.shallMalfunction --);\r\n      }\r\n    },\r\n    mounted() {\r\n      this.$canvas = this.$refs.canvas;\r\n      this.viewCtx = this.$canvas.getContext(\"2d\");\r\n      this.$canvasHidded = window.OffscreenCanvas ?\r\n        new OffscreenCanvas(this.$canvas.width, this.$canvas.height) :\r\n        document.createElement('canvas');\r\n\r\n      this.$canvasImage = window.OffscreenCanvas ?\r\n        new OffscreenCanvas(this.$canvas.width, this.$canvas.height) :\r\n        document.createElement('canvas');\r\n\r\n      this.$canvasImage.width = this.$canvasHidded.width = this.width = this.$el.offsetWidth;\r\n      this.$canvasImage.height = this.$canvasHidded.height = this.height = this.$el.offsetHeight;\r\n\r\n      this.ctx = this.$canvasHidded.getContext(\"2d\");\r\n      this.imgCtx = this.$canvasImage.getContext(\"2d\");\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" type=\"text/less\" scoped>\r\n  .canvas-view {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    opacity: 0.4;\r\n    width: 100%;\r\n    height: 100%;\r\n    flex: 1 1 0;\r\n    overflow: hidden;\r\n    z-index: 2900;\r\n  }\r\n\r\n  .canvas-view canvas {\r\n    position: relative;\r\n    width: 100%;\r\n    height: 100%;\r\n  }\r\n</style>\r\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./CanvasPic.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./CanvasPic.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./CanvasPic.vue?vue&type=template&id=0226e92a&scoped=true&\"\nimport script from \"./CanvasPic.vue?vue&type=script&lang=js&\"\nexport * from \"./CanvasPic.vue?vue&type=script&lang=js&\"\nimport style0 from \"./CanvasPic.vue?vue&type=style&index=0&id=0226e92a&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0226e92a\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"canvas-view\"},[_c('div',{style:(_vm.textStyle)},[_vm._v(\"Happy new Year!\")])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"canvas-view\">\r\n    <div :style=\"textStyle\">Happy new Year!</div>\r\n  </div>\r\n</template>\r\n<script>\r\n  import {Random, } from \"../tools/random\";\r\n  import {musicConfig} from \"../music/MusicConfig\";\r\n\r\n  export default {\r\n    name: 'CanvasText',\r\n    inject: [\r\n      'musicDataFlags',\r\n      'musicData',\r\n      'musicConfig',\r\n      'gameList',\r\n      'mv',\r\n      'modifyManager',\r\n      'navList'\r\n    ],\r\n    data() {\r\n      return {\r\n        width: 0,\r\n        height: 0,\r\n        count: 0,\r\n        thisCount: 0,\r\n        imgCtx: null,\r\n        textStyle: ''\r\n      }\r\n    },\r\n    computed: {},\r\n    watch: {\r\n      'musicDataFlags.dataFlag': {\r\n        immediate: true,\r\n        handler() {\r\n          const {realTimeData, calculateColors} = musicData;\r\n          const {avrLevel} = realTimeData;\r\n          const per = avrLevel / 255;\r\n          const rate = Math.round(avrLevel / 255 * 100) + 10;\r\n          const opa = avrLevel / 255 + .75;\r\n          const scale = avrLevel / 255 / 2 + .75;\r\n          this.textStyle = `text-shadow: ${[\r\n            `0 0 ${rate}px #fff`,\r\n            `0 0 ${rate * 2}px #fff`,\r\n            `0 0 ${rate * 3}px #fff`,\r\n            `0 0 ${rate * 4}px #fff`,\r\n            `0 0 ${rate * 5}px #ff5722`,\r\n            `0 0 ${rate * 6}px #ff5722`,\r\n            `0 0 ${rate * 7}px #ff5722`,\r\n            `0 0 ${rate * 8}px #ff5722`,\r\n          ].join(',')}; opacity: ${opa > 1 ? 1 : opa}; transform: translate3d(0,0,0) scale(${scale}, ${scale}) rotate(${Random.exec(per*3, per*-3,)}deg)`;\r\n        }\r\n      }\r\n    },\r\n    methods: {}\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n  .canvas-view {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    opacity: 1;\r\n    width: 100%;\r\n    height: 100%;\r\n    flex: 1 1 0;\r\n    overflow: hidden;\r\n    z-index: 2900;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    padding-bottom: 40vh;\r\n    font-size: 120px;\r\n    font-family: \"微软雅黑\";\r\n    filter: brightness(110%);\r\n\r\n  }\r\n\r\n  .canvas-view canvas {\r\n    position: relative;\r\n    width: 100%;\r\n    height: 100%;\r\n    will-change: opacity, box-shadow, transform;\r\n  }\r\n</style>\r\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./CanvasTitle.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./CanvasTitle.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./CanvasTitle.vue?vue&type=template&id=7a6a75bb&scoped=true&\"\nimport script from \"./CanvasTitle.vue?vue&type=script&lang=js&\"\nexport * from \"./CanvasTitle.vue?vue&type=script&lang=js&\"\nimport style0 from \"./CanvasTitle.vue?vue&type=style&index=0&id=7a6a75bb&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"7a6a75bb\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"canvas-view\"},[_c('canvas',{ref:\"canvas\",attrs:{\"width\":_vm.width,\"height\":_vm.height}})])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"canvas-view\">\r\n    <canvas ref=\"canvas\" :width=\"width\" :height=\"height\"></canvas>\r\n  </div>\r\n</template>\r\n<script>\r\n  import {Random} from \"../tools/random\";\r\n  import {PS} from \"../tools/PS\";\r\n  import {Picture} from \"../picture/Picture\";\r\n\r\n  export default {\r\n    name: 'CanvasText',\r\n    inject: [\r\n      'musicDataFlags',\r\n      'musicData',\r\n      'musicConfig',\r\n      'gameList',\r\n      'mv',\r\n      'modifyManager'\r\n    ],\r\n    data() {\r\n      return {\r\n        width: 0,\r\n        height: 0,\r\n        count: 0,\r\n        thisCount: 0,\r\n        imgCtx: null,\r\n        shallMalfunction: false,\r\n        size: 0,\r\n      }\r\n    },\r\n    watch: {\r\n      'musicDataFlags.dataFlag': {\r\n        immediate: true,\r\n        handler() {\r\n          this.$canvas && this.ctx && this.renderCanvas();\r\n        }\r\n      },\r\n      'musicDataFlags.shockFlag': {\r\n        immediate: true,\r\n        handler() {\r\n          this.modifyManager.getTrackByName('CommonOptionsTrack').getVal('CanvasTextMalfunction') && (this.shallMalfunction = true);\r\n          this.size = 0;\r\n        }\r\n      }\r\n    },\r\n    methods: {\r\n      renderCanvas() {\r\n        const {height, width, ctx, imgCtx, musicConfig, viewCtx, musicData} = this;\r\n        const {realTimeData, calculateColors} = musicData;\r\n        const {avrLevel} = realTimeData;\r\n\r\n        const w = width;\r\n        const h = 100;\r\n        const x = width / 2;\r\n        const y = height * .66;\r\n        let size =\r\n          this.size =\r\n            this.size ||\r\n            160 + Random.int(10 * avrLevel / 255, 0, true) - (musicConfig.lrc || '').length * 1.5;\r\n\r\n        // 清除原先的画布\r\n        ctx.clearRect(0, 0, width, height);\r\n        viewCtx.clearRect(0, 0, width, height);\r\n\r\n        if (musicConfig.lrc) {\r\n          ctx.fillStyle = `rgba(0,0,0,.5)`;\r\n          ctx.fillRect(0, height / 7 * 3.9, width, height / 7 * 1.3);\r\n        }\r\n\r\n        // 庞门正道标题体\r\n        ctx.font = `${size}px pmzdbtt`;\r\n\r\n\r\n        const measureText = ctx.measureText(musicConfig.lrc);\r\n        if (measureText.width > (width - 100)) {\r\n          size =\r\n            this.size =\r\n              Math.floor(this.size /measureText.width * (width - 100));\r\n          ctx.font = `${size}px pmzdbtt`;\r\n        }\r\n        // 字体居中\r\n        ctx.textAlign = 'center';\r\n        ctx.textBaseline = 'middle';\r\n        ctx.lineWidth = 1;\r\n\r\n        const percent = avrLevel / 255;\r\n        const offset = percent * size / 4 + 4;\r\n        ctx.strokeStyle = `rgba(${calculateColors[1].map(i => 255).join(', ')}, ${percent})`;\r\n        ctx.strokeText(musicConfig.lrc, x + offset, y - offset);\r\n\r\n\r\n        const pattern = ctx.createPattern(Picture.pciCanvas,\"repeat\");\r\n        ctx.fillStyle = pattern;\r\n        ctx.fillText(musicConfig.lrc, x + offset, y - offset);\r\n\r\n        ctx.strokeStyle = `rgba(${calculateColors[1].map(i => 255).join(', ')}, ${percent * 0.8})`;\r\n        ctx.strokeText(musicConfig.lrc, x + offset / 2, y - offset / 2);\r\n\r\n\r\n        ctx.fillStyle = `rgba(255,255,255,.3)`;\r\n        ctx.fillText(musicConfig.lrc, x + offset / 2, y - offset / 2);\r\n\r\n\r\n        ctx.strokeStyle = `rgba(${calculateColors[1].map(i => 255 - i).join(', ')}, 1)`;\r\n        ctx.strokeText(musicConfig.lrc, x, y);\r\n\r\n\r\n        ctx.fillStyle = `rgba(${calculateColors[1].join(', ')}, 0.3)`;\r\n        ctx.fillText(musicConfig.lrc, x, y);\r\n\r\n\r\n\r\n\r\n        const des = (index_ = 0) => {\r\n          const W = ctx.measureText(musicConfig.lrc).width || 1;\r\n          if (!W) return;\r\n\r\n          const _w = W;\r\n          const _h = size * index_ / 4;\r\n          const __x = 0;\r\n          const __y = size;\r\n\r\n          const _x = (width - _w) / 2;\r\n          const _y = y - __y / 2 + Random.int(size - _h, 0);\r\n\r\n          if (_h < 0) return;\r\n          const imageData = ctx.getImageData(_x, _y, _w, _h);\r\n\r\n          const ps = new PS(imageData);\r\n          const max = (h - size) / 4;\r\n\r\n          if (this.shallMalfunction) {\r\n            const fnMap = [\r\n              () => ps.aisleOffset('r', Random.int(max, max / 2, true), Random.int(max, max / 2, true)),\r\n              () => ps.aisleOffset('g', Random.int(max, max / 3, true), Random.int(max, max / 3, true)),\r\n              () => ps.aisleOffset('b', Random.int(max, max / 4, true), Random.int(max, max / 4, true)),\r\n            ];\r\n            const len = fnMap.length;\r\n            let index = Random.int(2, 0);\r\n            fnMap[index]();\r\n            Random.boolean() && fnMap[++index % len]();\r\n            Random.boolean() && fnMap[++index % len]();\r\n          }\r\n\r\n          ctx.putImageData(ps.imageData, _x, _y);\r\n\r\n          viewCtx.drawImage(this.$canvasHidded, 0, 0);\r\n        };\r\n        if (musicConfig.picDom) {\r\n          des(1);\r\n          des(2);\r\n          des(3);\r\n        }\r\n        this.shallMalfunction = false;\r\n      }\r\n    },\r\n    mounted() {\r\n      this.$canvas = this.$refs.canvas;\r\n      this.viewCtx = this.$canvas.getContext(\"2d\");\r\n      this.$canvasHidded = window.OffscreenCanvas ?\r\n        new OffscreenCanvas(this.$canvas.width, this.$canvas.height) :\r\n        document.createElement('canvas');\r\n\r\n      this.$canvasImage = window.OffscreenCanvas ?\r\n        new OffscreenCanvas(this.$canvas.width, this.$canvas.height) :\r\n        document.createElement('canvas');\r\n\r\n      this.$canvasImage.width = this.$canvasHidded.width = this.width = this.$el.offsetWidth;\r\n      this.$canvasImage.height = this.$canvasHidded.height = this.height = this.$el.offsetHeight;\r\n\r\n      this.ctx = this.$canvasHidded.getContext(\"2d\");\r\n      this.imgCtx = this.$canvasImage.getContext(\"2d\");\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n  .canvas-view {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    flex: 1 1 0;\r\n    overflow: hidden;\r\n    opacity: 0.8;\r\n    z-index: 2900;\r\n  }\r\n\r\n  .canvas-view canvas {\r\n    position: relative;\r\n    width: 100%;\r\n    height: 100%;\r\n  }\r\n</style>\r\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./CanvasText.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./CanvasText.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./CanvasText.vue?vue&type=template&id=3153c9aa&scoped=true&\"\nimport script from \"./CanvasText.vue?vue&type=script&lang=js&\"\nexport * from \"./CanvasText.vue?vue&type=script&lang=js&\"\nimport style0 from \"./CanvasText.vue?vue&type=style&index=0&id=3153c9aa&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3153c9aa\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"canvas-view\"},[_c('video',{attrs:{\"src\":_vm.src,\"autoplay\":\"autoplay\",\"muted\":\"\"},domProps:{\"muted\":true},on:{\"ended\":_vm.handelEnded}})])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"canvas-view\">\r\n    <video :src=\"src\" autoplay=\"autoplay\" muted @ended=\"handelEnded\"></video>\r\n  </div>\r\n</template>\r\n<script>\r\n\r\n\r\n  export default {\r\n    name: 'VideoView',\r\n    provide() {\r\n      return {}\r\n    },\r\n    components: {},\r\n    mixins: [],\r\n    props: ['index'],\r\n    inject: [\r\n      'musicDataFlags',\r\n      'musicData',\r\n      'musicConfig',\r\n      'gameList',\r\n      'mv',\r\n      'modifyManager'\r\n    ],\r\n    data() {\r\n      return {\r\n        ended: true,\r\n        shallChange: false,\r\n        current: this.index,\r\n        src: '',\r\n        srcs: [\r\n          './videos/1.mp4',\r\n          './videos/2.mp4',\r\n          './videos/3.mp4',\r\n          './videos/4.mp4',\r\n        ],\r\n        width: 0, height: 0,\r\n        play: () => {\r\n          // this.$refs.video && this.$refs.video.play();\r\n        }\r\n      }\r\n    },\r\n    computed: {\r\n      changeVideo(){\r\n        return this.musicData.soundTrackArr.find(item => item.isChangeDot)\r\n      },\r\n    },\r\n    methods: {\r\n      handelEnded(){\r\n        this.ended = true;\r\n      },\r\n    },\r\n    watch: {\r\n      'musicDataFlags.shockFlag'(){\r\n        if (this.ended) {\r\n          this.current ++;\r\n          this.src = this.srcs[this.current%this.srcs.length];\r\n          this.ended = false;\r\n        }\r\n      },\r\n    },\r\n    beforeDestroy(){\r\n      document.removeEventListener('click', this.play);\r\n    },\r\n    mounted() {\r\n      document.addEventListener('click', this.play);\r\n      this.play();\r\n      this.width = this.$el.offsetWidth;\r\n      this.height = this.$el.offsetHeight;\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n  .canvas-view {\r\n    position: absolute;\r\n    opacity: 1;\r\n    width: 100%;\r\n    height: 100%;\r\n    flex: 1 1 0;\r\n    top: 0;\r\n    left: 0;\r\n    overflow: hidden;\r\n    z-index: 2950;\r\n    background-blend-mode: lighten;\r\n    mix-blend-mode: lighten;\r\n  }\r\n\r\n  .canvas-view video {\r\n    position: absolute;\r\n    width: 100%;\r\n    height: 100%;\r\n    left: 0;\r\n    top: 0;\r\n  }\r\n</style>\r\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./VideoView.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./VideoView.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./VideoView.vue?vue&type=template&id=3830f794&scoped=true&\"\nimport script from \"./VideoView.vue?vue&type=script&lang=js&\"\nexport * from \"./VideoView.vue?vue&type=script&lang=js&\"\nimport style0 from \"./VideoView.vue?vue&type=style&index=0&id=3830f794&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3830f794\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"dom-clock\"},_vm._l((_vm.time),function(list,index){return _c('div',{style:(_vm.d3wrapStyle)},_vm._l((list),function(list_,index_){return _c('div',[(index_)?[_c('span',[_vm._v(_vm._s(index ? ':' : '-'))])]:_vm._e(),_vm._l((list_),function(num){return [_c('DomClockItem',{attrs:{\"num\":num}})]})],2)}),0)}),0)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","export class Time {\r\n  static format(stamp?: Date, format = `yea-mon-dat`){\r\n    const time  = stamp || new Date();\r\n    return  format.replace(/yea/g, time.getFullYear().toString())\r\n      .replace(/mon/g, Time.to00(time.getMonth() + 1))\r\n      .replace(/dat/g, Time.to00(time.getDate()))\r\n      .replace(/hou/g, Time.to00(time.getHours()))\r\n      .replace(/min/g, Time.to00(time.getMinutes()))\r\n      .replace(/sec/g, Time.to00(time.getSeconds()))\r\n      .replace(/mis/g, Time.to000(time.getMilliseconds()))\r\n  }\r\n  static to00(num: number){ return num>9 ? `${num}` : `0${num}`}\r\n  static to000(num: number){ return num>99 ? `${num}` : `0${Time.to00(num)}`}\r\n}\r\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"dom-clock-item-wrap\"},[_c('div',{staticClass:\"dom-clock-item\"},_vm._l((_vm.list),function(num,index){return _c('div',{class:{track: true}},[_c('div')])}),0),_c('div',{staticClass:\"dom-clock-item\"},_vm._l((_vm.list),function(num,index){return _c('div',{class:{active: num}},[_c('div')])}),0)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"dom-clock-item-wrap\">\r\n    <div class=\"dom-clock-item\">\r\n      <div v-for=\"(num, index) in list\" :class=\"{track: true}\">\r\n        <div></div>\r\n      </div>\r\n    </div>\r\n    <div class=\"dom-clock-item\">\r\n      <div v-for=\"(num, index) in list\" :class=\"{active: num}\">\r\n        <div></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n</template>\r\n<script>\r\n  import {musicData, musicDataFlags} from \"../music/Music\";\r\n  const list = [\r\n    [1, 1, 1, 1, 1, 1, 0],\r\n    [0, 1, 1, 0, 0, 0, 0],\r\n    [1, 1, 0, 1, 1, 0, 1],\r\n    [1, 1, 1, 1, 0, 0, 1],\r\n    [0, 1, 1, 0, 0, 1, 1],\r\n    [1, 0, 1, 1, 0, 1, 1],\r\n    [1, 0, 1, 1, 1, 1, 1],\r\n    [1, 1, 1, 0, 0, 0, 0],\r\n    [1, 1, 1, 1, 1, 1, 1],\r\n    [1, 1, 1, 1, 0, 1, 1],\r\n  ];\r\n  export default {\r\n    name: 'DomClockItem',\r\n    props: ['num'],\r\n    data(){\r\n      return {\r\n        musicData,\r\n        musicDataFlags\r\n      }\r\n    },\r\n    computed: {\r\n      list() {\r\n        return list[this.num]\r\n      },\r\n      // wrapStyle(){\r\n      //   const {data, avrLevel, total, cacheList, calculateColors} = this.musicData;\r\n      //   this.musicDataFlags.dataFlag;\r\n      //   return {\r\n      //     '--animateTime': `${.3 - avrLevel / 255 * 0.3}s`,\r\n      //     '--radius': `${avrLevel / 255 * 40}px`\r\n      //   }\r\n      // }\r\n    },\r\n    methods: {\r\n      renderCanvas() {\r\n      }\r\n    },\r\n    mounted() {\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" type=\"text/less\" scoped>\r\n\r\n  .dom-clock-item-wrap {\r\n    --animateTime: 0.7s;\r\n    --radius: 40px;\r\n    --textRadius: 2px;\r\n    --radius_: 0;\r\n    --time: 0.05s;\r\n    --a: 80px;\r\n    --b: calc(var(--a) / 10);\r\n    --a2: calc(var(--a) * 2);\r\n    --ha: calc(var(--a) / 2);\r\n    --hb: calc(var(--b) / 2);\r\n    --h: calc(var(--b) / 2);\r\n    --offsetx: calc((var(--hb) + var(--h)) * -1);\r\n    --offsety: calc(var(--h) * -1);\r\n    --offset2: calc((var(--hb) + var(--h) * 2) * -1);\r\n\r\n    margin: calc(var(--b) * 2);\r\n    position: relative;\r\n    height: var(--a2);\r\n    line-height: var(--a2);\r\n    font-size: 40px;\r\n    width: var(--a);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    text-shadow:\r\n      0 0 calc(var(--textRadius) * 1) #fff,\r\n      0 0 calc(var(--textRadius) * 2) #fff,\r\n      0 0 calc(var(--textRadius) * 3) #fff,\r\n      0 0 calc(var(--textRadius) * 4) #fff,\r\n      0 0 calc(var(--textRadius) * 5) #ff5722,\r\n      0 0 calc(var(--textRadius) * 6) #ff5722,\r\n      0 0 calc(var(--textRadius) * 7) #ff5722,\r\n      0 0 calc(var(--textRadius) * 8) #ff5722;\r\n\r\n    .dom-clock-item {\r\n      position: absolute;\r\n      height: 100%;\r\n      width: 100%;\r\n\r\n      > div {\r\n        position: absolute;\r\n        display: block;\r\n        transform: translateZ(0);\r\n        box-shadow:\r\n          0 0 calc(var(--radius_) * 1) #fff,\r\n          0 0 calc(var(--radius_) * 2) #fff,\r\n          0 0 calc(var(--radius_) * 3) #fff,\r\n          0 0 calc(var(--radius_) * 4) #fff,\r\n          0 0 calc(var(--radius_) * 5) #ff5722,\r\n          0 0 calc(var(--radius_) * 6) #ff5722,\r\n          0 0 calc(var(--radius_) * 7) #ff5722,\r\n          0 0 calc(var(--radius_) * 8) #ff5722;\r\n\r\n        > div {\r\n          width: 100%;\r\n          height: 100%;\r\n          background-color: rgba(0, 0, 0, 1);\r\n          clip-path: polygon(var(--hb) 0, calc(100% - var(--hb)) 0, 100% var(--hb), 100% calc(100% - var(--hb)), calc(100% - var(--hb)) 100%, var(--hb) 100%, 0 calc(100% - var(--hb)), 0 var(--hb));\r\n        }\r\n\r\n        &.track {\r\n          > div {\r\n            background-color: rgba(0, 0, 0, 1);\r\n          }\r\n        }\r\n\r\n        &.active {\r\n          box-shadow:\r\n            0 0 calc(var(--radius) * 1) #fff,\r\n            0 0 calc(var(--radius) * 2) #fff,\r\n            0 0 calc(var(--radius) * 3) #fff,\r\n            0 0 calc(var(--radius) * 4) #fff,\r\n            0 0 calc(var(--radius) * 5) #ff5722,\r\n            0 0 calc(var(--radius) * 6) #ff5722,\r\n            0 0 calc(var(--radius) * 7) #ff5722,\r\n            0 0 calc(var(--radius) * 8) #ff5722;\r\n          transform: translateZ(40px);\r\n\r\n          > div {\r\n            background-color: rgba(255, 255, 255, 1);\r\n          }\r\n        }\r\n\r\n        &:nth-of-type(1) {\r\n          width: var(--a);\r\n          height: var(--b);\r\n          top: var(--offset2);\r\n          left: 0;\r\n          transition: all var(--animateTime) calc(var(--time) * 1) cubic-bezier(.6,.42,.34,1.48);\r\n          > div {\r\n            transition: all var(--animateTime) calc(var(--time) * 1) cubic-bezier(.6,.42,.34,1.48);\r\n          }\r\n        }\r\n\r\n        &:nth-of-type(2) {\r\n          width: var(--b);\r\n          height: var(--a);\r\n          top: var(--offsety);\r\n          right: var(--offsetx);\r\n          transition: all var(--animateTime) calc(var(--time) * 2) cubic-bezier(.6,.42,.34,1.48);\r\n\r\n          > div {\r\n            transition: all var(--animateTime) calc(var(--time) * 2) cubic-bezier(.6,.42,.34,1.48);\r\n          }\r\n        }\r\n\r\n        &:nth-of-type(3) {\r\n          width: var(--b);\r\n          height: var(--a);\r\n          bottom: var(--offsety);\r\n          right: var(--offsetx);\r\n          transition: all var(--animateTime) calc(var(--time) * 3) cubic-bezier(.6,.42,.34,1.48);\r\n\r\n          > div {\r\n            transition: all var(--animateTime) calc(var(--time) * 3) cubic-bezier(.6,.42,.34,1.48);\r\n          }\r\n        }\r\n\r\n        &:nth-of-type(4) {\r\n          width: var(--a);\r\n          height: var(--b);\r\n          bottom: var(--offset2);\r\n          right: 0;\r\n          transition: all var(--animateTime) calc(var(--time) * 4) cubic-bezier(.6,.42,.34,1.48);\r\n\r\n          > div {\r\n            transition: all var(--animateTime) calc(var(--time) * 4) cubic-bezier(.6,.42,.34,1.48);\r\n          }\r\n        }\r\n\r\n        &:nth-of-type(5) {\r\n          width: var(--b);\r\n          height: var(--a);\r\n          left: var(--offsetx);\r\n          bottom: var(--offsety);\r\n          transition: all var(--animateTime) calc(var(--time) * 5) cubic-bezier(.6,.42,.34,1.48);\r\n\r\n          > div {\r\n            transition: all var(--animateTime) calc(var(--time) * 5) cubic-bezier(.6,.42,.34,1.48);\r\n          }\r\n        }\r\n\r\n        &:nth-of-type(6) {\r\n          width: var(--b);\r\n          height: var(--a);\r\n          top: var(--offsety);\r\n          left: var(--offsetx);\r\n          transition: all var(--animateTime) calc(var(--time) * 6) cubic-bezier(.6,.42,.34,1.48);\r\n\r\n          > div {\r\n            transition: all var(--animateTime) calc(var(--time) * 6) cubic-bezier(.6,.42,.34,1.48);\r\n          }\r\n        }\r\n\r\n        &:nth-of-type(7) {\r\n          width: var(--a);\r\n          height: var(--b);\r\n          top: calc(50% - var(--hb));\r\n          left: 0;\r\n          transition: all var(--animateTime) calc(var(--time) * 7) cubic-bezier(.6,.42,.34,1.48);\r\n\r\n          > div {\r\n            transition: all var(--animateTime) calc(var(--time) * 7) cubic-bezier(.6,.42,.34,1.48);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n</style>\r\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./DomClockItem.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./DomClockItem.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./DomClockItem.vue?vue&type=template&id=f8f17254&scoped=true&\"\nimport script from \"./DomClockItem.vue?vue&type=script&lang=js&\"\nexport * from \"./DomClockItem.vue?vue&type=script&lang=js&\"\nimport style0 from \"./DomClockItem.vue?vue&type=style&index=0&id=f8f17254&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"f8f17254\",\n  null\n  \n)\n\nexport default component.exports","<template>\r\n  <div class=\"dom-clock\">\r\n    <div v-for=\"(list, index) in time\" :style=\"d3wrapStyle\">\r\n      <div v-for=\"(list_, index_) in list\">\r\n        <template v-if=\"index_\"><span>{{index ? ':' : '-'}}</span></template>\r\n        <template v-for=\"(num) in list_\">\r\n          <DomClockItem :num=\"num\"/>\r\n        </template>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\n  import {Time} from \"../tools/Time\";\r\n  import DomClockItem from './DomClockItem.vue'\r\n\r\n  export default {\r\n    name: 'DomClock',\r\n    components: {DomClockItem},\r\n    data() {\r\n      return {\r\n        time: '',\r\n      }\r\n    },\r\n\r\n    inject: [\r\n      'musicDataFlags',\r\n      'musicData',\r\n      'musicConfig',\r\n      'gameList',\r\n      'mv',\r\n      'modifyManager'\r\n    ],\r\n    computed: {\r\n      d3wrapStyle(){\r\n        const {musicConfig} = this;\r\n        const {_x, _y} = musicConfig.mouseMoveConf;\r\n        const maxDeg = 150;\r\n        return {\r\n          transform: `translateZ(-400px) rotateX(${-_y*maxDeg - 20}deg) rotateY(${_x*maxDeg}deg)`,\r\n        }\r\n      },\r\n      dataFlag(){\r\n        return this.musicDataFlags.dataFlag\r\n      }\r\n    },\r\n    watch: {\r\n      'musicDataFlags.shockFlag': {\r\n        immediate: true,\r\n        handler() {\r\n          // 重新渲染的时候， 可能没初始化? // 其实是之前的被销毁了\r\n          // modifyManager.commonOptions.CanvasPicMalfunction && (this.shallMalfunction = 2);\r\n        }\r\n      },\r\n      'dataFlag': {\r\n        immediate: true,\r\n        handler() {\r\n          const stamp = new Date();\r\n          this.time = [\r\n            Time.format(stamp, `yea mon dat`).split(' ').map(i => i.split('')),\r\n            Time.format(stamp, `hou min sec`).split(' ').map(i => i.split(''))\r\n          ];\r\n        }\r\n      }\r\n    },\r\n    methods: {\r\n      renderCanvas() {\r\n      }\r\n    },\r\n    mounted() {\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" type=\"text/less\" scoped>\r\n  .dom-clock {\r\n    position: absolute;\r\n    top: 20vh;\r\n    left: 50%;\r\n    transform: translate(-50%, -50%);\r\n    flex: 1 1 0;\r\n    z-index: 2900;\r\n    perspective:1000px;\r\n\r\n    >div{\r\n      display: flex;\r\n      justify-content: center;\r\n      margin: 20px 0;\r\n      transform-style:preserve-3d;\r\n      >div{\r\n        display: flex;\r\n        align-items: flex-end;\r\n        >span{\r\n          opacity: 1;\r\n          margin: 20px;\r\n          font-size: 80px;\r\n          transform: translateZ(20px);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n</style>\r\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./DomClock.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./DomClock.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./DomClock.vue?vue&type=template&id=591f40bb&scoped=true&\"\nimport script from \"./DomClock.vue?vue&type=script&lang=js&\"\nexport * from \"./DomClock.vue?vue&type=script&lang=js&\"\nimport style0 from \"./DomClock.vue?vue&type=style&index=0&id=591f40bb&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"591f40bb\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"game-ui\",class:{active: _vm.gameList.ended}},[_c('div',{staticClass:\"progress\"},[_c('span',{style:(_vm.progressStyle)})]),_c('ul',[_vm._l((_vm.formConfigs),function(formConfig,index){return _c('li',[_c('div',[_vm._v(_vm._s(formConfig.label))]),_c('div',[_vm._v(_vm._s(_vm.gameList[formConfig.key]))])])}),_c('li',[_c('div',[_vm._v(\"realTimeData\")]),_c('div',[_vm._v(_vm._s(_vm.musicData.realTimeData.shockNum))])]),_c('li',[_c('div',[_vm._v(\"originData\")]),_c('div',[_vm._v(_vm._s(_vm.musicData.originData.shockNum))])])],2)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"game-ui\" :class=\"{active: gameList.ended}\">\r\n    <div class=\"progress\">\r\n      <span :style=\"progressStyle\"></span>\r\n    </div>\r\n    <ul>\r\n      <li v-for=\"(formConfig, index) in formConfigs\">\r\n        <div>{{formConfig.label}}</div>\r\n        <div>{{gameList[formConfig.key]}}</div>\r\n      </li>\r\n\r\n      <!--<li>-->\r\n        <!--<div>平均每击扣分</div>-->\r\n        <!--<div v-if=\"gameList.total\">{{gameList.totalScore / (gameList.total - gameList.missCount)}}</div>-->\r\n        <!--<div v-if=\"!gameList.total\">&#45;&#45;</div>-->\r\n      <!--</li>-->\r\n      <li>\r\n        <div>realTimeData</div>\r\n        <div>{{musicData.realTimeData.shockNum}}</div>\r\n      </li>\r\n      <li>\r\n        <div>originData</div>\r\n        <div>{{musicData.originData.shockNum}}</div>\r\n      </li>\r\n    </ul>\r\n  </div>\r\n</template>\r\n<script>\r\n\r\n\r\n  export default {\r\n    name: 'GameUI',\r\n    inject: [\r\n      'musicDataFlags',\r\n      'musicData',\r\n      'musicConfig',\r\n      'gameList',\r\n      'mv'\r\n    ],\r\n    data() {\r\n      return {\r\n        formConfigs: [\r\n          {\r\n            key: 'total',\r\n            label: '节点数',\r\n          },\r\n          {\r\n            key: 'totalScore',\r\n            label: '扣除分数',\r\n          },\r\n          {\r\n            key: 'maxCombo',\r\n            label: '最大连击数',\r\n          },\r\n          {\r\n            key: 'missCount',\r\n            label: 'miss',\r\n          },\r\n          {\r\n            key: 'uselessCount',\r\n            label: '无效按键',\r\n          },\r\n\r\n        ]\r\n      }\r\n    },\r\n    computed: {\r\n      progressStyle() {\r\n        const {currentTime, durationTime} = this.gameList;\r\n        return {\r\n          transform: `scale(${durationTime ? currentTime / durationTime : 0}, 1)`\r\n        }\r\n      }\r\n    },\r\n    watch: {},\r\n    methods: {},\r\n    mounted() {\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" type=\"text/less\" scoped>\r\n  .game-ui {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    flex: 1 1 0;\r\n    overflow: hidden;\r\n    z-index: 2999;\r\n\r\n    .progress {\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      height: 6px;\r\n      width: 100%;\r\n      text-align: left;\r\n\r\n      span {\r\n        display: block;\r\n        width: 100%;\r\n        height: 100%;\r\n        background: linear-gradient(90deg, hsla(0, 50%, 50%, 1), hsla(-30, 50%, 50%, 1), hsla(0, 50%, 50%, 1));\r\n      }\r\n    }\r\n\r\n    ul {\r\n      overflow: hidden;\r\n      border-radius: 10%;\r\n      opacity: 0.4;\r\n      position: absolute;\r\n      width: 90%;\r\n      top: 50%;\r\n      left: 50%;\r\n      padding: 5vh 0 10vh 0;\r\n      transform: translate(-50%, -50%);\r\n      transition: all 0.6s ease-in-out;\r\n      border: 2px solid hsla(15, 50%, 50%, 0);\r\n      white-space: nowrap;\r\n\r\n      &::before {\r\n        content: '';\r\n        display: block;\r\n        width: 100%;\r\n        height: 100%;\r\n        position: absolute;\r\n        top: 0;\r\n        left: 0;\r\n        background: linear-gradient(hsla(0, 50%, 50%, 0.6), hsla(10, 50%, 50%, 0.2) 10%, hsla(20, 50%, 50%, 0.2) 90%, hsla(30, 50%, 50%, 0.6));\r\n        opacity: 0;\r\n        transition: all 0.6s ease-in-out;\r\n      }\r\n\r\n      li {\r\n        position: relative;\r\n        padding: 1vh 0;\r\n        display: flex;\r\n        align-items: center;\r\n\r\n        div {\r\n          padding: 0 1vw;\r\n\r\n          &:first-of-type {\r\n            flex: 1 1 0;\r\n            text-align: right;\r\n          }\r\n\r\n          &:last-of-type {\r\n            font-size: 32px;\r\n            color: #fff;\r\n            font-weight: bold;\r\n            flex: 5 5 0;\r\n            text-align: left;\r\n            transition: all 0.6s ease-in-out;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    &.active {\r\n      ul {\r\n        padding: 5vh 5vw 10vh 5vw;\r\n        opacity: 1;\r\n        width: 60%;\r\n        border: 2px solid hsla(15, 50%, 50%, 1);\r\n\r\n        &::before {\r\n          opacity: 1;\r\n        }\r\n\r\n        li {\r\n          div {\r\n            &:last-of-type {\r\n              flex: 1 1 0;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n</style>\r\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./GameUI.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./GameUI.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./GameUI.vue?vue&type=template&id=17b5a148&scoped=true&\"\nimport script from \"./GameUI.vue?vue&type=script&lang=js&\"\nexport * from \"./GameUI.vue?vue&type=script&lang=js&\"\nimport style0 from \"./GameUI.vue?vue&type=style&index=0&id=17b5a148&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"17b5a148\",\n  null\n  \n)\n\nexport default component.exports","<style lang=\"less\" scoped>\r\n</style>\r\n<template>\r\n  <div class=\"container\">\r\n    <NavBar></NavBar>\r\n    <div class=\"box-wrap\">\r\n      <MusicSearchBox></MusicSearchBox>\r\n      <MusicLocalBox></MusicLocalBox>\r\n      <ModifyBox></ModifyBox>\r\n    </div>\r\n    <div class=\"canvas-view-wrap\">\r\n      <GameUI v-if=\"commonOptions.gameUI\"></GameUI>\r\n      <CanvasPic v-if=\"commonOptions.CanvasPic\"></CanvasPic>\r\n      <CanvasText v-if=\"commonOptions.CanvasText\"></CanvasText>\r\n      <template v-for=\"(item, index) in modifyManager.list[0].list\">\r\n        <CanvasView\r\n          :config=\"item\"\r\n          v-if=\"commonOptions.CanvasView && item && item.constructor.name_ === 'CanvasTrack'\"\r\n        ></CanvasView>\r\n      </template>\r\n    </div>\r\n    <VideoView :index=\"0\" v-if=\"commonOptions.VideoView\"></VideoView>\r\n    <VideoView :index=\"1\" v-if=\"commonOptions.VideoView1\"></VideoView>\r\n    <DomClock v-if=\"commonOptions.DomClock\"></DomClock>\r\n    <ThreeView v-if=\"musicData.realTimeData.data\"></ThreeView>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import {ShortCut, shortCut} from \"../tools/ShortCut\";\r\n  import {Color, GameList, GameScene, MusicData, MusicDataFlags, UniqueList} from \"../music/Music\";\r\n  import {MusicConfig} from \"../music/MusicConfig\";\r\n  import {MusicVisualizer} from \"../music/MusicVisualizer\";\r\n  import {DomUtil} from \"../tools/DomUtil\";\r\n  import {ModifyManager} from \"../components/canvasConfig\";\r\n\r\n  import NavBar from '../components/NavBar';\r\n  import MusicSearchBox from '../components/MusicSearchBox';\r\n  import MusicLocalBox from '../components/MusicLocalBox';\r\n  import ModifyBox from '../components/ModifyBox';\r\n  import ThreeView from '../components/ThreeView';\r\n  import CanvasView from '../components/CanvasView';\r\n  import CanvasPic from '../components/CanvasPic';\r\n  import CanvasTitle from '../components/CanvasTitle';\r\n  import CanvasText from '../components/CanvasText';\r\n  import VideoView from '../components/VideoView';\r\n  import DomClock from '../components/DomClock';\r\n  import GameUI from '../components/GameUI';\r\n\r\n\r\n\r\n  const globalData = (function () {\r\n\r\n    const modifyManager = new ModifyManager();\r\n\r\n    const commonOptions_ = modifyManager.getTrackByName('CommonOptionsTrack');\r\n\r\n    const balanceOptions = modifyManager.getTrackByName('BalanceTrack');\r\n    const gameWrap = DomUtil.node('div');\r\n    DomUtil.class(gameWrap, 'game-wrap');\r\n    DomUtil.append(document.body, gameWrap);\r\n\r\n    const gameInner = DomUtil.node('div');\r\n    DomUtil.class(gameInner, 'game-inner');\r\n    DomUtil.append(gameWrap, gameInner);\r\n\r\n    const musicDataFlags = new MusicDataFlags;\r\n\r\n    const musicData = new MusicData(modifyManager);\r\n\r\n    // @ts-ignore;\r\n    const images = ['22824.jpg', '22891.jpg'];\r\n    const musicConfig = new MusicConfig({\r\n      images,\r\n    });\r\n\r\n\r\n    const mv = new MusicVisualizer({\r\n      //定义的音频数组长度\r\n      size: Math.pow(2, 7),\r\n      // draw: draw,\r\n      musicConfig,\r\n      volume: 0.3\r\n    });\r\n\r\n    const gameList = new GameList(mv, gameInner, modifyManager);\r\n\r\n\r\n    const gameTrack = modifyManager.getTrackByName('GameTrack');\r\n    const createGameNode = function (ev) {\r\n      const gameUI = commonOptions_.getVal('gameUI');\r\n      // @ts-ignore;\r\n      gameUI && gameList.createGameNode(ev.rhythmPoint, gameTrack.getVal('trick'));\r\n    };\r\n\r\n    musicData.originData.event.addEventListener('shock', createGameNode);\r\n    musicData.originData.event.addEventListener('update', () => {\r\n      const gameScene = commonOptions_.getVal('gameScene');\r\n\r\n      if (!gameScene) return;\r\n      window.isPhone || new GameScene(musicData.originData, musicData, gameInner, modifyManager);\r\n      const {_x, _y} = musicConfig.mouseMoveConf;\r\n      const maxDeg = 180;\r\n      //@ts-ignore;d\r\n      gameInner.style = `transform: rotateY(${-_x * maxDeg}deg) rotateX(${_y * maxDeg}deg) translateZ(100px);`;\r\n    });\r\n\r\n\r\n    const navList = new UniqueList();\r\n    navList.enter({\r\n      name: '导出预设',\r\n      id: 'export_presets',\r\n      callback: () => {\r\n        modifyManager.exportPresets()\r\n      }\r\n    });\r\n\r\n    navList.enter({\r\n      type: 'fileReader',\r\n      name: '读取预设',\r\n      id: 'import_presets',\r\n      callback: (ev) => {\r\n        const files = ev.target.files;\r\n        console.log(files);\r\n        const reader = new FileReader();\r\n        reader.onload = function () {\r\n          try {\r\n            const res = JSON.parse(reader.result);\r\n            modifyManager.importPresets(res)\r\n          } catch (e) {\r\n            ShortCut.toast(['解析配置失败'])\r\n          }\r\n\r\n        };\r\n        files[0] && reader.readAsText(files[0]);\r\n      }\r\n    });\r\n\r\n    return {\r\n      balanceOptions,\r\n      navList,\r\n      commonOptions_,\r\n      modifyManager,\r\n      musicDataFlags,\r\n      musicData,\r\n      musicConfig,\r\n      gameList,\r\n      mv\r\n    }\r\n  })();\r\n\r\n\r\n  export default {\r\n    name: \"DashBoard\",\r\n    components: {\r\n      NavBar,\r\n      MusicSearchBox,\r\n      MusicLocalBox,\r\n      ModifyBox,\r\n      GameUI,\r\n      CanvasView,\r\n      VideoView,\r\n      CanvasPic,\r\n      CanvasText,\r\n      CanvasTitle,\r\n      DomClock,\r\n      ThreeView\r\n    },\r\n    provide() {\r\n      const {\r\n        navList,\r\n        commonOptions_,\r\n        modifyManager,\r\n        musicDataFlags,\r\n        musicData,\r\n        musicConfig,\r\n        gameList,\r\n        mv\r\n      } = this;\r\n      return {\r\n        navList,\r\n        commonOptions_,\r\n        modifyManager,\r\n        musicDataFlags,\r\n        musicData,\r\n        musicConfig,\r\n        gameList,\r\n        mv\r\n      }\r\n    },\r\n    computed: {\r\n      commonOptions() {\r\n        const commonOptions = {};\r\n        const list = this.commonOptions_.list;\r\n        list.forEach(item => {\r\n          commonOptions[item.key] = item.value;\r\n        });\r\n        return commonOptions;\r\n      }\r\n    },\r\n    mounted() {\r\n      const {musicData, musicDataFlags, musicConfig, mv} = this;\r\n      musicData.realTimeData.event.addEventListener('shock', () => {\r\n        musicDataFlags && musicDataFlags.shockFlag++;\r\n        musicConfig && musicConfig.shock();\r\n      });\r\n\r\n      shortCut.init(undefined, {\r\n        common: {\r\n          spacebar: () => this.gameList.shootGameNode(),\r\n          enter: () => this.gameList.shootGameNode(),\r\n        }\r\n      }, {common: {spacebar: '消除节奏点', enter: '消除节奏点'}});\r\n      mv.draw = (data) => {this.draw(data)};\r\n\r\n      // @ts-ignore;\r\n      document.addEventListener(window.isPhone ? \"touchmove\" : \"mousemove\", function (ev) {\r\n        musicConfig.handelMouseMove(ev)\r\n      });\r\n    },\r\n    data() {\r\n      return globalData;\r\n    },\r\n    watch: {\r\n      balanceOptions: {\r\n        immediate: true,\r\n        deep: true,\r\n        handler(){\r\n          const {balanceOptions, mv} = this;\r\n          mv.biquadFilters && mv.biquadFilters.forEach((i, index) => {\r\n            i.gain.value = balanceOptions.getVal(`balance${index}`);\r\n            i.gain.Q = 1;\r\n          });\r\n        }\r\n      }\r\n    },\r\n    methods: {\r\n\r\n      draw({realTimeData, originData}) {\r\n        const {modifyManager, musicDataFlags, musicData, musicConfig, gameList,} = this;\r\n        gameList.setBuffer(modifyManager.getTrackByName('GameTrack').getVal('RhythmPointRemoveFloatRange') * 10);\r\n        musicData.realTimeData.update(realTimeData);\r\n        musicData.originData.update(originData);\r\n\r\n        const [r, g, b, a] = musicConfig.currentImgAviColor;\r\n        const [[r1, g1, b1], [r2, g2, b2]] = musicData.calculateColors = Color.getPure(r, g, b);\r\n\r\n        const {soundTrackArr} = musicData.realTimeData;\r\n\r\n\r\n        // @ts-ignore;\r\n        this.commonOptions.gameUI && (document.querySelector('.sound-track').innerHTML = soundTrackArr.map(\r\n          // @ts-ignore;\r\n          (item) => `<li style=\"${[\r\n            `transform: translateY(-${item.vol}px);`,\r\n            `opacity: ${item.isRhythmPoint ? 1 : item.vol / 256 / 2 + .25};`,\r\n            `background-color: ${item.isRhythmPoint ? `rgba(${255 - r2},${255 - g2},${255 - b2}, 1)` : '#fff'};`\r\n          ].join('')}\"></li>`\r\n        ).join(''));\r\n\r\n        musicDataFlags.dataFlag++;\r\n      }\r\n    }\r\n  }\r\n</script>\r\n<style lang=\"less\" type=\"text/less\" scoped>\r\n  .container {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    height: 100vh;\r\n    width: 100vw;\r\n    overflow: hidden;\r\n  }\r\n\r\n  .canvas-view-wrap {\r\n    display: flex;\r\n    position: absolute;\r\n    height: 100vh;\r\n    width: 100vw;\r\n    top: 0;\r\n    left: 0;\r\n  }\r\n</style>\r\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./Index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./Index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Index.vue?vue&type=template&id=98b67e3c&scoped=true&\"\nimport script from \"./Index.vue?vue&type=script&lang=js&\"\nexport * from \"./Index.vue?vue&type=script&lang=js&\"\nimport style1 from \"./Index.vue?vue&type=style&index=1&id=98b67e3c&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"98b67e3c\",\n  null\n  \n)\n\nexport default component.exports","<template>\n  <div id=\"app\">\n    <Index></Index>\n  </div>\n</template>\n<script>\n  import Index from './views/Index'\n  export default {\n    name: 'App',\n    components: {\n      Index,\n    }\n  }\n</script>\n\n<style lang=\"less\">\n\n  * {\n    border: 0;\n    padding: 0;\n    margin: 0;\n    outline: 0;\n    box-sizing: border-box;\n  }\n\n  *::-webkit-scrollbar {\n    width: 0;\n  }\n\n  ul, li {\n    list-style: none;\n  }\n\n  html, body {\n    height: 100%;\n    width: 100%;\n    overflow: hidden;\n    position: relative;\n    color: #fff;\n    text-align: center;\n    background-color: #000;\n  }\n\n  b {\n    display: block;\n    position: absolute;\n    background-size: 1920px 1080px;\n    border-radius: 2px;\n    z-index: 2;\n    color: pink;\n    text-align: center;\n  }\n\n  img {\n    width: 100%;\n    top: 0;\n    left: 0;\n    position: absolute;\n    opacity: 0;\n  }\n</style>\n","import mod from \"-!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js??clonedRuleSet-39[0].rules[0].use[1]!../node_modules/cache-loader/dist/cjs.js??ruleSet[0].rules[0].use[0]!../node_modules/vue-loader-v15/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=4b5f7a9c&\"\nimport script from \"./App.vue?vue&type=script&lang=js&\"\nexport * from \"./App.vue?vue&type=script&lang=js&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","/* eslint-disable no-console */\n\nimport { register } from 'register-service-worker'\n\nif (process.env.NODE_ENV === 'production') {\n  register(`${process.env.BASE_URL}service-worker.js`, {\n    ready () {\n      console.log(\n        'App is being served from cache by a service worker.\\n' +\n        'For more details, visit https://goo.gl/AFskqB'\n      )\n    },\n    registered () {\n      console.log('Service worker has been registered.')\n    },\n    cached () {\n      console.log('Content has been cached for offline use.')\n    },\n    updatefound () {\n      console.log('New content is downloading.')\n    },\n    updated () {\n      console.log('New content is available; please refresh.')\n    },\n    offline () {\n      console.log('No internet connection found. App is running in offline mode.')\n    },\n    error (error) {\n      console.error('Error during service worker registration:', error)\n    }\n  })\n}\n","function IsPhone() {\r\n  return /Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)\r\n}\r\n// @ts-ignore;\r\nwindow.isPhone = IsPhone();\r\nimport './assets/style/index.less'\r\nimport App from './App.vue'\r\nimport './registerServiceWorker'\r\n\r\n\r\nimport Vue from 'vue'\r\n\r\nnew Vue({render: (h) => h(App),}).$mount('#app');\r\n\r\n\r\n// import { createApp } from 'vue'\r\n// createApp(App).mount('#app')\r\n","import {GetType} from \"@/tools/GetType\";\r\n\r\nexport class DomUtil {\r\n  static getBothAncestor(sDom: Node, eDom: Node) {\r\n    let sDom_: undefined | Node = sDom;\r\n    let eDom_: undefined | Node = eDom;\r\n    while (sDom_) {\r\n      if (DomUtil.hasChild(sDom_, eDom)) {\r\n        return sDom_;\r\n      }\r\n      // @ts-ignore;\r\n      sDom_ = sDom_.parentNode;\r\n    }\r\n    while (eDom_) {\r\n      if (DomUtil.hasChild(eDom_, sDom)) {\r\n        return eDom_;\r\n      }\r\n      // @ts-ignore;\r\n      eDom_ = eDom_.parentNode;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  /**\r\n   * 判断一个节点是否为空节点， 文本节点\r\n   * @param node\r\n   */\r\n  static isEmptyTag(node: Node): boolean {\r\n    if (node.nodeType === 1) {\r\n      if (node.childNodes.length === 0) return true;\r\n      return [...node.childNodes].every(i => DomUtil.isEmptyTag(i))\r\n    } else if (node.nodeType === 3) {\r\n      return !node.textContent;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  static isSameTag(a: Node, b: Node): boolean {\r\n    if (!(a && b)) return false;\r\n    if (a.nodeType === 3 && b.nodeType === 3) {\r\n      return true;\r\n    }\r\n    if (a.nodeType === 1 && b.nodeType === 1) {\r\n      // @ts-ignore;\r\n      return DomUtil.isTag(a, b.tagName);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * parentNode 的子孙中是否包含 child\r\n   * @param parentNode\r\n   * @param child\r\n   */\r\n  static hasChild(parentNode: Node, child: Node): boolean {\r\n    const list = [...parentNode.childNodes];\r\n    // @ts-ignore;\r\n    return list.includes(child) || list.some(item => DomUtil.hasChild(item, child))\r\n  }\r\n\r\n  /**\r\n   * 判断child 的祖先中是否包含 parentNode\r\n   * @param parentNode\r\n   * @param child\r\n   */\r\n  static isChildOf(parentNode: ParentNode, child: Node | null) {\r\n    while (child) {\r\n      if (child.parentNode === parentNode) return true;\r\n      child = child.parentNode\r\n    }\r\n    return false;\r\n  }\r\n\r\n  static isAncestor(target: Node, dom: Node | null) {\r\n    while (dom && dom.parentNode) {\r\n      if (dom.parentNode === target) return true;\r\n      // @ts-ignore;\r\n      dom = dom.parentNode;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * 传入节点的父级中最近的指定标签的一项， 直到 ’根节点‘\r\n   * @param node\r\n   * @param targetTagNames\r\n   * @param endAt 若传入该项， 则匹配到该项时会中断查找（此时不会返回值）\r\n   */\r\n  static findNearestTargetParentNodeByTag(node: Node | undefined | null, targetTagNames: string[] = [], endAt?: Node) {\r\n    targetTagNames = targetTagNames.map(i => i.toLowerCase())\r\n    while (node && !(endAt && node !== endAt)) {\r\n      // @ts-ignore;\r\n      const tagName = (node.tagName || '').toLowerCase();\r\n      if (targetTagNames.includes(tagName)) {\r\n        return node;\r\n      }\r\n      node = node.parentNode\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  /**\r\n   * 替换 nodeName， 注意替换后，为新节点， 且原子节点均转移到新节点\r\n   * @param node\r\n   * @param tag\r\n   */\r\n  static changeTag(node: Node, tag: string) {\r\n    const newNode = DomUtil.node(tag);\r\n    [...node.childNodes].forEach(item => {\r\n      newNode.appendChild(item)\r\n    });\r\n    DomUtil.replace(node, newNode);\r\n    return newNode;\r\n  }\r\n\r\n  /**\r\n   * 将节点从父节点中移除， 如果有父节点的话\r\n   * @param dom\r\n   */\r\n  static remove(dom: Node) {\r\n    dom.parentNode && dom.parentNode.removeChild(dom);\r\n  }\r\n\r\n  /**\r\n   * 判断节点是否为指定标签类型\r\n   * @param dom\r\n   * @param tag\r\n   */\r\n  static isTag(dom: Node, tag: string = ''): boolean {\r\n    return dom.nodeName.toLowerCase() === tag.toLowerCase();\r\n  }\r\n\r\n  /**\r\n   * 判断父节点的节点\r\n   * @param dom\r\n   * @param targetType\r\n   */\r\n  static isParentNodeTheTargetType(dom: Node, targetType: string = '') {\r\n    const parentNode = dom.parentNode;\r\n    // @ts-ignore;\r\n    return parentNode && parentNode.tagName.toLowerCase() === targetType.toLowerCase();\r\n  }\r\n\r\n  /**\r\n   * 生成 tagName 的空标签\r\n   * @param tagName\r\n   * @param innerHTML\r\n   */\r\n  static node(tagName: string, innerHTML?: string) {\r\n    const node = document.createElement(tagName);\r\n    innerHTML && (node.innerHTML = innerHTML);\r\n    return node;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param node\r\n   * @param className\r\n   */\r\n  static class(node: Node, className: string) {\r\n    if (node) {\r\n      // @ts-ignore;\r\n      node.classList.contains(className) || node.classList.add(className);\r\n    }\r\n  }\r\n\r\n  static removeClass(node: Node, className: string) {\r\n    if (node) {\r\n      // @ts-ignore;\r\n      node.classList.contains(className) || node.classList.remove(className)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 生成文本节点\r\n   * @param text\r\n   */\r\n  static text(text: string) {\r\n    return document.createTextNode(text);\r\n  }\r\n\r\n  static list(list: { [index: string]: any }[], template: string) {\r\n  }\r\n\r\n  /**\r\n   * 在之前插入， 如果有父节点的话\r\n   * @param oldDom\r\n   * @param newDom\r\n   */\r\n  static insertBefore(oldDom: Node, newDom: Node) {\r\n    const parentNode = oldDom.parentNode;\r\n    if (parentNode) {\r\n      parentNode.insertBefore(newDom, oldDom)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 在最后插入子节点\r\n   * @param parentNode\r\n   * @param child\r\n   */\r\n  static append(parentNode: Node, child: Node): void;\r\n  static append(parentNode: Node, childList: Node[]): void;\r\n  static append(parentNode: Node, child: Node | Node[]) {\r\n    if (GetType.isArray(child)) {\r\n      // @ts-ignore;\r\n      child.forEach((i: Node) => {\r\n        parentNode.appendChild(i);\r\n      })\r\n    } else {\r\n      // @ts-ignore;\r\n      parentNode.appendChild(child);\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * 在开头插入子节点\r\n   * @param parentNode\r\n   * @param child\r\n   */\r\n  static prepend(parentNode: Node, child: Node) {\r\n    const prev = parentNode.childNodes[0];\r\n    if (prev) {\r\n      DomUtil.insertBefore(prev, child)\r\n    } else {\r\n      parentNode.appendChild(child);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 在节点后插入， 如果有父节点的话\r\n   * @param oldDom\r\n   * @param newDom\r\n   */\r\n  static insertAfter(oldDom: Node, newDom: Node) {\r\n    const parentNode = oldDom.parentNode;\r\n    const nextSibling = oldDom.nextSibling;\r\n\r\n    if (!parentNode) return;\r\n    if (nextSibling) {\r\n      parentNode.insertBefore(newDom, nextSibling)\r\n    } else {\r\n      parentNode.appendChild(newDom);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 替换节点， 如果有父节点的话\r\n   * @param oldDom\r\n   * @param newDom\r\n   */\r\n  static replace(oldDom: Node, newDom: Node) {\r\n    const parentNode = oldDom.parentNode;\r\n    if (parentNode) {\r\n      parentNode.insertBefore(newDom, oldDom);\r\n      parentNode.removeChild(oldDom);\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * 判断是否为标签节点\r\n   * @param node\r\n   */\r\n  static isTagNode(node: Node) {\r\n    return node.nodeType === 1\r\n  }\r\n\r\n  /**\r\n   * 根据该节点的 tagName 生成新的同名标签, 忽略属性及子节点， 如传入 <p id=\"1\"></p> => <p></p>\r\n   * @param node\r\n   */\r\n  static copyEmptyTagNode(node: Node): Node {\r\n    if (!DomUtil.isTagNode(node)) return DomUtil.text('');\r\n    // @ts-ignore;\r\n    return DomUtil.node(node.tagName);\r\n  }\r\n\r\n  /**\r\n   * 递归查找第一个节点的文本节点，（如果首子节点为标签节点， 则递归查找其首子节点）\r\n   * @param dom\r\n   */\r\n  static findFirstTextNode(dom: Node | undefined) {\r\n    while (dom && dom.nodeType === 1) {\r\n      if (dom.nodeType === 1) {\r\n        return dom\r\n      }\r\n      dom = dom.childNodes[0]\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  /**\r\n   * 递归查找第后一个节点的文本节点，（如果末子节点为标签节点， 则递归查找其末子节点）\r\n   * @param dom\r\n   */\r\n  static findLastTextNode(dom: Node | undefined) {\r\n    while (dom && dom.nodeType === 1) {\r\n      if (dom.nodeType === 1) {\r\n        return dom\r\n      }\r\n      dom = dom.childNodes[dom.childNodes.length - 1]\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n\r\n  /**\r\n   * 请文本拆分成三份， 中间的五部分未原来的节点\r\n   * @param textNode\r\n   * @param start\r\n   * @param end\r\n   */\r\n  static splitTextNode(textNode: Node, start: number | undefined, end: number | undefined) {\r\n    const textContent = textNode.textContent || '';\r\n    const start_ = textContent.slice(0, start || 0);\r\n    const mid_ = textContent.slice(start || 0, end || undefined);\r\n    const end_ = textContent.slice(end || textContent.length);\r\n    const sDom = start_ && DomUtil.text(start_);\r\n    const eDom = end_ && DomUtil.text(end_);\r\n\r\n    sDom && DomUtil.insertBefore(textNode, sDom);\r\n    textNode.nodeValue = mid_;\r\n    eDom && DomUtil.insertAfter(textNode, eDom);\r\n    return [sDom, textNode, eDom];\r\n  }\r\n}\r\n\r\n","export class GetType {\r\n  static getType(item: any) {\r\n    return Object.prototype.toString.call(item).slice(8, -1);\r\n  }\r\n\r\n  static isNumber(item: any) {\r\n    return GetType.getType(item) === \"Number\"\r\n  };\r\n\r\n  static isString(item: any) {\r\n    return GetType.getType(item) === \"String\"\r\n  };\r\n\r\n  static isArray(item: any) {\r\n    return GetType.getType(item) === \"Array\"\r\n  };\r\n\r\n  static isObject(item: any) {\r\n    return GetType.getType(item) === \"Object\"\r\n  };\r\n\r\n  static isBoolean(item: any) {\r\n    return GetType.getType(item) === \"Boolean\"\r\n  };\r\n\r\n  static isNull(item: any) {\r\n    return GetType.getType(item) === \"Null\"\r\n  };\r\n\r\n  static isUndefined(item: any) {\r\n    return GetType.getType(item) === \"Undefined\"\r\n  };\r\n\r\n  static isFunction(item: any) {\r\n    return GetType.getType(item) === \"Function\"\r\n  };\r\n\r\n  static isDate(item: any) {\r\n    return GetType.getType(item) === \"Date\"\r\n  };\r\n  static isEmpty(item:any){\r\n    return ['', undefined, null].includes(item);\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","\r\nexport interface IOptions {\r\n  key?: string;\r\n  label?: string;\r\n  compType: string;\r\n  formCompType?: string;\r\n  tableCompType: string;\r\n  usage: []|string[];\r\n  readonly?: []|string[];\r\n  excludeWhenSubmit?: []|string[];\r\n  mapLists?: string[][];\r\n  maps: IIndexObj;\r\n  tableGroupCompType?: string;\r\n  [index: string]: any;\r\n}\r\nexport interface IPageConf {\r\n  apiPath?:[]|string[];\r\n  interfaceUrls?:IIndexObj;\r\n  options: []|IOptions[];\r\n  topBtn: []|string[];\r\n  rowBtn: []|string[];\r\n  enableAjax?: boolean;\r\n  formStepConf?: []|[string,string,[]][];\r\n  [index: string]: any;\r\n}\r\n\r\nexport interface IIndexObj {\r\n  [index: string]: any\r\n}\r\nexport interface IIndexFnObj {\r\n  [index: string]: Function\r\n}\r\n\r\n/**\r\n * 查找列表 list 中 键名为 key 且 键值为 val 的第一项\r\n * @param list 列表\r\n * @param key 用于删选的键名\r\n * @param val 用于删选的的键名的键值需要与之相等\r\n */\r\nexport function findEqualByKey(list: IIndexObj = [], key: string, val: any): any {\r\n  // 获取列表中 key === val 的 那一项， 保证返回一个对象（可能导致问题（如果用于vue 监听 可能会出现问题）| 暂时保证返回一个对象更优），TODO\r\n  return list.find((obj: IIndexObj) => obj[key] === val) || {};\r\n}\r\n/**\r\n * 删除列表 list 中 键名为 key 且 键值为 val 的项， 如果没有 则不处理\r\n * @param list 列表\r\n * @param key 用于筛选的字段名\r\n * @param val 用于筛选的的键名的键值需要与之相等\r\n */\r\nexport function deleteEqualByKey(list: any[], key: string, val: any){\r\n  const index = list.findIndex((item: any) => item[key] === val);\r\n  if (index !== -1) {\r\n    list.splice(index, 1);\r\n  }\r\n}\r\n\r\n/**\r\n * 替换列表 list 中 键名为 key 且 键值为 val 的项， 如果没有 则压人\r\n * @param list 列表\r\n * @param key 用于筛选的字段名\r\n * @param val 用于筛选的的键名的键值需要与之相等\r\n * @param replacer 用于替换的元素\r\n */\r\nexport function replaceEqualByKey(list: any[], key: string, val: any, replacer: any) {\r\n  const index = list.findIndex((item: any) => item[key] === val);\r\n  if (!key) {\r\n    list.push(replacer)\r\n  } else if (index !== -1) {\r\n    list.splice(index, 1, replacer);\r\n  } else if (replacer) {\r\n    list.push(replacer)\r\n  }\r\n}\r\n/**\r\n * 合并多个数组到一个新数组， 或者说有条件的数组去重降维\r\n * @param lists 需要合并的数组的集合\r\n * @param key 用于去重的字段名\r\n * @param result 存放结果的数组， 默认空数组\r\n */\r\nexport function concatListEqual(lists: [[] | IIndexObj[] | undefined], key: string, result: IIndexObj[] = []){\r\n  lists.forEach((subLists: []|IIndexObj[]|undefined) => {\r\n    subLists && subLists.forEach(item => {\r\n      replaceEqualByKey(result, key, item[key], item)\r\n    })\r\n  })\r\n  return result;\r\n}\r\nexport class ListEqual{\r\n  /**\r\n   * 查找列表 list 中 键名为 key 且 键值为 val 的第一项\r\n   * @param list 列表\r\n   * @param key 用于删选的键名\r\n   * @param val 用于删选的的键名的键值需要与之相等\r\n   */\r\n  public static find(list: IIndexObj = [], key: string, val: any):any {\r\n    return findEqualByKey(list, key, val)\r\n  }\r\n  /**\r\n   * 查找列表 list 中 键名为 key 且 键值为 val 的第一项\r\n   * @param list 列表\r\n   * @param val 用于删选的的键名的键值需要与之相等\r\n   */\r\n  public static findByKey(list: IIndexObj = [], val: any):any {\r\n    return findEqualByKey(list, 'key', val)\r\n  }\r\n\r\n  /**\r\n   * 删除列表 list 中 键名为 key 且 键值为 val 的项， 如果没有 则不处理\r\n   * @param list 列表\r\n   * @param key 用于筛选的字段名\r\n   * @param val 用于筛选的的键名的键值需要与之相等\r\n   */\r\n  public static delete(list: any[], key: string, val: any) {\r\n    return deleteEqualByKey(list, key, val);\r\n  }\r\n\r\n  /**\r\n   * 删除列表 list 中 键名为 key 且 键值为 val 的项， 如果没有 则不处理\r\n   * @param list 列表\r\n   * @param val 用于筛选的的键名的键值需要与之相等\r\n   */\r\n  public static deleteByKey(list: any[], val: any) {\r\n    return deleteEqualByKey(list, 'key', val);\r\n  }\r\n\r\n  /**\r\n   * 替换列表 list 中 键名为 key 且 键值为 val 的项， 如果没有 则压人\r\n   * @param list 列表\r\n   * @param key 用于筛选的字段名\r\n   * @param val 用于筛选的的键名的键值需要与之相等\r\n   * @param replacer 用于替换的元素\r\n   */\r\n  public static replace(list: any[], key: string, val: any, replacer: any) {\r\n    return replaceEqualByKey(list, key, val, replacer);\r\n  }\r\n\r\n  /**\r\n   * 替换列表 list 中 键名为 key 且 键值为 val 的项， 如果没有 则压人\r\n   * @param list 列表\r\n   * @param val 用于筛选的的键名的键值需要与之相等\r\n   * @param replacer 用于替换的元素\r\n   */\r\n  public static replaceByKey(list: any[], val: any, replacer: any) {\r\n    return replaceEqualByKey(list, 'key', val, replacer);\r\n  }\r\n  /**\r\n   * 合并多个数组到一个新数组， 或者说有条件的数组去重降维\r\n   * @param lists 需要合并的数组的集合\r\n   * @param key 用于合并的字段名\r\n   * @param result 存放结果的数组， 默认空数组\r\n   */\r\n  public static concat(lists: [[]|IIndexObj[]|IOptions[]|undefined], key: string,result: IIndexObj[] = []) {\r\n    return concatListEqual(lists,key, result)\r\n  }\r\n  /**\r\n   * 合并多个数组到一个新数组， 或者说有条件的数组去重降维\r\n   * @param lists 需要合并的数组的集合\r\n   * @param result 存放结果的数组， 默认空数组\r\n   */\r\n  public static concatByKey(lists: [[]|IIndexObj[]|IOptions[]|undefined], result: IIndexObj[] = []) {\r\n    return concatListEqual(lists,'key', result)\r\n  }\r\n}\r\n","import {GetType} from \"./GetType\";\r\nimport {Sound} from \"./Sound\";\r\n// @ts-ignore;\r\nimport {Random} from './random';\r\nimport {DomUtil} from \"@/tools/DomUtil\";\r\n\r\nconst keyMap: {[index: string]: string} = {\r\n  \"0\": \"96\", \"1\": \"97\", \"2\": \"98\", \"3\": \"99\", \"4\": \"100\", \"5\": \"101\", \"6\": \"102\", \"7\": \"103\", \"8\": \"104\", \"9\": \"105\",\r\n\r\n  \"a\": \"65\", \"b\": \"66\", \"c\": \"67\", \"d\": \"68\", \"e\": \"69\", \"f\": \"70\", \"g\": \"71\",\r\n  \"h\": \"72\", \"i\": \"73\", \"j\": \"74\", \"k\": \"75\", \"l\": \"76\", \"m\": \"77\", \"n\": \"78\",\r\n  \"o\": \"79\", \"p\": \"80\", \"q\": \"81\",\r\n  \"r\": \"82\", \"s\": \"83\", \"t\": \"84\",\r\n  \"u\": \"85\", \"v\": \"86\", \"w\": \"87\",\r\n  \"x\": \"88\", \"y\": \"89\", \"z\": \"90\",\r\n\r\n  \"f1\": \"112\", \"f2\": \"113\", \"f3\": \"114\", \"f4\": \"115\",\r\n  \"f5\": \"116\", \"f6\": \"117\", \"f7\": \"118\", \"f8\": \"119\",\r\n  \"f9\": \"120\", \"f10\": \"121\", \"f11\": \"122\", \"f12\": \"123\",\r\n\r\n  \"+\": \"107\", \"-\": \"109\", \"*\": \"106\", \"/\": \"111\", \".\": \"110\",\r\n\r\n  \"backspace\": \"8\", \"tab\": \"9\",\r\n  \"clear\": \"12\", \"enter\": \"13\",\r\n  \"esc\": \"27\", \"spacebar\": \"32\",\r\n  \"left arrow\": \"37\", \"up arrow\": \"38\", \"right arrow\": \"39\", \"down arrow\": \"40\",\r\n  \"left\": \"37\", \"up\": \"38\", \"right\": \"39\", \"down\": \"40\",\r\n\r\n  \";:\": \"186\", \"<\": \"188\", \"=+\": \"187\", \"-_\": \"189\", \">\": \"190\", \"/?\": \"191\", \"`~\": \"192\",\r\n\r\n  \"page up\": \"33\", \"page down\": \"34\",\r\n  \"end\": \"35\", \"home\": \"36\",\r\n  \"insert\": \"45\", \"delete\": \"46\",\r\n\r\n  \"cape lock\": \"20\",\r\n  \"num lock\": \"144\",\r\n\r\n  \"[{\": \"219\", \"\\\\|\": \"220\",\r\n  \"]}\": \"221\", \"'\\\"\": \"222\",\r\n\r\n  \"shift\": \"16\", \"control\": \"17\", \"alt\": \"18\",\r\n\r\n  \"搜索\": \"170\", \"收藏\": \"171\", \"浏览器\": \"172\",\r\n  \"音量减\": \"174\", \"音量加\": \"175\", \"静音\": \"173\", \"停止\": \"179\",\r\n  \"邮件\": \"180\",\r\n};\r\ntype TKeyMap = keyof typeof keyMap;\r\n\r\n\r\nconst keyMap_: {[index: string]: string} = {};\r\n\r\nObject.keys(keyMap).forEach((key: string) => {\r\n  keyMap_[keyMap[key]] = key\r\n});\r\nclass ShortCutAbstract {\r\n  common(keyNum: TKeyMap|number, cb: Function) {\r\n  }\r\n\r\n  ctrl(keyNum: TKeyMap|number, cb: Function) {\r\n  }\r\n\r\n  alt(keyNum: TKeyMap|number, cb: Function) {\r\n  }\r\n\r\n  shift(keyNum: TKeyMap|number, cb: Function) {\r\n  }\r\n\r\n  ctrl_alt(keyNum: TKeyMap|number, cb: Function) {\r\n  }\r\n\r\n  ctrl_shift(keyNum: TKeyMap|number, cb: Function) {\r\n  }\r\n\r\n  alt_shift(keyNum: TKeyMap|number, cb: Function) {\r\n  }\r\n  ctrl_alt_shift(keyNum: TKeyMap|number, cb: Function) {\r\n  }\r\n}\r\n\r\nfunction makeShortCutInitFn(key: string) {\r\n  // @ts-ignore;\r\n  ShortCut.prototype[key] = function (keyNum: TKeyMap|number, cb: Function) {\r\n    GetType.isNumber(keyNum) || (keyNum = keyMap[keyNum] || keyNum);\r\n    // @ts-ignore;\r\n    this.maps[key] || (this.maps[key] = {});\r\n    // @ts-ignore;\r\n    this.maps[key][keyNum] = (ev: Event) => {\r\n      Sound.play('confirm');\r\n      const result = cb();\r\n      if (!result) {\r\n        ev.stopPropagation();\r\n        ev.preventDefault();\r\n      }\r\n    }\r\n  }\r\n\r\n  // @ts-ignore;\r\n  ShortCut.prototype[`${key}Desc`] = function (keyNum: TKeyMap|number, desc: any) {\r\n    GetType.isNumber(keyNum) || (keyNum = keyMap[keyNum] || keyNum);\r\n    // @ts-ignore;\r\n    this.describeMaps[key] || (this.describeMaps[key] = {});\r\n    // @ts-ignore;\r\n    this.describeMaps[key][keyNum] = desc;\r\n  }\r\n}\r\nconst requestAnimationFrame = window.requestAnimationFrame ||\r\n  // @ts-ignore;\r\n  window.webkitrequestAnimationFrame ||\r\n  // @ts-ignore;\r\n  window.mozrequestAnimationFrame;//兼容\r\nconst wrap = DomUtil.node('div');\r\nwrap.className = 'short-cut-view';\r\nDomUtil.append(document.body, wrap);\r\n\r\nconst triggered: string[][] = [];\r\nexport class ShortCut extends ShortCutAbstract{\r\n  static toast(message: string[]){\r\n\r\n    const node = DomUtil.node('div');\r\n    message.forEach(key => {\r\n      DomUtil.append(node, DomUtil.node('span', key.toUpperCase()))\r\n    });\r\n\r\n    DomUtil.prepend(wrap, node);\r\n    requestAnimationFrame(() => {\r\n      requestAnimationFrame(() => {\r\n        DomUtil.class(node, 'active');\r\n        setTimeout(() => {\r\n          DomUtil.class(node, 'hide');\r\n          setTimeout(() => {\r\n            requestAnimationFrame(() => DomUtil.remove(node));\r\n          }, 2000);\r\n        }, 1000);\r\n      })\r\n    });\r\n  }\r\n  hasInited: boolean = false;\r\n  maps = {};\r\n\r\n  describeMaps = {};\r\n\r\n  static triggeredCacheLength = 20;\r\n  static triggered : string[][] = triggered;\r\n  static cacheTriggered(keys: string[]){\r\n    const {triggered, triggeredCacheLength} = ShortCut;\r\n    const prev = triggered[0];\r\n    if (prev && keys.every(((val, index) => prev[index] === val))) return;\r\n    triggered.unshift(keys);\r\n\r\n    ShortCut.toast(keys)\r\n    if (triggered.length > triggeredCacheLength) {\r\n      triggered.pop();\r\n    }\r\n  }\r\n\r\n\r\n  init(dom?: Node, fns: any = {}, describeMaps: any = {}) {\r\n    const slef = this;\r\n    const $body = dom || document.querySelector(\"body\");\r\n    // @ts-ignore;\r\n    this.hasInited || $body.addEventListener('keydown', (ev: Event) => {\r\n      let keys = [];\r\n\r\n      let key = '';\r\n      // @ts-ignore;\r\n      if (ev.ctrlKey) {\r\n        keys.push('ctrl');\r\n      }\r\n      // @ts-ignore;\r\n      if (ev.altKey) {\r\n        keys.push('alt');\r\n      }\r\n      // @ts-ignore;\r\n      if (ev.shiftKey) {\r\n        keys.push('shift');\r\n      }\r\n      key = keys.join('') || '';\r\n      // @ts-ignore;\r\n      keys.push(keyMap_[ev.which]);\r\n\r\n      // @ts-ignore;\r\n      const describeMaps_ = this.describeMaps[key || 'common'] || {};\r\n      // @ts-ignore;\r\n      keys.push(describeMaps_[ev.which] || '暂无描述，待补充');\r\n\r\n      // @ts-ignore;\r\n      const cmd = `slef.maps.${key || 'common'}[${ev.which}](ev)`;\r\n      try {\r\n        eval(cmd);\r\n        ShortCut.cacheTriggered(keys);\r\n      } catch (e) {\r\n        // console.log(e)\r\n      }\r\n\r\n    });\r\n    if (fns) {\r\n      GetType.isObject(fns) && Object.keys(fns).forEach((key: string) => {\r\n        // @ts-ignore;\r\n        fns[key] && Object.keys(fns[key]).forEach(item => this[key](item, fns[key][item]));\r\n      });\r\n    }\r\n    if (describeMaps) {\r\n      GetType.isObject(describeMaps) && Object.keys(describeMaps).forEach((key: string) => {\r\n        // @ts-ignore;\r\n        describeMaps[key] && Object.keys(describeMaps[key]).forEach(item => this[`${key}Desc`](item, describeMaps[key][item]));\r\n      });\r\n    }\r\n    this.hasInited = true;\r\n  };\r\n}\r\n\r\n['common', 'ctrl', 'alt', 'shift', 'ctrl_alt', 'ctrl_shift', 'alt_shift', 'ctrl_alt_shift',].forEach(makeShortCutInitFn);\r\n\r\n\r\n\r\n\r\nexport const shortCut = new ShortCut();\r\nshortCut.init();\r\n","const soundMap = {\r\n  change: \"./sound/change.mp3\",\r\n  confirm: \"./sound/confirm.mp3\",\r\n  done: \"./sound/done.mp3\",\r\n  warning: \"./sound/warning.mp3\",\r\n};\r\nclass CacheList {\r\n  list: Element[];\r\n  constructor(){\r\n    this.list = [];\r\n  }\r\n  getAudio(){\r\n    let dom = this.list.shift();\r\n    const playEnd = () => {\r\n      dom && this.list.push(dom);\r\n    };\r\n    if (!dom) {\r\n      dom = document.createElement('audio');\r\n      // @ts-ignore;\r\n      dom.volume = .2;\r\n      // @ts-ignore;\r\n      dom.autoplay = 'autoplay';\r\n      const body = document.querySelector(\"body\");\r\n      body && body.appendChild(dom);\r\n\r\n      dom.addEventListener('ended', playEnd);\r\n      dom.addEventListener('error', playEnd);\r\n    }\r\n\r\n    return dom;\r\n  }\r\n}\r\n\r\nconst cacheList = new CacheList();\r\ntype TSoundType = keyof typeof soundMap;\r\nexport class Sound {\r\n  static play(url: TSoundType){\r\n    const dom = cacheList.getAudio();\r\n    const volumeMap = {\r\n      change: 0.01,\r\n      confirm: 0.01,\r\n      done: 0.2,\r\n      warning: 0.01,\r\n    }\r\n    // @ts-ignore;\r\n    dom.volume = volumeMap[url] || 0.1;\r\n    // @ts-ignore;\r\n    dom.src = soundMap[url] || url;\r\n  }\r\n}\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","var deferred = [];\n__webpack_require__.O = function(result, chunkIds, fn, priority) {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar chunkIds = deferred[i][0];\n\t\tvar fn = deferred[i][1];\n\t\tvar priority = deferred[i][2];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every(function(key) { return __webpack_require__.O[key](chunkIds[j]); })) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tresult = fn();\n\t\t}\n\t}\n\treturn result;\n};","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t143: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = function(chunkId) { return installedChunks[chunkId] === 0; };\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tfor(moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkIds[i]] = 0;\n\t}\n\t__webpack_require__.O();\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkdy_player\"] = self[\"webpackChunkdy_player\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [998], function() { return __webpack_require__(7676); })\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"sourceRoot":""}