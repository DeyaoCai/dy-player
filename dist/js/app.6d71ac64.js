(function(){"use strict";var __webpack_modules__={8050:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{lD:function(){return biquadFilterFrequency},lW:function(){return ModifyManager}});var D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3618),D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(5020),D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(1165),D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(6018),D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(5416),core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(8309),core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(4747),core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(2222),core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es_array_map_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(1249),core_js_modules_es_array_map_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es_array_map_js__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es_array_find_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(9826),core_js_modules_es_array_find_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es_array_find_js__WEBPACK_IMPORTED_MODULE_6__),core_js_modules_es_array_splice_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(561),core_js_modules_es_array_splice_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_es_array_splice_js__WEBPACK_IMPORTED_MODULE_7__),core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(5306),core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_8__),core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(4916),core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_9__),core_js_modules_es_array_slice_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(7042),core_js_modules_es_array_slice_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(core_js_modules_es_array_slice_js__WEBPACK_IMPORTED_MODULE_10__),core_js_modules_web_url_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(285),core_js_modules_web_url_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(core_js_modules_web_url_js__WEBPACK_IMPORTED_MODULE_11__),core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(1539),core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_12__),core_js_modules_es_string_iterator_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(8783),core_js_modules_es_string_iterator_js__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(core_js_modules_es_string_iterator_js__WEBPACK_IMPORTED_MODULE_13__),core_js_modules_web_dom_collections_iterator_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(3948),core_js_modules_web_dom_collections_iterator_js__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(core_js_modules_web_dom_collections_iterator_js__WEBPACK_IMPORTED_MODULE_14__),core_js_modules_es_array_filter_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(7327),core_js_modules_es_array_filter_js__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(core_js_modules_es_array_filter_js__WEBPACK_IMPORTED_MODULE_15__),core_js_modules_es_array_includes_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(6699),core_js_modules_es_array_includes_js__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(core_js_modules_es_array_includes_js__WEBPACK_IMPORTED_MODULE_16__),_tools_DomUtil__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(353),_tools_GetType__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(8967),_tools_ListEqual__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(8556),TrackItem=function(){function e(t,n,i,r,a,s,o,c,u){(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_20__.Z)(this,e),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(this,"key",void 0),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(this,"name",void 0),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(this,"defValue",void 0),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(this,"value",void 0),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(this,"valueType",void 0),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(this,"min",void 0),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(this,"max",void 0),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(this,"desc",void 0),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(this,"trackList",void 0),this.trackList=t,this.key=n,this.name=i,this.defValue=r,this.value=a,this.valueType=s,this.min=o,this.max=c,this.desc=u}return(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_22__.Z)(e,[{key:"enc",value:function(){return this.setVal(this.value+1),this}},{key:"dec",value:function(){return this.setVal(this.value-1),this}},{key:"setMin",value:function(){return this.setVal(this.min),this}},{key:"setMax",value:function(){return this.setVal(this.max),this}},{key:"setVal",value:function(e){return e>this.max&&(e=this.max),e<this.min&&(e=this.min),this.value=e,this.trackList.savePresets(""),this}},{key:"reset",value:function(){return this.setVal(this.defValue),this}}]),e}(),Track=function(){function e(t,n){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_20__.Z)(this,e),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(this,"trackList",void 0),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(this,"current",void 0),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(this,"playing",void 0),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(this,"list",void 0),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(this,"name",void 0),this.name=t||this.constructor.name_,this.current=0,this.playing=0,this.trackList=n,this.list=[],e.commonConfigs[this.constructor.name_].forEach((function(e){var t=(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_1__.Z)(e,7),a=t[0],s=t[1],o=t[2],c=t[3],u=t[4],l=t[5],h=t[6],_=r[a];i.list.push(new TrackItem(n,a,s,o,void 0!==_?_:o,c,u,l,h))})),this.list.forEach((function(e){Object.defineProperty(i,e.key,{get:function(){return e.value}})}))}return(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_22__.Z)(e,[{key:"rename",value:function(e){console.log(e),this.name=e,this.trackList.savePresets("")}},{key:"len",get:function(){return this.list.length}},{key:"getVal",value:function(e){return _tools_ListEqual__WEBPACK_IMPORTED_MODULE_19__.kI.findByKey(this.list,e).value}},{key:"setIndex",value:function(e){return e>this.len-1&&(e=this.len-1),e<0&&(e=0),this.current=e,this.play(),this}},{key:"play",value:function(){return this.playing=this.current,this}},{key:"prev",value:function(){return this.setIndex((this.current-1+this.len)%this.len),this}},{key:"next",value:function(){return this.setIndex((this.current+1)%this.len),this}},{key:"enc",value:function(){var e=this.list[this.current];return e.enc(),this}},{key:"dec",value:function(){var e=this.list[this.current];return e.dec(),this}},{key:"setMin",value:function(){var e=this.list[this.current];return e.setMin(),this}},{key:"setMax",value:function(){var e=this.list[this.current];return e.setMax(),this}},{key:"setVal",value:function(e){var t=this.list[this.current];return t.setVal(e),this}},{key:"reset",value:function(){var e=this.list[this.current];return e.reset(),this}}]),e}();function createTrackClass(className){var string="\nclass ".concat(className," extends Track {\n  static name_ = '").concat(className,"';\n  constructor() {\n    const [...rest] = arguments;\n    super(...rest);\n  }\n\n  static setConfig(key, name, defaultValue, valueType, min, max, desc) {\n    Track.commonConfigs.").concat(className," || (Track.commonConfigs.").concat(className," = []);\n    Track.commonConfigs.").concat(className,".push([key, name, defaultValue, valueType, min, max, desc]);\n    return ").concat(className,";\n  }\n}");return eval("(".concat(string,")"))}(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(Track,"commonConfigs",{}),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(Track,"name_","Track");var trackConfigs=[{name:"CommonOptionsTrack",required:!0,list:[["CanvasView","开启音频可视化轨道",0,"int",0,1,"是否启用"],["CanvasPic","开启背景轨道",0,"int",0,1,"是否启用"],["CanvasPicMalfunction","开启背景轨道故障特效",0,"int",0,1,"是否启用"],["CanvasText","开启歌词轨道",0,"int",0,1,"是否启用"],["CanvasTextMalfunction","开启歌词轨道故障特效",0,"int",0,1,"是否启用"],["changeBG_When_LRC_Changed","背景歌词同步切换",1,"int",0,1,"是否启用"],["VideoView","开启视频轨道1",0,"int",0,1,"是否启用"],["VideoView1","开启视频轨道2",0,"int",0,1,"是否启用"],["DomClock","显示时钟",0,"int",0,1,"是否启用"],["gameUI","显示游戏界面",0,"int",0,1,"是否启用"],["gameScene","显示游戏场景",0,"int",0,1,"是否启用"]]},{name:"GameTrack",required:!0,list:[["RhythmPointVolumeFloatRange","节奏点浮动范围",1,"int",0,30,"值越大， 则节奏点越少"],["RhythmPointTimeout","节奏点最小间隔",15,"int",0,30,"timeout = (num * 10) ms"],["RhythmPointRemoveFloatRange","节奏点消除范围",20,"int",5,60,"range = (num * 10)"],["RhythmPointMissTipSound","miss提示音",0,"int",0,1,"是否开启"],["RhythmPointCenterPointOffset","轨道偏移量",-30,"int",-60,60,"轨道偏移量"],["trick","开启作弊模式",0,"int",0,1,"是否开启"]]},{multiple:!0,required:!0,name:"CanvasTrack",list:[["disable","是否启用",0,"int",0,1,"是否启用"],["renderType","渲染方式",2,"int",0,3,"渲染方式"],["direction","渲染方向",0,"int",0,1,"渲染方式"],["baseSizeType","基础尺寸单位",0,"int",0,1,"0: 屏幕较小边， 1： 屏幕较大边"],["noZero","删除无效数据",1,"int",0,1,"将频谱数据复制一份， 并逆向拼接在源数据后面"],["copyData","复制并反向数据",1,"int",0,1,"将频谱数据复制一份， 并逆向拼接在源数据后面"],["showDataBefore","展示均衡前的数据",0,"int",0,1,"展示均衡前的数据"],["midPositionX","X中心位子",50,"int",0,100,"绘制中心位于屏幕位置， 0在最左， 100在最右"],["midPositionY","Y中心位子",50,"int",0,100,"绘制中心位于屏幕位置， 0在最上， 100在最下"],["clearPrevView","保留上次渲染",70,"int",0,100,"保留上次绘制（百分比）"],["mainRadius","基线距中心点位置（Y轴）",25,"int",-100,100,"圆形时为半径, 百分比基于基础尺寸单位"],["avrLevelMainRadiusModify","频谱均值基线距离修正系数",25,"int",0,100,"基线随频谱修正系数（百分比）"],["mainRadiusOpacity","基线透明度",75,"int",0,100,"基线透明度"],["mainRadiusLineWidth","基线宽度",3,"int",0,100,"基线宽度， 千分比基准此村"],["floatRange","频谱波动范围",2,"int",-10,10,"频谱波动范围 相对基础尺寸 百分制"],["avrLevelFloatRangeModify","频谱均值波动范围修正系数",25,"int",0,100,"基线随频谱修正系数（百分比）"],["stepModify","频谱间隔修正",10,"int",0,100," 十分比预设"],["lineLineWidth","频谱宽度",3,"int",0,100," 千分比预设"],["dataModify","频谱修正系数",15,"int",0,100,"十分比预设"],["dataOffsetModify","频谱偏移修正系数",6,"int",-100,100,"百分比预设"],["minHeightModify","频谱最小修正系数",-0,"int",-300,100,"百分比预设"],["threshold","阈值",7,"int",0,100,"百分比预设"]]},{name:"VideoTrack",list:[]}],biquadFilterFrequency=[31,63,125,250,500,1e3,2e3,4e3,8e3,16e3,2e4,24e3],balanceTrackConfigs={name:"BalanceTrack",required:!0,list:biquadFilterFrequency.map((function(e,t){return["balance".concat(t),"".concat(e),0,"int",-12,12,"db"]}))};trackConfigs.push(balanceTrackConfigs);var ModifyManager=function(){function e(t){(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_20__.Z)(this,e),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(this,"updateCommonOptions",void 0),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(this,"list",void 0),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(this,"playing",void 0),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(this,"current",void 0),this.list=[],this.playing=0,this.current=0,this.setList([new TrackList(this)]),this.setIndex(0),t&&(this.updateCommonOptions=t),this.init()}return(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_22__.Z)(e,[{key:"getTrackByName",value:function(e){return this.list[0].list.find((function(t){return t.constructor.name_===e}))}},{key:"init",value:function(){return this.updateCommonOptions&&this.updateCommonOptions(),this}},{key:"len",get:function(){return this.list.length}},{key:"savePresets",value:function(){var e;return null===(e=this.list[0])||void 0===e||e.savePresets(""),this}},{key:"exportPresets",value:function(){var e;return null===(e=this.list[0])||void 0===e||e.exportPresets(),this}},{key:"importPresets",value:function(e){var t;return null===(t=this.list[0])||void 0===t||t.importPresets(e),this}},{key:"setList",value:function(e){return this.list=e,this.current=0,this}},{key:"replace",value:function(e,t){return this.list.splice(e,1,t),this}},{key:"setIndex",value:function(e){return e>this.len-1&&(e=this.len-1),e<0&&(e=0),this.current=e,this.play(),this}},{key:"play",value:function(){return this.playing=this.current,0===this.current&&this.replace(1,this.list[this.current]),this.list[this.current].play(),this}},{key:"prev",value:function(){return this.setIndex((this.current-1+this.len)%this.len),this}},{key:"next",value:function(){return this.setIndex((this.current+1)%this.len),this}},{key:"enc",value:function(){var e;return this.list[this.current]&&this.list[this.current].enc(),null===(e=this.list[0])||void 0===e||e.savePresets(""),this}},{key:"dec",value:function(){var e;return this.list[this.current]&&this.list[this.current].dec(),null===(e=this.list[0])||void 0===e||e.savePresets(""),this}},{key:"prevItem",value:function(){return this.list[this.current]&&this.list[this.current].prev(),this}},{key:"nextItem",value:function(){return this.list[this.current]&&this.list[this.current].next(),this}},{key:"up",value:function(){return this.list[0].prev(),this}},{key:"down",value:function(){return this.list[0].next(),this}},{key:"add",value:function(){var e,t,n;return null===(e=this.list[0])||void 0===e||(t=e.add).call.apply(t,[this.list[0]].concat(Array.prototype.slice.call(arguments))),null===(n=this.list[0])||void 0===n||n.savePresets(""),this}},{key:"delete",value:function(){var e,t;return(e=this.list[0].delete).call.apply(e,[this.list[0]].concat(Array.prototype.slice.call(arguments))),null===(t=this.list[0])||void 0===t||t.savePresets(),this}},{key:"copy",value:function(){var e;return(e=this.list[0].copy).call.apply(e,[this.list[0]].concat(Array.prototype.slice.call(arguments))),this.list[0].savePresets(),this}}]),e}();function createALink(e,t,n){var i=new Blob([e],{type:"text/plain;charset=utf-8"}),r=URL.createObjectURL(i),a=_tools_DomUtil__WEBPACK_IMPORTED_MODULE_17__.h.node("a",t);return a.href=r,a.download=t,_tools_DomUtil__WEBPACK_IMPORTED_MODULE_17__.h.append(n||document.body,a),a}var TrackList=function(){function e(t){var n=this;(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_20__.Z)(this,e),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(this,"playing",void 0),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(this,"current",void 0),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(this,"parent",void 0),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(this,"list",void 0),this.list=[],this.parent=t,this.playing=0,this.current=0,this.loadPresets(),constructorList.forEach((function(e){var t=e.name_,i=n.list.some((function(e){return e.constructor.name_===t}));i||n.add({type:t,name:t})}))}return(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_22__.Z)(e,[{key:"len",get:function(){return this.list.length}},{key:"add",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=e.type,i=void 0===n?"CanvasTrack":n,r=e.name,a=e.data,s=0;s<t;s++)TrackClass[i]&&this.list.push(new TrackClass[i](r,this,a));return this.setIndex(this.len-1),this}},{key:"delete",value:function(){var e=this.list[this.current],t=e.constructor.name_,n=trackConfigs.find((function(e){return e.name===t}));if(n.multiple&&!(this.list.filter((function(e){return e.constructor.name_===t})).length<=1))return e&&(this.list.splice(this.current,1),this.setIndex(0)),this}},{key:"copy",value:function(){var e=this.list[this.current],t=e.constructor.name_,n=trackConfigs.find((function(e){return e.name===t}));if(n.multiple)return e&&!["CommonOptionsTrack","BalanceTrack"].includes(e.constructor.name_)&&(this.list.splice(this.current,0,new e.constructor(e.name+"Copy",this,e)),this.setIndex(this.current+1)),this}},{key:"setList",value:function(e){return this.list=e,this.current=0,this}},{key:"setIndex",value:function(e){return e>this.len-1&&(e=this.len-1),e<0&&(e=0),this.current=e,this.play(),this}},{key:"play",value:function(){return this.playing=this.current,this.parent.replace(1,this.list[this.current]),this}},{key:"prev",value:function(){return this.setIndex((this.current-1+this.len)%this.len),this}},{key:"next",value:function(){return this.setIndex((this.current+1)%this.len),this}},{key:"importPresets",value:function(e){var t=this;return e.forEach((function(e,n){var i=t.list.find((function(t){return t.constructor.name_===e.type}));i&&!["CanvasTrack"].includes(e.type)?i.list.forEach((function(t){var n=e.data[t.key];_tools_GetType__WEBPACK_IMPORTED_MODULE_18__.X.isEmpty(n)||(t.value=n)})):t.add(e)})),this.savePresets(""),location.reload(),this}},{key:"exportPresets",value:function(){var e=this.list.map((function(e){var t={};return e.list.forEach((function(n){t[n.key]=e[n.key]})),{name:e.name,data:t,type:e.constructor.name_}})),t=createALink(JSON.stringify(e),"dy_player.preset");t.click(),_tools_DomUtil__WEBPACK_IMPORTED_MODULE_17__.h.remove(t)}},{key:"savePresets",value:function(e){var t,n,i=this.list.map((function(e){var t={};return e.list.forEach((function(n){t[n.key]=e[n.key]})),{name:e.name,data:t,type:e.constructor.name_}}));return(null===(t=this.parent)||void 0===t?void 0:t.updateCommonOptions)&&(null===(n=this.parent)||void 0===n||n.updateCommonOptions()),localStorage.setItem("configPresets",JSON.stringify(i)),this}},{key:"loadPresets",value:function(){var e=this;try{var t=JSON.parse(localStorage.getItem("configPresets")||"[]");t.length||t.push({}),constructorList.forEach((function(n){var i=n.name_,r=t.some((function(e){return e.type===i}));r||e.add({type:i,name:i})})),t.forEach((function(t){e.add(t)}))}catch(n){console.log(n),console.log("load presets fail.")}return this}}]),e}();(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_21__.Z)(TrackList,"name_","TrackList");var TrackClass={};trackConfigs.forEach((function(e){var t=TrackClass[e.name]=createTrackClass(e.name);e.list.forEach((function(e){t.setConfig.apply(t,(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__.Z)(e))}))}));var constructorList=trackConfigs.filter((function(e){return e.required})).map((function(e){return TrackClass[e.name]}))},7676:function(e,t,n){var i={};n.r(i),n.d(i,{Il:function(){return C},bs:function(){return P},J5:function(){return D},ZW:function(){return w},bH:function(){return v},mS:function(){return M}});n(6992),n(8674),n(9601),n(7727);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("Index")],1)},a=[],s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[n("NavBar"),n("div",{staticClass:"box-wrap"},[n("MusicSearchBox"),n("MusicLocalBox"),n("ModifyBox")],1),n("div",{staticClass:"canvas-view-wrap"},[e.commonOptions.gameUI?n("GameUI"):e._e(),e.commonOptions.CanvasPic?n("CanvasPic"):e._e(),e.commonOptions.CanvasText?n("CanvasText"):e._e(),e._l(e.modifyManager.list[0].list,(function(t,i){return[e.commonOptions.CanvasView&&t&&"CanvasTrack"===t.constructor.name_?n("CanvasView",{attrs:{config:t}}):e._e()]}))],2),e.commonOptions.VideoView?n("VideoView",{attrs:{index:0}}):e._e(),e.commonOptions.VideoView1?n("VideoView",{attrs:{index:1}}):e._e(),e.commonOptions.DomClock?n("DomClock"):e._e(),e.musicData.realTimeData.data?n("ThreeView"):e._e()],1)},o=[],c=n(5020),u=(n(2222),n(4747),n(9600),n(1249),n(2395)),l=n(3618),h=n(1165),_=n(6018),d=n(5416),f=(n(561),n(5827),n(1539),n(9714),n(9826),n(7327),n(4553),n(353)),p=n(5034),m=function(){function e(){(0,h.Z)(this,e),(0,d.Z)(this,"listeners",{})}return(0,_.Z)(e,[{key:"addEventListener",value:function(e,t){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t)}},{key:"removeEventListener",value:function(e,t){if(e in this.listeners)for(var n=this.listeners[e],i=0,r=n.length;i<r;i++)if(n[i]===t)return n.splice(i,1),this.removeEventListener(e,t)}},{key:"dispatchEvent",value:function(e){if(e.type in this.listeners){var t=this.listeners[e.type];e.target=this;for(var n=0,i=t.length;n<i;n++)t[n].call(this,e)}}}]),e}(),v=function e(){(0,h.Z)(this,e),(0,d.Z)(this,"dataFlag",0),(0,d.Z)(this,"shockFlag",0)},g=function e(t,n){(0,h.Z)(this,e),(0,d.Z)(this,"isRhythmPoint",void 0),(0,d.Z)(this,"vol",void 0),this.vol=t,this.isRhythmPoint=n},y=function(){function e(){(0,h.Z)(this,e),(0,d.Z)(this,"fnMap",{})}return(0,_.Z)(e,[{key:"addEventListener",value:function(e,t){this.fnMap[e]||(this.fnMap[e]=[]),this.fnMap[e].push(t)}},{key:"dispatchEvent",value:function(e){var t=this.fnMap[e.type];t&&t.forEach((function(t){return t(e)}))}}]),e}(),b=function(){function e(t){(0,h.Z)(this,e),(0,d.Z)(this,"event",new y),(0,d.Z)(this,"prevAddSpeed",0),(0,d.Z)(this,"prevAvrLevel",0),(0,d.Z)(this,"data",void 0),(0,d.Z)(this,"avrLevel",0),(0,d.Z)(this,"total",0),(0,d.Z)(this,"addSpeed",0),(0,d.Z)(this,"soundTrackArr",[]),(0,d.Z)(this,"soundTrackArrMaxLen",100),(0,d.Z)(this,"shockNum",0),(0,d.Z)(this,"modifyManager",void 0),this.modifyManager=t}return(0,_.Z)(e,[{key:"update",value:function(e){var t=this.soundTrackArr,n=this.prevAvrLevel,i=this.prevAddSpeed;this.data=e,this.total=e.reduce((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e+t}));var r=this.avrLevel=this.total/e.length,a=this.addSpeed=r-n,s=this.modifyManager.getTrackByName("GameTrack").getVal("RhythmPointVolumeFloatRange"),o=i<=0&&a>s/10,c=new g(r,o);if(t.push(c),o){this.shockNum++;var u=new Event("shock");u.rhythmPoint=c,this.event.dispatchEvent(u)}t.length>this.soundTrackArrMaxLen&&t.shift(),this.prevAddSpeed=a,this.prevAvrLevel=r,this.event.dispatchEvent(new Event("update"))}}]),e}(),w=function e(t){(0,h.Z)(this,e),(0,d.Z)(this,"realTimeData",void 0),(0,d.Z)(this,"originData",void 0),(0,d.Z)(this,"currentImgAviColor",[0,0,0,0]),(0,d.Z)(this,"calculateColors",[[255,255,255],[255,255,255]]),(0,d.Z)(this,"modifyManager",void 0),this.modifyManager=t,this.realTimeData=new b(t),this.originData=new b(t)},k=function e(t){(0,h.Z)(this,e);var n=f.h.node("div");n.classList.add("game-score"),n.innerHTML=t.toString(),f.h.append(document.body,n),e.prevNode&&f.h.remove(e.prevNode),e.prevNode=n};(0,d.Z)(k,"prevNode",void 0);var E=function e(t){if((0,h.Z)(this,e),e.prevNode&&f.h.remove(e.prevNode),e.prevNode=void 0,t>5){var n=f.h.node("div");n.classList.add("game-combo"),n.innerHTML="".concat(t||0," x combo"),f.h.append(document.body,n),e.prevNode=n}};(0,d.Z)(E,"prevNode",void 0);var T=function(){function e(t,n){var i=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;(0,h.Z)(this,e),(0,d.Z)(this,"gameList",void 0),(0,d.Z)(this,"dom",void 0),(0,d.Z)(this,"score",void 0),(0,d.Z)(this,"time",void 0),(0,d.Z)(this,"isDebug",!1),(0,d.Z)(this,"modifyManager",void 0),(0,d.Z)(this,"endFunction",(function(e){i.isDebug&&i.calculateScore(Date.now()),i.remove(),i.gameList.remove(i)})),this.gameList=t,this.time=Date.now(),this.modifyManager=s;var o=this.dom=f.h.node("div");o.className="game-item",r&&(this.isDebug=r,o.style="animation: gamingDebug linear 0.8s;");var c=120,u=n.vol*this.modifyManager.getTrackByName("GameTrack").getVal("RhythmPointCenterPointOffset"),l=f.h.node("div");f.h.append(o,l),l.style="\n      transform: rotate(".concat(u,"deg) translate(0, calc(").concat(150+n.vol/3,"px));\n      background-color: hsl(").concat(90-c*n.vol/255,", 50%, 50%);\n    "),f.h.append(a,o),o.addEventListener("webkitAnimationEnd",this.endFunction),o.addEventListener("animationend",this.endFunction)}return(0,_.Z)(e,[{key:"calculateScore",value:function(e){var t=this.gameList,n=this.time;this.score=Math.abs(e-n-t.delay)}},{key:"remove",value:function(){var e=this.dom;this.gameList.setCurrentScore(this.score),void 0!==this.score?p.$.play("done"):this.modifyManager.getTrackByName("GameTrack").getVal("RhythmPointMissTipSound")&&p.$.play("warning"),e.removeEventListener("webkitAnimationEnd",this.endFunction),e.removeEventListener("animationend",this.endFunction),e&&f.h.remove(e)}}]),e}(),P=function(){function e(t,n,i){(0,h.Z)(this,e),(0,d.Z)(this,"currentTime",0),(0,d.Z)(this,"durationTime",0),(0,d.Z)(this,"ended",!1),(0,d.Z)(this,"combo",0),(0,d.Z)(this,"maxCombo",0),(0,d.Z)(this,"currentScore",0),(0,d.Z)(this,"totalScore",0),(0,d.Z)(this,"total",0),(0,d.Z)(this,"missCount",0),(0,d.Z)(this,"uselessCount",0),(0,d.Z)(this,"mv",void 0),(0,d.Z)(this,"gameInner",void 0),(0,d.Z)(this,"modifyManager",void 0),(0,d.Z)(this,"eventTarget",new m),(0,d.Z)(this,"delay",void 0),(0,d.Z)(this,"buffer",150),(0,d.Z)(this,"duration",2e3),(0,d.Z)(this,"list",[]),this.modifyManager=i,this.mv=t,this.delay=1e3*this.mv.delay.delayTime.value,this.gameInner=n}return(0,_.Z)(e,[{key:"endSong",value:function(){this.ended=!0}},{key:"startSong",value:function(){this.ended=!1,this.currentScore=0,this.totalScore=0,this.total=0,this.combo=0,this.maxCombo=0,this.missCount=0,this.uselessCount=0}},{key:"setCombo",value:function(e){e?this.combo=0:this.combo++,this.combo>this.maxCombo&&(this.maxCombo=this.combo),new E(this.combo)}},{key:"setCurrentScore",value:function(e){this.currentScore=e||0,this.totalScore+=e||0;var t=void 0===e;t&&this.missCount++,this.setCombo(t),new k(t?"miss":"score - ".concat(e))}},{key:"find",value:function(e){var t=this.buffer,n=this.delay;return this.list.find((function(i){return Math.abs(e-i.time-n)<t}))}},{key:"indexOf",value:function(e){return this.list.indexOf(e)}},{key:"remove",value:function(e){var t=this.indexOf(e);-1!==t&&this.list.splice(t,1)}},{key:"createGameNode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new T(this,e,t,this.gameInner,this.modifyManager);return this.list.push(n),this.total++,n}},{key:"setBuffer",value:function(e){this.buffer=e,this.eventTarget.dispatchEvent(new Event("bufferChange"))}},{key:"shootGameNode",value:function(){var e=Date.now(),t=this.find(e);t?(t.calculateScore(e),t.endFunction()):(this.uselessCount++,new k("userLess press"))}}]),e}(),D=function(){function e(t,n,i,r){var a=this;(0,h.Z)(this,e),(0,d.Z)(this,"dom",void 0),(0,d.Z)(this,"time",void 0),(0,d.Z)(this,"modifyManager",void 0),(0,d.Z)(this,"destroy",(function(){a.remove()})),this.modifyManager=r,this.time=Date.now();var s=this.dom=f.h.node("div");s.className="game-scene";var o=(0,l.Z)(t.data).filter((function(e){return e})).filter((function(e,t){return!(t%16)})),c=360/o.length,u=n.originData.avrLevel*(r.getTrackByName("GameTrack").getVal("RhythmPointCenterPointOffset")||0);s.innerHTML=o.map((function(e,t){return'<div style="transform: rotateZ('.concat(-t*c+180+u,"deg) translate(0, calc(400px + ").concat(10*e,'px));"></div>')})).join(""),f.h.append(i,s),s.addEventListener("webkitAnimationEnd",this.destroy),s.addEventListener("animationend",this.destroy)}return(0,_.Z)(e,[{key:"remove",value:function(){var e=this.dom;e.removeEventListener("webkitAnimationEnd",this.destroy),e.removeEventListener("animationend",this.destroy),e&&f.h.remove(e)}}]),e}(),M=function(){function e(){(0,h.Z)(this,e),(0,d.Z)(this,"list",[])}return(0,_.Z)(e,[{key:"enter",value:function(e){var t=this.list.findIndex((function(t){return e.id===t.id}));-1===t?this.list.push(e):this.list.splice(t,1)}}]),e}(),C=function(){function e(){(0,h.Z)(this,e)}return(0,_.Z)(e,null,[{key:"compose",value:function(e){return e/=255,Math.round(255*(e+(e-.5)*(1-e)))}},{key:"dCompose",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e/=255;var n=1-e;while(t+3)n*=1-e,t--;return Math.round(255*(1-n))}},{key:"getPure",value:function(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=Math.min(t,n,i),s=a/256,o=e.dCompose,c=e.reduce;return[[o(t,r),o(t,r),o(t,r)],[o(c(t,s),r+2),o(c(n,s),r+2),o(c(i,s),r+2)]]}},{key:"reduce",value:function(e,t){return Math.round((e-255*t)/(1-t))}}]),e}(),x=(n(7941),n(655));n(7042);function O(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300,t=0;return function(n,i,r){var a=n[i];n[i]=function(){Date.now()-t-e>0&&(a.apply(n,Array.prototype.slice.call(arguments)),t=Date.now())}}}n(5306),n(4916);function I(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(I.cacheMap||(I.cacheMap={}),n||!I.cacheMap[e]){var i=document.createElement("style");i.innerHTML=t.replace(/<\/?style.*?>/g,""),document.head.appendChild(i),I.cacheMap[e]=t}else console.log("[style][".concat(e,"] is already exist!"))}I("","");var L=document.createElement("canvas"),A=document.createElement("canvas"),j=function(){function e(t){(0,h.Z)(this,e),(0,d.Z)(this,"compressRate",void 0),(0,d.Z)(this,"canvas",void 0),(0,d.Z)(this,"ctx",void 0),(0,d.Z)(this,"musicConfig",void 0),(0,d.Z)(this,"cacheList",void 0),(0,d.Z)(this,"cacheImg",void 0),this.compressRate=.1,this.musicConfig=t,this.canvas=L=L||document.createElement("canvas"),this.ctx=L.getContext("2d"),this.cacheList=[],this.cacheImg={}}return(0,_.Z)(e,[{key:"makeEl",value:function(){var t=this,n=document.createElement("img"),i=this.cacheList,r=this.cacheImg,a=this.ctx,s=this.compressRate;return n.onload=function(){if(e.setImage(n),!r[n.src]){var o=n.width,c=n.height;L.width=o*s,L.height=c*s,a.drawImage(n,0,0,L.width,L.height);var u=a.getImageData(0,0,L.width,L.height),l=[[],[],[],[]];u.data.forEach((function(e,t){l[t%4].push(e)})),r[n.src]=[B(l[0]),B(l[1]),B(l[2]),B(l[3])]}n.noNeedChangeCurrentImgAviColor||(t.musicConfig.currentImgAviColor=r[n.src]),i.push(n)},n}},{key:"load",value:function(e,t){if(e){var n=this.cacheList.shift()||this.makeEl();return n.noNeedChangeCurrentImgAviColor=t,n.src=/:\/\//.test(e)?e:"./img/".concat(e),n}}}],[{key:"setImage",value:function(t){var n=document.body,i=n.offsetWidth,r=n.offsetHeight;e.pciCanvas.width=i,e.pciCanvas.height=r,e&&e.pciCtx&&e.pciCtx.drawImage(t,(i-t.width)/2,(r-t.height)/2,t.width,t.height)}},{key:"getImageData",value:function(t,n,i,r){return e.pciCtx&&e.pciCtx.getImageData(t,n,i,r)}}]),e}();function R(e){return e.reduce((function(e,t){return e+t}),0)}function B(e){return Math.round(R(e)/e.length)}(0,d.Z)(j,"pciCanvas",A),(0,d.Z)(j,"pciCtx",A.getContext("2d"));var S=function(){function e(t){(0,h.Z)(this,e),(0,d.Z)(this,"lrc",""),(0,d.Z)(this,"ended",void 0),(0,d.Z)(this,"pictureCanvasCtx",void 0),(0,d.Z)(this,"picDom",void 0),(0,d.Z)(this,"imageGroup",[]),(0,d.Z)(this,"mouseMoveConf",{x:0,y:0,w:1,h:1,_x:.5,_y:.5}),(0,d.Z)(this,"currentImgAviColor",[255,255,255,1]),(0,d.Z)(this,"volume",{_main:1,main:.01}),(0,d.Z)(this,"currentImgSrc","");var n=t.images;this.imageGroup=[t.images];var i=new j(this);this.setPictureCanvasCtx(i),this.currentImgSrc=n[0],this.currentImgSrc&&this.changePic(void 0,!0)}return(0,_.Z)(e,[{key:"handelMouseMove",value:function(e){if(e.target===document.body){var t=this.mouseMoveConf,n=e.touches?e.touches[0]:e,i=[n.clientX,n.clientY,n.target.offsetWidth,n.target.offsetHeight],r=i[0],a=i[1],s=i[2],o=i[3],c={x:r,y:a,w:s,h:o,_x:(r-s/2)/s,_y:(a-o/2)/o};Object.keys(t).forEach((function(e){t[e]=c[e]}))}}},{key:"shock",value:function(){}},{key:"setLrc",value:function(e){this.lrc=e}},{key:"getImageData",value:function(e,t,n,i){return j.getImageData(e,t,n,i)}},{key:"changePicGroup",value:function(e){var t=this.imageGroup;t.length&&(e?t.unshift(t.pop()):t.push(t.shift())),this.changePic()}},{key:"changePic",value:function(e,t){var n=this.imageGroup[0];n.length&&(e?n.unshift(n.pop()):n.push(n.shift()),this.currentImgSrc=n[0],this.pictureCanvasCtx&&(this.picDom=this.pictureCanvasCtx.load(this.currentImgSrc)),t&&this.shock())}},{key:"encVolume",value:function(){var e=this.volume.main;e+=.05,e<0&&(e=0),e>1&&(e=1),this.volume.main=e}},{key:"decVolumn",value:function(){var e=this.volume.main;e-=.05,e<0&&(e=0),e>1&&(e=1),this.volume.main=e}},{key:"setPictureCanvasCtx",value:function(e){this.pictureCanvasCtx=e}}]),e}();(0,x.gn)([O(1)],S.prototype,"shock",null);n(8264),n(2472),n(2990),n(8927),n(3105),n(5035),n(4345),n(7174),n(2846),n(4731),n(7209),n(6319),n(8867),n(7789),n(3739),n(9368),n(4483),n(2056),n(3462),n(678),n(7462),n(3824),n(5021),n(2974),n(5016);var U=n(8050);function N(e){var t=e.ac.createPanner();return t.panningModel="HRTF",t.distanceModel="inverse",t.refDistance=1,t.maxDistance=10,t.rolloffFactor=10,t.coneInnerAngle=360,t.coneOuterAngle=0,t.coneOuterGain=0,t.orientationX?(t.orientationX.value=0,t.orientationY.value=0,t.orientationZ.value=0,t.positionX.value=0,t.positionY.value=0,t.positionZ.value=0):(t.setOrientation&&t.setOrientation(0,0,0),t.setPosition&&t.setPosition(0,0,0)),t}function Z(e){var t=e.ac.listener;return t.forwardX?(t.forwardX.value=0,t.forwardY.value=1,t.forwardZ.value=0,t.upX.value=0,t.upY.value=0,t.upZ.value=1,t.positionX.value=0,t.positionY.value=0,t.positionZ.value=0):(t.setOrientation&&t.setOrientation(0,1,0,0,0,1),t.setPosition&&t.setPosition(0,0,0)),t}function F(e,t,n){var i=U.lD.map((function(t){return W(e,t)}));return i.forEach((function(e){t.connect(e),t=e})),t.connect(n),i}function W(e,t){var n=e.ac.createBiquadFilter();return n.type="peaking",n.frequency.value=t,n}function K(e){var t=e.$audio=document.createElement("audio"),n=e.ac.createMediaElementSource(t);return t.crossOrigin="anonymous",t.autoplay=!0,t.volume=e.musicConfig.volume.main,t.onended=function(){return e.musicConfig.ended&&e.musicConfig.ended()},{$audio:t,source:n}}window.dy_player_mv_cache||(window.dy_player_mv_cache=[]);var $=function(){function e(t){if((0,h.Z)(this,e),(0,d.Z)(this,"duration",1),(0,d.Z)(this,"playing",!1),(0,d.Z)(this,"stopType",""),(0,d.Z)(this,"source",null),(0,d.Z)(this,"latestPlayTime",0),(0,d.Z)(this,"count",0),(0,d.Z)(this,"delay",void 0),(0,d.Z)(this,"musicConfig",void 0),(0,d.Z)(this,"gain",void 0),(0,d.Z)(this,"size",void 0),(0,d.Z)(this,"analyser",void 0),(0,d.Z)(this,"analyserBefore",void 0),(0,d.Z)(this,"biquadFilters",void 0),(0,d.Z)(this,"draw",void 0),(0,d.Z)(this,"resetLatestPlayTime",!1),(0,d.Z)(this,"xhr",void 0),(0,d.Z)(this,"panner",void 0),(0,d.Z)(this,"$audio",void 0),(0,d.Z)(this,"isDestoryed",!1),(0,d.Z)(this,"ac",void 0),!t.notClearPrev)while(dy_player_mv_cache.length){var n=dy_player_mv_cache.shift();n.isDestoryed=!0,n.destory()}dy_player_mv_cache.push(this),this.ac=new(window.AudioContext||window.webkitAudioContext),this.musicConfig=t.musicConfig;var i=K(this),r=i.$audio,a=i.source;this.$audio=r,r.volume=.01;var s=this.panner=N(this);Z(this);var o=this.analyser=this.ac.createAnalyser(),c=this.analyserBefore=this.ac.createAnalyser(),u=this.gain=this.ac.createGain();u.gain.value=.5,this.size=t.size||8,c.fftSize=o.fftSize=2*this.size;var l=this.delay=this.ac.createDelay();l.delayTime.value=.8,a.connect(c),this.biquadFilters=F(this,c,l),l.connect(o),o.connect(s),s.connect(u),u.connect(this.ac.destination),this.xhr=new XMLHttpRequest,this.draw=t.draw,t.volume&&this.changeVolume(t.volume),this.visualize()}return(0,_.Z)(e,[{key:"load",value:function(e,t){var n=this;this.stopType="",this.playing=!1,this.xhr.abort(),this.xhr.open("GET",e),this.xhr.responseType="arraybuffer",this.xhr.onload=function(){t(n.xhr.response)},this.xhr.send()}},{key:"destory",value:function(){this.$audio&&this.$audio.pause(),this.ac.suspend()}},{key:"decode",value:function(e,t){this.ac.decodeAudioData(e,(function(e){t(e)}),(function(e){console.log(e)}))}},{key:"play",value:function(e){var t=this,n=++this.count;this.source&&this.source[this.source.stop?"stop":"noteOff"](),this.resetLatestPlayTime=!0,e instanceof ArrayBuffer?this.decode(e,(function(e){if(n===t.count){var i=t.ac.createBufferSource();i.buffer=e,i.connect(t.analyserBefore),i[i.start?"start":"noteOn"](0),t.source=i,t.resetLatestPlayTime&&(t.latestPlayTime=t.ac.currentTime)}})):window.isPhone?this.load(e,(function(e){n===t.count&&t.decode(e,(function(e){if(t.playing=!0,n===t.count){var i=t.ac.createBufferSource();i.buffer=e,i.connect(t.analyserBefore),i[i.start?"start":"noteOn"](0),t.source=i,i.onended=function(){t.stopType||t.musicConfig.ended&&t.musicConfig.ended()},t.resetLatestPlayTime&&(t.latestPlayTime=t.ac.currentTime)}}))})):this.$audio.src=e}},{key:"changeVolume",value:function(e){this.musicConfig.volume.main=e}},{key:"setVolume",value:function(){var e=this.musicConfig,t=e.volume.main;this.$audio.volume=t;var n=this.panner,i=e.mouseMoveConf,r=i.x,a=i.y,s=i.w,o=i.h,c=(r-s/2)/s,u=-(a-o/2)/o;n.positionX?(n.positionX.value=c,n.positionY.value=u):n.setPosition&&n.setPosition(c,u,0)}},{key:"visualize",value:function(){var e=this,t=new Uint8Array(this.analyser.frequencyBinCount),n=new Uint8Array(this.analyserBefore.frequencyBinCount),i=window.requestAnimationFrame||window.webkitrequestAnimationFrame||window.mozrequestAnimationFrame,r=function r(){window.hidden||(e.draw&&(e.analyser.getByteFrequencyData(t),e.analyserBefore.getByteFrequencyData(n),e.draw({realTimeData:t,originData:n})),e.setVolume()),e.isDestoryed||i(r)};i(r)}}]),e}();(0,d.Z)($,"dtos",[]);var q=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"nav-bar",class:{active:e.active},on:{click:function(t){e.active=!e.active}}},[n("ul",[e._l(e.navList.list,(function(t,i){return n("li",["fileReader"===t.type?[n("label",{attrs:{for:t.id}},[e._v(" "+e._s(t.name)+" "),n("input",{attrs:{type:"file",id:t.id},on:{change:function(e){e.stopPropagation(),t.callback&&t.callback(e)}}})])]:[n("div",{on:{click:function(e){e.stopPropagation(),t.callback&&t.callback()}}},[e._v(e._s(t.name))])]],2)})),e._t("default")],2)])},V=[],z={name:"BalanceView",provide:function(){return{}},components:{},mixins:[],props:[],inject:["musicDataFlags","musicData","musicConfig","gameList","mv","modifyManager","navList"],data:function(){return{balanceTrack:this.modifyManager.balanceTrack,searchText:"",active:!1}},computed:{},watch:{},methods:{},mounted:function(){}},H=z,G=n(5961),X=(0,G.Z)(H,q,V,!1,null,"d6d933a2",null),Y=X.exports,Q=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ListBoxView",{attrs:{config:e.config}})},J=[],ee=(n(6699),n(4765),n(8309),n(3123),n(4723),["album.js","artists.js","artist_album.js","artist_desc.js","artist_list.js","artist_mv.js","artist_sub.js","artist_sublist.js","banner.js","check_music.js","comment.js","comment_album.js","comment_dj.js","comment_hot.js","comment_like.js","comment_music.js","comment_mv.js","comment_playlist.js","comment_video.js","daily_signin.js","dj_catelist.js","dj_detail.js","dj_hot.js","dj_paygift.js","dj_program.js","dj_program_detail.js","dj_recommend.js","dj_recommend_type.js","dj_sub.js","dj_sublist.js","event.js","fm_trash.js","follow.js","like.js","likelist.js","login.js","login_cellphone.js","login_refresh.js","login_status.js","logout.js","lyric.js","mv_detail.js","mv_first.js","mv_sub.js","mv_url.js","personalized.js","personalized_djprogram.js","personalized_mv.js","personalized_newsong.js","personalized_privatecontent.js","personal_fm.js","playlist_catlist.js","playlist_create.js","playlist_detail.js","playlist_hot.js","playlist_subscribe.js","playlist_tracks.js","playlist_update.js","program_recommend.js","recommend_resource.js","recommend_songs.js","related_allvideo.js","related_playlist.js","resource_like.js","search.js","search_hot.js","search_multimatch.js","search_suggest.js","send_playlist.js","send_text.js","simi_artist.js","simi_mv.js","simi_playlist.js","simi_song.js","simi_user.js","song_detail.js","song_url.js","toplist.js","toplist_artist.js","toplist_detail.js","top_album.js","top_artists.js","top_list.js","top_mv.js","top_playlist.js","top_playlist_highquality.js","top_song.js","user_audio.js","user_cloud.js","user_cloud_search.js","user_detail.js","user_dj.js","user_event.js","user_followeds.js","user_follows.js","user_playlist.js","user_record.js","user_subcount.js","user_update.js","video_detail.js","video_sub.js","video_url.js","weblog.js"]);function te(e){return function(t){var n={fn:null,then:function(e){return n.fn=e}},i="".concat(location.protocol,"//").concat(location.hostname,":3000")+e+(t?"?"+Object.keys(t).map((function(e){return e+"="+t[e]})).join("&"):"");return fetch(encodeURI(i),{xhrFields:{withCredentials:!0},credentials:"include"}).then((function(e){e.json().then((function(e){return n.fn&&n.fn(e)})).catch((function(e){return console.log(e)}))})),function(e){return n.fn=e}}}var ne={"daily_signin.js":"/daily_signin","fm_trash.js":"/fm_trash","personal_fm.js":"/personal_fm"},ie={};function re(e){return e.replace(/\//,"").split(/\//).map((function(e,t){return t?e[0].toUpperCase()+e.slice(1):e})).join("")}ee.forEach((function(e){if(/\.js$/i.test(e)){var t=e in ne?ne[e]:"/"+e.replace(/\.js$/i,"").replace(/_/g,"/");ie[re(t)]=te(t)}}));var ae=function(){function e(){var t=this,n=arguments,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,h.Z)(this,e),(0,d.Z)(this,"play",void 0),(0,d.Z)(this,"playing",0),(0,d.Z)(this,"current",0),(0,d.Z)(this,"list",void 0),Object.keys(i).forEach((function(e){return t[e]=i[e]})),this.play=function(){return t},i.play&&(this.play=function(){i.play&&i.play.apply(i,(0,l.Z)(n)),t.playing=t.current}),this.list=[],this.playing=0,this.current=0}return(0,_.Z)(e,[{key:"len",get:function(){return this.list.length}},{key:"setList",value:function(e,t){return this.list=e,this.current=0,t&&this.play&&this.play(),this}},{key:"setIndex",value:function(e){return e>this.len-1&&(e=this.len-1),e<0&&(e=0),this.current=e,this}},{key:"prev",value:function(e){return console.log(e),this.setIndex.apply(this,[(this.current-1+this.len)%this.len].concat(Array.prototype.slice.call(arguments))),this}},{key:"next",value:function(){return this.setIndex.apply(this,[(this.current+1)%this.len].concat(Array.prototype.slice.call(arguments))),this}}]),e}(),se=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("label",{staticClass:"music-wrap",class:{focus:e.isFocus},attrs:{for:e.itemId}},[n("div",{staticClass:"search-box",class:{focus:e.isFocus}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.config.searchText,expression:"config.searchText"}],ref:"input",attrs:{id:e.itemId,type:"text",autocomplete:"off",placeholder:"网易云音乐"},domProps:{value:e.config.searchText},on:{focus:e.focus,blur:e.blur,input:function(t){t.target.composing||e.$set(e.config,"searchText",t.target.value)}}})]),n("div",{staticClass:"music-lists"},[e._l(e.config.tabs.list,(function(t,i){return n("div",{staticClass:"song-list",class:{prev:i===(e.tabs.current-1+e.tabs.list.length)%e.tabs.list.length,active:i===e.tabs.current,next:i===(e.tabs.current+1)%e.tabs.list.length}},[e.getImgUrl(t.list[t.current])?n("span",{style:{backgroundImage:"url('"+e.getImgUrl(t.list[t.current])+"')"}}):e._e(),n("div",[n("ul",{style:{transform:"translateY(-"+50*t.current+"px)"}},e._l(t.list,(function(r,a){return n("li",{class:{active:t.current===a,playing:t.playing===a},on:{click:function(e){return e.stopPropagation(),t.setIndex(a,"list_box_click")}}},[n("span",["modify"===e.config.type&&1===i?n("ProgressBar",{attrs:{template:"",config:r}}):[e.getImgUrl(r)?n("img",{attrs:{src:e.getImgUrl(r)}}):e._e(),e._v(" "+e._s(r.name)+" "),n("span",{staticClass:"button",on:{click:function(e){t.setIndex(a,"list_box_click").play("list_box_click")}}},[e._v("play")]),t.copy?n("span",{staticClass:"button",on:{click:function(e){t.setIndex(a,"list_box_click").copy("list_box_click")}}},[e._v("copy")]):e._e(),t.delete?n("span",{staticClass:"button",on:{click:function(e){t.setIndex(a,"list_box_click").delete("list_box_click")}}},[e._v("delete")]):e._e(),r.rename?n("span",{staticClass:"button",on:{click:function(t){e.config.searchText&&r.rename(e.config.searchText,"list_box_click")}}},[e._v("rename")]):e._e()]],2)])})),0)])])})),n("div",{staticClass:"music-lists-prev",on:{click:function(t){return t.stopPropagation(),e.tabs.prev()}}}),n("div",{staticClass:"music-lists-next",on:{click:function(t){return t.stopPropagation(),e.tabs.next()}}})],2)])},oe=[],ce=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"progress-bar-wrap"},[n("div",{staticClass:"progress-bar"},[n("span",[e._v(e._s(e.config.name))]),n("span",[e._v(e._s(e.config.min))]),n("div",{ref:"drag",on:{mousedown:function(t){return e.touchEv(t)},mousemove:function(t){return e.moveEv(t)},mouseup:function(t){return e.endEv()},mouseleave:function(t){return e.endEv()}}},[n("span",{style:e.barStyle})]),n("span",[e._v(e._s(e.config.max))]),n("span",{on:{click:function(t){return e.config.setMin()}}},[e._v("min")]),n("span",{on:{click:function(t){return e.config.dec()}}},[e._v("dec")]),n("span",[e._v(e._s(e.config.value))]),n("span",{on:{click:function(t){return e.config.enc()}}},[e._v("enc")]),n("span",{on:{click:function(t){return e.config.setMax()}}},[e._v("max")]),n("span",{on:{click:function(t){return e.config.reset()}}},[e._v("reset")])])])},ue=[],le=(n(2023),function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,h.Z)(this,e),(0,d.Z)(this,"rect",void 0),(0,d.Z)(this,"position",void 0),(0,d.Z)(this,"$el",void 0),(0,d.Z)(this,"direction",void 0),(0,d.Z)(this,"_direction",void 0),(0,d.Z)(this,"oriPoint",void 0),(0,d.Z)(this,"ori",void 0),(0,d.Z)(this,"pre",void 0),(0,d.Z)(this,"now",void 0),(0,d.Z)(this,"doNotStopWhenMatch",void 0),(0,d.Z)(this,"isTouching",void 0),(0,d.Z)(this,"touched",void 0),(0,d.Z)(this,"cachePosition",void 0),(0,d.Z)(this,"moved",!1),(0,d.Z)(this,"DOMRect",void 0),(0,d.Z)(this,"resetPositionWhenTouch",void 0),this.direction=t.direction||"xy",this.oriPoint={y:0,x:0},this.ori={y:0,x:0},this.pre={y:0,x:0},this.now={y:0,x:0},this.doNotStopWhenMatch=t.doNotStopWhenMatch,this.resetPositionWhenTouch=t.resetPositionWhenTouch||!1,this.position=t.position||{x:0,y:0},this.isTouching=!1,this._direction="",this.touched=!1,this.cachePosition=[]}return(0,_.Z)(e,[{key:"setEl",value:function(e){this.$el=e;var t=this.DOMRect=e.getBoundingClientRect();this.rect={h:t.bottom-t.top,w:t.right-t.left}}},{key:"touchEv",value:function(e){if(this.setEl(e.target),this.resetPositionWhenTouch){var t=this.position,n=this.DOMRect;n&&(t.x=e.screenX-n.left,t.y=e.screenY-n.top)}this.touched=!0;var i=e.touches?e.touches[0]:e,r=i.clientY,a=i.clientX;this.oriPoint={y:r,x:a},this.direction.includes("x")||(a=0),this.direction.includes("y")||(r=0),this.ori={y:r,x:a},this.pre={y:r,x:a},this.now={y:r,x:a},this.isTouching=!0,this.moved=!1,this.cachePosition=[],this._direction=""}},{key:"moveEv",value:function(e){if(this.touched){var t=e.touches?e.touches[0]:e,n=t.clientY,i=t.clientX,r={y:0,x:0};this._direction||(this._direction=Math.abs(i-this.oriPoint.x)<Math.abs(n-this.oriPoint.y)?"y":"x"),this.direction.includes("x")&&(r.x=i),this.direction.includes("y")&&(r.y=n),this.cachePosition.push(r),this.direction.includes(this._direction)&&(this.pre=this.now,this.now=r,this.doNotStopWhenMatch||(e.cancelBubble=!0,e.stopPropagation(),e.preventDefault()))}}},{key:"endEv",value:function(){this.touched=!1,this.isTouching=!1;var e=this.getOffset(),t=this.position,n=this.rect,i={x:t.x+e.x,y:t.y+e.y};n&&(i.x<0&&(i.x=0),i.y<0&&(i.y=0),i.x>n.w&&(i.x=n.w),i.y>n.h&&(i.y=n.h)),this.position=i}},{key:"getPercent",value:function(){var e=this.rect,t=this.position,n=this.isTouching,i=this.getOffset();if(e)return{x:(t.x+(n?i.x:0))/e.w,y:(t.y+(n?i.y:0))/e.h}}},{key:"setPercent",value:function(e){var t=this.rect,n=this.position,i=e.x,r=e.y;t&&(n.x=i*t.w,n.y=r*t.h)}},{key:"getOffset",value:function(){return{y:this.now.y-this.ori.y,x:this.now.x-this.ori.x}}},{key:"getSpeed",value:function(){return{y:this.now.y-this.pre.y,x:this.now.x-this.pre.x}}}]),e}()),he=le,_e={name:"ProgressBar",inject:["musicDataFlags","musicData","musicConfig","gameList","mv","modifyManager","commonOptions_"],props:["config"],data:function(){return{drag:new he({doNotStopWhenMatch:!0,resetPositionWhenTouch:!0})}},methods:{touchEv:function(e){this.drag.touchEv(e)},moveEv:function(e){this.drag.moveEv(e)},endEv:function(e){this.drag.endEv(e),this.setPer()},setPer:function(){if(this.$el&&!this.drag.isTouching){var e=this.config,t=this.drag;t.setPercent({x:(this.currentVal-e.min)/(e.max-e.min),y:0})}}},computed:{percent:function(){var e=this.drag,t=(e.isTouching,e.position,e.getPercent());return t?t.x:0},barStyle:function(){var e=this.drag.isTouching;return{width:"".concat(100*this.percent,"%"),transition:"all ".concat(e?0:.3,"s")}},currentVal:function(){var e=this.config;return e?e.value:0}},watch:{currentVal:{immediate:!0,handler:function(){this.setPer()}},config:{immediate:!0,handler:function(){this.setPer()}},percent:function(){var e=this.config;e.setVal(Math.round(this.percent*(e.max-e.min))+e.min)}},mounted:function(){var e=this.config,t=this.drag;e.current=8,t.setEl(this.$refs.drag),this.setPer()}},de=_e,fe=(0,G.Z)(de,ce,ue,!1,null,"3982f1bd",null),pe=fe.exports,me={name:"ListBoxView",provide:function(){return{}},components:{ProgressBar:pe},mixins:[],inject:["musicDataFlags","musicData","musicConfig","gameList","mv","modifyManager","navList"],props:["config"],computed:{tabs:function(){return this.config.tabs},itemId:function(){return"ListBoxView_".concat(this.config.focusKey)}},watch:{},data:function(){return{isFocus:!1}},methods:{focus:function(){var e=this,t=this.isFocus_=Date.now();setTimeout((function(){t===e.isFocus_&&(e.isFocus=!0)}),300)},blur:function(){var e=this,t=this.isFocus_=Date.now();setTimeout((function(){t===e.isFocus_&&(e.isFocus=!1)}),300)},getImgUrl:function(e){return e&&(e.coverImgUrl||e.al&&e.al.picUrl||e.album&&e.album.picUrl)}},beforeDestory:function(){},mounted:function(){var e=this;this.navList.enter({name:this.config.name,id:this.itemId,callback:function(){e.$refs.input.focus()}});this.musicConfig,this.gameList,this.mv;var t=this.config,n=t.tabs;this.$shortCut=new u.r,"modify"===t.type&&this.$shortCut.init(this.$refs.input,{common:{w:function(){return t.tabs.up("list_box_shortcut")},s:function(){return t.tabs.down("list_box_shortcut")},q:function(){return t.tabs.prev("list_box_shortcut")},e:function(){return t.tabs.next("list_box_shortcut")},enter:function(){return t.searchText?n.search&&n.search():n.play&&n.play()},107:function(){return t.tabs.add(void 0,"list_box_shortcut")},delete:function(){return t.tabs.delete(void 0,"list_box_shortcut")},c:function(){return t.tabs.copy(void 0,"list_box_shortcut")},4:function(){return t.tabs.dec("list_box_shortcut")},6:function(){return t.tabs.enc("list_box_shortcut")},left:function(){return t.tabs.dec("list_box_shortcut")},right:function(){return t.tabs.enc("list_box_shortcut")},a:function(){return t.tabs.dec("list_box_shortcut")},d:function(){return t.tabs.enc("list_box_shortcut")},8:function(){return t.tabs.prevItem("list_box_shortcut")},2:function(){return t.tabs.nextItem("list_box_shortcut")},up:function(){return t.tabs.prevItem("list_box_shortcut")},down:function(){return t.tabs.nextItem("list_box_shortcut")},esc:function(){return e.$refs.input.blur("list_box_shortcut")}},alt:{},shift:{},ctrl:{}},{common:{w:"上一项",s:"下一项",q:"左翻页",e:"右翻页",107:"添加配置",delete:"删除配置",c:"复制当前配置",4:"参数小",6:"参数大",left:"参数小",right:"参数大",a:"参数小",d:"参数大",8:"上一项",2:"下一项",up:"上一项",down:"下一项",esc:"关闭配置页面"},alt:{},shift:{},ctrl:{}}),"listBox"===t.type&&this.$shortCut.init(this.$refs.input,{common:{up:function(){return t.tabs.list[t.tabs.current].prev("list_box_shortcut")},down:function(){return t.tabs.list[t.tabs.current].next("list_box_shortcut")},left:function(){return t.searchText||t.tabs.prev("list_box_shortcut")},right:function(){return t.searchText||t.tabs.next("list_box_shortcut")},enter:function(){return t.search&&t.searchText?t.search():t.tabs.list[t.tabs.current].play()},backspace:function(){return t.searchText||t.tabs.current&&t.tabs.prev("list_box_shortcut")},esc:function(){return e.$refs.input.blur()}}},{common:{up:"上一项",down:"下一项",left:"上一页",right:"上一页",enter:"搜索|播放|确认",backspace:"删除|返回上一页",esc:"关闭页面"}}),u.t.init(void 0,{alt:(0,d.Z)({},this.config.focusKey,(function(){e.$refs.input.focus()}))},{alt:(0,d.Z)({},this.config.focusKey,"打开页面")})}},ve=me,ge=(0,G.Z)(ve,se,oe,!1,null,null,null),ye=ge.exports,be={name:"MusicSearchBox",provide:function(){return{}},components:{ListBoxView:ye},mixins:[],inject:["musicDataFlags","musicData","musicConfig","gameList","mv","modifyManager"],data:function(){var e=this,t=new ae,n=new ae({play:function(t){var i=n.list[n.current];e.mv.$audio.currentTime=i.time/10},setIndex:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(this.setIndexFlag&&!n)return this;if(["list_box_click","list_box_shortcut"].includes(n)){var i=this.setIndexFlag=Date.now();setTimeout((function(){i===t.setIndexFlag&&(t.setIndexFlag=void 0)}),3e3)}return e>this.len-1&&(e=this.len-1),e<0&&(e=0),this.current=e,this}}),i=new ae({play:function(t){return e.play(t)}}),r=new ae({play:function(){ie.playlistDetail({id:e.sheetList.list[e.sheetList.current].id})((function(t){e.sheet.setList(t.playlist.tracks,!0)}))}});return t.setList([r,i,n]),{config:{type:"listBox",name:"网易云音乐",tabs:t,searchText:"",focusKey:"q",search:function(){return e.search()}},currentTime:0,timer:null,tabs:t,lrcs:n,sheet:i,sheetList:r,account:null}},computed:{},watch:{"lrcs.current":function(){var e=this.lrcs,t=e.list,n=e.current;this.modifyManager.getTrackByName("CommonOptionsTrack").getVal("changeBG_When_LRC_Changed")&&this.musicConfig.changePic(),this.musicConfig.setLrc(t[n]&&t[n].name||"")},currentTime:{immediate:!0,handler:function(){var e=this.mv.$audio.currentTime;this.gameList.currentTime=1e3*e;var t=parseInt(10*e),n=0;this.lrcs.list.some((function(e,i){return e.time<=t&&(n=i),e.time>t})),this.lrcs.setIndex(n)}},account:{immediate:!0,handler:function(){this.account&&this.getUserSongList()}}},methods:{getLrc:function(){var e=this,t=this.sheet.list[this.sheet.current];t&&(ie.lyric({id:t.id||t.songId})((function(t){var n=t.lrc.lyric.split(/\n/).map((function(e){var t=e.match(/(?:\[)(\d+)(?::)([^\]]+)(?:\])([^\[\]]*)/);return{name:t?t[3]:"",time:t?parseInt(10*(60*+t[1]+ +t[2])):0}}));e.lrcs.setList(n)})),this.lrcs.setList([]))},login:function(){var e=this,t={phone:localStorage.getItem("userPhone"),password:localStorage.getItem("password")};if(!t.password||!t.password)return u.r.toast(["正式环境位开放远程歌曲"]),void setTimeout((function(){u.r.toast(["请使用测试歌曲"])}),600);ie.loginCellphone(t)((function(t){e.account=t.account,e.getMySheets()}))},getImgUrl:function(e){return e&&(e.coverImgUrl||e.al&&e.al.picUrl||e.album&&e.album.picUrl)},getSongUrl:function(){var e=this.mv,t=this.sheet.list[this.sheet.current];t&&(this.gameList.durationTime=e.duration=e.duration=t.duration||t.dt,ie.songUrl({id:t.id})((function(t){e.play(t.data[0].url)})))},play:function(e){var t=this,n=this.gameList,i=this.mv,r=function(){n.startSong(),i.stopType=e,t.getSongUrl(),t.getLrc(),t.tabs.setIndex(1),t.config.searchText=""};i.$audio.paused?r():(i.$audio.pause(),setTimeout((function(){r()}),1e3*i.delay.delayTime.value+n.buffer))},getUserSongList:function(){var e=this;ie.userPlaylist({uid:this.account.id})((function(t){e.sheetList.setList(t.playlist,!0)}))},getMySheets:function(){var e=this;ie.recommendSongs()((function(t){e.sheet.setList(t.recommend||[])}))},like:function(){var e=this.sheet.list[this.sheet.current],t=this.sheetList.list[0];t&&e&&ie.playlistTracks({op:"add",pid:t.id,tracks:e.id})((function(e){console.log("like")}))},search:function(){var e=this;this.config.searchText&&ie.search({keywords:this.config.searchText})((function(t){e.sheet.setList(t.result.songs,!0),e.config.searchText=""}))}},beforeDestory:function(){clearInterval(this.timer)},mounted:function(){var e=this,t=this.musicConfig,n=this.gameList,i=this.mv;t.ended=function(){setTimeout((function(){n.endSong(),setTimeout((function(){e.sheet.next(),e.sheet.play()}),5e3)}),1e3*i.delay.delayTime.value+n.buffer+1e3)},this.timer=setInterval((function(){return e.currentTime=Date.now()}),50),this.login(),u.t.init(void 0,{alt:{left:function(){var e=i.$audio.currentTime-5;i.$audio.currentTime=e>=0?e:0},right:function(){var e=i.$audio.currentTime+5;i.$audio.currentTime=e<=i.$audio.duration?e:i.$audio.duration},p:function(){return i.$audio.paused?i.$audio.play():i.$audio.pause()}},ctrl:{left:function(){return t.changePic(!0)},right:function(){return t.changePic()}}},{alt:{left:"退后5s",right:"前进5s",p:"暂停/播放"},ctrl:{left:"上一张图片",right:"下一张图片"}})}},we=be,ke=(0,G.Z)(we,Q,J,!1,null,null,null),Ee=ke.exports,Te=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ListBoxView",{attrs:{config:e.config}})},Pe=[],De={name:"MusicLocalBox",provide:function(){return{}},components:{ListBoxView:ye},mixins:[],inject:["musicDataFlags","musicData","musicConfig","gameList","mv","modifyManager","navList"],data:function(){var e=this,t=new ae,n=new ae({play:function(){e.play()}});return t.setList([n]),n.setList([{name:"testSong",url:"./sound/testSound.mp3"}]),{config:{type:"listBox",name:"测试歌曲",tabs:t,searchText:"",focusKey:"w"},tabs:t,songList:n}},computed:{},watch:{},methods:{play:function(e){var t=this,n=this.gameList,i=this.mv,r=function(){n.startSong(),i.stopType=e,i.play(t.songList.list[t.songList.current].url),t.searchText=""};i.$audio.paused?r():(i.$audio.pause(),setTimeout((function(){r()}),1e3*i.delay.delayTime.value+n.buffer))}},mounted:function(){this.musicConfig,this.gameList;var e=this.mv;u.t.init(void 0,{alt:{left:function(){var t=e.$audio.currentTime-5;e.$audio.currentTime=t>=0?t:0},right:function(){var t=e.$audio.currentTime+5;e.$audio.currentTime=t<=e.$audio.duration?t:e.$audio.duration},p:function(){return e.$audio.paused?e.$audio.play():e.$audio.pause()}},ctrl:{}},{alt:{left:"退后5s",right:"前进5s",p:"暂停/播放"},ctrl:{}})}},Me=De,Ce=(0,G.Z)(Me,Te,Pe,!1,null,null,null),xe=Ce.exports,Oe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ListBoxView",{attrs:{config:e.config}})},Ie=[],Le={name:"ModifyBox",provide:function(){return{}},components:{ListBoxView:ye},mixins:[],inject:["modifyManager","navList"],data:function(){return{config:{type:"modify",name:"参数调整",tabs:this.modifyManager,searchText:"",focusKey:"e"}}},computed:{},watch:{},methods:{search:function(){}},mounted:function(){}},Ae=Le,je=(0,G.Z)(Ae,Oe,Ie,!1,null,"a24a1548",null),Re=je.exports,Be=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"wrap",staticClass:"three-view"})},Se=[],Ue=(n(2479),n(9100)),Ne=(n(3948),n(86),function(e,t){void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new Ue.Pa4,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:Ue.RsA.ROTATE,MIDDLE:Ue.RsA.DOLLY,RIGHT:Ue.RsA.PAN},this.touches={ONE:Ue.QmN.ROTATE,TWO:Ue.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return u.phi},this.getAzimuthalAngle=function(){return u.theta},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(i),n.update(),o=s.NONE},this.update=function(){var t=new Ue.Pa4,r=(new Ue._fP).setFromUnitVectors(e.up,new Ue.Pa4(0,1,0)),a=r.clone().inverse(),f=new Ue.Pa4,p=new Ue._fP;return function(){var e=n.object.position;return t.copy(e).sub(n.target),t.applyQuaternion(r),u.setFromVector3(t),n.autoRotate&&o===s.NONE&&P(E()),n.enableDamping?(u.theta+=l.theta*n.dampingFactor,u.phi+=l.phi*n.dampingFactor):(u.theta+=l.theta,u.phi+=l.phi),u.theta=Math.max(n.minAzimuthAngle,Math.min(n.maxAzimuthAngle,u.theta)),u.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,u.phi)),u.makeSafe(),u.radius*=h,u.radius=Math.max(n.minDistance,Math.min(n.maxDistance,u.radius)),!0===n.enableDamping?n.target.addScaledVector(_,n.dampingFactor):n.target.add(_),t.setFromSpherical(u),t.applyQuaternion(a),e.copy(n.target).add(t),n.object.lookAt(n.target),!0===n.enableDamping?(l.theta*=1-n.dampingFactor,l.phi*=1-n.dampingFactor,_.multiplyScalar(1-n.dampingFactor)):(l.set(0,0,0),_.set(0,0,0)),h=1,!!(d||f.distanceToSquared(n.object.position)>c||8*(1-p.dot(n.object.quaternion))>c)&&(n.dispatchEvent(i),f.copy(n.object.position),p.copy(n.object.quaternion),d=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",se,!1),n.domElement.removeEventListener("mousedown",Q,!1),n.domElement.removeEventListener("wheel",te,!1),n.domElement.removeEventListener("touchstart",ie,!1),n.domElement.removeEventListener("touchend",ae,!1),n.domElement.removeEventListener("touchmove",re,!1),document.removeEventListener("mousemove",J,!1),document.removeEventListener("mouseup",ee,!1),n.domElement.removeEventListener("keydown",ne,!1)};var n=this,i={type:"change"},r={type:"start"},a={type:"end"},s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},o=s.NONE,c=1e-6,u=new Ue.$V,l=new Ue.$V,h=1,_=new Ue.Pa4,d=!1,f=new Ue.FM8,p=new Ue.FM8,m=new Ue.FM8,v=new Ue.FM8,g=new Ue.FM8,y=new Ue.FM8,b=new Ue.FM8,w=new Ue.FM8,k=new Ue.FM8;function E(){return 2*Math.PI/60/60*n.autoRotateSpeed}function T(){return Math.pow(.95,n.zoomSpeed)}function P(e){l.theta-=e}function D(e){l.phi-=e}var M=function(){var e=new Ue.Pa4;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),_.add(e)}}(),C=function(){var e=new Ue.Pa4;return function(t,i){!0===n.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),_.add(e)}}(),x=function(){var e=new Ue.Pa4;return function(t,i){var r=n.domElement;if(n.object.isPerspectiveCamera){var a=n.object.position;e.copy(a).sub(n.target);var s=e.length();s*=Math.tan(n.object.fov/2*Math.PI/180),M(2*t*s/r.clientHeight,n.object.matrix),C(2*i*s/r.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(M(t*(n.object.right-n.object.left)/n.object.zoom/r.clientWidth,n.object.matrix),C(i*(n.object.top-n.object.bottom)/n.object.zoom/r.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function O(e){n.object.isPerspectiveCamera?h/=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*e)),n.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function I(e){n.object.isPerspectiveCamera?h*=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/e)),n.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function L(e){f.set(e.clientX,e.clientY)}function A(e){b.set(e.clientX,e.clientY)}function j(e){v.set(e.clientX,e.clientY)}function R(e){p.set(e.clientX,e.clientY),m.subVectors(p,f).multiplyScalar(n.rotateSpeed);var t=n.domElement;P(2*Math.PI*m.x/t.clientHeight),D(2*Math.PI*m.y/t.clientHeight),f.copy(p),n.update()}function B(e){w.set(e.clientX,e.clientY),k.subVectors(w,b),k.y>0?O(T()):k.y<0&&I(T()),b.copy(w),n.update()}function S(e){g.set(e.clientX,e.clientY),y.subVectors(g,v).multiplyScalar(n.panSpeed),x(y.x,y.y),v.copy(g),n.update()}function U(){}function N(e){e.deltaY<0?I(T()):e.deltaY>0&&O(T()),n.update()}function Z(e){var t=!1;switch(e.keyCode){case n.keys.UP:x(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:x(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:x(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:x(-n.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),n.update())}function F(e){if(1==e.touches.length)f.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);f.set(t,n)}}function W(e){if(1==e.touches.length)v.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);v.set(t,n)}}function K(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);b.set(0,i)}function $(e){n.enableZoom&&K(e),n.enablePan&&W(e)}function q(e){n.enableZoom&&K(e),n.enableRotate&&F(e)}function V(e){if(1==e.touches.length)p.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);p.set(t,i)}m.subVectors(p,f).multiplyScalar(n.rotateSpeed);var r=n.domElement;P(2*Math.PI*m.x/r.clientHeight),D(2*Math.PI*m.y/r.clientHeight),f.copy(p)}function z(e){if(1==e.touches.length)g.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);g.set(t,i)}y.subVectors(g,v).multiplyScalar(n.panSpeed),x(y.x,y.y),v.copy(g)}function H(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+i*i);w.set(0,r),k.set(0,Math.pow(w.y/b.y,n.zoomSpeed)),O(k.y),b.copy(w)}function G(e){n.enableZoom&&H(e),n.enablePan&&z(e)}function X(e){n.enableZoom&&H(e),n.enableRotate&&V(e)}function Y(){}function Q(e){if(!1!==n.enabled){switch(e.preventDefault(),n.domElement.focus?n.domElement.focus():window.focus(),e.button){case 0:switch(n.mouseButtons.LEFT){case Ue.RsA.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;j(e),o=s.PAN}else{if(!1===n.enableRotate)return;L(e),o=s.ROTATE}break;case Ue.RsA.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;L(e),o=s.ROTATE}else{if(!1===n.enablePan)return;j(e),o=s.PAN}break;default:o=s.NONE}break;case 1:switch(n.mouseButtons.MIDDLE){case Ue.RsA.DOLLY:if(!1===n.enableZoom)return;A(e),o=s.DOLLY;break;default:o=s.NONE}break;case 2:switch(n.mouseButtons.RIGHT){case Ue.RsA.ROTATE:if(!1===n.enableRotate)return;L(e),o=s.ROTATE;break;case Ue.RsA.PAN:if(!1===n.enablePan)return;j(e),o=s.PAN;break;default:o=s.NONE}break}o!==s.NONE&&(document.addEventListener("mousemove",J,!1),document.addEventListener("mouseup",ee,!1),n.dispatchEvent(r))}}function J(e){if(!1!==n.enabled)switch(e.preventDefault(),o){case s.ROTATE:if(!1===n.enableRotate)return;R(e);break;case s.DOLLY:if(!1===n.enableZoom)return;B(e);break;case s.PAN:if(!1===n.enablePan)return;S(e);break}}function ee(e){!1!==n.enabled&&(U(e),document.removeEventListener("mousemove",J,!1),document.removeEventListener("mouseup",ee,!1),n.dispatchEvent(a),o=s.NONE)}function te(e){!1===n.enabled||!1===n.enableZoom||o!==s.NONE&&o!==s.ROTATE||(e.preventDefault(),e.stopPropagation(),n.dispatchEvent(r),N(e),n.dispatchEvent(a))}function ne(e){!1!==n.enabled&&!1!==n.enableKeys&&!1!==n.enablePan&&Z(e)}function ie(e){if(!1!==n.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(n.touches.ONE){case Ue.QmN.ROTATE:if(!1===n.enableRotate)return;F(e),o=s.TOUCH_ROTATE;break;case Ue.QmN.PAN:if(!1===n.enablePan)return;W(e),o=s.TOUCH_PAN;break;default:o=s.NONE}break;case 2:switch(n.touches.TWO){case Ue.QmN.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;$(e),o=s.TOUCH_DOLLY_PAN;break;case Ue.QmN.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;q(e),o=s.TOUCH_DOLLY_ROTATE;break;default:o=s.NONE}break;default:o=s.NONE}o!==s.NONE&&n.dispatchEvent(r)}}function re(e){if(!1!==n.enabled)switch(e.preventDefault(),e.stopPropagation(),o){case s.TOUCH_ROTATE:if(!1===n.enableRotate)return;V(e),n.update();break;case s.TOUCH_PAN:if(!1===n.enablePan)return;z(e),n.update();break;case s.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;G(e),n.update();break;case s.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;X(e),n.update();break;default:o=s.NONE}}function ae(e){!1!==n.enabled&&(Y(e),n.dispatchEvent(a),o=s.NONE)}function se(e){!1!==n.enabled&&e.preventDefault()}n.domElement.addEventListener("contextmenu",se,!1),n.domElement.addEventListener("mousedown",Q,!1),n.domElement.addEventListener("wheel",te,!1),n.domElement.addEventListener("touchstart",ie,!1),n.domElement.addEventListener("touchend",ae,!1),n.domElement.addEventListener("touchmove",re,!1),n.domElement.addEventListener("keydown",ne,!1),-1===n.domElement.tabIndex&&(n.domElement.tabIndex=0),this.update()});Ne.prototype=Object.create(Ue.pBf.prototype),Ne.prototype.constructor=Ne;var Ze=function(e,t){Ne.call(this,e,t),this.mouseButtons.LEFT=Ue.RsA.PAN,this.mouseButtons.RIGHT=Ue.RsA.ROTATE,this.touches.ONE=Ue.QmN.PAN,this.touches.TWO=Ue.QmN.DOLLY_ROTATE};Ze.prototype=Object.create(Ue.pBf.prototype),Ze.prototype.constructor=Ze;n(4129),n(8783),n(285);var Fe=function(e){Ue.aNw.call(this,e),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[]};Fe.taskCache=new WeakMap,Fe.prototype=Object.assign(Object.create(Ue.aNw.prototype),{constructor:Fe,setLibraryPath:function(e){return this.libraryPath=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},load:function(e,t,n,i){var r=this,a=new Ue.hH6(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.load(e,(function(n){if(Fe.taskCache.has(n)){var a=Fe.taskCache.get(n);return a.promise.then(t).catch(i)}r.decodeObjects(n,e).then(t).catch(i)}),n,i)},debug:function(){console.log("Task load: ",this.workerPool.map((function(e){return e._taskLoad})))},decodeObjects:function(e,t){var n,i,r=this,a=e.byteLength,s=this._getWorker(a).then((function(t){return n=t,i=r.workerNextTaskID++,new Promise((function(t,r){n._callbacks[i]={resolve:t,reject:r},n.postMessage({type:"decode",id:i,buffer:e},[e])}))})).then((function(e){return r._createGeometry(e.data)}));return s.catch((function(){return!0})).then((function(){n&&i&&r._releaseTask(n,i)})),Fe.taskCache.set(e,{url:t,promise:s}),s},parse:function(e,t,n){this.decodeObjects(e,"").then(t).catch(n)},_compareMaterials:function(e){var t={};t.name=e.name,t.color={},t.color.r=e.color.r,t.color.g=e.color.g,t.color.b=e.color.b,t.type=e.type;for(var n=0;n<this.materials.length;n++){var i=this.materials[n],r={};if(r.name=i.name,r.color={},r.color.r=i.color.r,r.color.g=i.color.g,r.color.b=i.color.b,r.type=i.type,JSON.stringify(t)===JSON.stringify(r))return i}return this.materials.push(e),e},_createMaterial:function(e){if(void 0===e)return new Ue.Wid({color:new Ue.Ilk(1,1,1),metalness:.8,name:"default",side:2});var t=e.diffuseColor,n=new Ue.Ilk(t.r/255,t.g/255,t.b/255);0===t.r&&0===t.g&&0===t.b&&(n.r=1,n.g=1,n.b=1);for(var i=new Ue.Wid({color:n,name:e.name,side:2,transparent:e.transparency>0,opacity:1-e.transparency}),r=new Ue.dpR,a=0;a<e.textures.length;a++){var s=e.textures[a];if(null!==s.image){var o=r.load(s.image);switch(s.type){case"Diffuse":i.map=o;break;case"Bump":i.bumpMap=o;break;case"Transparency":i.alphaMap=o,i.transparent=!0;break;case"Emap":i.envMap=o;break}}}return i},_createGeometry:function(e){var t=new Ue.Tme,n=[],i=[],r=[];t.userData["layers"]=e.layers,t.userData["groups"]=e.groups,t.userData["settings"]=e.settings;for(var a=e.objects,s=e.materials,o=0;o<a.length;o++){var c=a[o],u=c.attributes;switch(c.objectType){case"InstanceDefinition":i.push(c);break;case"InstanceReference":r.push(c);break;default:if(u.hasOwnProperty("materialUUID")){var l=s.find((function(e){return e.id===u.materialUUID})),h=this._createMaterial(l);h=this._compareMaterials(h);var _=this._createObject(c,h)}else _=this._createObject(c,null);if(void 0===_)continue;var d=e.layers[u.layerIndex];_.visible=!d||e.layers[u.layerIndex].visible,u.isInstanceDefinitionObject?n.push(_):t.add(_);break}}for(o=0;o<i.length;o++){for(var f=i[o],p=(a=[],0);p<f.attributes.objectIds.length;p++)for(var m=f.attributes.objectIds[p],v=0;v<n.length;v++){var g=n[v].userData.attributes.id;m===g&&a.push(n[v])}for(p=0;p<r.length;p++){var y=r[p];if(y.geometry.parentIdefId===f.attributes.id){var b=new Ue.Tme,w=y.geometry.xform.array,k=new Ue.yGw;k.set(w[0],w[1],w[2],w[3],w[4],w[5],w[6],w[7],w[8],w[9],w[10],w[11],w[12],w[13],w[14],w[15]),b.applyMatrix4(k);for(v=0;v<a.length;v++)b.add(a[v].clone(!0));t.add(b)}}}return this.materials=[],t},_createObject:function(e,t){var n=new Ue.s4_,i=e.attributes;switch(e.objectType){case"Point":case"PointSet":var r=n.parse(e.geometry),a=i.drawColor,s=new Ue.Ilk(a.r/255,a.g/255,a.b/255),o=new Ue.UY4({color:s,sizeAttenuation:!1,size:2});r.attributes.hasOwnProperty("color")&&(o.vertexColors=!0),o=this._compareMaterials(o);var c=new Ue.woe(r,o);return c.userData["attributes"]=i,c.userData["objectType"]=e.objectType,c;case"Mesh":case"Extrusion":r=n.parse(e.geometry);r.attributes.hasOwnProperty("color")&&(t.vertexColors=!0);var u=new Ue.Kj0(r,t);return u.castShadow=i.castsShadows,u.receiveShadow=i.receivesShadows,u.userData["attributes"]=i,u.userData["objectType"]=e.objectType,u;case"Brep":for(var l=new Ue.Tme,h=0;h<e.geometry.length;h++){r=n.parse(e.geometry[h]);u=new Ue.Kj0(r,t);u.castShadow=i.castsShadows,u.receiveShadow=i.receivesShadows,l.add(u)}return l.userData["attributes"]=i,l.userData["objectType"]=e.objectType,l;case"Curve":r=n.parse(e.geometry);a=i.drawColor,s=new Ue.Ilk(a.r/255,a.g/255,a.b/255),o=new Ue.nls({color:s});o=this._compareMaterials(o);var _=new Ue.x12(r,o);return _.userData["attributes"]=i,_.userData["objectType"]=e.objectType,_;case"TextDot":r=e.geometry;var d=document.createElement("canvas").getContext("2d"),f="".concat(r.fontHeight,"px ").concat(r.fontFace);d.font=f;var p=d.measureText(r.text).width+10,m=r.fontHeight+10;d.canvas.width=p,d.canvas.height=m,d.font=f,d.textBaseline="middle",d.textAlign="center";s=i.drawColor;d.fillStyle="rgba(".concat(s.r,",").concat(s.g,",").concat(s.b,",").concat(s.a,")"),d.fillRect(0,0,p,m),d.fillStyle="white",d.fillText(r.text,p/2,m/2);var v=new Ue.ROQ(d.canvas);v.minFilter=Ue.wem,v.wrapS=Ue.uWy,v.wrapT=Ue.uWy;o=new Ue.xeV({map:v,depthTest:!1});var g=new Ue.jyi(o);return g.position.set(r.point[0],r.point[1],r.point[2]),g.scale.set(p/10,m/10,1),g.userData["attributes"]=i,g.userData["objectType"]=e.objectType,g;case"Light":var y;if(r=e.geometry,r.isDirectionalLight)y=new Ue.Ox3,y.castShadow=i.castsShadows,y.position.set(r.location[0],r.location[1],r.location[2]),y.target.position.set(r.direction[0],r.direction[1],r.direction[2]),y.shadow.normalBias=.1;else if(r.isPointLight)y=new Ue.cek,y.castShadow=i.castsShadows,y.position.set(r.location[0],r.location[1],r.location[2]),y.shadow.normalBias=.1;else if(r.isRectangularLight){y=new Ue.T_f;p=Math.abs(r.width[2]),m=Math.abs(r.length[0]);y.position.set(r.location[0]-m/2,r.location[1],r.location[2]-p/2),y.height=m,y.width=p,y.lookAt(new Ue.Pa4(r.direction[0],r.direction[1],r.direction[2]))}else if(r.isSpotLight)y=new Ue.PMe,y.castShadow=i.castsShadows,y.position.set(r.location[0],r.location[1],r.location[2]),y.target.position.set(r.direction[0],r.direction[1],r.direction[2]),y.angle=r.spotAngleRadians,y.shadow.normalBias=.1;else if(r.isLinearLight)return void console.warn("THREE.3DMLoader:  No conversion exists for linear lights.");return y&&(y.intensity=r.intensity,y.userData["attributes"]=i,y.userData["objectType"]=e.objectType),y}},_initLibrary:function(){var e=this;if(!this.libraryPending){var t=new Ue.hH6(this.manager);t.setPath(this.libraryPath);var n=new Promise((function(e,n){t.load("rhino3dm.js",e,void 0,n)})),i=new Ue.hH6(this.manager);i.setPath(this.libraryPath),i.setResponseType("arraybuffer");var r=new Promise((function(e,t){i.load("rhino3dm.wasm",e,void 0,t)}));this.libraryPending=Promise.all([n,r]).then((function(t){var n=(0,c.Z)(t,2),i=n[0],r=n[1];e.libraryConfig.wasmBinary=r;var a=Fe.Rhino3dmWorker.toString(),s=["/* rhino3dm.js */",i,"/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([s]))}))}return this.libraryPending},_getWorker:function(e){var t=this;return this._initLibrary().then((function(){if(t.workerPool.length<t.workerLimit){var n=new Worker(t.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",libraryConfig:t.libraryConfig}),n.onmessage=function(e){var t=e.data;switch(t.type){case"decode":n._callbacks[t.id].resolve(t);break;case"error":n._callbacks[t.id].reject(t);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+t.type+'"')}},t.workerPool.push(n)}else t.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));n=t.workerPool[t.workerPool.length-1];return n._taskLoad+=e,n}))},_releaseTask:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]},dispose:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}),Fe.Rhino3dmWorker=function(){var e,t,n;function i(e,t){for(var n=new Uint8Array(t),i=e.File3dm.fromByteArray(n),s=[],o=[],c=[],u=[],l=[],h=[],_=0;_<i.objects().count;_++){var d=i.objects().get(_),f=r(d,i);if(void 0!==f){if(f.attributes.materialIndex>=0){var p=i.materials().findIndex(f.attributes.materialIndex).id;f.attributes.materialUUID=p}s.push(f)}d.delete()}for(_=0;_<i.instanceDefinitions().count();_++){var m=i.instanceDefinitions().get(_),v=a(m);v.objectIds=m.getObjectIds(),s.push({geometry:null,attributes:v,objectType:"InstanceDefinition"})}var g=[e.TextureType.Diffuse,e.TextureType.Bump,e.TextureType.Transparency,e.TextureType.Opacity,e.TextureType.Emap],y=[e.TextureType.PBR_BaseColor,e.TextureType.PBR_Subsurface,e.TextureType.PBR_SubsurfaceScattering,e.TextureType.PBR_SubsurfaceScatteringRadius,e.TextureType.PBR_Metallic,e.TextureType.PBR_Specular,e.TextureType.PBR_SpecularTint,e.TextureType.PBR_Roughness,e.TextureType.PBR_Anisotropic,e.TextureType.PBR_Anisotropic_Rotation,e.TextureType.PBR_Sheen,e.TextureType.PBR_SheenTint,e.TextureType.PBR_Clearcoat,e.TextureType.PBR_ClearcoatBump,e.TextureType.PBR_ClearcoatRoughness,e.TextureType.PBR_OpacityIor,e.TextureType.PBR_OpacityRoughness,e.TextureType.PBR_Emission,e.TextureType.PBR_AmbientOcclusion,e.TextureType.PBR_Displacement];for(_=0;_<i.materials().count();_++){for(var b=i.materials().get(_),w=b.physicallyBased(),k=a(b),E=[],T=0;T<g.length;T++){var P=b.getTexture(g[T]);if(P){var D=g[T].constructor.name;D=D.substring(12,D.length);var M={type:D},C=i.getEmbeddedFileAsBase64(P.fileName);C?M.image="data:image/png;base64,"+C:(console.warn("THREE.3DMLoader: Image for ".concat(D," texture not embedded in file.")),M.image=null),E.push(M),P.delete()}}if(k.textures=E,w.supported){console.log("pbr true");for(T=0;T<y.length;T++){P=b.getTexture(g[T]);if(P){C=i.getEmbeddedFileAsBase64(P.fileName),D=g[T].constructor.name;D=D.substring(12,D.length);M={type:D,image:"data:image/png;base64,"+C};E.push(M),P.delete()}}var x=a(b.physicallyBased());k=Object.assign(x,k)}o.push(k),b.delete(),w.delete()}for(_=0;_<i.layers().count();_++){var O=i.layers().get(_),I=a(O);c.push(I),O.delete()}for(_=0;_<i.views().count();_++){var L=i.views().get(_),A=a(L);u.push(A),L.delete()}for(_=0;_<i.namedViews().count();_++){var j=i.namedViews().get(_),R=a(j);l.push(R),j.delete()}for(_=0;_<i.groups().count();_++){var B=i.groups().get(_),S=a(B);h.push(S),B.delete()}var U=a(i.settings());return i.delete(),{objects:s,materials:o,layers:c,views:u,namedViews:l,groups:h,settings:U}}function r(e,t){var i=e.geometry(),r=e.attributes(),o=i.objectType,c=null,u=null;switch(o){case n.ObjectType.Curve:var l=s(i,100),h={},_=(u={},{});h.itemSize=3,h.type="Float32Array",h.array=[];for(var d=0;d<l.length;d++)h.array.push(l[d][0]),h.array.push(l[d][1]),h.array.push(l[d][2]);u.position=h,_.attributes=u,c={data:_};break;case n.ObjectType.Point:var f=i.location,p=(h={},{});u={},_={};h.itemSize=3,h.type="Float32Array",h.array=[f[0],f[1],f[2]];var m=r.drawColor(t);p.itemSize=3,p.type="Float32Array",p.array=[m.r/255,m.g/255,m.b/255],u.position=h,u.color=p,_.attributes=u,c={data:_};break;case n.ObjectType.PointSet:case n.ObjectType.Mesh:c=i.toThreejsJSON();break;case n.ObjectType.Brep:var v=i.faces();c=[];for(var g=0;g<v.count;g++){var y=v.get(g),b=y.getMesh(n.MeshType.Any);b&&(c.push(b.toThreejsJSON()),b.delete()),y.delete()}v.delete();break;case n.ObjectType.Extrusion:b=i.getMesh(n.MeshType.Any);b&&(c=b.toThreejsJSON(),b.delete());break;case n.ObjectType.TextDot:c=a(i);break;case n.ObjectType.Light:c=a(i);break;case n.ObjectType.InstanceReference:c=a(i),c.xform=a(i.xform),c.xform.array=i.xform.toFloatArray(!0);break;default:console.warn("THREE.3DMLoader: TODO: Implement ".concat(o.constructor.name));break}if(c){u=a(r);return u.geometry=a(i),r.groupCount>0&&(u.groupIds=r.getGroupList()),r.userStringCount>0&&(u.userStrings=r.getUserStrings()),u.drawColor=r.drawColor(t),o=o.constructor.name,o=o.substring(11,o.length),u.geometry.objectType=o,{geometry:c,attributes:u,objectType:o}}}function a(e){var t={};for(var n in e)"function"!==typeof e[n]&&(t[n]=e[n]);return t}function s(e,t){var i=t,r=[],a=[];if(e instanceof n.LineCurve)return[e.pointAtStart,e.pointAtEnd];if(e instanceof n.PolylineCurve){i=e.pointCount;for(var o=0;o<i;o++)r.push(e.point(o));return r}if(e instanceof n.PolyCurve){var c=e.segmentCount;for(o=0;o<c;o++){var u=e.segmentCurve(o),l=s(u,i);r=r.concat(l),u.delete()}return r}if(e instanceof n.ArcCurve&&(i=Math.floor(e.angleDegrees/5),i=i<1?2:i),e instanceof n.NurbsCurve&&1===e.degree&&(void 0===e.segmentCount||1===e.segmentCount))return[e.pointAtStart,e.pointAtEnd];for(var h=e.domain,_=i-1,d=0;d<i;d++){var f=h[0]+d/_*(h[1]-h[0]);if(f!==h[0]&&f!==h[1]){var p,m=e.tangentAt(f),v=e.tangentAt(a.slice(-1)[0]),g=m[0]*m[0]+m[1]*m[1]+m[2]*m[2],y=v[0]*v[0]+v[1]*v[1]+v[2]*v[2],b=Math.sqrt(g*y);if(0===b)p=Math.PI/2;else{var w=(m.x*v.x+m.y*v.y+m.z*v.z)/b;p=Math.acos(Math.max(-1,Math.min(1,w)))}p<.1||a.push(f)}else a.push(f)}return r=a.map((function(t){return e.pointAt(t)})),r}onmessage=function(r){var a=r.data;switch(a.type){case"init":t=a.libraryConfig;var s,o=t.wasmBinary;e=new Promise((function(e){s={wasmBinary:o,onRuntimeInitialized:e},rhino3dm(s)})).then((function(){n=s}));break;case"decode":var c=a.buffer;e.then((function(){var e=i(n,c);self.postMessage({type:"decode",id:a.id,data:e})}));break}}};var We=function(e){Ue.aNw.call(this,e)};We.prototype=Object.assign(Object.create(Ue.aNw.prototype),{constructor:We,load:function(e,t,n,i){var r=this,a=new Ue.hH6(r.manager);a.setPath(r.path),a.setResponseType("arraybuffer"),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,(function(n){try{t(r.parse(n))}catch(a){i?i(a):console.error(a),r.manager.itemError(e)}}),n,i)},parse:function(){var e=[[-.525731,0,.850651],[-.442863,.238856,.864188],[-.295242,0,.955423],[-.309017,.5,.809017],[-.16246,.262866,.951056],[0,0,1],[0,.850651,.525731],[-.147621,.716567,.681718],[.147621,.716567,.681718],[0,.525731,.850651],[.309017,.5,.809017],[.525731,0,.850651],[.295242,0,.955423],[.442863,.238856,.864188],[.16246,.262866,.951056],[-.681718,.147621,.716567],[-.809017,.309017,.5],[-.587785,.425325,.688191],[-.850651,.525731,0],[-.864188,.442863,.238856],[-.716567,.681718,.147621],[-.688191,.587785,.425325],[-.5,.809017,.309017],[-.238856,.864188,.442863],[-.425325,.688191,.587785],[-.716567,.681718,-.147621],[-.5,.809017,-.309017],[-.525731,.850651,0],[0,.850651,-.525731],[-.238856,.864188,-.442863],[0,.955423,-.295242],[-.262866,.951056,-.16246],[0,1,0],[0,.955423,.295242],[-.262866,.951056,.16246],[.238856,.864188,.442863],[.262866,.951056,.16246],[.5,.809017,.309017],[.238856,.864188,-.442863],[.262866,.951056,-.16246],[.5,.809017,-.309017],[.850651,.525731,0],[.716567,.681718,.147621],[.716567,.681718,-.147621],[.525731,.850651,0],[.425325,.688191,.587785],[.864188,.442863,.238856],[.688191,.587785,.425325],[.809017,.309017,.5],[.681718,.147621,.716567],[.587785,.425325,.688191],[.955423,.295242,0],[1,0,0],[.951056,.16246,.262866],[.850651,-.525731,0],[.955423,-.295242,0],[.864188,-.442863,.238856],[.951056,-.16246,.262866],[.809017,-.309017,.5],[.681718,-.147621,.716567],[.850651,0,.525731],[.864188,.442863,-.238856],[.809017,.309017,-.5],[.951056,.16246,-.262866],[.525731,0,-.850651],[.681718,.147621,-.716567],[.681718,-.147621,-.716567],[.850651,0,-.525731],[.809017,-.309017,-.5],[.864188,-.442863,-.238856],[.951056,-.16246,-.262866],[.147621,.716567,-.681718],[.309017,.5,-.809017],[.425325,.688191,-.587785],[.442863,.238856,-.864188],[.587785,.425325,-.688191],[.688191,.587785,-.425325],[-.147621,.716567,-.681718],[-.309017,.5,-.809017],[0,.525731,-.850651],[-.525731,0,-.850651],[-.442863,.238856,-.864188],[-.295242,0,-.955423],[-.16246,.262866,-.951056],[0,0,-1],[.295242,0,-.955423],[.16246,.262866,-.951056],[-.442863,-.238856,-.864188],[-.309017,-.5,-.809017],[-.16246,-.262866,-.951056],[0,-.850651,-.525731],[-.147621,-.716567,-.681718],[.147621,-.716567,-.681718],[0,-.525731,-.850651],[.309017,-.5,-.809017],[.442863,-.238856,-.864188],[.16246,-.262866,-.951056],[.238856,-.864188,-.442863],[.5,-.809017,-.309017],[.425325,-.688191,-.587785],[.716567,-.681718,-.147621],[.688191,-.587785,-.425325],[.587785,-.425325,-.688191],[0,-.955423,-.295242],[0,-1,0],[.262866,-.951056,-.16246],[0,-.850651,.525731],[0,-.955423,.295242],[.238856,-.864188,.442863],[.262866,-.951056,.16246],[.5,-.809017,.309017],[.716567,-.681718,.147621],[.525731,-.850651,0],[-.238856,-.864188,-.442863],[-.5,-.809017,-.309017],[-.262866,-.951056,-.16246],[-.850651,-.525731,0],[-.716567,-.681718,-.147621],[-.716567,-.681718,.147621],[-.525731,-.850651,0],[-.5,-.809017,.309017],[-.238856,-.864188,.442863],[-.262866,-.951056,.16246],[-.864188,-.442863,.238856],[-.809017,-.309017,.5],[-.688191,-.587785,.425325],[-.681718,-.147621,.716567],[-.442863,-.238856,.864188],[-.587785,-.425325,.688191],[-.309017,-.5,.809017],[-.147621,-.716567,.681718],[-.425325,-.688191,.587785],[-.16246,-.262866,.951056],[.442863,-.238856,.864188],[.16246,-.262866,.951056],[.309017,-.5,.809017],[.147621,-.716567,.681718],[0,-.525731,.850651],[.425325,-.688191,.587785],[.587785,-.425325,.688191],[.688191,-.587785,.425325],[-.955423,.295242,0],[-.951056,.16246,.262866],[-1,0,0],[-.850651,0,.525731],[-.955423,-.295242,0],[-.951056,-.16246,.262866],[-.864188,.442863,-.238856],[-.951056,.16246,-.262866],[-.809017,.309017,-.5],[-.864188,-.442863,-.238856],[-.951056,-.16246,-.262866],[-.809017,-.309017,-.5],[-.681718,.147621,-.716567],[-.681718,-.147621,-.716567],[-.850651,0,-.525731],[-.688191,.587785,-.425325],[-.587785,.425325,-.688191],[-.425325,.688191,-.587785],[-.425325,-.688191,-.587785],[-.587785,-.425325,-.688191],[-.688191,-.587785,-.425325]];return function(t){for(var n=new DataView(t),i={},r=["ident","version","skinwidth","skinheight","framesize","num_skins","num_vertices","num_st","num_tris","num_glcmds","num_frames","offset_skins","offset_st","offset_tris","offset_frames","offset_glcmds","offset_end"],a=0;a<r.length;a++)i[r[a]]=n.getInt32(4*a,!0);if(844121161===i.ident&&8===i.version){if(i.offset_end===n.byteLength){for(var s=new Ue.u9r,o=[],c=i.offset_st,u=(a=0,i.num_st);a<u;a++){var l=n.getInt16(c+0,!0),h=n.getInt16(c+2,!0);o.push(l/i.skinwidth,1-h/i.skinheight),c+=4}c=i.offset_tris;var _=[],d=[];for(a=0,u=i.num_tris;a<u;a++)_.push(n.getUint16(c+0,!0),n.getUint16(c+2,!0),n.getUint16(c+4,!0)),d.push(n.getUint16(c+6,!0),n.getUint16(c+8,!0),n.getUint16(c+10,!0)),c+=12;var f=new Ue.Pa4,p=new Ue.Pa4,m=[],v=[];c=i.offset_frames;for(a=0,u=i.num_frames;a<u;a++){p.set(n.getFloat32(c+0,!0),n.getFloat32(c+4,!0),n.getFloat32(c+8,!0)),f.set(n.getFloat32(c+12,!0),n.getFloat32(c+16,!0),n.getFloat32(c+20,!0)),c+=24;for(var g=0;g<16;g++){var y=n.getUint8(c+g,!0);if(0===y)break;m[g]=y}var b={name:String.fromCharCode.apply(null,m),vertices:[],normals:[]};c+=16;for(g=0;g<i.num_vertices;g++){var w=n.getUint8(c++,!0),k=n.getUint8(c++,!0),E=n.getUint8(c++,!0),T=e[n.getUint8(c++,!0)];w=w*p.x+f.x,k=k*p.y+f.y,E=E*p.z+f.z,b.vertices.push(w,E,k),b.normals.push(T[0],T[2],T[1])}v.push(b)}var P=[],D=[],M=[],C=v[0].vertices,x=v[0].normals;for(a=0,u=_.length;a<u;a++){var O=_[a],I=3*O;w=C[I],k=C[I+1],E=C[I+2];P.push(w,k,E);var L=x[I],A=x[I+1],j=x[I+2];D.push(L,A,j);var R=d[a];I=2*R;l=o[I],h=o[I+1];M.push(l,h)}s.setAttribute("position",new Ue.a$l(P,3)),s.setAttribute("normal",new Ue.a$l(D,3)),s.setAttribute("uv",new Ue.a$l(M,2));var B=[],S=[];for(a=0,u=v.length;a<u;a++){b=v[a];var U=b.name;if(b.vertices.length>0){P=[],g=0;for(var N=_.length;g<N;g++){O=_[g],I=3*O,w=b.vertices[I],k=b.vertices[I+1],E=b.vertices[I+2];P.push(w,k,E)}var Z=new Ue.a$l(P,3);Z.name=U,B.push(Z)}if(b.normals.length>0){for(D=[],g=0,N=_.length;g<N;g++){O=_[g],I=3*O,L=b.normals[I],A=b.normals[I+1],j=b.normals[I+2];D.push(L,A,j)}var F=new Ue.a$l(D,3);F.name=U,S.push(F)}}return s.morphAttributes.position=B,s.morphAttributes.normal=S,s.morphTargetsRelative=!1,s.animations=Ue.m7l.CreateClipsFromMorphTargetSequences(v,10),s}console.error("Corrupted MD2 file")}else console.error("Not a valid MD2 file")}}()});var Ke=n(3609),$e=(n(1532),n(2481),n(4197),n(3210),n(8255),n(9135),n(9653),{}),qe=void 0,Ve=$e;function ze(e,t){var n,i=e.split("."),r=Ve;!(i[0]in r)&&r.execScript&&r.execScript("var "+i[0]);for(;i.length&&(n=i.shift());)i.length||t===qe?r=r[n]?r[n]:r[n]={}:r[n]=t}var He="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array&&"undefined"!==typeof DataView;function Ge(e){var t,n,i,r,a,s,o,c,u,l,h=e.length,_=0,d=Number.POSITIVE_INFINITY;for(c=0;c<h;++c)e[c]>_&&(_=e[c]),e[c]<d&&(d=e[c]);for(t=1<<_,n=new(He?Uint32Array:Array)(t),i=1,r=0,a=2;i<=_;){for(c=0;c<h;++c)if(e[c]===i){for(s=0,o=r,u=0;u<i;++u)s=s<<1|1&o,o>>=1;for(l=i<<16|c,u=s;u<t;u+=a)n[u]=l;++r}++i,r<<=1,a<<=1}return[n,_,d]}function Xe(e,t){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=He?new Uint8Array(e):e,this.m=!1,this.i=Qe,this.r=!1,!t&&(t={})||(t.index&&(this.a=t.index),t.bufferSize&&(this.h=t.bufferSize),t.bufferType&&(this.i=t.bufferType),t.resize&&(this.r=t.resize)),this.i){case Ye:this.b=32768,this.c=new(He?Uint8Array:Array)(32768+this.h+258);break;case Qe:this.b=0,this.c=new(He?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var Ye=0,Qe=1,Je={t:Ye,s:Qe};Xe.prototype.k=function(){for(;!this.m;){var e=gt(this,3);switch(1&e&&(this.m=!0),e>>>=1,e){case 0:var t=this.input,n=this.a,i=this.c,r=this.b,a=t.length,s=qe,o=qe,c=i.length,u=qe;if(this.d=this.f=0,n+1>=a)throw Error("invalid uncompressed block header: LEN");if(s=t[n++]|t[n++]<<8,n+1>=a)throw Error("invalid uncompressed block header: NLEN");if(o=t[n++]|t[n++]<<8,s===~o)throw Error("invalid uncompressed block header: length verify");if(n+s>t.length)throw Error("input buffer is broken");switch(this.i){case Ye:for(;r+s>i.length;){if(u=c-r,s-=u,He)i.set(t.subarray(n,n+u),r),r+=u,n+=u;else for(;u--;)i[r++]=t[n++];this.b=r,i=this.e(),r=this.b}break;case Qe:for(;r+s>i.length;)i=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(He)i.set(t.subarray(n,n+s),r),r+=s,n+=s;else for(;s--;)i[r++]=t[n++];this.a=n,this.b=r,this.c=i;break;case 1:this.j(pt,vt);break;case 2:var l=gt(this,5)+257,h=gt(this,5)+1,_=gt(this,4)+4,d=new(He?Uint8Array:Array)(it.length),f=qe,p=qe,m=qe,v=qe,g=qe,y=qe,b=qe,w=qe,k=qe;for(w=0;w<_;++w)d[it[w]]=gt(this,3);if(!He)for(w=_,_=d.length;w<_;++w)d[it[w]]=0;for(f=Ge(d),v=new(He?Uint8Array:Array)(l+h),w=0,k=l+h;w<k;)switch(g=yt(this,f),g){case 16:for(b=3+gt(this,2);b--;)v[w++]=y;break;case 17:for(b=3+gt(this,3);b--;)v[w++]=0;y=0;break;case 18:for(b=11+gt(this,7);b--;)v[w++]=0;y=0;break;default:y=v[w++]=g}p=Ge(He?v.subarray(0,l):v.slice(0,l)),m=Ge(He?v.subarray(l):v.slice(l)),this.j(p,m);break;default:throw Error("unknown BTYPE: "+e)}}return this.n()};var et,tt,nt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],it=He?new Uint16Array(nt):nt,rt=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],at=He?new Uint16Array(rt):rt,st=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],ot=He?new Uint8Array(st):st,ct=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],ut=He?new Uint16Array(ct):ct,lt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ht=He?new Uint8Array(lt):lt,_t=new(He?Uint8Array:Array)(288);for(et=0,tt=_t.length;et<tt;++et)_t[et]=143>=et?8:255>=et?9:279>=et?7:8;var dt,ft,pt=Ge(_t),mt=new(He?Uint8Array:Array)(30);for(dt=0,ft=mt.length;dt<ft;++dt)mt[dt]=5;var vt=Ge(mt);function gt(e,t){for(var n,i=e.f,r=e.d,a=e.input,s=e.a,o=a.length;r<t;){if(s>=o)throw Error("input buffer is broken");i|=a[s++]<<r,r+=8}return n=i&(1<<t)-1,e.f=i>>>t,e.d=r-t,e.a=s,n}function yt(e,t){for(var n,i,r=e.f,a=e.d,s=e.input,o=e.a,c=s.length,u=t[0],l=t[1];a<l&&!(o>=c);)r|=s[o++]<<a,a+=8;if(n=u[r&(1<<l)-1],i=n>>>16,i>a)throw Error("invalid code length: "+i);return e.f=r>>i,e.d=a-i,e.a=o,65535&n}function bt(e,t){var n,i;switch(this.input=e,this.a=0,!t&&(t={})||(t.index&&(this.a=t.index),t.verify&&(this.A=t.verify)),n=e[this.a++],i=e[this.a++],15&n){case wt:this.method=wt;break;default:throw Error("unsupported compression method")}if(0!==((n<<8)+i)%31)throw Error("invalid fcheck flag:"+((n<<8)+i)%31);if(32&i)throw Error("fdict flag is not supported");this.q=new Xe(e,{index:this.a,bufferSize:t.bufferSize,bufferType:t.bufferType,resize:t.resize})}Xe.prototype.j=function(e,t){var n=this.c,i=this.b;this.o=e;for(var r,a,s,o,c=n.length-258;256!==(r=yt(this,e));)if(256>r)i>=c&&(this.b=i,n=this.e(),i=this.b),n[i++]=r;else for(a=r-257,o=at[a],0<ot[a]&&(o+=gt(this,ot[a])),r=yt(this,t),s=ut[r],0<ht[r]&&(s+=gt(this,ht[r])),i>=c&&(this.b=i,n=this.e(),i=this.b);o--;)n[i]=n[i++-s];for(;8<=this.d;)this.d-=8,this.a--;this.b=i},Xe.prototype.w=function(e,t){var n=this.c,i=this.b;this.o=e;for(var r,a,s,o,c=n.length;256!==(r=yt(this,e));)if(256>r)i>=c&&(n=this.e(),c=n.length),n[i++]=r;else for(a=r-257,o=at[a],0<ot[a]&&(o+=gt(this,ot[a])),r=yt(this,t),s=ut[r],0<ht[r]&&(s+=gt(this,ht[r])),i+o>c&&(n=this.e(),c=n.length);o--;)n[i]=n[i++-s];for(;8<=this.d;)this.d-=8,this.a--;this.b=i},Xe.prototype.e=function(){var e,t,n=new(He?Uint8Array:Array)(this.b-32768),i=this.b-32768,r=this.c;if(He)n.set(r.subarray(32768,n.length));else for(e=0,t=n.length;e<t;++e)n[e]=r[e+32768];if(this.g.push(n),this.l+=n.length,He)r.set(r.subarray(i,i+32768));else for(e=0;32768>e;++e)r[e]=r[i+e];return this.b=32768,r},Xe.prototype.z=function(e){var t,n,i,r,a=this.input.length/this.a+1|0,s=this.input,o=this.c;return e&&("number"===typeof e.p&&(a=e.p),"number"===typeof e.u&&(a+=e.u)),2>a?(n=(s.length-this.a)/this.o[2],r=n/2*258|0,i=r<o.length?o.length+r:o.length<<1):i=o.length*a,He?(t=new Uint8Array(i),t.set(o)):t=o,this.c=t},Xe.prototype.n=function(){var e,t,n,i,r,a=0,s=this.c,o=this.g,c=new(He?Uint8Array:Array)(this.l+(this.b-32768));if(0===o.length)return He?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(t=0,n=o.length;t<n;++t)for(e=o[t],i=0,r=e.length;i<r;++i)c[a++]=e[i];for(t=32768,n=this.b;t<n;++t)c[a++]=s[t];return this.g=[],this.buffer=c},Xe.prototype.v=function(){var e,t=this.b;return He?this.r?(e=new Uint8Array(t),e.set(this.c.subarray(0,t))):e=this.c.subarray(0,t):(this.c.length>t&&(this.c.length=t),e=this.c),this.buffer=e},bt.prototype.k=function(){var e,t,n=this.input;if(e=this.q.k(),this.a=this.q.a,this.A){t=(n[this.a++]<<24|n[this.a++]<<16|n[this.a++]<<8|n[this.a++])>>>0;var i=e;if("string"===typeof i){var r,a,s=i.split("");for(r=0,a=s.length;r<a;r++)s[r]=(255&s[r].charCodeAt(0))>>>0;i=s}for(var o,c=1,u=0,l=i.length,h=0;0<l;){o=1024<l?1024:l,l-=o;do{c+=i[h++],u+=c}while(--o);c%=65521,u%=65521}if(t!==(u<<16|c)>>>0)throw Error("invalid adler-32 checksum")}return e};var wt=8;ze("Zlib.Inflate",bt),ze("Zlib.Inflate.prototype.decompress",bt.prototype.k);var kt,Et,Tt,Pt,Dt={ADAPTIVE:Je.s,BLOCK:Je.t};if(Object.keys)kt=Object.keys(Dt);else for(Et in kt=[],Tt=0,Dt)kt[Tt++]=Et;for(Tt=0,Pt=kt.length;Tt<Pt;++Tt)Et=kt[Tt],ze("Zlib.Inflate.BufferType."+Et,Dt[Et]);var Mt=$e.Zlib.Inflate,Ct={findSpan:function(e,t,n){var i=n.length-e-1;if(t>=n[i])return i-1;if(t<=n[e])return e;var r=e,a=i,s=Math.floor((r+a)/2);while(t<n[s]||t>=n[s+1])t<n[s]?a=s:r=s,s=Math.floor((r+a)/2);return s},calcBasisFunctions:function(e,t,n,i){var r=[],a=[],s=[];r[0]=1;for(var o=1;o<=n;++o){a[o]=t-i[e+1-o],s[o]=i[e+o]-t;for(var c=0,u=0;u<o;++u){var l=s[u+1],h=a[o-u],_=r[u]/(l+h);r[u]=c+l*_,c=h*_}r[o]=c}return r},calcBSplinePoint:function(e,t,n,i){for(var r=this.findSpan(e,i,t),a=this.calcBasisFunctions(r,i,e,t),s=new Ue.Ltg(0,0,0,0),o=0;o<=e;++o){var c=n[r-e+o],u=a[o],l=c.w*u;s.x+=c.x*l,s.y+=c.y*l,s.z+=c.z*l,s.w+=c.w*u}return s},calcBasisFunctionDerivatives:function(e,t,n,i,r){for(var a=[],s=0;s<=n;++s)a[s]=0;var o=[];for(s=0;s<=i;++s)o[s]=a.slice(0);var c=[];for(s=0;s<=n;++s)c[s]=a.slice(0);c[0][0]=1;for(var u=a.slice(0),l=a.slice(0),h=1;h<=n;++h){u[h]=t-r[e+1-h],l[h]=r[e+h]-t;for(var _=0,d=0;d<h;++d){var f=l[d+1],p=u[h-d];c[h][d]=f+p;var m=c[d][h-1]/c[h][d];c[d][h]=_+f*m,_=p*m}c[h][h]=_}for(h=0;h<=n;++h)o[0][h]=c[h][n];for(d=0;d<=n;++d){var v=0,g=1,y=[];for(s=0;s<=n;++s)y[s]=a.slice(0);y[0][0]=1;for(var b=1;b<=i;++b){var w=0,k=d-b,E=n-b;d>=b&&(y[g][0]=y[v][0]/c[E+1][k],w=y[g][0]*c[k][E]);var T=k>=-1?1:-k,P=d-1<=E?b-1:n-d;for(h=T;h<=P;++h)y[g][h]=(y[v][h]-y[v][h-1])/c[E+1][k+h],w+=y[g][h]*c[k+h][E];d<=E&&(y[g][b]=-y[v][b-1]/c[E+1][d],w+=y[g][b]*c[d][E]),o[b][d]=w;h=v;v=g,g=h}}for(d=n,b=1;b<=i;++b){for(h=0;h<=n;++h)o[b][h]*=d;d*=n-b}return o},calcBSplineDerivatives:function(e,t,n,i,r){for(var a=r<e?r:e,s=[],o=this.findSpan(e,i,t),c=this.calcBasisFunctionDerivatives(o,i,e,a,t),u=[],l=0;l<n.length;++l){var h=n[l].clone(),_=h.w;h.x*=_,h.y*=_,h.z*=_,u[l]=h}for(var d=0;d<=a;++d){h=u[o-e].clone().multiplyScalar(c[d][0]);for(var f=1;f<=e;++f)h.add(u[o-e+f].clone().multiplyScalar(c[d][f]));s[d]=h}for(d=a+1;d<=r+1;++d)s[d]=new Ue.Ltg(0,0,0);return s},calcKoverI:function(e,t){for(var n=1,i=2;i<=e;++i)n*=i;var r=1;for(i=2;i<=t;++i)r*=i;for(i=2;i<=e-t;++i)r*=i;return n/r},calcRationalCurveDerivatives:function(e){for(var t=e.length,n=[],i=[],r=0;r<t;++r){var a=e[r];n[r]=new Ue.Pa4(a.x,a.y,a.z),i[r]=a.w}for(var s=[],o=0;o<t;++o){var c=n[o].clone();for(r=1;r<=o;++r)c.sub(s[o-r].clone().multiplyScalar(this.calcKoverI(o,r)*i[r]));s[o]=c.divideScalar(i[0])}return s},calcNURBSDerivatives:function(e,t,n,i,r){var a=this.calcBSplineDerivatives(e,t,n,i,r);return this.calcRationalCurveDerivatives(a)},calcSurfacePoint:function(e,t,n,i,r,a,s,o){for(var c=this.findSpan(e,a,n),u=this.findSpan(t,s,i),l=this.calcBasisFunctions(c,a,e,n),h=this.calcBasisFunctions(u,s,t,i),_=[],d=0;d<=t;++d){_[d]=new Ue.Ltg(0,0,0,0);for(var f=0;f<=e;++f){var p=r[c-e+f][u-t+d].clone(),m=p.w;p.x*=m,p.y*=m,p.z*=m,_[d].add(p.multiplyScalar(l[f]))}}var v=new Ue.Ltg(0,0,0,0);for(d=0;d<=t;++d)v.add(_[d].multiplyScalar(h[d]));v.divideScalar(v.w),o.set(v.x,v.y,v.z)}},xt=function(e,t,n,i,r){Ue.Hyl.call(this),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=r||this.knots.length-1;for(var a=0;a<n.length;++a){var s=n[a];this.controlPoints[a]=new Ue.Ltg(s.x,s.y,s.z,s.w)}};xt.prototype=Object.create(Ue.Hyl.prototype),xt.prototype.constructor=xt,xt.prototype.getPoint=function(e,t){var n=t||new Ue.Pa4,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=Ct.calcBSplinePoint(this.degree,this.knots,this.controlPoints,i);return 1!=r.w&&r.divideScalar(r.w),n.set(r.x,r.y,r.z)},xt.prototype.getTangent=function(e,t){var n=t||new Ue.Pa4,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=Ct.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,i,1);return n.copy(r[1]).normalize(),n};(function(){var e,t,n;function i(e){Ue.aNw.call(this,e)}function r(e,t){this.textureLoader=e,this.manager=t}function a(){}function s(){}function o(){}function c(){}function u(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function l(){}function h(e){var t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===k(e,0,t.length)}function _(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],n=0;function i(t){var i=e[t-1];return e=e.slice(n+t),n++,i}for(var r=0;r<t.length;++r){var a=i(1);if(a===t[r])return!1}return!0}function d(e){var t=/FBXVersion: (\d+)/,n=e.match(t);if(n){var i=parseInt(n[1]);return i}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function f(e){return e/46186158e3}i.prototype=Object.assign(Object.create(Ue.aNw.prototype),{constructor:i,load:function(e,t,n,i){var r=this,a=""===r.path?Ue.Zp0.extractUrlBase(e):r.path,s=new Ue.hH6(this.manager);s.setPath(r.path),s.setResponseType("arraybuffer"),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,(function(n){try{t(r.parse(n,a))}catch(s){i?i(s):console.error(s),r.manager.itemError(e)}}),n,i)},parse:function(t,n){if(h(t))e=(new c).parse(t);else{var i=k(t);if(!_(i))throw new Error("THREE.FBXLoader: Unknown format.");if(d(i)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+d(i));e=(new o).parse(i)}var a=new Ue.dpR(this.manager).setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin);return new r(a,this.manager).parse(e)}}),r.prototype={constructor:r,parse:function(){t=this.parseConnections();var e=this.parseImages(),i=this.parseTextures(e),r=this.parseMaterials(i),s=this.parseDeformers(),o=(new a).parse(s);return this.parseScene(s,o,r),n},parseConnections:function(){var t=new Map;if("Connections"in e){var n=e.Connections.connections;n.forEach((function(e){var n=e[0],i=e[1],r=e[2];t.has(n)||t.set(n,{parents:[],children:[]});var a={ID:i,relationship:r};t.get(n).parents.push(a),t.has(i)||t.set(i,{parents:[],children:[]});var s={ID:n,relationship:r};t.get(i).children.push(s)}))}return t},parseImages:function(){var t={},n={};if("Video"in e.Objects){var i=e.Objects.Video;for(var r in i){var a=i[r],s=parseInt(r);if(t[s]=a.RelativeFilename||a.Filename,"Content"in a){var o=a.Content instanceof ArrayBuffer&&a.Content.byteLength>0,c="string"===typeof a.Content&&""!==a.Content;if(o||c){var u=this.parseImage(i[r]);n[a.RelativeFilename||a.Filename]=u}}}}for(var s in t){var l=t[s];void 0!==n[l]?t[s]=n[l]:t[s]=t[s].split("\\").pop()}return t},parseImage:function(e){var t,n=e.Content,i=e.RelativeFilename||e.Filename,r=i.slice(i.lastIndexOf(".")+1).toLowerCase();switch(r){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",i),t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+r+'" is not supported.')}if("string"===typeof n)return"data:"+t+";base64,"+n;var a=new Uint8Array(n);return window.URL.createObjectURL(new Blob([a],{type:t}))},parseTextures:function(t){var n=new Map;if("Texture"in e.Objects){var i=e.Objects.Texture;for(var r in i){var a=this.parseTexture(i[r],t);n.set(parseInt(r),a)}}return n},parseTexture:function(e,t){var n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;var i=e.WrapModeU,r=e.WrapModeV,a=void 0!==i?i.value:0,s=void 0!==r?r.value:0;if(n.wrapS=0===a?Ue.rpg:Ue.uWy,n.wrapT=0===s?Ue.rpg:Ue.uWy,"Scaling"in e){var o=e.Scaling.value;n.repeat.x=o[0],n.repeat.y=o[1]}return n},loadTexture:function(e,n){var i,r,a=this.textureLoader.path,s=t.get(e.id).children;void 0!==s&&s.length>0&&void 0!==n[s[0].ID]&&(i=n[s[0].ID],0!==i.indexOf("blob:")&&0!==i.indexOf("data:")||this.textureLoader.setPath(void 0));var o=e.FileName.slice(-3).toLowerCase();if("tga"===o){var c=this.manager.getHandler(".tga");null===c?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),r=new Ue.xEZ):r=c.load(i)}else"psd"===o?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),r=new Ue.xEZ):r=this.textureLoader.load(i);return this.textureLoader.setPath(a),r},parseMaterials:function(t){var n=new Map;if("Material"in e.Objects){var i=e.Objects.Material;for(var r in i){var a=this.parseMaterial(i[r],t);null!==a&&n.set(parseInt(r),a)}}return n},parseMaterial:function(e,n){var i=e.id,r=e.attrName,a=e.ShadingModel;if("object"===(0,Ke.Z)(a)&&(a=a.value),!t.has(i))return null;var s,o=this.parseParameters(e,n,i);switch(a.toLowerCase()){case"phong":s=new Ue.xoR;break;case"lambert":s=new Ue.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),s=new Ue.xoR;break}return s.setValues(o),s.name=r,s},parseParameters:function(e,n,i){var r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=(new Ue.Ilk).fromArray(e.Diffuse.value):e.DiffuseColor&&"Color"===e.DiffuseColor.type&&(r.color=(new Ue.Ilk).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=(new Ue.Ilk).fromArray(e.Emissive.value):e.EmissiveColor&&"Color"===e.EmissiveColor.type&&(r.emissive=(new Ue.Ilk).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=(new Ue.Ilk).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(r.specular=(new Ue.Ilk).fromArray(e.SpecularColor.value));var a=this;return t.get(i).children.forEach((function(e){var t=e.relationship;switch(t){case"Bump":r.bumpMap=a.getTexture(n,e.ID);break;case"Maya|TEX_ao_map":r.aoMap=a.getTexture(n,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=a.getTexture(n,e.ID),r.map.encoding=Ue.knz;break;case"DisplacementColor":r.displacementMap=a.getTexture(n,e.ID);break;case"EmissiveColor":r.emissiveMap=a.getTexture(n,e.ID),r.emissiveMap.encoding=Ue.knz;break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=a.getTexture(n,e.ID);break;case"ReflectionColor":r.envMap=a.getTexture(n,e.ID),r.envMap.mapping=Ue.dSO,r.envMap.encoding=Ue.knz;break;case"SpecularColor":r.specularMap=a.getTexture(n,e.ID),r.specularMap.encoding=Ue.knz;break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=a.getTexture(n,e.ID),r.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",t);break}})),r},getTexture:function(n,i){return"LayeredTexture"in e.Objects&&i in e.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),i=t.get(i).children[0].ID),n.get(i)},parseDeformers:function(){var n={},i={};if("Deformer"in e.Objects){var r=e.Objects.Deformer;for(var a in r){var s=r[a],o=t.get(parseInt(a));if("Skin"===s.attrType){var c=this.parseSkeleton(o,r);c.ID=a,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),c.geometryID=o.parents[0].ID,n[a]=c}else if("BlendShape"===s.attrType){var u={id:a};u.rawTargets=this.parseMorphTargets(o,r),u.id=a,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),i[a]=u}}}return{skeletons:n,morphTargets:i}},parseSkeleton:function(e,t){var n=[];return e.children.forEach((function(e){var i=t[e.ID];if("Cluster"===i.attrType){var r={ID:e.ID,indices:[],weights:[],transformLink:(new Ue.yGw).fromArray(i.TransformLink.a)};"Indexes"in i&&(r.indices=i.Indexes.a,r.weights=i.Weights.a),n.push(r)}})),{rawBones:n,bones:[]}},parseMorphTargets:function(e,n){for(var i=[],r=0;r<e.children.length;r++){var a=e.children[r],s=n[a.ID],o={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if("BlendShapeChannel"!==s.attrType)return;o.geoID=t.get(parseInt(a.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,i.push(o)}return i},parseScene:function(i,r,a){n=new Ue.ZAu;var o=this.parseModels(i.skeletons,r,a),c=e.Objects.Model,u=this;o.forEach((function(e){var i=c[e.ID];u.setLookAtProperties(e,i);var r=t.get(e.ID).parents;r.forEach((function(t){var n=o.get(t.ID);void 0!==n&&n.add(e)})),null===e.parent&&n.add(e)})),this.bindSkeleton(i.skeletons,r,o),this.createAmbientLight(),this.setupMorphMaterials(),n.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrixWorld=e.parent.matrix);var t=y(e.userData.transformData);e.applyMatrix4(t)}}));var l=(new s).parse();1===n.children.length&&n.children[0].isGroup&&(n.children[0].animations=l,n=n.children[0]),n.animations=l},parseModels:function(n,i,r){var a=new Map,s=e.Objects.Model;for(var o in s){var c=parseInt(o),u=s[o],l=t.get(c),h=this.buildSkeleton(l,n,c,u.attrName);if(!h){switch(u.attrType){case"Camera":h=this.createCamera(l);break;case"Light":h=this.createLight(l);break;case"Mesh":h=this.createMesh(l,i,r);break;case"NurbsCurve":h=this.createCurve(l,i);break;case"LimbNode":case"Root":h=new Ue.N$j;break;case"Null":default:h=new Ue.ZAu;break}h.name=u.attrName?Ue.iUV.sanitizeNodeName(u.attrName):"",h.ID=c}this.getTransformData(h,u),a.set(c,h)}return a},buildSkeleton:function(e,t,n,i){var r=null;return e.parents.forEach((function(e){for(var a in t){var s=t[a];s.rawBones.forEach((function(t,a){if(t.ID===e.ID){var o=r;r=new Ue.N$j,r.matrixWorld.copy(t.transformLink),r.name=i?Ue.iUV.sanitizeNodeName(i):"",r.ID=n,s.bones[a]=r,null!==o&&r.add(o)}}))}})),r},createCamera:function(t){var n,i;if(t.children.forEach((function(t){var n=e.Objects.NodeAttribute[t.ID];void 0!==n&&(i=n)})),void 0===i)n=new Ue.Tme;else{var r=0;void 0!==i.CameraProjectionType&&1===i.CameraProjectionType.value&&(r=1);var a=1;void 0!==i.NearPlane&&(a=i.NearPlane.value/1e3);var s=1e3;void 0!==i.FarPlane&&(s=i.FarPlane.value/1e3);var o=window.innerWidth,c=window.innerHeight;void 0!==i.AspectWidth&&void 0!==i.AspectHeight&&(o=i.AspectWidth.value,c=i.AspectHeight.value);var u=o/c,l=45;void 0!==i.FieldOfView&&(l=i.FieldOfView.value);var h=i.FocalLength?i.FocalLength.value:null;switch(r){case 0:n=new Ue.cPb(l,u,a,s),null!==h&&n.setFocalLength(h);break;case 1:n=new Ue.iKG(-o/2,o/2,c/2,-c/2,a,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),n=new Ue.Tme;break}}return n},createLight:function(t){var n,i;if(t.children.forEach((function(t){var n=e.Objects.NodeAttribute[t.ID];void 0!==n&&(i=n)})),void 0===i)n=new Ue.Tme;else{var r;r=void 0===i.LightType?0:i.LightType.value;var a=16777215;void 0!==i.Color&&(a=(new Ue.Ilk).fromArray(i.Color.value));var s=void 0===i.Intensity?1:i.Intensity.value/100;void 0!==i.CastLightOnObject&&0===i.CastLightOnObject.value&&(s=0);var o=0;void 0!==i.FarAttenuationEnd&&(o=void 0!==i.EnableFarAttenuation&&0===i.EnableFarAttenuation.value?0:i.FarAttenuationEnd.value);var c=1;switch(r){case 0:n=new Ue.cek(a,s,o,c);break;case 1:n=new Ue.Ox3(a,s);break;case 2:var u=Math.PI/3;void 0!==i.InnerAngle&&(u=Ue.M8C.degToRad(i.InnerAngle.value));var l=0;void 0!==i.OuterAngle&&(l=Ue.M8C.degToRad(i.OuterAngle.value),l=Math.max(l,1)),n=new Ue.PMe(a,s,o,u,l,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),n=new Ue.cek(a,s);break}void 0!==i.CastShadows&&1===i.CastShadows.value&&(n.castShadow=!0)}return n},createMesh:function(e,t,n){var i,r=null,a=null,s=[];return e.children.forEach((function(e){t.has(e.ID)&&(r=t.get(e.ID)),n.has(e.ID)&&s.push(n.get(e.ID))})),s.length>1?a=s:s.length>0?a=s[0]:(a=new Ue.xoR({color:13421772}),s.push(a)),"color"in r.attributes&&s.forEach((function(e){e.vertexColors=!0})),r.FBX_Deformer?(s.forEach((function(e){e.skinning=!0})),i=new Ue.TUv(r,a),i.normalizeSkinWeights()):i=new Ue.Kj0(r,a),i},createCurve:function(e,t){var n=e.children.reduce((function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e}),null),i=new Ue.nls({color:3342591,linewidth:1});return new Ue.x12(n,i)},getTransformData:function(e,t){var n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?b(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n},setLookAtProperties:function(i,r){if("LookAtProperty"in r){var a=t.get(i.ID).children;a.forEach((function(t){if("LookAtProperty"===t.relationship){var r=e.Objects.Model[t.ID];if("Lcl_Translation"in r){var a=r.Lcl_Translation.value;void 0!==i.target?(i.target.position.fromArray(a),n.add(i.target)):i.lookAt((new Ue.Pa4).fromArray(a))}}}))}},bindSkeleton:function(e,n,i){var r=this.parsePoseNodes();for(var a in e){var s=e[a],o=t.get(parseInt(s.ID)).parents;o.forEach((function(e){if(n.has(e.ID)){var a=e.ID,o=t.get(a);o.parents.forEach((function(e){if(i.has(e.ID)){var t=i.get(e.ID);t.bind(new Ue.OdW(s.bones),r[e.ID])}}))}}))}},parsePoseNodes:function(){var t={};if("Pose"in e.Objects){var n=e.Objects.Pose;for(var i in n)if("BindPose"===n[i].attrType){var r=n[i].PoseNode;Array.isArray(r)?r.forEach((function(e){t[e.Node]=(new Ue.yGw).fromArray(e.Matrix.a)})):t[r.Node]=(new Ue.yGw).fromArray(r.Matrix.a)}}return t},createAmbientLight:function(){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var t=e.GlobalSettings.AmbientColor.value,i=t[0],r=t[1],a=t[2];if(0!==i||0!==r||0!==a){var s=new Ue.Ilk(i,r,a);n.add(new Ue.Mig(s,1))}}},setupMorphMaterials:function(){var e=this;n.traverse((function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach((function(n,i){e.setupMorphMaterial(t,n,i)})):e.setupMorphMaterial(t,t.material))}))},setupMorphMaterial:function(e,t,i){var r=e.uuid,a=t.uuid,s=!1;if(n.traverse((function(e){e.isMesh&&(Array.isArray(e.material)?e.material.forEach((function(t){t.uuid===a&&e.uuid!==r&&(s=!0)})):e.material.uuid===a&&e.uuid!==r&&(s=!0))})),!0===s){var o=t.clone();o.morphTargets=!0,void 0===i?e.material=o:e.material[i]=o}else t.morphTargets=!0}},a.prototype={constructor:a,parse:function(n){var i=new Map;if("Geometry"in e.Objects){var r=e.Objects.Geometry;for(var a in r){var s=t.get(parseInt(a)),o=this.parseGeometry(s,r[a],n);i.set(parseInt(a),o)}}return i},parseGeometry:function(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}},parseMeshGeometry:function(t,n,i){var r=i.skeletons,a=[],s=t.parents.map((function(t){return e.Objects.Model[t.ID]}));if(0!==s.length){var o=t.children.reduce((function(e,t){return void 0!==r[t.ID]&&(e=r[t.ID]),e}),null);t.children.forEach((function(e){void 0!==i.morphTargets[e.ID]&&a.push(i.morphTargets[e.ID])}));var c=s[0],u={};"RotationOrder"in c&&(u.eulerOrder=b(c.RotationOrder.value)),"InheritType"in c&&(u.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(u.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(u.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(u.scale=c.GeometricScaling.value);var l=y(u);return this.genGeometry(n,o,a,l)}},genGeometry:function(e,t,n,i){var r=new Ue.u9r;e.attrName&&(r.name=e.attrName);var a=this.parseGeoNode(e,t),s=this.genBuffers(a),o=new Ue.a$l(s.vertex,3);if(o.applyMatrix4(i),r.setAttribute("position",o),s.colors.length>0&&r.setAttribute("color",new Ue.a$l(s.colors,3)),t&&(r.setAttribute("skinIndex",new Ue.qlB(s.weightsIndices,4)),r.setAttribute("skinWeight",new Ue.a$l(s.vertexWeights,4)),r.FBX_Deformer=t),s.normal.length>0){var c=(new Ue.Vkp).getNormalMatrix(i),u=new Ue.a$l(s.normal,3);u.applyNormalMatrix(c),r.setAttribute("normal",u)}if(s.uvs.forEach((function(e,t){var n="uv"+(t+1).toString();0===t&&(n="uv"),r.setAttribute(n,new Ue.a$l(s.uvs[t],2))})),a.material&&"AllSame"!==a.material.mappingType){var l=s.materialIndex[0],h=0;if(s.materialIndex.forEach((function(e,t){e!==l&&(r.addGroup(h,t-h,l),l=e,h=t)})),r.groups.length>0){var _=r.groups[r.groups.length-1],d=_.start+_.count;d!==s.materialIndex.length&&r.addGroup(d,s.materialIndex.length-d,l)}0===r.groups.length&&r.addGroup(0,s.materialIndex.length,s.materialIndex[0])}return this.addMorphTargets(r,e,n,i),r},parseGeoNode:function(e,t){var n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];var i=0;while(e.LayerElementUV[i])e.LayerElementUV[i].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[i])),i++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(i,r){void 0===n.weightTable[i]&&(n.weightTable[i]=[]),n.weightTable[i].push({id:t,weight:e.weights[r]})}))}))),n},genBuffers:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},n=0,i=0,r=!1,a=[],s=[],o=[],c=[],u=[],l=[],h=this;return e.vertexIndices.forEach((function(_,d){var f=!1;_<0&&(_^=-1,f=!0);var p=[],v=[];if(a.push(3*_,3*_+1,3*_+2),e.color){var g=m(d,n,_,e.color);o.push(g[0],g[1],g[2])}if(e.skeleton){if(void 0!==e.weightTable[_]&&e.weightTable[_].forEach((function(e){v.push(e.weight),p.push(e.id)})),v.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);var y=[0,0,0,0],b=[0,0,0,0];v.forEach((function(e,t){var n=e,i=p[t];b.forEach((function(e,t,r){if(n>e){r[t]=n,n=e;var a=y[t];y[t]=i,i=a}}))})),p=y,v=b}while(v.length<4)v.push(0),p.push(0);for(var w=0;w<4;++w)u.push(v[w]),l.push(p[w])}if(e.normal){g=m(d,n,_,e.normal);s.push(g[0],g[1],g[2])}if(e.material&&"AllSame"!==e.material.mappingType)var k=m(d,n,_,e.material)[0];e.uv&&e.uv.forEach((function(e,t){var i=m(d,n,_,e);void 0===c[t]&&(c[t]=[]),c[t].push(i[0]),c[t].push(i[1])})),i++,f&&(h.genFace(t,e,a,k,s,o,c,u,l,i),n++,i=0,a=[],s=[],o=[],c=[],u=[],l=[])})),t},genFace:function(e,t,n,i,r,a,s,o,c,u){for(var l=2;l<u;l++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(l-1)]]),e.vertex.push(t.vertexPositions[n[3*(l-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(l-1)+2]]),e.vertex.push(t.vertexPositions[n[3*l]]),e.vertex.push(t.vertexPositions[n[3*l+1]]),e.vertex.push(t.vertexPositions[n[3*l+2]]),t.skeleton&&(e.vertexWeights.push(o[0]),e.vertexWeights.push(o[1]),e.vertexWeights.push(o[2]),e.vertexWeights.push(o[3]),e.vertexWeights.push(o[4*(l-1)]),e.vertexWeights.push(o[4*(l-1)+1]),e.vertexWeights.push(o[4*(l-1)+2]),e.vertexWeights.push(o[4*(l-1)+3]),e.vertexWeights.push(o[4*l]),e.vertexWeights.push(o[4*l+1]),e.vertexWeights.push(o[4*l+2]),e.vertexWeights.push(o[4*l+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[4*(l-1)]),e.weightsIndices.push(c[4*(l-1)+1]),e.weightsIndices.push(c[4*(l-1)+2]),e.weightsIndices.push(c[4*(l-1)+3]),e.weightsIndices.push(c[4*l]),e.weightsIndices.push(c[4*l+1]),e.weightsIndices.push(c[4*l+2]),e.weightsIndices.push(c[4*l+3])),t.color&&(e.colors.push(a[0]),e.colors.push(a[1]),e.colors.push(a[2]),e.colors.push(a[3*(l-1)]),e.colors.push(a[3*(l-1)+1]),e.colors.push(a[3*(l-1)+2]),e.colors.push(a[3*l]),e.colors.push(a[3*l+1]),e.colors.push(a[3*l+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(r[0]),e.normal.push(r[1]),e.normal.push(r[2]),e.normal.push(r[3*(l-1)]),e.normal.push(r[3*(l-1)+1]),e.normal.push(r[3*(l-1)+2]),e.normal.push(r[3*l]),e.normal.push(r[3*l+1]),e.normal.push(r[3*l+2])),t.uv&&t.uv.forEach((function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(s[n][0]),e.uvs[n].push(s[n][1]),e.uvs[n].push(s[n][2*(l-1)]),e.uvs[n].push(s[n][2*(l-1)+1]),e.uvs[n].push(s[n][2*l]),e.uvs[n].push(s[n][2*l+1])}))},addMorphTargets:function(t,n,i,r){if(0!==i.length){t.morphTargetsRelative=!0,t.morphAttributes.position=[];var a=this;i.forEach((function(i){i.rawTargets.forEach((function(i){var s=e.Objects.Geometry[i.geoID];void 0!==s&&a.genMorphGeometry(t,n,s,r,i.name)}))}))}},genMorphGeometry:function(e,t,n,i,r){for(var a=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],s=void 0!==n.Vertices?n.Vertices.a:[],o=void 0!==n.Indexes?n.Indexes.a:[],c=3*e.attributes.position.count,u=new Float32Array(c),l=0;l<o.length;l++){var h=3*o[l];u[h]=s[3*l],u[h+1]=s[3*l+1],u[h+2]=s[3*l+2]}var _={vertexIndices:a,vertexPositions:u},d=this.genBuffers(_),f=new Ue.a$l(d.vertex,3);f.name=r||n.attrName,f.applyMatrix4(i),e.morphAttributes.position.push(f)},parseNormals:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Normals.a,r=[];return"IndexToDirect"===n&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:r,mappingType:t,referenceType:n}},parseUVs:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.UV.a,r=[];return"IndexToDirect"===n&&(r=e.UVIndex.a),{dataSize:2,buffer:i,indices:r,mappingType:t,referenceType:n}},parseVertexColors:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Colors.a,r=[];return"IndexToDirect"===n&&(r=e.ColorIndex.a),{dataSize:4,buffer:i,indices:r,mappingType:t,referenceType:n}},parseMaterialIndices:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};for(var i=e.Materials.a,r=[],a=0;a<i.length;++a)r.push(a);return{dataSize:1,buffer:i,indices:r,mappingType:t,referenceType:n}},parseNurbsGeometry:function(e){if(void 0===xt)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new Ue.u9r;var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new Ue.u9r;for(var n,i,r=t-1,a=e.KnotVector.a,s=[],o=e.Points.a,c=0,u=o.length;c<u;c+=4)s.push((new Ue.Ltg).fromArray(o,c));if("Closed"===e.Form)s.push(s[0]);else if("Periodic"===e.Form){n=r,i=a.length-1-n;for(c=0;c<r;++c)s.push(s[c])}var l=new xt(r,a,s,n,i),h=l.getPoints(7*s.length),_=new Float32Array(3*h.length);h.forEach((function(e,t){e.toArray(_,3*t)}));var d=new Ue.u9r;return d.setAttribute("position",new Ue.TlE(_,3)),d}},s.prototype={constructor:s,parse:function(){var e=[],t=this.parseClips();if(void 0!==t)for(var n in t){var i=t[n],r=this.addClip(i);e.push(r)}return e},parseClips:function(){if(void 0!==e.Objects.AnimationCurve){var t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);var n=this.parseAnimationLayers(t),i=this.parseAnimStacks(n);return i}},parseAnimationCurveNodes:function(){var t=e.Objects.AnimationCurveNode,n=new Map;for(var i in t){var r=t[i];if(null!==r.attrName.match(/S|R|T|DeformPercent/)){var a={id:r.id,attr:r.attrName,curves:{}};n.set(a.id,a)}}return n},parseAnimationCurves:function(n){var i=e.Objects.AnimationCurve;for(var r in i){var a={id:i[r].id,times:i[r].KeyTime.a.map(f),values:i[r].KeyValueFloat.a},s=t.get(a.id);if(void 0!==s){var o=s.parents[0].ID,c=s.parents[0].relationship;c.match(/X/)?n.get(o).curves["x"]=a:c.match(/Y/)?n.get(o).curves["y"]=a:c.match(/Z/)?n.get(o).curves["z"]=a:c.match(/d|DeformPercent/)&&n.has(o)&&(n.get(o).curves["morph"]=a)}}},parseAnimationLayers:function(i){var r=e.Objects.AnimationLayer,a=new Map;for(var s in r){var o=[],c=t.get(parseInt(s));if(void 0!==c){var u=c.children;u.forEach((function(r,a){if(i.has(r.ID)){var s=i.get(r.ID);if(void 0!==s.curves.x||void 0!==s.curves.y||void 0!==s.curves.z){if(void 0===o[a]){var c=t.get(r.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==c){var u=e.Objects.Model[c.toString()];if(void 0===u)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",r);var l={modelName:u.attrName?Ue.iUV.sanitizeNodeName(u.attrName):"",ID:u.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};n.traverse((function(e){e.ID===u.id&&(l.transform=e.matrix,e.userData.transformData&&(l.eulerOrder=e.userData.transformData.eulerOrder))})),l.transform||(l.transform=new Ue.yGw),"PreRotation"in u&&(l.preRotation=u.PreRotation.value),"PostRotation"in u&&(l.postRotation=u.PostRotation.value),o[a]=l}}o[a]&&(o[a][s.attr]=s)}else if(void 0!==s.curves.morph){if(void 0===o[a]){var h=t.get(r.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,_=t.get(h).parents[0].ID,d=t.get(_).parents[0].ID;c=t.get(d).parents[0].ID,u=e.Objects.Model[c],l={modelName:u.attrName?Ue.iUV.sanitizeNodeName(u.attrName):"",morphName:e.Objects.Deformer[h].attrName};o[a]=l}o[a][s.attr]=s}}})),a.set(parseInt(s),o)}}return a},parseAnimStacks:function(n){var i=e.Objects.AnimationStack,r={};for(var a in i){var s=t.get(parseInt(a)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var o=n.get(s[0].ID);r[a]={name:i[a].attrName,layer:o}}return r},addClip:function(e){var t=[],n=this;return e.layer.forEach((function(e){t=t.concat(n.generateTracks(e))})),new Ue.m7l(e.name,-1,t)},generateTracks:function(e){var t=[],n=new Ue.Pa4,i=new Ue._fP,r=new Ue.Pa4;if(e.transform&&e.transform.decompose(n,i,r),n=n.toArray(),i=(new Ue.USm).setFromQuaternion(i,e.eulerOrder).toArray(),r=r.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var a=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==a&&t.push(a)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var s=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);void 0!==s&&t.push(s)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var o=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");void 0!==o&&t.push(o)}if(void 0!==e.DeformPercent){var c=this.generateMorphTrack(e);void 0!==c&&t.push(c)}return t},generateVectorTrack:function(e,t,n,i){var r=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(r,t,n);return new Ue.yC1(e+"."+i,r,a)},generateRotationTrack:function(e,t,n,i,r,a){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(Ue.M8C.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(Ue.M8C.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(Ue.M8C.degToRad));var s=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(s,t,n);void 0!==i&&(i=i.map(Ue.M8C.degToRad),i.push(a),i=(new Ue.USm).fromArray(i),i=(new Ue._fP).setFromEuler(i)),void 0!==r&&(r=r.map(Ue.M8C.degToRad),r.push(a),r=(new Ue.USm).fromArray(r),r=(new Ue._fP).setFromEuler(r).inverse());for(var c=new Ue._fP,u=new Ue.USm,l=[],h=0;h<o.length;h+=3)u.set(o[h],o[h+1],o[h+2],a),c.setFromEuler(u),void 0!==i&&c.premultiply(i),void 0!==r&&c.multiply(r),c.toArray(l,h/3*4);return new Ue.iLg(e+".quaternion",s,l)},generateMorphTrack:function(e){var t=e.DeformPercent.curves.morph,i=t.values.map((function(e){return e/100})),r=n.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Ue.dUE(e.modelName+".morphTargetInfluences["+r+"]",t.times,i)},getTimesForAllAxes:function(e){var t=[];return void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})).filter((function(e,t,n){return n.indexOf(e)==t})),t},getKeyframeTrackValues:function(e,t,n){var i=n,r=[],a=-1,s=-1,o=-1;return e.forEach((function(e){if(t.x&&(a=t.x.times.indexOf(e)),t.y&&(s=t.y.times.indexOf(e)),t.z&&(o=t.z.times.indexOf(e)),-1!==a){var n=t.x.values[a];r.push(n),i[0]=n}else r.push(i[0]);if(-1!==s){var c=t.y.values[s];r.push(c),i[1]=c}else r.push(i[1]);if(-1!==o){var u=t.z.values[o];r.push(u),i[2]=u}else r.push(i[2])})),r},interpolateRotations:function(e){for(var t=1;t<e.values.length;t++){var n=e.values[t-1],i=e.values[t]-n,r=Math.abs(i);if(r>=180){var a=r/180,s=i/a,o=n+s,c=e.times[t-1],u=e.times[t]-c,l=u/a,h=c+l,_=[],d=[];while(h<e.times[t])_.push(h),h+=l,d.push(o),o+=s;e.times=P(e.times,t,_),e.values=P(e.values,t,d)}}}},o.prototype={constructor:o,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new l,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,n=e.split(/[\r\n]+/);return n.forEach((function(e,i){var r=e.match(/^[\s\t]*;/),a=e.match(/^[\s\t]*$/);if(!r&&!a){var s=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),o=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),c=e.match("^\\t{"+(t.currentIndent-1)+"}}");s?t.parseNodeBegin(e,s):o?t.parseNodeProperty(e,o,n[++i]):c?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}})),this.allNodes},parseNodeBegin:function(e,t){var n=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),r={name:n},a=this.parseNodeAttr(i),s=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,r):n in s?("PoseNode"===n?s.PoseNode.push(r):void 0!==s[n].id&&(s[n]={},s[n][s[n].id]=s[n]),""!==a.id&&(s[n][a.id]=r)):"number"===typeof a.id?(s[n]={},s[n][a.id]=r):"Properties70"!==n&&(s[n]="PoseNode"===n?[r]:r),"number"===typeof a.id&&(r.id=a.id),""!==a.name&&(r.attrName=a.name),""!==a.type&&(r.attrType=a.type),this.pushStack(r)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var n="",i="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:n,type:i}},parseNodeProperty:function(e,t,n){var i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===i&&","===r&&(r=n.replace(/"/g,"").replace(/,$/,"").trim());var a=this.getCurrentNode(),s=a.name;if("Properties70"!==s){if("C"===i){var o=r.split(",").slice(1),c=parseInt(o[0]),u=parseInt(o[1]),l=r.split(",").slice(3);l=l.map((function(e){return e.trim().replace(/^"/,"")})),i="connections",r=[c,u],E(r,l),void 0===a[i]&&(a[i]=[])}"Node"===i&&(a.id=r),i in a&&Array.isArray(a[i])?a[i].push(r):"a"!==i?a[i]=r:a.a=r,this.setCurrentProp(a,i),"a"===i&&","!==r.slice(-1)&&(a.a=w(r))}else this.parseNodeSpecialProperty(e,i,r)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=w(t.a))},parseNodeSpecialProperty:function(e,t,n){var i=n.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),r=i[0],a=i[1],s=i[2],o=i[3],c=i[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=w(c);break}this.getPrevNode()[r]={type:a,type2:s,flag:o,value:c},this.setCurrentProp(this.getPrevNode(),r)}},c.prototype={constructor:c,parse:function(e){var t=new u(e);t.skip(23);var n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);var i=new l;while(!this.endOfContent(t)){var r=this.parseNode(t,n);null!==r&&i.add(r.name,r)}return i},endOfContent:function(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var n={},i=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();var a=e.getUint8(),s=e.getString(a);if(0===i)return null;for(var o=[],c=0;c<r;c++)o.push(this.parseProperty(e));var u=o.length>0?o[0]:"",l=o.length>1?o[1]:"",h=o.length>2?o[2]:"";n.singleProperty=1===r&&e.getOffset()===i;while(i>e.getOffset()){var _=this.parseNode(e,t);null!==_&&this.parseSubNode(s,n,_)}return n.propertyList=o,"number"===typeof u&&(n.id=u),""!==l&&(n.attrName=l),""!==h&&(n.attrType=h),""!==s&&(n.name=s),n},parseSubNode:function(e,t,n){if(!0===n.singleProperty){var i=n.propertyList[0];Array.isArray(i)?(t[n.name]=n,n.a=i):t[n.name]=i}else if("Connections"===e&&"C"===n.name){var r=[];n.propertyList.forEach((function(e,t){0!==t&&r.push(e)})),void 0===t.connections&&(t.connections=[]),t.connections.push(r)}else if("Properties70"===n.name){var a=Object.keys(n);a.forEach((function(e){t[e]=n[e]}))}else if("Properties70"===e&&"P"===n.name){var s,o=n.propertyList[0],c=n.propertyList[1],u=n.propertyList[2],l=n.propertyList[3];0===o.indexOf("Lcl ")&&(o=o.replace("Lcl ","Lcl_")),0===c.indexOf("Lcl ")&&(c=c.replace("Lcl ","Lcl_")),s="Color"===c||"ColorRGB"===c||"Vector"===c||"Vector3D"===c||0===c.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[o]={type:c,type2:u,flag:l,value:s}}else void 0===t[n.name]?"number"===typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var n=e.getUint32();return e.getArrayBuffer(n);case"S":n=e.getUint32();return e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var i=e.getUint32(),r=e.getUint32(),a=e.getUint32();if(0===r)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}"undefined"===typeof Mt&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var s=new Mt(new Uint8Array(e.getArrayBuffer(a))),o=new u(s.decompress().buffer);switch(t){case"b":case"c":return o.getBooleanArray(i);case"d":return o.getFloat64Array(i);case"f":return o.getFloat32Array(i);case"i":return o.getInt32Array(i);case"l":return o.getInt64Array(i)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},u.prototype={constructor:u,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1===(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e},getInt64Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=[],n=0;n<e;n++)t[n]=this.getUint8();var i=t.indexOf(0);return i>=0&&(t=t.slice(0,i)),Ue.Zp0.decodeText(new Uint8Array(t))}},l.prototype={constructor:l,add:function(e,t){this[e]=t}};var p=[];function m(e,t,n,i){var r;switch(i.mappingType){case"ByPolygonVertex":r=e;break;case"ByPolygon":r=t;break;case"ByVertice":r=n;break;case"AllSame":r=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}"IndexToDirect"===i.referenceType&&(r=i.indices[r]);var a=r*i.dataSize,s=a+i.dataSize;return T(p,i.buffer,a,s)}var v=new Ue.USm,g=new Ue.Pa4;function y(e){var t=new Ue.yGw,n=new Ue.yGw,i=new Ue.yGw,r=new Ue.yGw,a=new Ue.yGw,s=new Ue.yGw,o=new Ue.yGw,c=new Ue.yGw,u=new Ue.yGw,l=new Ue.yGw,h=new Ue.yGw,_=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(g.fromArray(e.translation)),e.preRotation){var d=e.preRotation.map(Ue.M8C.degToRad);d.push(e.eulerOrder),n.makeRotationFromEuler(v.fromArray(d))}if(e.rotation){d=e.rotation.map(Ue.M8C.degToRad);d.push(e.eulerOrder),i.makeRotationFromEuler(v.fromArray(d))}if(e.postRotation){d=e.postRotation.map(Ue.M8C.degToRad);d.push(e.eulerOrder),r.makeRotationFromEuler(v.fromArray(d))}e.scale&&a.scale(g.fromArray(e.scale)),e.scalingOffset&&o.setPosition(g.fromArray(e.scalingOffset)),e.scalingPivot&&s.setPosition(g.fromArray(e.scalingPivot)),e.rotationOffset&&c.setPosition(g.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(g.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(l=e.parentMatrixWorld);var f=n.multiply(i).multiply(r),p=new Ue.yGw;l.extractRotation(p);var m=new Ue.yGw;m.copyPosition(l);var y=new Ue.yGw;y.getInverse(p).multiply(l);var b=new Ue.yGw;if(0===_)b.copy(p).multiply(f).multiply(y).multiply(a);else if(1===_)b.copy(p).multiply(y).multiply(f).multiply(a);else{var w=(new Ue.yGw).getInverse(a),k=(new Ue.yGw).multiply(y).multiply(w);b.copy(p).multiply(f).multiply(k).multiply(a)}var E=(new Ue.yGw).getInverse(u),T=(new Ue.yGw).getInverse(s),P=new Ue.yGw;P.copy(t).multiply(c).multiply(u).multiply(n).multiply(i).multiply(r).multiply(E).multiply(o).multiply(s).multiply(a).multiply(T);var D=(new Ue.yGw).copyPosition(P),M=(new Ue.yGw).copy(l).multiply(D);return h.copyPosition(M),P=(new Ue.yGw).multiply(h).multiply(b),P}function b(e){e=e||0;var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===e?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function w(e){var t=e.split(",").map((function(e){return parseFloat(e)}));return t}function k(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),Ue.Zp0.decodeText(new Uint8Array(e,t,n))}function E(e,t){for(var n=0,i=e.length,r=t.length;n<r;n++,i++)e[i]=t[n]}function T(e,t,n,i){for(var r=n,a=0;r<i;r++,a++)e[a]=t[r];return e}function P(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t))}})(),n(2087);var Ot=function(e){Ue.aNw.call(this,e)};Ot.prototype=Object.assign(Object.create(Ue.aNw.prototype),{constructor:Ot,load:function(e,t,n,i){var r=this,a=new Ue.xEZ,s=new Ue.hH6(this.manager);return s.setResponseType("arraybuffer"),s.setPath(this.path),s.setWithCredentials(this.withCredentials),s.load(e,(function(e){a.image=r.parse(e),a.needsUpdate=!0,void 0!==t&&t(a)}),n,i),a},parse:function(e){function t(e){switch(e.image_type){case h:case f:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case _:case d:case p:case m:e.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case l:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',e.pixel_size)}function n(e,t,n,i,r){var a,s,o,c;if(s=n.pixel_size>>3,o=n.width*n.height*s,t&&(c=r.subarray(i,i+=n.colormap_length*(n.colormap_size>>3))),e){var u,l,h;a=new Uint8Array(o);var _=0,d=new Uint8Array(s);while(_<o)if(u=r[i++],l=1+(127&u),128&u){for(h=0;h<s;++h)d[h]=r[i++];for(h=0;h<l;++h)a.set(d,_+h*s);_+=s*l}else{for(l*=s,h=0;h<l;++h)a[_+h]=r[i++];_+=l}}else a=r.subarray(i,i+=t?n.width*n.height:o);return{pixel_data:a,palettes:c}}function i(e,t,n,i,r,a,s,o,c){var u,l,h,_=c,d=0,f=P.width;for(h=t;h!==i;h+=n)for(l=r;l!==s;l+=a,d++)u=o[d],e[4*(l+f*h)+3]=255,e[4*(l+f*h)+2]=_[3*u+0],e[4*(l+f*h)+1]=_[3*u+1],e[4*(l+f*h)+0]=_[3*u+2];return e}function r(e,t,n,i,r,a,s,o){var c,u,l,h=0,_=P.width;for(l=t;l!==i;l+=n)for(u=r;u!==s;u+=a,h+=2)c=o[h+0]+(o[h+1]<<8),e[4*(u+_*l)+0]=(31744&c)>>7,e[4*(u+_*l)+1]=(992&c)>>2,e[4*(u+_*l)+2]=(31&c)>>3,e[4*(u+_*l)+3]=32768&c?0:255;return e}function a(e,t,n,i,r,a,s,o){var c,u,l=0,h=P.width;for(u=t;u!==i;u+=n)for(c=r;c!==s;c+=a,l+=3)e[4*(c+h*u)+3]=255,e[4*(c+h*u)+2]=o[l+0],e[4*(c+h*u)+1]=o[l+1],e[4*(c+h*u)+0]=o[l+2];return e}function s(e,t,n,i,r,a,s,o){var c,u,l=0,h=P.width;for(u=t;u!==i;u+=n)for(c=r;c!==s;c+=a,l+=4)e[4*(c+h*u)+2]=o[l+0],e[4*(c+h*u)+1]=o[l+1],e[4*(c+h*u)+0]=o[l+2],e[4*(c+h*u)+3]=o[l+3];return e}function o(e,t,n,i,r,a,s,o){var c,u,l,h=0,_=P.width;for(l=t;l!==i;l+=n)for(u=r;u!==s;u+=a,h++)c=o[h],e[4*(u+_*l)+0]=c,e[4*(u+_*l)+1]=c,e[4*(u+_*l)+2]=c,e[4*(u+_*l)+3]=255;return e}function c(e,t,n,i,r,a,s,o){var c,u,l=0,h=P.width;for(u=t;u!==i;u+=n)for(c=r;c!==s;c+=a,l+=2)e[4*(c+h*u)+0]=o[l+0],e[4*(c+h*u)+1]=o[l+0],e[4*(c+h*u)+2]=o[l+0],e[4*(c+h*u)+3]=o[l+1];return e}function u(e,t,n,u,l){var h,_,d,f,p,m;switch((P.flags&v)>>g){default:case w:h=0,d=1,p=t,_=0,f=1,m=n;break;case y:h=0,d=1,p=t,_=n-1,f=-1,m=-1;break;case k:h=t-1,d=-1,p=-1,_=0,f=1,m=n;break;case b:h=t-1,d=-1,p=-1,_=n-1,f=-1,m=-1;break}if(C)switch(P.pixel_size){case 8:o(e,_,f,m,h,d,p,u);break;case 16:c(e,_,f,m,h,d,p,u);break;default:console.error("THREE.TGALoader: Format not supported.");break}else switch(P.pixel_size){case 8:i(e,_,f,m,h,d,p,u,l);break;case 16:r(e,_,f,m,h,d,p,u);break;case 24:a(e,_,f,m,h,d,p,u);break;case 32:s(e,_,f,m,h,d,p,u);break;default:console.error("THREE.TGALoader: Format not supported.");break}return e}var l=0,h=1,_=2,d=3,f=9,p=10,m=11,v=48,g=4,y=0,b=1,w=2,k=3;e.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");var E=new Uint8Array(e),T=0,P={id_length:E[T++],colormap_type:E[T++],image_type:E[T++],colormap_index:E[T++]|E[T++]<<8,colormap_length:E[T++]|E[T++]<<8,colormap_size:E[T++],origin:[E[T++]|E[T++]<<8,E[T++]|E[T++]<<8],width:E[T++]|E[T++]<<8,height:E[T++]|E[T++]<<8,pixel_size:E[T++],flags:E[T++]};t(P),P.id_length+T>e.length&&console.error("THREE.TGALoader: No data."),T+=P.id_length;var D=!1,M=!1,C=!1;switch(P.image_type){case f:D=!0,M=!0;break;case h:M=!0;break;case p:D=!0;break;case _:break;case m:D=!0,C=!0;break;case d:C=!0;break}var x="undefined"!==typeof OffscreenCanvas,O=x?new OffscreenCanvas(P.width,P.height):document.createElement("canvas");O.width=P.width,O.height=P.height;var I=O.getContext("2d"),L=I.createImageData(P.width,P.height),A=n(D,M,P,T,E);return u(L.data,P.width,P.height,A.pixel_data,A.palettes),I.putImageData(L,0,0),O}});var It=function(){function e(){(0,h.Z)(this,e)}return(0,_.Z)(e,null,[{key:"makeCubes",value:function(e,t,n){var i=[],r=[[0,1],[1,0],[0,-1],[-1,0]],a=[0,0],s=0,o=r[0],c=r[0];while(n.length){o=r.shift(),o===c&&(s+=1);while(n.length&&(1===o[1]&&a[1]<s||-1===o[1]&&a[1]>-s||1===o[0]&&a[0]<s||-1===o[0]&&a[0]>-s)){n.shift();var u=new Ue.nvb(.8,1,.8),l=new Ue.Kj0(u,t);l.position.x=a[0],l.position.z=a[1],a[0]=a[0]+o[0],a[1]=a[1]+o[1],e.add(l),i.push(l)}r.push(o)}return i}},{key:"makeCircles",value:function(e,t,n){var i=[],r=2*Math.PI/n.length;return n.forEach((function(n,a){var s=new Ue.m_w(.7,.7,5,32),o=new Ue.Kj0(s,t);o.position.x=15*Math.sin(r*a),o.position.z=15*Math.cos(r*a),e.add(o),i.push(o)})),i}},{key:"makePointLight",value:function(e,t){var n=new Ue.Aip(.1,16,8),i=new Ue.cek(t,2,50);return i.add(new Ue.Kj0(n,new Ue.vBJ({color:t}))),e.add(i),i}}]),e}(),Lt={name:"ThreeView",provide:function(){return{}},components:{},mixins:[],props:["index"],inject:["musicData"],data:function(){return{camera:null,scene:null,renderer:null,mesh:null,light1:null,time:0,width:0,height:0,hasInit:!1}},computed:{},methods:{init:function(){var e=this.musicData,t=this.$el,n=t.clientWidth,i=t.clientHeight,r=this.camera=new Ue.cPb(30,n/i,1,1e4);r.position.set(50,50,50);var a=this.scene=new Ue.xsS;a.add(new Ue.Mig(16777215,.3)),this.pointLights={r:It.makePointLight(a,65280),g:It.makePointLight(a,65280),b:It.makePointLight(a,255),rg:It.makePointLight(a,16776960),rb:It.makePointLight(a,16711935),gb:It.makePointLight(a,65535)};var s=this.renderer=new Ue.CP7;s.shadowMap.enabled=!0,s.setPixelRatio(window.devicePixelRatio),s.setSize(window.innerWidth,window.innerHeight),s.domElement.className="three-view-canvas",document.body.appendChild(s.domElement);var o=new Ne(r,s.domElement);o.target.set(0,1,0),o.update();var c=new Ue.xoR({color:3355443,shininess:0}),u=new Ue.Kj0(new Ue.BKK(200,200,1,1),c);u.rotation.x=-Math.PI/2,u.receiveShadow=!0,a.add(u);var h=new Ue.EJi({color:16777215,shininess:10});this.cubes=It.makeCubes(a,h,(0,l.Z)(e.realTimeData.data)),this.circles=It.makeCircles(a,h,(0,l.Z)(e.realTimeData.data)),this.hasInit=!0},threeRenderer:function(){if(this.hasInit){var e=this.renderer,t=this.scene,n=this.camera,i=this.cubes,r=this.circles,a=this.time,s=this.musicData.realTimeData.avrLevel;this.time+=s/255*.8+.2,Object.values(this.pointLights).forEach((function(e,t){var n=t/3+1,i=120*t;e.position.x=15*Math.sin(i+a/30*n*1.5),e.position.y=10*Math.cos(i+a/30*n*2)+20,e.position.z=15*Math.cos(i+a/30*n*3)}));var o=(0,l.Z)(this.musicData.realTimeData.data),c=2*Math.PI/o.length;i&&i.forEach((function(e,t){e&&(e.scale.y=o[t]/255*2.7+.3)})),r&&r.forEach((function(e,t){e&&(e.scale.y=o[t]/255*2.9+.1,e.position.x=30*Math.sin(c*t),e.position.z=30*Math.cos(c*t))})),e.render(t,n)}}},watch:{},beforeDestroy:function(){},mounted:function(){var e=this;this.width=this.$el.offsetWidth,this.height=this.$el.offsetHeight,this.init(),this.musicData.realTimeData.event.addEventListener("update",(function(){e.threeRenderer()}))}},At=Lt,jt=(0,G.Z)(At,Be,Se,!1,null,"aaad4802",null),Rt=jt.exports,Bt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"canvas-view"},[n("canvas",{ref:"canvas",attrs:{width:e.width,height:e.height}})])},St=[],Ut=(n(3290),{name:"CanvasView",inject:["musicDataFlags","musicData","musicConfig","gameList","mv"],data:function(){return{width:0,height:0}},computed:{},props:["config"],watch:{"musicDataFlags.dataFlag":{immediate:!0,deep:!0,handler:function(){this.$canvas&&this.ctx&&this.renderCanvas()}}},methods:{renderCanvas:function(){var e=this.mv,t=this.musicData,n=this.config,i=this.musicConfig,r=n;this.$canvasHidded.width=this.width=this.$el.offsetWidth,this.$canvasHidded.height=this.height=this.$el.offsetHeight,e.size=8*r.dataSize;var a=this.height,s=this.width,o=this.ctx,c=this.viewCtx,u=t.originData,h=t.realTimeData,_=t.calculateColors,d=h.avrLevel,f=h.data,p=u.data,m=(0,l.Z)(r.copyData?f:[]);m.reverse();var v=[];if(r.showDataBefore){var g=(0,l.Z)(r.copyData?p:[]);g.reverse(),v=[].concat((0,l.Z)(p),(0,l.Z)(g)),v.reverse()}var y=[].concat((0,l.Z)(f),(0,l.Z)(m),(0,l.Z)(v)).filter((function(e){return!r.noZero||e})),b=(i.currentImgAviColor,i.mouseMoveConf,[Math.min(a,s),Math.max(a,s)][r.baseSizeType]),w={x:s*r.midPositionX/100,y:a*r.midPositionY/100},k=b*r.mainRadius/100*(100-r.avrLevelMainRadiusModify+r.avrLevelMainRadiusModify*d/256)/100,E=b*r.floatRange/100*(100-r.avrLevelFloatRangeModify+r.avrLevelFloatRangeModify*d/256)/100;if(o.fillStyle="rgba(0, 0, 0, ".concat(r.disable?1:1-r.clearPrevView/100,")"),o.fillRect(0,0,this.width,this.height),o.clearRect(0,0,s,a),c.clearRect(0,0,s,a),r.disable)c.drawImage(this.$canvasHidded,0,0);else{o.fillStyle=o.strokeStyle="rgba(".concat(_[0].join(", "),", ").concat(r.mainRadiusOpacity/100,")"),o.lineWidth=b*r.mainRadiusLineWidth/1e3,o.beginPath(),0===r.direction&&o.arc(w.x,w.y,Math.abs(k),0,2*Math.PI),o.closePath(),o.stroke();var T=y.length||1,P=2*Math.PI/(T||1)*r.stepModify/10,D=P/2,M=0*Math.PI;o.lineWidth=b*r.lineLineWidth/1e3;var C=r.dataModify/10,x=1+r.dataOffsetModify/100;o.closePath();var O=y.length,I=r.minHeightModify/100;y.forEach((function(e,t){e=e/256+I;var n=y[(t+1)%O]/256+I,i=P*t+M;function a(){var n=(t-T/2)*r.stepModify,a=[[Math.sin(i)*(e*C+x*k)+w.x,Math.cos(i)*(e*C+x*k)+w.y],[w.x+n,-(e*C+x*k)+w.y]][r.direction],s=[[Math.sin(i)*(e*C*E*3+x*k)+w.x,Math.cos(i)*(e*C*E*3+x*k)+w.y],[w.x+n,-(e*C*E*3+x*k)+w.y]][r.direction],c=o.createLinearGradient(a[0],a[1],s[0],s[1]);c.addColorStop(1,"rgba(".concat(_[0].join(", "),", 1)")),c.addColorStop(.75,"rgba(".concat(_[1].join(", "),", 1)")),c.addColorStop(0,"rgba(".concat(_[1].join(", "),", 1)")),o.strokeStyle=c,o.beginPath(),o.moveTo(a[0],a[1]),o.lineTo(s[0],s[1]),o.closePath(),o.stroke()}var s=e*C*E*3+k;function c(){o.strokeStyle="rgba(".concat(_[1].join(", "),", ").concat(2*d/255+.25,")");var e=n*C*E*3+k;o.beginPath(),o.moveTo(Math.sin(i)*s+w.x,Math.cos(i)*s+w.y),o.bezierCurveTo(Math.sin(i+P/3)*s+w.x,Math.cos(i+P/3)*s+w.y,Math.sin(i+P/3*2)*e+w.x,Math.cos(i+P/3*2)*e+w.y,Math.sin(i+P)*e+w.x,Math.cos(i+P)*e+w.y),o.closePath(),o.stroke()}function u(){o.fillStyle="rgba(".concat(_[1].join(", "),", 1)"),o.beginPath();var n=(t-T/2)*r.stepModify+w.x,a=[[Math.sin(i)*s+w.x,Math.cos(i)*s+w.y],[n,-(e*C*E*3+x*k)+w.y]][r.direction]||[],c=a[0],u=a[1];o.arc(c,u,b*r.lineLineWidth/1e3,0,2*Math.PI),o.closePath(),o.fill()}function l(){o.strokeStyle="rgba(".concat(_[1].join(", "),", 1)"),o.beginPath();var t=(e*C-r.threshold/10)*E;t<0&&(t=0);var n=[[Math.sin(i-D)*k+w.x,Math.cos(i-D)*k+w.y],[Math.sin(i+D)*k+w.x,Math.cos(i+D)*k+w.y],[Math.sin(i)*(-t+k)+w.x,Math.cos(i)*(-t+k)+w.y],[Math.sin(i)*(t+k)+w.x,Math.cos(i)*(t+k)+w.y]];[0,2,1,3,0,2].forEach((function(e){o.lineTo.apply(o,n[e])})),o.closePath(),o.stroke()}[a,c,l,u][r.renderType]()})),o.closePath(),c.drawImage(this.$canvasHidded,0,0)}}},mounted:function(){this.$canvas=this.$refs.canvas,this.viewCtx=this.$canvas.getContext("2d"),this.$canvasHidded=window.OffscreenCanvas?new OffscreenCanvas(this.$canvas.width,this.$canvas.height):document.createElement("canvas"),this.ctx=this.$canvasHidded.getContext("2d")}}),Nt=Ut,Zt=(0,G.Z)(Nt,Bt,St,!1,null,"bd352cee",null),Ft=Zt.exports,Wt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"canvas-view"},[n("canvas",{ref:"canvas",attrs:{width:e.width,height:e.height}})])},Kt=[],$t=n(8967),qt=function(){function e(){(0,h.Z)(this,e)}return(0,_.Z)(e,[{key:"exec",value:function(){var t=this.max_,n=this.min_,i=this.sign_;return e.exec(t,n,i)}},{key:"sign",value:function(){return this.sign_=-1,this}},{key:"min",value:function(e){return $t.X.isNumber(e)&&(this.min_=e),this}},{key:"max",value:function(e){return $t.X.isNumber(e)&&(this.max_=e),this}},{key:"int",value:function(t,n){var i=this.max_,r=this.min_,a=this.sign_;return e.int(i,r,a,t,n)}},{key:"boolean",value:function(){return e.boolean(size,rate)}}],[{key:"exec",value:function(e,t,n){var i=Math.random();return $t.X.isNumber(e)&&(i*=e),$t.X.isNumber(t)&&(i+=t),n&&(i*=-1),i}},{key:"int",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;return(i&&e.boolean()?-1:1)*Math.round(Math.random()*t+n)}},{key:"boolean",value:function(){return Math.round(Math.random())}},{key:"time",value:function(){return Date.now().toString()}}]),e}();var Vt={r:0,g:1,b:2,a:3},zt=function(){function e(t){(0,h.Z)(this,e),(0,d.Z)(this,"aisleMap",Vt),(0,d.Z)(this,"imageData",void 0),this.imageData=t}return(0,_.Z)(e,[{key:"getAisle",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.aisleMap[t];if(void 0===i)return[];for(var r=this.imageData,a=r.data,s=r.width,o=r.height,c=[],u=0;u<o;u++){var l=[];c.push(l);for(var h=s*u,_=0;_<s;_++)l.push(a[4*(h+_)+i]),n&&(a[4*(h+_)+i]=e.cutFnMap[n]&&e.cutFnMap[n]()||255)}return c}},{key:"aisleOffset",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=this.aisleMap[e];if(void 0!==a)for(var s=this.getAisle(e,r),o=this.imageData,c=o.data,u=o.width,l=o.height,h=0;h<l;h++)for(var _=s[h+n]||{},d=u*(h+n)+t,f=0;f<u;f++)c[4*(d+f)+a]=(_[f]||0)*i}}]),e}();(0,d.Z)(zt,"cutFnMap",{1:function(){return 255},2:function(){return 0},3:function(){return qt.int(255,0)}});var Ht={name:"CanvasPic",inject:["musicDataFlags","musicData","musicConfig","gameList","mv","modifyManager","commonOptions_"],data:function(){return{width:0,height:0,count:0,thisCount:0,imgCtx:null,shallMalfunction:0}},watch:{"musicDataFlags.shockFlag":{immediate:!0,handler:function(){this.commonOptions_.CanvasPicMalfunction&&(this.shallMalfunction=2)}},"musicDataFlags.dataFlag":{immediate:!0,handler:function(){this.$canvas&&this.ctx&&this.renderCanvas()}}},methods:{renderCanvas:function(){var e=this,t=this.height,n=this.width,i=this.ctx,r=(this.imgCtx,this.musicConfig),a=this.musicData,s=a.realTimeData,o=s.avrLevel;if(i.putImageData(r.getImageData(0,0,n,t),0,0),this.shallMalfunction){var c=[0,1,2,3,4,5];function u(e,t,n){return'<filter id="'.concat(e,'"><feGaussianBlur in="SourceGraphic" stdDeviation="').concat(t,",").concat(n,'"></feGaussianBlur></filter>')}document.querySelector("#svg-all").innerHTML="<defs>".concat(c.map((function(e){return u("blur".concat(2*e),0,e?o/255/e*20:0)})).join("")).concat(c.map((function(e){return u("blur".concat(2*e,"-v"),e?o/255/e*20:0,0)})).join("")).concat(c.map((function(e){return u("blur".concat(2*e,"--45"),e?o/255/e*20:0,0)})).join(""),"</defs>")}var l=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=a?qt.int(n,n/(a+.2*a)):n,c=a?qt.int(t,t/(5*a)):t/10,u=(n-s)/2,l=(t-c)/2+qt.int(c/2,0,!0),h=r.getImageData(u,l,s,c);if(h){var _=new zt(h),d=qt.boolean(),f=o/4;if(e.shallMalfunction){var p=[function(e){return _.aisleOffset("r",d?e:0,d?0:e,void 0,qt.int(3,0))},function(e){return _.aisleOffset("g",d?e:0,d?0:e,void 0,qt.int(3,0))},function(e){return _.aisleOffset("b",d?e:0,d?0:e,void 0,qt.int(3,0))}],m=qt.int(2,0);p[m](qt.int(f,f/2,!0)),qt.boolean()&&p[(m+1)%p.length](qt.int(f,f/3,!0)),qt.boolean()&&p[(m+2)%p.length](qt.int(f,f/4,!0)),i.putImageData(_.imageData,u+qt.int(20*a,0,!0),l+qt.int(10*a,0,!0))}i.putImageData(h,u,l)}};r.picDom&&2===this.shallMalfunction&&l(0),this.viewCtx.drawImage(this.$canvasHidded,0,0),this.shallMalfunction&&this.shallMalfunction--}},mounted:function(){this.$canvas=this.$refs.canvas,this.viewCtx=this.$canvas.getContext("2d"),this.$canvasHidded=window.OffscreenCanvas?new OffscreenCanvas(this.$canvas.width,this.$canvas.height):document.createElement("canvas"),this.$canvasImage=window.OffscreenCanvas?new OffscreenCanvas(this.$canvas.width,this.$canvas.height):document.createElement("canvas"),this.$canvasImage.width=this.$canvasHidded.width=this.width=this.$el.offsetWidth,this.$canvasImage.height=this.$canvasHidded.height=this.height=this.$el.offsetHeight,this.ctx=this.$canvasHidded.getContext("2d"),this.imgCtx=this.$canvasImage.getContext("2d")}},Gt=Ht,Xt=(0,G.Z)(Gt,Wt,Kt,!1,null,"0226e92a",null),Yt=Xt.exports,Qt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"canvas-view"},[n("div",{style:e.textStyle},[e._v("Happy new Year!")])])},Jt=[],en={name:"CanvasText",inject:["musicDataFlags","musicData","musicConfig","gameList","mv","modifyManager","navList"],data:function(){return{width:0,height:0,count:0,thisCount:0,imgCtx:null,textStyle:""}},computed:{},watch:{"musicDataFlags.dataFlag":{immediate:!0,handler:function(){var e=musicData,t=e.realTimeData,n=(e.calculateColors,t.avrLevel),i=n/255,r=Math.round(n/255*100)+10,a=n/255+.75,s=n/255/2+.75;this.textStyle="text-shadow: ".concat(["0 0 ".concat(r,"px #fff"),"0 0 ".concat(2*r,"px #fff"),"0 0 ".concat(3*r,"px #fff"),"0 0 ".concat(4*r,"px #fff"),"0 0 ".concat(5*r,"px #ff5722"),"0 0 ".concat(6*r,"px #ff5722"),"0 0 ".concat(7*r,"px #ff5722"),"0 0 ".concat(8*r,"px #ff5722")].join(","),"; opacity: ").concat(a>1?1:a,"; transform: translate3d(0,0,0) scale(").concat(s,", ").concat(s,") rotate(").concat(qt.exec(3*i,-3*i),"deg)")}}},methods:{}},tn=en,nn=(0,G.Z)(tn,Qt,Jt,!1,null,"7a6a75bb",null),rn=nn.exports,an=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"canvas-view"},[n("canvas",{ref:"canvas",attrs:{width:e.width,height:e.height}})])},sn=[],on={name:"CanvasText",inject:["musicDataFlags","musicData","musicConfig","gameList","mv","modifyManager"],data:function(){return{width:0,height:0,count:0,thisCount:0,imgCtx:null,shallMalfunction:!1,size:0}},watch:{"musicDataFlags.dataFlag":{immediate:!0,handler:function(){this.$canvas&&this.ctx&&this.renderCanvas()}},"musicDataFlags.shockFlag":{immediate:!0,handler:function(){this.modifyManager.getTrackByName("CommonOptionsTrack").getVal("CanvasTextMalfunction")&&(this.shallMalfunction=!0),this.size=0}}},methods:{renderCanvas:function(){var e=this,t=this.height,n=this.width,i=this.ctx,r=(this.imgCtx,this.musicConfig),a=this.viewCtx,s=this.musicData,o=s.realTimeData,c=s.calculateColors,u=o.avrLevel,l=100,h=n/2,_=.66*t,d=this.size=this.size||160+qt.int(10*u/255,0,!0)-1.5*(r.lrc||"").length;i.clearRect(0,0,n,t),a.clearRect(0,0,n,t),r.lrc&&(i.fillStyle="rgba(0,0,0,.5)",i.fillRect(0,t/7*3.9,n,t/7*1.3)),i.font="".concat(d,"px pmzdbtt");var f=i.measureText(r.lrc);f.width>n-100&&(d=this.size=Math.floor(this.size/f.width*(n-100)),i.font="".concat(d,"px pmzdbtt")),i.textAlign="center",i.textBaseline="middle",i.lineWidth=1;var p=u/255,m=p*d/4+4;i.strokeStyle="rgba(".concat(c[1].map((function(e){return 255})).join(", "),", ").concat(p,")"),i.strokeText(r.lrc,h+m,_-m);var v=i.createPattern(j.pciCanvas,"repeat");i.fillStyle=v,i.fillText(r.lrc,h+m,_-m),i.strokeStyle="rgba(".concat(c[1].map((function(e){return 255})).join(", "),", ").concat(.8*p,")"),i.strokeText(r.lrc,h+m/2,_-m/2),i.fillStyle="rgba(255,255,255,.3)",i.fillText(r.lrc,h+m/2,_-m/2),i.strokeStyle="rgba(".concat(c[1].map((function(e){return 255-e})).join(", "),", 1)"),i.strokeText(r.lrc,h,_),i.fillStyle="rgba(".concat(c[1].join(", "),", 0.3)"),i.fillText(r.lrc,h,_);var g=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=i.measureText(r.lrc).width||1;if(s){var o=s,c=d*t/4,u=d,h=(n-o)/2,f=_-u/2+qt.int(d-c,0);if(!(c<0)){var p=i.getImageData(h,f,o,c),m=new zt(p),v=(l-d)/4;if(e.shallMalfunction){var g=[function(){return m.aisleOffset("r",qt.int(v,v/2,!0),qt.int(v,v/2,!0))},function(){return m.aisleOffset("g",qt.int(v,v/3,!0),qt.int(v,v/3,!0))},function(){return m.aisleOffset("b",qt.int(v,v/4,!0),qt.int(v,v/4,!0))}],y=g.length,b=qt.int(2,0);g[b](),qt.boolean()&&g[++b%y](),qt.boolean()&&g[++b%y]()}i.putImageData(m.imageData,h,f),a.drawImage(e.$canvasHidded,0,0)}}};r.picDom&&(g(1),g(2),g(3)),this.shallMalfunction=!1}},mounted:function(){this.$canvas=this.$refs.canvas,this.viewCtx=this.$canvas.getContext("2d"),this.$canvasHidded=window.OffscreenCanvas?new OffscreenCanvas(this.$canvas.width,this.$canvas.height):document.createElement("canvas"),this.$canvasImage=window.OffscreenCanvas?new OffscreenCanvas(this.$canvas.width,this.$canvas.height):document.createElement("canvas"),this.$canvasImage.width=this.$canvasHidded.width=this.width=this.$el.offsetWidth,this.$canvasImage.height=this.$canvasHidded.height=this.height=this.$el.offsetHeight,this.ctx=this.$canvasHidded.getContext("2d"),this.imgCtx=this.$canvasImage.getContext("2d")}},cn=on,un=(0,G.Z)(cn,an,sn,!1,null,"3153c9aa",null),ln=un.exports,hn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"canvas-view"},[n("video",{attrs:{src:e.src,autoplay:"autoplay",muted:""},domProps:{muted:!0},on:{ended:e.handelEnded}})])},_n=[],dn={name:"VideoView",provide:function(){return{}},components:{},mixins:[],props:["index"],inject:["musicDataFlags","musicData","musicConfig","gameList","mv","modifyManager"],data:function(){return{ended:!0,shallChange:!1,current:this.index,src:"",srcs:["./videos/1.mp4","./videos/2.mp4","./videos/3.mp4","./videos/4.mp4"],width:0,height:0,play:function(){}}},computed:{changeVideo:function(){return this.musicData.soundTrackArr.find((function(e){return e.isChangeDot}))}},methods:{handelEnded:function(){this.ended=!0}},watch:{"musicDataFlags.shockFlag":function(){this.ended&&(this.current++,this.src=this.srcs[this.current%this.srcs.length],this.ended=!1)}},beforeDestroy:function(){document.removeEventListener("click",this.play)},mounted:function(){document.addEventListener("click",this.play),this.play(),this.width=this.$el.offsetWidth,this.height=this.$el.offsetHeight}},fn=dn,pn=(0,G.Z)(fn,hn,_n,!1,null,"3830f794",null),mn=pn.exports,vn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"dom-clock"},e._l(e.time,(function(t,i){return n("div",{style:e.d3wrapStyle},e._l(t,(function(t,r){return n("div",[r?[n("span",[e._v(e._s(i?":":"-"))])]:e._e(),e._l(t,(function(e){return[n("DomClockItem",{attrs:{num:e}})]}))],2)})),0)})),0)},gn=[],yn=function(){function e(){(0,h.Z)(this,e)}return(0,_.Z)(e,null,[{key:"format",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yea-mon-dat",i=t||new Date;return n.replace(/yea/g,i.getFullYear().toString()).replace(/mon/g,e.to00(i.getMonth()+1)).replace(/dat/g,e.to00(i.getDate())).replace(/hou/g,e.to00(i.getHours())).replace(/min/g,e.to00(i.getMinutes())).replace(/sec/g,e.to00(i.getSeconds())).replace(/mis/g,e.to000(i.getMilliseconds()))}},{key:"to00",value:function(e){return e>9?"".concat(e):"0".concat(e)}},{key:"to000",value:function(t){return t>99?"".concat(t):"0".concat(e.to00(t))}}]),e}(),bn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"dom-clock-item-wrap"},[n("div",{staticClass:"dom-clock-item"},e._l(e.list,(function(e,t){return n("div",{class:{track:!0}},[n("div")])})),0),n("div",{staticClass:"dom-clock-item"},e._l(e.list,(function(e,t){return n("div",{class:{active:e}},[n("div")])})),0)])},wn=[],kn=[[1,1,1,1,1,1,0],[0,1,1,0,0,0,0],[1,1,0,1,1,0,1],[1,1,1,1,0,0,1],[0,1,1,0,0,1,1],[1,0,1,1,0,1,1],[1,0,1,1,1,1,1],[1,1,1,0,0,0,0],[1,1,1,1,1,1,1],[1,1,1,1,0,1,1]],En={name:"DomClockItem",props:["num"],data:function(){return{musicData:i.musicData,musicDataFlags:i.musicDataFlags}},computed:{list:function(){return kn[this.num]}},methods:{renderCanvas:function(){}},mounted:function(){}},Tn=En,Pn=(0,G.Z)(Tn,bn,wn,!1,null,"f8f17254",null),Dn=Pn.exports,Mn={name:"DomClock",components:{DomClockItem:Dn},data:function(){return{time:""}},inject:["musicDataFlags","musicData","musicConfig","gameList","mv","modifyManager"],computed:{d3wrapStyle:function(){var e=this.musicConfig,t=e.mouseMoveConf,n=t._x,i=t._y,r=150;return{transform:"translateZ(-400px) rotateX(".concat(-i*r-20,"deg) rotateY(").concat(n*r,"deg)")}},dataFlag:function(){return this.musicDataFlags.dataFlag}},watch:{"musicDataFlags.shockFlag":{immediate:!0,handler:function(){}},dataFlag:{immediate:!0,handler:function(){var e=new Date;this.time=[yn.format(e,"yea mon dat").split(" ").map((function(e){return e.split("")})),yn.format(e,"hou min sec").split(" ").map((function(e){return e.split("")}))]}}},methods:{renderCanvas:function(){}},mounted:function(){}},Cn=Mn,xn=(0,G.Z)(Cn,vn,gn,!1,null,"591f40bb",null),On=xn.exports,In=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"game-ui",class:{active:e.gameList.ended}},[n("div",{staticClass:"progress"},[n("span",{style:e.progressStyle})]),n("ul",[e._l(e.formConfigs,(function(t,i){return n("li",[n("div",[e._v(e._s(t.label))]),n("div",[e._v(e._s(e.gameList[t.key]))])])})),n("li",[n("div",[e._v("realTimeData")]),n("div",[e._v(e._s(e.musicData.realTimeData.shockNum))])]),n("li",[n("div",[e._v("originData")]),n("div",[e._v(e._s(e.musicData.originData.shockNum))])])],2)])},Ln=[],An={name:"GameUI",inject:["musicDataFlags","musicData","musicConfig","gameList","mv"],data:function(){return{formConfigs:[{key:"total",label:"节点数"},{key:"totalScore",label:"扣除分数"},{key:"maxCombo",label:"最大连击数"},{key:"missCount",label:"miss"},{key:"uselessCount",label:"无效按键"}]}},computed:{progressStyle:function(){var e=this.gameList,t=e.currentTime,n=e.durationTime;return{transform:"scale(".concat(n?t/n:0,", 1)")}}},watch:{},methods:{},mounted:function(){}},jn=An,Rn=(0,G.Z)(jn,In,Ln,!1,null,"17b5a148",null),Bn=Rn.exports,Sn=function(){var e=new U.lW,t=e.getTrackByName("CommonOptionsTrack"),n=e.getTrackByName("BalanceTrack"),i=f.h.node("div");f.h.class(i,"game-wrap"),f.h.append(document.body,i);var r=f.h.node("div");f.h.class(r,"game-inner"),f.h.append(i,r);var a=new v,s=new w(e),o=["22824.jpg","22891.jpg"],c=new S({images:o}),l=new $({size:Math.pow(2,7),musicConfig:c,volume:.3}),h=new P(l,r,e),_=e.getTrackByName("GameTrack"),d=function(e){var n=t.getVal("gameUI");n&&h.createGameNode(e.rhythmPoint,_.getVal("trick"))};s.originData.event.addEventListener("shock",d),s.originData.event.addEventListener("update",(function(){var n=t.getVal("gameScene");if(n){window.isPhone||new D(s.originData,s,r,e);var i=c.mouseMoveConf,a=i._x,o=i._y,u=180;r.style="transform: rotateY(".concat(-a*u,"deg) rotateX(").concat(o*u,"deg) translateZ(100px);")}}));var p=new M;return p.enter({name:"导出预设",id:"export_presets",callback:function(){e.exportPresets()}}),p.enter({type:"fileReader",name:"读取预设",id:"import_presets",callback:function(t){var n=t.target.files;console.log(n);var i=new FileReader;i.onload=function(){try{var t=JSON.parse(i.result);e.importPresets(t)}catch(n){u.r.toast(["解析配置失败"])}},n[0]&&i.readAsText(n[0])}}),{balanceOptions:n,navList:p,commonOptions_:t,modifyManager:e,musicDataFlags:a,musicData:s,musicConfig:c,gameList:h,mv:l}}(),Un={name:"DashBoard",components:{NavBar:Y,MusicSearchBox:Ee,MusicLocalBox:xe,ModifyBox:Re,GameUI:Bn,CanvasView:Ft,VideoView:mn,CanvasPic:Yt,CanvasText:ln,CanvasTitle:rn,DomClock:On,ThreeView:Rt},provide:function(){var e=this.navList,t=this.commonOptions_,n=this.modifyManager,i=this.musicDataFlags,r=this.musicData,a=this.musicConfig,s=this.gameList,o=this.mv;return{navList:e,commonOptions_:t,modifyManager:n,musicDataFlags:i,musicData:r,musicConfig:a,gameList:s,mv:o}},computed:{commonOptions:function(){var e={},t=this.commonOptions_.list;return t.forEach((function(t){e[t.key]=t.value})),e}},mounted:function(){var e=this,t=this.musicData,n=this.musicDataFlags,i=this.musicConfig,r=this.mv;t.realTimeData.event.addEventListener("shock",(function(){n&&n.shockFlag++,i&&i.shock()})),u.t.init(void 0,{common:{spacebar:function(){return e.gameList.shootGameNode()},enter:function(){return e.gameList.shootGameNode()}}},{common:{spacebar:"消除节奏点",enter:"消除节奏点"}}),r.draw=function(t){e.draw(t)},document.addEventListener(window.isPhone?"touchmove":"mousemove",(function(e){i.handelMouseMove(e)}))},data:function(){return Sn},watch:{balanceOptions:{immediate:!0,deep:!0,handler:function(){var e=this.balanceOptions,t=this.mv;t.biquadFilters&&t.biquadFilters.forEach((function(t,n){t.gain.value=e.getVal("balance".concat(n)),t.gain.Q=1}))}}},methods:{draw:function(e){var t=e.realTimeData,n=e.originData,i=this.modifyManager,r=this.musicDataFlags,a=this.musicData,s=this.musicConfig,o=this.gameList;o.setBuffer(10*i.getTrackByName("GameTrack").getVal("RhythmPointRemoveFloatRange")),a.realTimeData.update(t),a.originData.update(n);var u=(0,c.Z)(s.currentImgAviColor,4),l=u[0],h=u[1],_=u[2],d=(u[3],a.calculateColors=C.getPure(l,h,_)),f=(0,c.Z)(d,2),p=(0,c.Z)(f[0],3),m=(p[0],p[1],p[2],(0,c.Z)(f[1],3)),v=m[0],g=m[1],y=m[2],b=a.realTimeData.soundTrackArr;this.commonOptions.gameUI&&(document.querySelector(".sound-track").innerHTML=b.map((function(e){return'<li style="'.concat(["transform: translateY(-".concat(e.vol,"px);"),"opacity: ".concat(e.isRhythmPoint?1:e.vol/256/2+.25,";"),"background-color: ".concat(e.isRhythmPoint?"rgba(".concat(255-v,",").concat(255-g,",").concat(255-y,", 1)"):"#fff",";")].join(""),'"></li>')})).join("")),r.dataFlag++}}},Nn=Un,Zn=(0,G.Z)(Nn,s,o,!1,null,"98b67e3c",null),Fn=Zn.exports,Wn={name:"App",components:{Index:Fn}},Kn=Wn,$n=(0,G.Z)(Kn,r,a,!1,null,null,null),qn=$n.exports,Vn=n(5205);(0,Vn.z)("".concat("","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});var zn=n(6071);function Hn(){return/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)}window.isPhone=Hn(),new zn.Z({render:function(e){return e(qn)}}).$mount("#app")},353:function(e,t,n){n.d(t,{h:function(){return o}});var i=n(3618),r=n(1165),a=n(6018),s=(n(6699),n(2023),n(1249),n(4747),n(5306),n(4916),n(7042),n(8967)),o=function(){function e(){(0,r.Z)(this,e)}return(0,a.Z)(e,null,[{key:"getBothAncestor",value:function(t,n){var i=t,r=n;while(i){if(e.hasChild(i,n))return i;i=i.parentNode}while(r){if(e.hasChild(r,t))return r;r=r.parentNode}}},{key:"isEmptyTag",value:function(t){return 1===t.nodeType?0===t.childNodes.length||(0,i.Z)(t.childNodes).every((function(t){return e.isEmptyTag(t)})):3===t.nodeType&&!t.textContent}},{key:"isSameTag",value:function(t,n){return!(!t||!n)&&(3===t.nodeType&&3===n.nodeType||1===t.nodeType&&1===n.nodeType&&e.isTag(t,n.tagName))}},{key:"hasChild",value:function(t,n){var r=(0,i.Z)(t.childNodes);return r.includes(n)||r.some((function(t){return e.hasChild(t,n)}))}},{key:"isChildOf",value:function(e,t){while(t){if(t.parentNode===e)return!0;t=t.parentNode}return!1}},{key:"isAncestor",value:function(e,t){while(t&&t.parentNode){if(t.parentNode===e)return!0;t=t.parentNode}return!1}},{key:"findNearestTargetParentNodeByTag",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0;t=t.map((function(e){return e.toLowerCase()}));while(e&&(!n||e===n)){var i=(e.tagName||"").toLowerCase();if(t.includes(i))return e;e=e.parentNode}}},{key:"changeTag",value:function(t,n){var r=e.node(n);return(0,i.Z)(t.childNodes).forEach((function(e){r.appendChild(e)})),e.replace(t,r),r}},{key:"remove",value:function(e){e.parentNode&&e.parentNode.removeChild(e)}},{key:"isTag",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.nodeName.toLowerCase()===t.toLowerCase()}},{key:"isParentNodeTheTargetType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e.parentNode;return n&&n.tagName.toLowerCase()===t.toLowerCase()}},{key:"node",value:function(e,t){var n=document.createElement(e);return t&&(n.innerHTML=t),n}},{key:"class",value:function(e,t){e&&(e.classList.contains(t)||e.classList.add(t))}},{key:"removeClass",value:function(e,t){e&&(e.classList.contains(t)||e.classList.remove(t))}},{key:"text",value:function(e){return document.createTextNode(e)}},{key:"list",value:function(e,t){}},{key:"insertBefore",value:function(e,t){var n=e.parentNode;n&&n.insertBefore(t,e)}},{key:"append",value:function(e,t){s.X.isArray(t)?t.forEach((function(t){e.appendChild(t)})):e.appendChild(t)}},{key:"prepend",value:function(t,n){var i=t.childNodes[0];i?e.insertBefore(i,n):t.appendChild(n)}},{key:"insertAfter",value:function(e,t){var n=e.parentNode,i=e.nextSibling;n&&(i?n.insertBefore(t,i):n.appendChild(t))}},{key:"replace",value:function(e,t){var n=e.parentNode;n&&(n.insertBefore(t,e),n.removeChild(e))}},{key:"isTagNode",value:function(e){return 1===e.nodeType}},{key:"copyEmptyTagNode",value:function(t){return e.isTagNode(t)?e.node(t.tagName):e.text("")}},{key:"findFirstTextNode",value:function(e){while(e&&1===e.nodeType){if(1===e.nodeType)return e;e=e.childNodes[0]}}},{key:"findLastTextNode",value:function(e){while(e&&1===e.nodeType){if(1===e.nodeType)return e;e=e.childNodes[e.childNodes.length-1]}}},{key:"splitTextNode",value:function(t,n,i){var r=t.textContent||"",a=r.slice(0,n||0),s=r.slice(n||0,i||void 0),o=r.slice(i||r.length),c=a&&e.text(a),u=o&&e.text(o);return c&&e.insertBefore(t,c),t.nodeValue=s,u&&e.insertAfter(t,u),[c,t,u]}}]),e}()},8967:function(e,t,n){n.d(t,{X:function(){return a}});var i=n(1165),r=n(6018),a=(n(7042),n(1539),n(6699),function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"getType",value:function(e){return Object.prototype.toString.call(e).slice(8,-1)}},{key:"isNumber",value:function(t){return"Number"===e.getType(t)}},{key:"isString",value:function(t){return"String"===e.getType(t)}},{key:"isArray",value:function(t){return"Array"===e.getType(t)}},{key:"isObject",value:function(t){return"Object"===e.getType(t)}},{key:"isBoolean",value:function(t){return"Boolean"===e.getType(t)}},{key:"isNull",value:function(t){return"Null"===e.getType(t)}},{key:"isUndefined",value:function(t){return"Undefined"===e.getType(t)}},{key:"isFunction",value:function(t){return"Function"===e.getType(t)}},{key:"isDate",value:function(t){return"Date"===e.getType(t)}},{key:"isEmpty",value:function(e){return["",void 0,null].includes(e)}}]),e}())},8556:function(e,t,n){n.d(t,{kI:function(){return u}});var i=n(1165),r=n(6018);n(9826),n(4553),n(561),n(4747);function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return e.find((function(e){return e[t]===n}))||{}}function s(e,t,n){var i=e.findIndex((function(e){return e[t]===n}));-1!==i&&e.splice(i,1)}function o(e,t,n,i){var r=e.findIndex((function(e){return e[t]===n}));t?-1!==r?e.splice(r,1,i):i&&e.push(i):e.push(i)}function c(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return e.forEach((function(e){e&&e.forEach((function(e){o(n,t,e[t],e)}))})),n}var u=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"find",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return a(e,t,n)}},{key:"findByKey",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return a(e,"key",t)}},{key:"delete",value:function(e,t,n){return s(e,t,n)}},{key:"deleteByKey",value:function(e,t){return s(e,"key",t)}},{key:"replace",value:function(e,t,n,i){return o(e,t,n,i)}},{key:"replaceByKey",value:function(e,t,n){return o(e,"key",t,n)}},{key:"concat",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return c(e,t,n)}},{key:"concatByKey",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return c(e,"key",t)}}]),e}()},2395:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{r:function(){return ShortCut},t:function(){return shortCut}});var D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(6192),D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_inherits__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(9890),D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_createSuper__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3848),D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(5416),D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(1165),D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(6018),core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4747),core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es_object_keys_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(7941),core_js_modules_es_object_keys_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es_object_keys_js__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(2222),core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es_array_join_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(9600),core_js_modules_es_array_join_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es_array_join_js__WEBPACK_IMPORTED_MODULE_4__),_GetType__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(8967),_Sound__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(5034),_tools_DomUtil__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(353),keyMap={0:"96",1:"97",2:"98",3:"99",4:"100",5:"101",6:"102",7:"103",8:"104",9:"105",a:"65",b:"66",c:"67",d:"68",e:"69",f:"70",g:"71",h:"72",i:"73",j:"74",k:"75",l:"76",m:"77",n:"78",o:"79",p:"80",q:"81",r:"82",s:"83",t:"84",u:"85",v:"86",w:"87",x:"88",y:"89",z:"90",f1:"112",f2:"113",f3:"114",f4:"115",f5:"116",f6:"117",f7:"118",f8:"119",f9:"120",f10:"121",f11:"122",f12:"123","+":"107","-":"109","*":"106","/":"111",".":"110",backspace:"8",tab:"9",clear:"12",enter:"13",esc:"27",spacebar:"32","left arrow":"37","up arrow":"38","right arrow":"39","down arrow":"40",left:"37",up:"38",right:"39",down:"40",";:":"186","<":"188","=+":"187","-_":"189",">":"190","/?":"191","`~":"192","page up":"33","page down":"34",end:"35",home:"36",insert:"45",delete:"46","cape lock":"20","num lock":"144","[{":"219","\\|":"220","]}":"221","'\"":"222",shift:"16",control:"17",alt:"18","搜索":"170","收藏":"171","浏览器":"172","音量减":"174","音量加":"175","静音":"173","停止":"179","邮件":"180"},keyMap_={};Object.keys(keyMap).forEach((function(e){keyMap_[keyMap[e]]=e}));var ShortCutAbstract=function(){function e(){(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_8__.Z)(this,e)}return(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_9__.Z)(e,[{key:"common",value:function(e,t){}},{key:"ctrl",value:function(e,t){}},{key:"alt",value:function(e,t){}},{key:"shift",value:function(e,t){}},{key:"ctrl_alt",value:function(e,t){}},{key:"ctrl_shift",value:function(e,t){}},{key:"alt_shift",value:function(e,t){}},{key:"ctrl_alt_shift",value:function(e,t){}}]),e}();function makeShortCutInitFn(e){ShortCut.prototype[e]=function(t,n){_GetType__WEBPACK_IMPORTED_MODULE_5__.X.isNumber(t)||(t=keyMap[t]||t),this.maps[e]||(this.maps[e]={}),this.maps[e][t]=function(e){_Sound__WEBPACK_IMPORTED_MODULE_6__.$.play("confirm");var t=n();t||(e.stopPropagation(),e.preventDefault())}},ShortCut.prototype["".concat(e,"Desc")]=function(t,n){_GetType__WEBPACK_IMPORTED_MODULE_5__.X.isNumber(t)||(t=keyMap[t]||t),this.describeMaps[e]||(this.describeMaps[e]={}),this.describeMaps[e][t]=n}}var requestAnimationFrame=window.requestAnimationFrame||window.webkitrequestAnimationFrame||window.mozrequestAnimationFrame,wrap=_tools_DomUtil__WEBPACK_IMPORTED_MODULE_7__.h.node("div");wrap.className="short-cut-view",_tools_DomUtil__WEBPACK_IMPORTED_MODULE_7__.h.append(document.body,wrap);var triggered=[],ShortCut=function(_ShortCutAbstract){(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_inherits__WEBPACK_IMPORTED_MODULE_10__.Z)(ShortCut,_ShortCutAbstract);var _super=(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_createSuper__WEBPACK_IMPORTED_MODULE_0__.Z)(ShortCut);function ShortCut(){var e;(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_8__.Z)(this,ShortCut);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=_super.call.apply(_super,[this].concat(n)),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_11__.Z)((0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_12__.Z)(e),"hasInited",!1),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_11__.Z)((0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_12__.Z)(e),"maps",{}),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_11__.Z)((0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_12__.Z)(e),"describeMaps",{}),e}return(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_9__.Z)(ShortCut,[{key:"init",value:function init(dom){var _this2=this,fns=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},describeMaps=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},slef=this,$body=dom||document.querySelector("body");this.hasInited||$body.addEventListener("keydown",(function(ev){var keys=[],key="";ev.ctrlKey&&keys.push("ctrl"),ev.altKey&&keys.push("alt"),ev.shiftKey&&keys.push("shift"),key=keys.join("")||"",keys.push(keyMap_[ev.which]);var describeMaps_=_this2.describeMaps[key||"common"]||{};keys.push(describeMaps_[ev.which]||"暂无描述，待补充");var cmd="slef.maps.".concat(key||"common","[").concat(ev.which,"](ev)");try{eval(cmd),ShortCut.cacheTriggered(keys)}catch(e){}})),fns&&_GetType__WEBPACK_IMPORTED_MODULE_5__.X.isObject(fns)&&Object.keys(fns).forEach((function(e){fns[e]&&Object.keys(fns[e]).forEach((function(t){return _this2[e](t,fns[e][t])}))})),describeMaps&&_GetType__WEBPACK_IMPORTED_MODULE_5__.X.isObject(describeMaps)&&Object.keys(describeMaps).forEach((function(e){describeMaps[e]&&Object.keys(describeMaps[e]).forEach((function(t){return _this2["".concat(e,"Desc")](t,describeMaps[e][t])}))})),this.hasInited=!0}}],[{key:"toast",value:function(e){var t=_tools_DomUtil__WEBPACK_IMPORTED_MODULE_7__.h.node("div");e.forEach((function(e){_tools_DomUtil__WEBPACK_IMPORTED_MODULE_7__.h.append(t,_tools_DomUtil__WEBPACK_IMPORTED_MODULE_7__.h.node("span",e.toUpperCase()))})),_tools_DomUtil__WEBPACK_IMPORTED_MODULE_7__.h.prepend(wrap,t),requestAnimationFrame((function(){requestAnimationFrame((function(){_tools_DomUtil__WEBPACK_IMPORTED_MODULE_7__.h.class(t,"active"),setTimeout((function(){_tools_DomUtil__WEBPACK_IMPORTED_MODULE_7__.h.class(t,"hide"),setTimeout((function(){requestAnimationFrame((function(){return _tools_DomUtil__WEBPACK_IMPORTED_MODULE_7__.h.remove(t)}))}),2e3)}),1e3)}))}))}},{key:"cacheTriggered",value:function(e){var t=ShortCut.triggered,n=ShortCut.triggeredCacheLength,i=t[0];i&&e.every((function(e,t){return i[t]===e}))||(t.unshift(e),ShortCut.toast(e),t.length>n&&t.pop())}}]),ShortCut}(ShortCutAbstract);(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_11__.Z)(ShortCut,"triggeredCacheLength",20),(0,D_workspace_dy_player_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_11__.Z)(ShortCut,"triggered",triggered),["common","ctrl","alt","shift","ctrl_alt","ctrl_shift","alt_shift","ctrl_alt_shift"].forEach(makeShortCutInitFn);var shortCut=new ShortCut;shortCut.init()},5034:function(e,t,n){n.d(t,{$:function(){return u}});var i=n(1165),r=n(6018),a=n(5416),s={change:"./sound/change.mp3",confirm:"./sound/confirm.mp3",done:"./sound/done.mp3",warning:"./sound/warning.mp3"},o=function(){function e(){(0,i.Z)(this,e),(0,a.Z)(this,"list",void 0),this.list=[]}return(0,r.Z)(e,[{key:"getAudio",value:function(){var e=this,t=this.list.shift(),n=function(){t&&e.list.push(t)};if(!t){t=document.createElement("audio"),t.volume=.2,t.autoplay="autoplay";var i=document.querySelector("body");i&&i.appendChild(t),t.addEventListener("ended",n),t.addEventListener("error",n)}return t}}]),e}(),c=new o,u=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"play",value:function(e){var t=c.getAudio(),n={change:.01,confirm:.01,done:.2,warning:.01};t.volume=n[e]||.1,t.src=s[e]||e}}]),e}()}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](n,n.exports,__webpack_require__),n.exports}__webpack_require__.m=__webpack_modules__,function(){var e=[];__webpack_require__.O=function(t,n,i,r){if(!n){var a=1/0;for(c=0;c<e.length;c++){n=e[c][0],i=e[c][1],r=e[c][2];for(var s=!0,o=0;o<n.length;o++)(!1&r||a>=r)&&Object.keys(__webpack_require__.O).every((function(e){return __webpack_require__.O[e](n[o])}))?n.splice(o--,1):(s=!1,r<a&&(a=r));s&&(e.splice(c--,1),t=i())}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[n,i,r]}}(),function(){__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return __webpack_require__.d(t,{a:t}),t}}(),function(){__webpack_require__.d=function(e,t){for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){__webpack_require__.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){__webpack_require__.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};__webpack_require__.O.j=function(t){return 0===e[t]};var t=function(t,n){var i,r,a=n[0],s=n[1],o=n[2],c=0;for(i in s)__webpack_require__.o(s,i)&&(__webpack_require__.m[i]=s[i]);for(o&&o(__webpack_require__),t&&t(n);c<a.length;c++)r=a[c],__webpack_require__.o(e,r)&&e[r]&&e[r][0](),e[a[c]]=0;__webpack_require__.O()},n=self["webpackChunkdy_player"]=self["webpackChunkdy_player"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var __webpack_exports__=__webpack_require__.O(void 0,[998],(function(){return __webpack_require__(7676)}));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();
//# sourceMappingURL=app.6d71ac64.js.map